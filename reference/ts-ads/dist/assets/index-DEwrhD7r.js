const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CoKPUul2.js","assets/second-manager-B9sUP_Kf.js","assets/index-BH7afBP2.css","assets/index-BoEwlzj5.js","assets/index-D370PFVR.css"])))=>i.map(i=>d[i]);
var du=Object.defineProperty;var uu=(t,e,n)=>e in t?du(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var C=(t,e,n)=>uu(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();function Ai(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(n[s[i]]=t[s[i]]);return n}function hu(t,e,n,s){function i(a){return a instanceof n?a:new n(function(r){r(a)})}return new(n||(n=Promise))(function(a,r){function o(d){try{c(s.next(d))}catch(u){r(u)}}function l(d){try{c(s.throw(d))}catch(u){r(u)}}function c(d){d.done?a(d.value):i(d.value).then(o,l)}c((s=s.apply(t,e||[])).next())})}const fu=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class Va extends Error{constructor(e,n="FunctionsError",s){super(e),this.name=n,this.context=s}}class gu extends Va{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Dr extends Va{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ir extends Va{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ma;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(ma||(ma={}));class pu{constructor(e,{headers:n={},customFetch:s,region:i=ma.Any}={}){this.url=e,this.headers=n,this.region=i,this.fetch=fu(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return hu(this,arguments,void 0,function*(n,s={}){var i;let a,r;try{const{headers:o,method:l,body:c,signal:d,timeout:u}=s;let h={},{region:f}=s;f||(f=this.region);const p=new URL(`${this.url}/${n}`);f&&f!=="any"&&(h["x-region"]=f,p.searchParams.set("forceFunctionRegion",f));let g;c&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",g=c):typeof c=="string"?(h["Content-Type"]="text/plain",g=c):typeof FormData<"u"&&c instanceof FormData?g=c:(h["Content-Type"]="application/json",g=JSON.stringify(c)):c&&typeof c!="string"&&!(typeof Blob<"u"&&c instanceof Blob)&&!(c instanceof ArrayBuffer)&&!(typeof FormData<"u"&&c instanceof FormData)?g=JSON.stringify(c):g=c;let m=d;u&&(r=new AbortController,a=setTimeout(()=>r.abort(),u),d?(m=r.signal,d.addEventListener("abort",()=>r.abort())):m=r.signal);const _=yield this.fetch(p.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),o),body:g,signal:m}).catch(w=>{throw new gu(w)}),y=_.headers.get("x-relay-error");if(y&&y==="true")throw new Dr(_);if(!_.ok)throw new Ir(_);let b=((i=_.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),v;return b==="application/json"?v=yield _.json():b==="application/octet-stream"||b==="application/pdf"?v=yield _.blob():b==="text/event-stream"?v=_:b==="multipart/form-data"?v=yield _.formData():v=yield _.text(),{data:v,error:null,response:_}}catch(o){return{data:null,error:o,response:o instanceof Ir||o instanceof Dr?o.context:void 0}}finally{a&&clearTimeout(a)}})}}var mu=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},_u=class{constructor(t){var e,n,s;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,this.urlLengthLimit=(s=t.urlLengthLimit)!==null&&s!==void 0?s:8e3,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{let r=null,o=null,l=null,c=a.status,d=a.statusText;if(a.ok){var u,h;if(n.method!=="HEAD"){var f;const _=await a.text();_===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((f=n.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?o=_:o=JSON.parse(_))}const g=(u=n.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),m=(h=a.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");g&&m&&m.length>1&&(l=parseInt(m[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(o)&&(o.length>1?(r={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,l=null,c=406,d="Not Acceptable"):o.length===1?o=o[0]:o=null)}else{var p;const g=await a.text();try{r=JSON.parse(g),Array.isArray(r)&&a.status===404&&(o=[],r=null,c=200,d="OK")}catch{a.status===404&&g===""?(c=204,d="No Content"):r={message:g}}if(r&&n.isMaybeSingle&&(!(r==null||(p=r.details)===null||p===void 0)&&p.includes("0 rows"))&&(r=null,c=200,d="OK"),r&&n.shouldThrowOnError)throw new mu(r)}return{error:r,data:o,count:l,status:c,statusText:d}});return this.shouldThrowOnError||(i=i.catch(a=>{var r;let o="",l="",c="";const d=a==null?void 0:a.cause;if(d){var u,h,f,p;const _=(u=d==null?void 0:d.message)!==null&&u!==void 0?u:"",y=(h=d==null?void 0:d.code)!==null&&h!==void 0?h:"";o=`${(f=a==null?void 0:a.name)!==null&&f!==void 0?f:"FetchError"}: ${a==null?void 0:a.message}`,o+=`

Caused by: ${(p=d==null?void 0:d.name)!==null&&p!==void 0?p:"Error"}: ${_}`,y&&(o+=` (${y})`),d!=null&&d.stack&&(o+=`
${d.stack}`)}else{var g;o=(g=a==null?void 0:a.stack)!==null&&g!==void 0?g:""}const m=this.url.toString().length;return(a==null?void 0:a.name)==="AbortError"||(a==null?void 0:a.code)==="ABORT_ERR"?(c="",l="Request was aborted (timeout or manual cancellation)",m>this.urlLengthLimit&&(l+=`. Note: Your request URL is ${m} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((d==null?void 0:d.name)==="HeadersOverflowError"||(d==null?void 0:d.code)==="UND_ERR_HEADERS_OVERFLOW")&&(c="",l="HTTP headers exceeded server limits (typically 16KB)",m>this.urlLengthLimit&&(l+=`. Your request URL is ${m} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(r=a==null?void 0:a.name)!==null&&r!==void 0?r:"FetchError"}: ${a==null?void 0:a.message}`,details:o,hint:l,code:c},data:null,count:null,status:0,statusText:""}})),i.then(t,e)}returns(){return this}overrideTypes(){return this}},yu=class extends _u{select(t){let e=!1;const n=(t??"*").split("").map(s=>/\s/.test(s)&&!e?"":(s==='"'&&(e=!e),s)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:s,referencedTable:i=s}={}){const a=i?`${i}.order`:"order",r=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${r?`${r},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:s=n}={}){const i=typeof s>"u"?"offset":`${s}.offset`,a=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${t}`),this.url.searchParams.set(a,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:s=!1,wal:i=!1,format:a="text"}={}){var r;const o=[t?"analyze":null,e?"verbose":null,n?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=(r=this.headers.get("Accept"))!==null&&r!==void 0?r:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${a}; for="${l}"; options=${o};`),a==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const Lr=new RegExp("[,()]");var Zt=class extends yu{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(s=>typeof s=="string"&&Lr.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(s=>typeof s=="string"&&Lr.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const a=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${i}fts${a}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},bu=class{constructor(t,{headers:e={},schema:n,fetch:s,urlLengthLimit:i=8e3}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=s,this.urlLengthLimit=i}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:n=!1,count:s}=e??{},i=n?"HEAD":"GET";let a=!1;const r=(t??"*").split("").map(c=>/\s/.test(c)&&!a?"":(c==='"'&&(a=!a),c)).join(""),{url:o,headers:l}=this.cloneRequestState();return o.searchParams.set("select",r),s&&l.append("Prefer",`count=${s}`),new Zt({method:i,url:o,headers:l,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(t,{count:e,defaultToNull:n=!0}={}){var s;const i="POST",{url:a,headers:r}=this.cloneRequestState();if(e&&r.append("Prefer",`count=${e}`),n||r.append("Prefer","missing=default"),Array.isArray(t)){const o=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);a.searchParams.set("columns",l.join(","))}}return new Zt({method:i,url:a,headers:r,schema:this.schema,body:t,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:s,defaultToNull:i=!0}={}){var a;const r="POST",{url:o,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&o.searchParams.set("on_conflict",e),s&&l.append("Prefer",`count=${s}`),i||l.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);o.searchParams.set("columns",d.join(","))}}return new Zt({method:r,url:o,headers:l,schema:this.schema,body:t,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch,urlLengthLimit:this.urlLengthLimit})}update(t,{count:e}={}){var n;const s="PATCH",{url:i,headers:a}=this.cloneRequestState();return e&&a.append("Prefer",`count=${e}`),new Zt({method:s,url:i,headers:a,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:t}={}){var e;const n="DELETE",{url:s,headers:i}=this.cloneRequestState();return t&&i.append("Prefer",`count=${t}`),new Zt({method:n,url:s,headers:i,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function Qn(t){"@babel/helpers - typeof";return Qn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qn(t)}function vu(t,e){if(Qn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(Qn(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function wu(t){var e=vu(t,"string");return Qn(e)=="symbol"?e:e+""}function ku(t,e,n){return(e=wu(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Or(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,s)}return n}function ws(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Or(Object(n),!0).forEach(function(s){ku(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Or(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var Su=class Hl{constructor(e,{headers:n={},schema:s,fetch:i,timeout:a,urlLengthLimit:r=8e3}={}){this.url=e,this.headers=new Headers(n),this.schemaName=s,this.urlLengthLimit=r;const o=i??globalThis.fetch;a!==void 0&&a>0?this.fetch=(l,c)=>{const d=new AbortController,u=setTimeout(()=>d.abort(),a),h=c==null?void 0:c.signal;if(h){if(h.aborted)return clearTimeout(u),o(l,c);const f=()=>{clearTimeout(u),d.abort()};return h.addEventListener("abort",f,{once:!0}),o(l,ws(ws({},c),{},{signal:d.signal})).finally(()=>{clearTimeout(u),h.removeEventListener("abort",f)})}return o(l,ws(ws({},c),{},{signal:d.signal})).finally(()=>clearTimeout(u))}:this.fetch=o}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new bu(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new Hl(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,n={},{head:s=!1,get:i=!1,count:a}={}){var r;let o;const l=new URL(`${this.url}/rpc/${e}`);let c;const d=f=>f!==null&&typeof f=="object"&&(!Array.isArray(f)||f.some(d)),u=s&&Object.values(n).some(d);u?(o="POST",c=n):s||i?(o=s?"HEAD":"GET",Object.entries(n).filter(([f,p])=>p!==void 0).map(([f,p])=>[f,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([f,p])=>{l.searchParams.append(f,p)})):(o="POST",c=n);const h=new Headers(this.headers);return u?h.set("Prefer",a?`count=${a},return=minimal`:"return=minimal"):a&&h.set("Prefer",`count=${a}`),new Zt({method:o,url:l,headers:h,schema:this.schemaName,body:c,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}};class xu{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const n=globalThis.process;if(n){const s=n.versions;if(s&&s.node){const i=s.node,a=parseInt(i.replace(/^v/,"").split(".")[0]);return a>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${a} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${a} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const s=this.getWebSocketConstructor();return new s(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Cu="2.95.3",Eu=`realtime-js/${Cu}`,Au="1.0.0",Ul="2.0.0",Pr=Ul,_a=1e4,Mu=1e3,Tu=100;var lt;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(lt||(lt={}));var le;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(le||(le={}));var $e;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})($e||($e={}));var ya;(function(t){t.websocket="websocket"})(ya||(ya={}));var Mt;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Mt||(Mt={}));class Ru{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,s;const i=(s=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,i)}_encodeJsonUserBroadcastPush(e){var n,s;const i=(s=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&s!==void 0?s:{},r=new TextEncoder().encode(JSON.stringify(i)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,r)}_encodeUserBroadcastPush(e,n,s){var i,a;const r=e.topic,o=(i=e.ref)!==null&&i!==void 0?i:"",l=(a=e.join_ref)!==null&&a!==void 0?a:"",c=e.payload.event,d=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},u=Object.keys(d).length===0?"":JSON.stringify(d);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`ref length ${o.length} exceeds maximum of 255`);if(r.length>255)throw new Error(`topic length ${r.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`metadata length ${u.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+o.length+r.length+c.length+u.length,f=new ArrayBuffer(this.HEADER_LENGTH+h);let p=new DataView(f),g=0;p.setUint8(g++,this.KINDS.userBroadcastPush),p.setUint8(g++,l.length),p.setUint8(g++,o.length),p.setUint8(g++,r.length),p.setUint8(g++,c.length),p.setUint8(g++,u.length),p.setUint8(g++,n),Array.from(l,_=>p.setUint8(g++,_.charCodeAt(0))),Array.from(o,_=>p.setUint8(g++,_.charCodeAt(0))),Array.from(r,_=>p.setUint8(g++,_.charCodeAt(0))),Array.from(c,_=>p.setUint8(g++,_.charCodeAt(0))),Array.from(u,_=>p.setUint8(g++,_.charCodeAt(0)));var m=new Uint8Array(f.byteLength+s.byteLength);return m.set(new Uint8Array(f),0),m.set(new Uint8Array(s),f.byteLength),m.buffer}decode(e,n){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return n(s)}if(typeof e=="string"){const s=JSON.parse(e),[i,a,r,o,l]=s;return n({join_ref:i,ref:a,topic:r,event:o,payload:l})}return n({})}_binaryDecode(e){const n=new DataView(e),s=n.getUint8(0),i=new TextDecoder;switch(s){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,i)}}_decodeUserBroadcast(e,n,s){const i=n.getUint8(1),a=n.getUint8(2),r=n.getUint8(3),o=n.getUint8(4);let l=this.HEADER_LENGTH+4;const c=s.decode(e.slice(l,l+i));l=l+i;const d=s.decode(e.slice(l,l+a));l=l+a;const u=s.decode(e.slice(l,l+r));l=l+r;const h=e.slice(l,e.byteLength),f=o===this.JSON_ENCODING?JSON.parse(s.decode(h)):h,p={type:this.BROADCAST_EVENT,event:d,payload:f};return r>0&&(p.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:p}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([s])=>n.includes(s)))}}class ql{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var z;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(z||(z={}));const $r=(t,e,n={})=>{var s;const i=(s=n.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((a,r)=>(a[r]=Du(r,t,e,i),a),{}):{}},Du=(t,e,n,s)=>{const i=e.find(o=>o.name===t),a=i==null?void 0:i.type,r=n[t];return a&&!s.includes(a)?Vl(a,r):ba(r)},Vl=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return Pu(e,n)}switch(t){case z.bool:return Iu(e);case z.float4:case z.float8:case z.int2:case z.int4:case z.int8:case z.numeric:case z.oid:return Lu(e);case z.json:case z.jsonb:return Ou(e);case z.timestamp:return $u(e);case z.abstime:case z.date:case z.daterange:case z.int4range:case z.int8range:case z.money:case z.reltime:case z.text:case z.time:case z.timestamptz:case z.timetz:case z.tsrange:case z.tstzrange:return ba(e);default:return ba(e)}},ba=t=>t,Iu=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Lu=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},Ou=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},Pu=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,s=t[n];if(t[0]==="{"&&s==="}"){let a;const r=t.slice(1,n);try{a=JSON.parse("["+r+"]")}catch{a=r?r.split(","):[]}return a.map(o=>Vl(e,o))}return t},$u=t=>typeof t=="string"?t.replace(" ","T"):t,zl=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Ki{constructor(e,n,s={},i=_a){this.channel=e,this.event=n,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var s;return this._hasReceived(e)&&n((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Nr;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Nr||(Nr={}));class Wn{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:a,onLeave:r,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Wn.syncState(this.state,i,a,r),this.pendingDiffs.forEach(l=>{this.state=Wn.syncDiff(this.state,l,a,r)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},i=>{const{onJoin:a,onLeave:r,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Wn.syncDiff(this.state,i,a,r),o())}),this.onJoin((i,a,r)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:a,newPresences:r})}),this.onLeave((i,a,r)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:a,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,s,i){const a=this.cloneDeep(e),r=this.transformState(n),o={},l={};return this.map(a,(c,d)=>{r[c]||(l[c]=d)}),this.map(r,(c,d)=>{const u=a[c];if(u){const h=d.map(m=>m.presence_ref),f=u.map(m=>m.presence_ref),p=d.filter(m=>f.indexOf(m.presence_ref)<0),g=u.filter(m=>h.indexOf(m.presence_ref)<0);p.length>0&&(o[c]=p),g.length>0&&(l[c]=g)}else o[c]=d}),this.syncDiff(a,{joins:o,leaves:l},s,i)}static syncDiff(e,n,s,i){const{joins:a,leaves:r}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(a,(o,l)=>{var c;const d=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(l),d.length>0){const u=e[o].map(f=>f.presence_ref),h=d.filter(f=>u.indexOf(f.presence_ref)<0);e[o].unshift(...h)}s(o,d,l)}),this.map(r,(o,l)=>{let c=e[o];if(!c)return;const d=l.map(u=>u.presence_ref);c=c.filter(u=>d.indexOf(u.presence_ref)<0),e[o]=c,i(o,c,l),c.length===0&&delete e[o]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(s=>n(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,s)=>{const i=e[s];return"metas"in i?n[s]=i.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):n[s]=i,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Br;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Br||(Br={}));var Gn;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Gn||(Gn={}));var Qe;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Qe||(Qe={}));class nn{constructor(e,n={config:{}},s){var i,a;if(this.topic=e,this.params=n,this.socket=s,this.bindings={},this.state=le.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Ki(this,$e.join,this.params,this.timeout),this.rejoinTimer=new ql(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=le.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(r=>r.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=le.closed,this.socket._remove(this)}),this._onError(r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=le.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=le.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=le.errored,this.rejoinTimer.scheduleTimeout())}),this._on($e.reply,{},(r,o)=>{this._trigger(this._replyEventName(o),r)}),this.presence=new Wn(this),this.broadcastEndpointURL=zl(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((a=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||a===void 0)&&a.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var s,i,a;if(this.socket.isConnected()||this.socket.connect(),this.state==le.closed){const{config:{broadcast:r,presence:o,private:l}}=this.params,c=(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(f=>f.filter))!==null&&i!==void 0?i:[],d=!!this.bindings[Gn.PRESENCE]&&this.bindings[Gn.PRESENCE].length>0||((a=this.params.config.presence)===null||a===void 0?void 0:a.enabled)===!0,u={},h={broadcast:r,presence:Object.assign(Object.assign({},o),{enabled:d}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(f=>e==null?void 0:e(Qe.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(Qe.CLOSED)),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:f})=>{var p;if(this.socket._isManualToken()||this.socket.setAuth(),f===void 0){e==null||e(Qe.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,m=(p=g==null?void 0:g.length)!==null&&p!==void 0?p:0,_=[];for(let y=0;y<m;y++){const b=g[y],{filter:{event:v,schema:w,table:k,filter:S}}=b,x=f&&f[y];if(x&&x.event===v&&nn.isFilterValueEqual(x.schema,w)&&nn.isFilterValueEqual(x.table,k)&&nn.isFilterValueEqual(x.filter,S))_.push(Object.assign(Object.assign({},b),{id:x.id}));else{this.unsubscribe(),this.state=le.errored,e==null||e(Qe.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=_,e&&e(Qe.SUBSCRIBED);return}}).receive("error",f=>{this.state=le.errored,e==null||e(Qe.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Qe.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,s){return this.state===le.joined&&e===Gn.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,s)}async httpSend(e,n,s={}){var i;if(n==null)return Promise.reject("Payload is required for httpSend()");const a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const r={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,r,(i=s.timeout)!==null&&i!==void 0?i:this.timeout);if(o.status===202)return{success:!0};let l=o.statusText;try{const c=await o.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,n={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:a,payload:r}=e,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:r,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=c.body)===null||i===void 0?void 0:i.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var r,o,l;const c=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(r=this.params)===null||r===void 0?void 0:r.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&a("ok"),c.receive("ok",()=>a("ok")),c.receive("error",()=>a("error")),c.receive("timeout",()=>a("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=le.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger($e.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(i=>{s=new Ki(this,$e.leave,{},e),s.receive("ok",()=>{n(),i("ok")}).receive("timeout",()=>{n(),i("timed out")}).receive("error",()=>{i("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=le.closed,this.bindings={}}async _fetchWithTimeout(e,n,s){const i=new AbortController,a=setTimeout(()=>i.abort(),s),r=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:i.signal}));return clearTimeout(a),r}_push(e,n,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Ki(this,e,n,s);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Tu){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,s){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,s){var i,a;const r=e.toLocaleLowerCase(),{close:o,error:l,leave:c,join:d}=$e;if(s&&[o,l,c,d].indexOf(r)>=0&&s!==this._joinRef())return;let h=this._onMessage(r,n,s);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(r)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(f=>{var p,g,m;return((p=f.filter)===null||p===void 0?void 0:p.event)==="*"||((m=(g=f.filter)===null||g===void 0?void 0:g.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===r}).map(f=>f.callback(h,s)):(a=this.bindings[r])===null||a===void 0||a.filter(f=>{var p,g,m,_,y,b;if(["broadcast","presence","postgres_changes"].includes(r))if("id"in f){const v=f.id,w=(p=f.filter)===null||p===void 0?void 0:p.event;return v&&((g=n.ids)===null||g===void 0?void 0:g.includes(v))&&(w==="*"||(w==null?void 0:w.toLocaleLowerCase())===((m=n.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const v=(y=(_=f==null?void 0:f.filter)===null||_===void 0?void 0:_.event)===null||y===void 0?void 0:y.toLocaleLowerCase();return v==="*"||v===((b=n==null?void 0:n.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===r}).map(f=>{if(typeof h=="object"&&"ids"in h){const p=h.data,{schema:g,table:m,commit_timestamp:_,type:y,errors:b}=p;h=Object.assign(Object.assign({},{schema:g,table:m,commit_timestamp:_,eventType:y,new:{},old:{},errors:b}),this._getPayloadRecords(p))}f.callback(h,s)})}_isClosed(){return this.state===le.closed}_isJoined(){return this.state===le.joined}_isJoining(){return this.state===le.joining}_isLeaving(){return this.state===le.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,s){const i=e.toLocaleLowerCase(),a={type:i,filter:n,callback:s};return this.bindings[i]?this.bindings[i].push(a):this.bindings[i]=[a],this}_off(e,n){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(i=>{var a;return!(((a=i.type)===null||a===void 0?void 0:a.toLocaleLowerCase())===s&&nn.isEqual(i.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const s in e)if(e[s]!==n[s])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on($e.close,{},e)}_onError(e){this._on($e.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=le.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=$r(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=$r(e.columns,e.old_record)),n}}const Yi=()=>{},ks={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Nu=[1e3,2e3,5e3,1e4],Bu=1e4,ju=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Fu{constructor(e,n){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=_a,this.transport=null,this.heartbeatIntervalMs=ks.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Yi,this.ref=0,this.reconnectTimer=null,this.vsn=Pr,this.logger=Yi,this.conn=null,this.sendBuffer=[],this.serializer=new Ru,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=i=>i?(...a)=>i(...a):(...a)=>fetch(...a),!(!((s=n==null?void 0:n.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${ya.websocket}`,this.httpEndpoint=zl(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=xu.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return n==="ok"&&this._remove(e),this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,s){this.logger(e,n,s)}connectionState(){switch(this.conn&&this.conn.readyState){case lt.connecting:return Mt.Connecting;case lt.open:return Mt.Open;case lt.closing:return Mt.Closing;default:return Mt.Closed}}isConnected(){return this.connectionState()===Mt.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const s=`realtime:${e}`,i=this.getChannels().find(a=>a.topic===s);if(i)return i;{const a=new nn(`realtime:${e}`,n,this);return this.channels.push(a),a}}push(e){const{topic:n,event:s,payload:i,ref:a}=e,r=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${n} ${s} (${a})`,i),this.isConnected()?r():this.sendBuffer.push(r)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Mu,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},ks.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply"&&n.ref&&n.ref===this.pendingHeartbeatRef){const c=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error",c)}catch(d){this.log("error","error in heartbeat callback",d)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:s,event:i,payload:a,ref:r}=n,o=r?`(${r})`:"",l=a.status||"";this.log("receive",`${l} ${s} ${i} ${o}`.trim(),a),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(i,a,r)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===lt.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===lt.open||this.conn.readyState===lt.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(n){this.log("error","error in heartbeat callback",n)}}_triggerChanError(){this.channels.forEach(e=>e._trigger($e.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(n);return`${e}${s}${i}`}_workerObjectUrl(e){let n;if(e)n=e;else{const s=new Blob([ju],{type:"application/javascript"});n=URL.createObjectURL(s)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,s=!1;if(e)n=e,s=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),n=this.accessTokenValue}else n=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(i=>{const a={access_token:n,version:Eu};n&&i.updateJoinPayload(a),i.joinedOnce&&i._isJoined()&&i._push($e.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(n)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new ql(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ks.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,s,i,a,r,o,l,c,d,u,h,f;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(s=e==null?void 0:e.timeout)!==null&&s!==void 0?s:_a,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:ks.HEARTBEAT_INTERVAL,this.worker=(a=e==null?void 0:e.worker)!==null&&a!==void 0?a:!1,this.accessToken=(r=e==null?void 0:e.accessToken)!==null&&r!==void 0?r:null,this.heartbeatCallback=(o=e==null?void 0:e.heartbeatCallback)!==null&&o!==void 0?o:Yi,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:Pr,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:p=>Nu[p-1]||Bu,this.vsn){case Au:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:(p,g)=>g(JSON.stringify(p)),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:(p,g)=>g(JSON.parse(p));break;case Ul:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var Zn=class extends Error{constructor(t,e){var n;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((n=e.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Wu(t,e,n){const s=new URL(e,t);if(n)for(const[i,a]of Object.entries(n))a!==void 0&&s.searchParams.set(i,a);return s.toString()}async function Gu(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function Hu(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:s,query:i,body:a,headers:r}){const o=Wu(t.baseUrl,s,i),l=await Gu(t.auth),c=await e(o,{method:n,headers:{...a?{"Content-Type":"application/json"}:{},...l,...r},body:a?JSON.stringify(a):void 0}),d=await c.text(),u=(c.headers.get("content-type")||"").includes("application/json"),h=u&&d?JSON.parse(d):d;if(!c.ok){const f=u?h:void 0,p=f==null?void 0:f.error;throw new Zn((p==null?void 0:p.message)??`Request failed with status ${c.status}`,{status:c.status,icebergType:p==null?void 0:p.type,icebergCode:p==null?void 0:p.code,details:f})}return{status:c.status,headers:c.headers,data:h}}}}function Ss(t){return t.join("")}var Uu=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:Ss(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ss(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ss(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ss(t.namespace)}`}),!0}catch(e){if(e instanceof Zn&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof Zn&&n.status===409)return;throw n}}};function Ut(t){return t.join("")}var qu=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ut(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ut(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ut(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ut(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ut(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ut(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof Zn&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof Zn&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},Vu=class{constructor(t){var s;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=Hu({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(s=t.accessDelegation)==null?void 0:s.join(","),this.namespaceOps=new Uu(this.client,e),this.tableOps=new qu(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},Mi=class extends Error{constructor(t,e="storage",n,s){super(t),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=n,this.statusCode=s}};function Ti(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var xs=class extends Mi{constructor(t,e,n,s="storage"){super(t,s,e,n),this.name=s==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Kl=class extends Mi{constructor(t,e,n="storage"){super(t,n),this.name=n==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const zu=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Ku=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},va=t=>{if(Array.isArray(t))return t.map(n=>va(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,s])=>{const i=n.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""));e[i]=va(s)}),e},Yu=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function es(t){"@babel/helpers - typeof";return es=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},es(t)}function Ju(t,e){if(es(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(es(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Xu(t){var e=Ju(t,"string");return es(e)=="symbol"?e:e+""}function Qu(t,e,n){return(e=Xu(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,s)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?jr(Object(n),!0).forEach(function(s){Qu(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}const Fr=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},Zu=async(t,e,n,s)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const i=t,a=i.status||500;if(typeof i.json=="function")i.json().then(r=>{const o=(r==null?void 0:r.statusCode)||(r==null?void 0:r.code)||a+"";e(new xs(Fr(r),a,o,s))}).catch(()=>{if(s==="vectors"){const r=a+"";e(new xs(i.statusText||`HTTP ${a} error`,a,r,s))}else{const r=a+"";e(new xs(i.statusText||`HTTP ${a} error`,a,r,s))}});else{const r=a+"";e(new xs(i.statusText||`HTTP ${a} error`,a,r,s))}}else e(new Kl(Fr(t),t,s))},eh=(t,e,n,s)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||t==="HEAD"||!s?I(I({},i),n):(Ku(s)?(i.headers=I({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(s)):i.body=s,e!=null&&e.duplex&&(i.duplex=e.duplex),I(I({},i),n))};async function kn(t,e,n,s,i,a,r){return new Promise((o,l)=>{t(n,eh(e,s,i,a)).then(c=>{if(!c.ok)throw c;if(s!=null&&s.noResolveJson)return c;if(r==="vectors"){const d=c.headers.get("content-type");if(c.headers.get("content-length")==="0"||c.status===204)return{};if(!d||!d.includes("application/json"))return{}}return c.json()}).then(c=>o(c)).catch(c=>Zu(c,l,s,r))})}function Yl(t="storage"){return{get:async(e,n,s,i)=>kn(e,"GET",n,s,i,void 0,t),post:async(e,n,s,i,a)=>kn(e,"POST",n,i,a,s,t),put:async(e,n,s,i,a)=>kn(e,"PUT",n,i,a,s,t),head:async(e,n,s,i)=>kn(e,"HEAD",n,I(I({},s),{},{noResolveJson:!0}),i,void 0,t),remove:async(e,n,s,i,a)=>kn(e,"DELETE",n,i,a,s,t)}}const th=Yl("storage"),{get:ts,post:Pe,put:wa,head:nh,remove:za}=th,De=Yl("vectors");var gn=class{constructor(t,e={},n,s="storage"){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.fetch=zu(n),this.namespace=s}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(t){var e=this;try{return{data:await t(),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ti(n))return{data:null,error:n};throw n}}},sh=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Ti(e))return{data:null,error:e};throw e}}};let Jl;Jl=Symbol.toStringTag;var ih=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[Jl]="BlobDownloadBuilder",this.promise=null}asStream(){return new sh(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Ti(e))return{data:null,error:e};throw e}}};const ah={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Wr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var rh=class extends gn{constructor(t,e={},n,s){super(t,e,s,"storage"),this.bucketId=n}async uploadOrUpdate(t,e,n,s){var i=this;return i.handleOperation(async()=>{let a;const r=I(I({},Wr),s);let o=I(I({},i.headers),t==="POST"&&{"x-upsert":String(r.upsert)});const l=r.metadata;typeof Blob<"u"&&n instanceof Blob?(a=new FormData,a.append("cacheControl",r.cacheControl),l&&a.append("metadata",i.encodeMetadata(l)),a.append("",n)):typeof FormData<"u"&&n instanceof FormData?(a=n,a.has("cacheControl")||a.append("cacheControl",r.cacheControl),l&&!a.has("metadata")&&a.append("metadata",i.encodeMetadata(l))):(a=n,o["cache-control"]=`max-age=${r.cacheControl}`,o["content-type"]=r.contentType,l&&(o["x-metadata"]=i.toBase64(i.encodeMetadata(l))),(typeof ReadableStream<"u"&&a instanceof ReadableStream||a&&typeof a=="object"&&"pipe"in a&&typeof a.pipe=="function")&&!r.duplex&&(r.duplex="half")),s!=null&&s.headers&&(o=I(I({},o),s.headers));const c=i._removeEmptyFolders(e),d=i._getFinalPath(c),u=await(t=="PUT"?wa:Pe)(i.fetch,`${i.url}/object/${d}`,a,I({headers:o},r!=null&&r.duplex?{duplex:r.duplex}:{}));return{path:c,id:u.Id,fullPath:u.Key}})}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,s){var i=this;const a=i._removeEmptyFolders(t),r=i._getFinalPath(a),o=new URL(i.url+`/object/upload/sign/${r}`);return o.searchParams.set("token",e),i.handleOperation(async()=>{let l;const c=I({upsert:Wr.upsert},s),d=I(I({},i.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType),{path:a,fullPath:(await wa(i.fetch,o.toString(),l,{headers:d})).Key}})}async createSignedUploadUrl(t,e){var n=this;return n.handleOperation(async()=>{let s=n._getFinalPath(t);const i=I({},n.headers);e!=null&&e.upsert&&(i["x-upsert"]="true");const a=await Pe(n.fetch,`${n.url}/object/upload/sign/${s}`,{},{headers:i}),r=new URL(n.url+a.url),o=r.searchParams.get("token");if(!o)throw new Mi("No token returned by API");return{signedUrl:r.toString(),path:t,token:o}})}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var s=this;return s.handleOperation(async()=>await Pe(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:s.headers}))}async copy(t,e,n){var s=this;return s.handleOperation(async()=>({path:(await Pe(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:s.headers})).Key}))}async createSignedUrl(t,e,n){var s=this;return s.handleOperation(async()=>{let i=s._getFinalPath(t),a=await Pe(s.fetch,`${s.url}/object/sign/${i}`,I({expiresIn:e},n!=null&&n.transform?{transform:n.transform}:{}),{headers:s.headers});const r=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{signedUrl:encodeURI(`${s.url}${a.signedURL}${r}`)}})}async createSignedUrls(t,e,n){var s=this;return s.handleOperation(async()=>{const i=await Pe(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:e,paths:t},{headers:s.headers}),a=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i.map(r=>I(I({},r),{},{signedUrl:r.signedURL?encodeURI(`${s.url}${r.signedURL}${a}`):null}))})}download(t,e,n){const s=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),a=i?`?${i}`:"",r=this._getFinalPath(t),o=()=>ts(this.fetch,`${this.url}/${s}/${r}${a}`,{headers:this.headers,noResolveJson:!0},n);return new ih(o,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);return e.handleOperation(async()=>va(await ts(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})))}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await nh(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(Ti(s)&&s instanceof Kl){const i=s.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:s}}throw s}}getPublicUrl(t,e){const n=this._getFinalPath(t),s=[],i=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&s.push(i);const a=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",r=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});r!==""&&s.push(r);let o=s.join("&");return o!==""&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${o}`)}}}async remove(t){var e=this;return e.handleOperation(async()=>await za(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}))}async list(t,e,n){var s=this;return s.handleOperation(async()=>{const i=I(I(I({},ah),e),{},{prefix:t||""});return await Pe(s.fetch,`${s.url}/object/list/${s.bucketId}`,i,{headers:s.headers},n)})}async listV2(t,e){var n=this;return n.handleOperation(async()=>{const s=I({},t);return await Pe(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,s,{headers:n.headers},e)})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const oh="2.95.3",ps={"X-Client-Info":`storage-js/${oh}`};var lh=class extends gn{constructor(t,e={},n,s){const i=new URL(t);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase."));const a=i.href.replace(/\/$/,""),r=I(I({},ps),e);super(a,r,n,"storage")}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const n=e.listBucketOptionsToQueryString(t);return await ts(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers})})}async getBucket(t){var e=this;return e.handleOperation(async()=>await ts(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}))}async createBucket(t,e={public:!1}){var n=this;return n.handleOperation(async()=>await Pe(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}))}async updateBucket(t,e){var n=this;return n.handleOperation(async()=>await wa(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}))}async emptyBucket(t){var e=this;return e.handleOperation(async()=>await Pe(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await za(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},ch=class extends gn{constructor(t,e={},n){const s=t.replace(/\/$/,""),i=I(I({},ps),e);super(s,i,n,"storage")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Pe(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}))}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const n=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&n.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&n.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&n.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&n.set("sortOrder",t.sortOrder),t!=null&&t.search&&n.set("search",t.search);const s=n.toString(),i=s?`${e.url}/bucket?${s}`:`${e.url}/bucket`;return await ts(e.fetch,i,{headers:e.headers})})}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await za(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}from(t){var e=this;if(!Yu(t))throw new Mi("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new Vu({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(n,{get(i,a){const r=i[a];return typeof r!="function"?r:async(...o)=>{try{return{data:await r.apply(i,o),error:null}}catch(l){if(s)throw l;return{data:null,error:l}}}}})}},dh=class extends gn{constructor(t,e={},n){const s=t.replace(/\/$/,""),i=I(I({},ps),{},{"Content-Type":"application/json"},e);super(s,i,n,"vectors")}async createIndex(t){var e=this;return e.handleOperation(async()=>await De.post(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{})}async getIndex(t,e){var n=this;return n.handleOperation(async()=>await De.post(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}))}async listIndexes(t){var e=this;return e.handleOperation(async()=>await De.post(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}))}async deleteIndex(t,e){var n=this;return n.handleOperation(async()=>await De.post(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{})}},uh=class extends gn{constructor(t,e={},n){const s=t.replace(/\/$/,""),i=I(I({},ps),{},{"Content-Type":"application/json"},e);super(s,i,n,"vectors")}async putVectors(t){var e=this;if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await De.post(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{})}async getVectors(t){var e=this;return e.handleOperation(async()=>await De.post(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}))}async listVectors(t){var e=this;if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return e.handleOperation(async()=>await De.post(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}))}async queryVectors(t){var e=this;return e.handleOperation(async()=>await De.post(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}))}async deleteVectors(t){var e=this;if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await De.post(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{})}},hh=class extends gn{constructor(t,e={},n){const s=t.replace(/\/$/,""),i=I(I({},ps),{},{"Content-Type":"application/json"},e);super(s,i,n,"vectors")}async createBucket(t){var e=this;return e.handleOperation(async()=>await De.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}async getBucket(t){var e=this;return e.handleOperation(async()=>await De.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}))}async listBuckets(t={}){var e=this;return e.handleOperation(async()=>await De.post(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await De.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}},fh=class extends hh{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new gh(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},gh=class extends dh{constructor(t,e,n,s){super(t,e,s),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,I(I({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,I(I({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new ph(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},ph=class extends uh{constructor(t,e,n,s,i){super(t,e,i),this.vectorBucketName=n,this.indexName=s}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,I(I({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,I(I({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,I(I({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,I(I({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,I(I({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},mh=class extends lh{constructor(t,e={},n,s){super(t,e,n,s)}from(t){return new rh(this.url,this.headers,t,this.fetch)}get vectors(){return new fh(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new ch(this.url+"/iceberg",this.headers,this.fetch)}};const Xl="2.95.3",en=30*1e3,ka=3,Ji=ka*en,_h="http://localhost:9999",yh="supabase.auth.token",bh={"X-Client-Info":`gotrue-js/${Xl}`},Sa="X-Supabase-Api-Version",Ql={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},vh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,wh=10*60*1e3;class ns extends Error{constructor(e,n,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=s}}function M(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class kh extends ns{constructor(e,n,s){super(e,n,s),this.name="AuthApiError",this.status=n,this.code=s}}function Sh(t){return M(t)&&t.name==="AuthApiError"}class Tt extends ns{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class ot extends ns{constructor(e,n,s,i){super(e,s,i),this.name=n,this.status=s}}class Me extends ot{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Xi(t){return M(t)&&t.name==="AuthSessionMissingError"}class qt extends ot{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Cs extends ot{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Es extends ot{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function xh(t){return M(t)&&t.name==="AuthImplicitGrantRedirectError"}class Gr extends ot{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ch extends ot{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class xa extends ot{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Qi(t){return M(t)&&t.name==="AuthRetryableFetchError"}class Hr extends ot{constructor(e,n,s){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=s}}class Ca extends ot{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ci="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ur=` 	
\r=`.split(""),Eh=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Ur.length;e+=1)t[Ur[e].charCodeAt(0)]=-2;for(let e=0;e<ci.length;e+=1)t[ci[e].charCodeAt(0)]=e;return t})();function qr(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;n(ci[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;n(ci[s]),e.queuedBits-=6}}function Zl(t,e,n){const s=Eh[t];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Vr(t){const e=[],n=r=>{e.push(String.fromCodePoint(r))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},a=r=>{Th(r,s,n)};for(let r=0;r<t.length;r+=1)Zl(t.charCodeAt(r),i,a);return e.join("")}function Ah(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Mh(t,e){for(let n=0;n<t.length;n+=1){let s=t.charCodeAt(n);if(s>55295&&s<=56319){const i=(s-55296)*1024&65535;s=(t.charCodeAt(n+1)-56320&65535|i)+65536,n+=1}Ah(s,e)}}function Th(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let s=1;s<6;s+=1)if(!(t>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function sn(t){const e=[],n={queue:0,queuedBits:0},s=i=>{e.push(i)};for(let i=0;i<t.length;i+=1)Zl(t.charCodeAt(i),n,s);return new Uint8Array(e)}function Rh(t){const e=[];return Mh(t,n=>e.push(n)),new Uint8Array(e)}function Rt(t){const e=[],n={queue:0,queuedBits:0},s=i=>{e.push(i)};return t.forEach(i=>qr(i,n,s)),qr(null,n,s),e.join("")}function Dh(t){return Math.round(Date.now()/1e3)+t}function Ih(){return Symbol("auth-callback")}const ge=()=>typeof window<"u"&&typeof document<"u",bt={tested:!1,writable:!1},ec=()=>{if(!ge())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(bt.tested)return bt.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),bt.tested=!0,bt.writable=!0}catch{bt.tested=!0,bt.writable=!1}return bt.writable};function Lh(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((i,a)=>{e[a]=i})}catch{}return n.searchParams.forEach((s,i)=>{e[i]=s}),e}const tc=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Oh=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",tn=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},vt=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},fe=async(t,e)=>{await t.removeItem(e)};class Ri{constructor(){this.promise=new Ri.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Ri.promiseConstructor=Promise;function As(t){const e=t.split(".");if(e.length!==3)throw new Ca("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!vh.test(e[s]))throw new Ca("JWT not in base64url format");return{header:JSON.parse(Vr(e[0])),payload:JSON.parse(Vr(e[1])),signature:sn(e[2]),raw:{header:e[0],payload:e[1]}}}async function Ph(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function $h(t,e){return new Promise((s,i)=>{(async()=>{for(let a=0;a<1/0;a++)try{const r=await t(a);if(!e(a,null,r)){s(r);return}}catch(r){if(!e(a,r)){i(r);return}}})()})}function Nh(t){return("0"+t.toString(16)).substr(-2)}function Bh(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=n.length;let i="";for(let a=0;a<56;a++)i+=n.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,Nh).join("")}async function jh(t){const n=new TextEncoder().encode(t),s=await crypto.subtle.digest("SHA-256",n),i=new Uint8Array(s);return Array.from(i).map(a=>String.fromCharCode(a)).join("")}async function Fh(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await jh(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Vt(t,e,n=!1){const s=Bh();let i=s;n&&(i+="/PASSWORD_RECOVERY"),await tn(t,`${e}-code-verifier`,i);const a=await Fh(s);return[a,s===a?"plain":"s256"]}const Wh=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Gh(t){const e=t.headers.get(Sa);if(!e||!e.match(Wh))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Hh(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function Uh(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const qh=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function zt(t){if(!qh.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Zi(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const s=n.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Vh(t,e){return new Proxy(t,{get:(n,s,i)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const a=s.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)"||a==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,s,i)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,s,i)}})}function zr(t){return JSON.parse(JSON.stringify(t))}const Ct=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),zh=[502,503,504];async function Kr(t){var e;if(!Oh(t))throw new xa(Ct(t),0);if(zh.includes(t.status))throw new xa(Ct(t),t.status);let n;try{n=await t.json()}catch(a){throw new Tt(Ct(a),a)}let s;const i=Gh(t);if(i&&i.getTime()>=Ql["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?s=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(s=n.error_code),s){if(s==="weak_password")throw new Hr(Ct(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new Me}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((a,r)=>a&&typeof r=="string",!0))throw new Hr(Ct(n),t.status,n.weak_password.reasons);throw new kh(Ct(n),t.status||500,s)}const Kh=(t,e,n,s)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),n))};async function R(t,e,n,s){var i;const a=Object.assign({},s==null?void 0:s.headers);a[Sa]||(a[Sa]=Ql["2024-01-01"].name),s!=null&&s.jwt&&(a.Authorization=`Bearer ${s.jwt}`);const r=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(r.redirect_to=s.redirectTo);const o=Object.keys(r).length?"?"+new URLSearchParams(r).toString():"",l=await Yh(t,e,n+o,{headers:a,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function Yh(t,e,n,s,i,a){const r=Kh(e,s,i,a);let o;try{o=await t(n,Object.assign({},r))}catch(l){throw console.error(l),new xa(Ct(l),0)}if(o.ok||await Kr(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(l){await Kr(l)}}function Oe(t){var e;let n=null;Qh(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=Dh(t.expires_in)));const s=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:s},error:null}}function Yr(t){const e=Oe(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,s)=>n&&typeof s=="string",!0)&&(e.data.weak_password=t.weak_password),e}function ct(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function Jh(t){return{data:t,error:null}}function Xh(t){const{action_link:e,email_otp:n,hashed_token:s,redirect_to:i,verification_type:a}=t,r=Ai(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:n,hashed_token:s,redirect_to:i,verification_type:a},l=Object.assign({},r);return{data:{properties:o,user:l},error:null}}function Jr(t){return t}function Qh(t){return t.access_token&&t.refresh_token&&t.expires_in}const ea=["global","local","others"];class Zh{constructor({url:e="",headers:n={},fetch:s}){this.url=e,this.headers=n,this.fetch=tc(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=ea[0]){if(ea.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ea.join(", ")}`);try{return await R(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(M(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,n={}){try{return await R(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:ct})}catch(s){if(M(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:n}=e,s=Ai(e,["options"]),i=Object.assign(Object.assign({},s),n);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await R(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Xh,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(M(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await R(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ct})}catch(n){if(M(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,s,i,a,r,o,l;try{const c={nextPage:null,lastPage:0,total:0},d=await R(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:"",per_page:(a=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:""},xform:Jr});if(d.error)throw d.error;const u=await d.json(),h=(r=d.headers.get("x-total-count"))!==null&&r!==void 0?r:0,f=(l=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(p=>{const g=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(p.split(";")[1].split("=")[1]);c[`${m}Page`]=g}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(M(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){zt(e);try{return await R(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ct})}catch(n){if(M(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){zt(e);try{return await R(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:ct})}catch(s){if(M(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,n=!1){zt(e);try{return await R(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:ct})}catch(s){if(M(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){zt(e.userId);try{const{data:n,error:s}=await R(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:n,error:s}}catch(n){if(M(n))return{data:null,error:n};throw n}}async _deleteFactor(e){zt(e.userId),zt(e.id);try{return{data:await R(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(M(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,s,i,a,r,o,l;try{const c={nextPage:null,lastPage:0,total:0},d=await R(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:"",per_page:(a=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:""},xform:Jr});if(d.error)throw d.error;const u=await d.json(),h=(r=d.headers.get("x-total-count"))!==null&&r!==void 0?r:0,f=(l=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(p=>{const g=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(p.split(";")[1].split("=")[1]);c[`${m}Page`]=g}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(M(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await R(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(M(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await R(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(M(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await R(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(M(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await R(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(M(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await R(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(M(n))return{data:null,error:n};throw n}}}function Xr(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const Kt={debug:!!(globalThis&&ec()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class nc extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ef extends nc{}async function tf(t,e,n){Kt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Kt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){Kt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,i.name);try{return await n()}finally{Kt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,i.name)}}else{if(e===0)throw Kt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new ef(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Kt.debug)try{const a=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(a,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function nf(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function sc(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function sf(t){return parseInt(t,16)}function af(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function rf(t){var e;const{chainId:n,domain:s,expirationTime:i,issuedAt:a=new Date,nonce:r,notBefore:o,requestId:l,resources:c,scheme:d,uri:u,version:h}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(r&&r.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${r}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const f=sc(t.address),p=d?`${d}://${s}`:s,g=t.statement?`${t.statement}
`:"",m=`${p} wants you to sign in with your Ethereum account:
${f}

${g}`;let _=`URI: ${u}
Version: ${h}
Chain ID: ${n}${r?`
Nonce: ${r}`:""}
Issued At: ${a.toISOString()}`;if(i&&(_+=`
Expiration Time: ${i.toISOString()}`),o&&(_+=`
Not Before: ${o.toISOString()}`),l&&(_+=`
Request ID: ${l}`),c){let y=`
Resources:`;for(const b of c){if(!b||typeof b!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${b}`);y+=`
- ${b}`}_+=y}return`${m}
${_}`}class re extends Error{constructor({message:e,code:n,cause:s,name:i}){var a;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(a=i??(s instanceof Error?s.name:void 0))!==null&&a!==void 0?a:"Unknown Error",this.code=n}}class di extends re{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function of({error:t,options:e}){var n,s,i;const{publicKey:a}=e;if(!a)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new re({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=a.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new re({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((s=a.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new re({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((i=a.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new re({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new re({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new re({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return a.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new re({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new re({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(ic(r)){if(a.rp.id!==r)return new re({message:`The RP ID "${a.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new re({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(a.user.id.byteLength<1||a.user.id.byteLength>64)return new re({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new re({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new re({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function lf({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new re({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new re({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const s=window.location.hostname;if(ic(s)){if(n.rpId!==s)return new re({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new re({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new re({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new re({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class cf{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const df=new cf;function uf(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:s}=t,i=Ai(t,["challenge","user","excludeCredentials"]),a=sn(e).buffer,r=Object.assign(Object.assign({},n),{id:sn(n.id).buffer}),o=Object.assign(Object.assign({},i),{challenge:a,user:r});if(s&&s.length>0){o.excludeCredentials=new Array(s.length);for(let l=0;l<s.length;l++){const c=s[l];o.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:sn(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return o}function hf(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,s=Ai(t,["challenge","allowCredentials"]),i=sn(e).buffer,a=Object.assign(Object.assign({},s),{challenge:i});if(n&&n.length>0){a.allowCredentials=new Array(n.length);for(let r=0;r<n.length;r++){const o=n[r];a.allowCredentials[r]=Object.assign(Object.assign({},o),{id:sn(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return a}function ff(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:Rt(new Uint8Array(t.response.attestationObject)),clientDataJSON:Rt(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function gf(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,s=t.getClientExtensionResults(),i=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Rt(new Uint8Array(i.authenticatorData)),clientDataJSON:Rt(new Uint8Array(i.clientDataJSON)),signature:Rt(new Uint8Array(i.signature)),userHandle:i.userHandle?Rt(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function ic(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function Qr(){var t,e;return!!(ge()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function pf(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new di("Browser returned unexpected credential type",e)}:{data:null,error:new di("Empty credential response",e)}}catch(e){return{data:null,error:of({error:e,options:t})}}}async function mf(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new di("Browser returned unexpected credential type",e)}:{data:null,error:new di("Empty credential response",e)}}catch(e){return{data:null,error:lf({error:e,options:t})}}}const _f={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},yf={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function ui(...t){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),n=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),s={};for(const i of t)if(i)for(const a in i){const r=i[a];if(r!==void 0)if(Array.isArray(r))s[a]=r;else if(n(r))s[a]=r;else if(e(r)){const o=s[a];e(o)?s[a]=ui(o,r):s[a]=ui(r)}else s[a]=r}return s}function bf(t,e){return ui(_f,t,e||{})}function vf(t,e){return ui(yf,t,e||{})}class wf{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:s,signal:i},a){var r;try{const{data:o,error:l}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!o)return{data:null,error:l};const c=i??df.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:d}=o.webauthn.credential_options.publicKey;if(!d.name){const u=s;if(u)d.name=`${d.id}:${u}`;else{const f=(await this.client.getUser()).data.user,p=((r=f==null?void 0:f.user_metadata)===null||r===void 0?void 0:r.name)||(f==null?void 0:f.email)||(f==null?void 0:f.id)||"User";d.name=`${d.id}:${p}`}}d.displayName||(d.displayName=d.name)}switch(o.webauthn.type){case"create":{const d=bf(o.webauthn.credential_options.publicKey,a==null?void 0:a.create),{data:u,error:h}=await pf({publicKey:d,signal:c});return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}case"request":{const d=vf(o.webauthn.credential_options.publicKey,a==null?void 0:a.request),{data:u,error:h}=await mf(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:d,signal:c}));return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}}}catch(o){return M(o)?{data:null,error:o}:{data:null,error:new Tt("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:n,webauthn:s}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},a){if(!n)return{data:null,error:new ns("rpId is required for WebAuthn authentication")};try{if(!Qr())return{data:null,error:new Tt("Browser does not support WebAuthn",null)};const{data:r,error:o}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:s},signal:i},{request:a});if(!r)return{data:null,error:o};const{webauthn:l}=r;return this._verify({factorId:e,challengeId:r.challengeId,webauthn:{type:l.type,rpId:n,rpOrigins:s,credential_response:l.credential_response}})}catch(r){return M(r)?{data:null,error:r}:{data:null,error:new Tt("Unexpected error in authenticate",r)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},a){if(!n)return{data:null,error:new ns("rpId is required for WebAuthn registration")};try{if(!Qr())return{data:null,error:new Tt("Browser does not support WebAuthn",null)};const{data:r,error:o}=await this._enroll({friendlyName:e});if(!r)return await this.client.mfa.listFactors().then(d=>{var u;return(u=d.data)===null||u===void 0?void 0:u.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:o};const{data:l,error:c}=await this._challenge({factorId:r.id,friendlyName:r.friendly_name,webauthn:{rpId:n,rpOrigins:s},signal:i},{create:a});return l?this._verify({factorId:r.id,challengeId:l.challengeId,webauthn:{rpId:n,rpOrigins:s,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(r){return M(r)?{data:null,error:r}:{data:null,error:new Tt("Unexpected error in register",r)}}}}nf();const kf={url:_h,storageKey:yh,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:bh,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function Zr(t,e,n){return await n()}const Yt={};class ss{get jwks(){var e,n;return(n=(e=Yt[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){Yt[this.storageKey]=Object.assign(Object.assign({},Yt[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=Yt[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Yt[this.storageKey]=Object.assign(Object.assign({},Yt[this.storageKey]),{cachedAt:e})}constructor(e){var n,s,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const a=Object.assign(Object.assign({},kf),e);if(this.storageKey=a.storageKey,this.instanceID=(n=ss.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,ss.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.instanceID>0&&ge()){const r=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(r),this.logDebugMessages&&console.trace(r)}if(this.persistSession=a.persistSession,this.autoRefreshToken=a.autoRefreshToken,this.admin=new Zh({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=tc(a.fetch),this.lock=a.lock||Zr,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,this.throwOnError=a.throwOnError,this.lockAcquireTimeout=a.lockAcquireTimeout,a.lock?this.lock=a.lock:this.persistSession&&ge()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=tf:this.lock=Zr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new wf(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:ec()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Xr(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=Xr(this.memoryStorage)),ge()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async r=>{this._debug("received broadcast notification from other tab or client",r);try{await this._notifyAllSubscribers(r.data.event,r.data.session,!1)}catch(o){this._debug("#broadcastChannel","error",o)}})}this.initialize().catch(r=>{this._debug("#initialize()","error",r)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Xl}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},s="none";if(ge()&&(n=Lh(window.location.href),this._isImplicitGrantCallback(n)?s="implicit":await this._isPKCECallback(n)&&(s="pkce")),ge()&&this.detectSessionInUrl&&s!=="none"){const{data:i,error:a}=await this._getSessionFromURL(n,s);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),xh(a)){const l=(e=a.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:a}}return{error:a}}const{session:r,redirectType:o}=i;return this._debug("#_initialize()","detected session in URL",r,"redirect type",o),await this._saveSession(r),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",r):await this._notifyAllSubscribers("SIGNED_IN",r)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return M(n)?this._returnResult({error:n}):this._returnResult({error:new Tt("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,s,i;try{const a=await R(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:Oe}),{data:r,error:o}=a;if(o||!r)return this._returnResult({data:{user:null,session:null},error:o});const l=r.session,c=r.user;return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(a){if(M(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signUp(e){var n,s,i;try{let a;if("email"in e){const{email:d,password:u,options:h}=e;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await Vt(this.storage,this.storageKey)),a=await R(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:d,password:u,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:p},xform:Oe})}else if("phone"in e){const{phone:d,password:u,options:h}=e;a=await R(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:u,data:(s=h==null?void 0:h.data)!==null&&s!==void 0?s:{},channel:(i=h==null?void 0:h.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:Oe})}else throw new Cs("You must provide either an email or phone number and a password");const{data:r,error:o}=a;if(o||!r)return await fe(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:o});const l=r.session,c=r.user;return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(a){if(await fe(this.storage,`${this.storageKey}-code-verifier`),M(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithPassword(e){try{let n;if("email"in e){const{email:a,password:r,options:o}=e;n=await R(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:r,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Yr})}else if("phone"in e){const{phone:a,password:r,options:o}=e;n=await R(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:r,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Yr})}else throw new Cs("You must provide either an email or phone number and a password");const{data:s,error:i}=n;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!s||!s.session||!s.user){const a=new qt;return this._returnResult({data:{user:null,session:null},error:a})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(n){if(M(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,s,i,a;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(a=e.options)===null||a===void 0?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,s,i,a,r,o,l,c,d,u,h;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:g,wallet:m,statement:_,options:y}=e;let b;if(ge())if(typeof m=="object")b=m;else{const E=window;if("ethereum"in E&&typeof E.ethereum=="object"&&"request"in E.ethereum&&typeof E.ethereum.request=="function")b=E.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=m}const v=new URL((n=y==null?void 0:y.url)!==null&&n!==void 0?n:window.location.href),w=await b.request({method:"eth_requestAccounts"}).then(E=>E).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!w||w.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const k=sc(w[0]);let S=(s=y==null?void 0:y.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!S){const E=await b.request({method:"eth_chainId"});S=sf(E)}const x={domain:v.host,address:k,statement:_,uri:v.href,version:"1",chainId:S,nonce:(i=y==null?void 0:y.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(r=(a=y==null?void 0:y.signInWithEthereum)===null||a===void 0?void 0:a.issuedAt)!==null&&r!==void 0?r:new Date,expirationTime:(o=y==null?void 0:y.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(l=y==null?void 0:y.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=y==null?void 0:y.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(d=y==null?void 0:y.signInWithEthereum)===null||d===void 0?void 0:d.resources};f=rf(x),p=await b.request({method:"personal_sign",params:[af(f),k]})}try{const{data:g,error:m}=await R(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:p},!((u=e.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:Oe});if(m)throw m;if(!g||!g.session||!g.user){const _=new qt;return this._returnResult({data:{user:null,session:null},error:_})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:m})}catch(g){if(M(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async signInWithSolana(e){var n,s,i,a,r,o,l,c,d,u,h,f;let p,g;if("message"in e)p=e.message,g=e.signature;else{const{chain:m,wallet:_,statement:y,options:b}=e;let v;if(ge())if(typeof _=="object")v=_;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))v=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof _!="object"||!(b!=null&&b.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=_}const w=new URL((n=b==null?void 0:b.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in v&&v.signIn){const k=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b==null?void 0:b.signInWithSolana),{version:"1",domain:w.host,uri:w.href}),y?{statement:y}:null));let S;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")S=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)S=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)p=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),g=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in v)||typeof v.signMessage!="function"||!("publicKey"in v)||typeof v!="object"||!v.publicKey||!("toBase58"in v.publicKey)||typeof v.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${w.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...y?["",y,""]:[""],"Version: 1",`URI: ${w.href}`,`Issued At: ${(i=(s=b==null?void 0:b.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((a=b==null?void 0:b.signInWithSolana)===null||a===void 0)&&a.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((r=b==null?void 0:b.signInWithSolana)===null||r===void 0)&&r.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((o=b==null?void 0:b.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((l=b==null?void 0:b.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((c=b==null?void 0:b.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((u=(d=b==null?void 0:b.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||u===void 0)&&u.length?["Resources",...b.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const k=await v.signMessage(new TextEncoder().encode(p),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=k}}try{const{data:m,error:_}=await R(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:Rt(g)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Oe});if(_)throw _;if(!m||!m.session||!m.user){const y=new qt;return this._returnResult({data:{user:null,session:null},error:y})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:_})}catch(m){if(M(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async _exchangeCodeForSession(e){const n=await vt(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(n??"").split("/");try{if(!s&&this.flowType==="pkce")throw new Ch;const{data:a,error:r}=await R(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Oe});if(await fe(this.storage,`${this.storageKey}-code-verifier`),r)throw r;if(!a||!a.session||!a.user){const o=new qt;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign(Object.assign({},a),{redirectType:i??null}),error:r})}catch(a){if(await fe(this.storage,`${this.storageKey}-code-verifier`),M(a))return this._returnResult({data:{user:null,session:null,redirectType:null},error:a});throw a}}async signInWithIdToken(e){try{const{options:n,provider:s,token:i,access_token:a,nonce:r}=e,o=await R(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:a,nonce:r,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Oe}),{data:l,error:c}=o;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const d=new qt;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(n){if(M(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,s,i,a,r;try{if("email"in e){const{email:o,options:l}=e;let c=null,d=null;this.flowType==="pkce"&&([c,d]=await Vt(this.storage,this.storageKey));const{error:u}=await R(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:u})}if("phone"in e){const{phone:o,options:l}=e,{data:c,error:d}=await R(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(a=l==null?void 0:l.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(r=l==null?void 0:l.channel)!==null&&r!==void 0?r:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:d})}throw new Cs("You must provide either an email or phone number.")}catch(o){if(await fe(this.storage,`${this.storageKey}-code-verifier`),M(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(e){var n,s;try{let i,a;"options"in e&&(i=(n=e.options)===null||n===void 0?void 0:n.redirectTo,a=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:r,error:o}=await R(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:i,xform:Oe});if(o)throw o;if(!r)throw new Error("An error occurred on token verification.");const l=r.session,c=r.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(M(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var n,s,i,a,r;try{let o=null,l=null;this.flowType==="pkce"&&([o,l]=await Vt(this.storage,this.storageKey));const c=await R(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:l}),headers:this.headers,xform:Jh});return!((a=c.data)===null||a===void 0)&&a.url&&ge()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(o){if(await fe(this.storage,`${this.storageKey}-code-verifier`),M(o))return this._returnResult({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:s}=e;if(s)throw s;if(!n)throw new Me;const{error:i}=await R(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(M(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:a}=e,{error:r}=await R(this.fetch,"POST",n,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},redirectTo:a==null?void 0:a.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:r})}else if("phone"in e){const{phone:s,type:i,options:a}=e,{data:r,error:o}=await R(this.fetch,"POST",n,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:r==null?void 0:r.message_id},error:o})}throw new Cs("You must provide either an email or phone number and a type")}catch(n){if(M(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await n()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=n();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await vt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Ji:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const r=await vt(this.userStorage,this.storageKey+"-user");r!=null&&r.user?e.user=r.user:e.user=Zi()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const r={value:this.suppressGetSessionWarning};e.user=Vh(e.user,r),r.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:i,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{session:null},error:a}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await R(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ct}):await this._useSession(async n=>{var s,i,a;const{data:r,error:o}=n;if(o)throw o;return!(!((s=r.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Me}:await R(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(i=r.session)===null||i===void 0?void 0:i.access_token)!==null&&a!==void 0?a:void 0,xform:ct})})}catch(n){if(M(n))return Xi(n)&&(await this._removeSession(),await fe(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async s=>{const{data:i,error:a}=s;if(a)throw a;if(!i.session)throw new Me;const r=i.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await Vt(this.storage,this.storageKey));const{data:c,error:d}=await R(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:r.access_token,xform:ct});if(d)throw d;return r.user=c.user,await this._saveSession(r),await this._notifyAllSubscribers("USER_UPDATED",r),this._returnResult({data:{user:r.user},error:null})})}catch(s){if(await fe(this.storage,`${this.storageKey}-code-verifier`),M(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Me;const n=Date.now()/1e3;let s=n,i=!0,a=null;const{payload:r}=As(e.access_token);if(r.exp&&(s=r.exp,i=s<=n),i){const{data:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!o)return{data:{user:null,session:null},error:null};a=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});a={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-n,expires_at:s},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return this._returnResult({data:{user:a.user,session:a},error:null})}catch(n){if(M(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var s;if(!e){const{data:r,error:o}=n;if(o)throw o;e=(s=r.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new Me;const{data:i,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{user:null,session:null},error:a}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(M(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!ge())throw new Es("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Es(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Gr("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Es("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Gr("No code detected.");const{data:y,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const v=new URL(window.location.href);return v.searchParams.delete("code"),window.history.replaceState(window.history.state,"",v.toString()),{data:{session:y.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:a,refresh_token:r,expires_in:o,expires_at:l,token_type:c}=e;if(!a||!o||!r||!c)throw new Es("No session defined in URL");const d=Math.round(Date.now()/1e3),u=parseInt(o);let h=d+u;l&&(h=parseInt(l));const f=h-d;f*1e3<=en&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${u}s`);const p=h-u;d-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,h,d):d-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,h,d);const{data:g,error:m}=await this._getUser(a);if(m)throw m;const _={provider_token:s,provider_refresh_token:i,access_token:a,expires_in:u,expires_at:h,refresh_token:r,token_type:c,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:_,redirectType:e.type},error:null})}catch(s){if(M(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await vt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var s;const{data:i,error:a}=n;if(a&&!Xi(a))return this._returnResult({error:a});const r=(s=i.session)===null||s===void 0?void 0:s.access_token;if(r){const{error:o}=await this.admin.signOut(r,e);if(o&&!(Sh(o)&&(o.status===404||o.status===401||o.status===403)||Xi(o)))return this._returnResult({error:o})}return e!=="others"&&(await this._removeSession(),await fe(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=Ih(),s={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,s),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async n=>{var s,i;try{const{data:{session:a},error:r}=n;if(r)throw r;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",e,"session",a)}catch(a){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}})}async resetPasswordForEmail(e,n={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await Vt(this.storage,this.storageKey,!0));try{return await R(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(a){if(await fe(this.storage,`${this.storageKey}-code-verifier`),M(a))return this._returnResult({data:null,error:a});throw a}}async getUserIdentities(){var e;try{const{data:n,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(M(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:s,error:i}=await this._useSession(async a=>{var r,o,l,c,d;const{data:u,error:h}=a;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await R(this.fetch,"GET",f,{headers:this.headers,jwt:(d=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return ge()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),this._returnResult({data:{provider:e.provider,url:s==null?void 0:s.url},error:null})}catch(s){if(M(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var s;try{const{error:i,data:{session:a}}=n;if(i)throw i;const{options:r,provider:o,token:l,access_token:c,nonce:d}=e,u=await R(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=a==null?void 0:a.access_token)!==null&&s!==void 0?s:void 0,body:{provider:o,id_token:l,access_token:c,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:Oe}),{data:h,error:f}=u;return f?this._returnResult({data:{user:null,session:null},error:f}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new qt}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:f}))}catch(i){if(await fe(this.storage,`${this.storageKey}-code-verifier`),M(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var s,i;const{data:a,error:r}=n;if(r)throw r;return await R(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(n){if(M(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const s=Date.now();return await $h(async i=>(i>0&&await Ph(200*Math.pow(2,i-1)),this._debug(n,"refreshing attempt",i),await R(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Oe})),(i,a)=>{const r=200*Math.pow(2,i);return a&&Qi(a)&&Date.now()+r-s<en})}catch(s){if(this._debug(n,"error",s),M(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",s),ge()&&!n.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,n;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const i=await vt(this.storage,this.storageKey);if(i&&this.userStorage){let r=await vt(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!r&&(r={user:i.user},await tn(this.userStorage,this.storageKey+"-user",r)),i.user=(e=r==null?void 0:r.user)!==null&&e!==void 0?e:Zi()}else if(i&&!i.user&&!i.user){const r=await vt(this.storage,this.storageKey+"-user");r&&(r!=null&&r.user)?(i.user=r.user,await fe(this.storage,this.storageKey+"-user"),await tn(this.storage,this.storageKey,i)):i.user=Zi()}if(this._debug(s,"session from storage",i),!this._isValidSession(i)){this._debug(s,"session is not valid"),i!==null&&await this._removeSession();return}const a=((n=i.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Ji;if(this._debug(s,`session has${a?"":" not"} expired with margin of ${Ji}s`),a){if(this.autoRefreshToken&&i.refresh_token){const{error:r}=await this._callRefreshToken(i.refresh_token);r&&(console.error(r),Qi(r)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",r),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:r,error:o}=await this._getUser(i.access_token);!o&&(r!=null&&r.user)?(i.user=r.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(s,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(s,"error",i),console.error(i);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var n,s;if(!e)throw new Me;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Ri;const{data:a,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!a.session)throw new Me;await this._saveSession(a.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const o={data:a.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(a){if(this._debug(i,"error",a),M(a)){const r={data:null,error:a};return Qi(a)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(r),r}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(a),a}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,n,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",n,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:n});const a=[],r=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,n)}catch(l){a.push(l)}});if(await Promise.all(r),a.length>0){for(let o=0;o<a.length;o+=1)console.error(a[o]);throw a[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await fe(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),s=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&n.user&&await tn(this.userStorage,this.storageKey+"-user",{user:n.user});const i=Object.assign({},n);delete i.user;const a=zr(i);await tn(this.storage,this.storageKey,a)}else{const i=zr(n);await tn(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await fe(this.storage,this.storageKey),await fe(this.storage,this.storageKey+"-code-verifier"),await fe(this.storage,this.storageKey+"-user"),this.userStorage&&await fe(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ge()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),en);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const n=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const n=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,n&&clearTimeout(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:s}}=n;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/en);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${en}ms, refresh threshold is ${ka} ticks`),i<=ka&&await this._callRefreshToken(s.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof nc)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ge()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,s){const i=[`provider=${encodeURIComponent(n)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[a,r]=await Vt(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(r)}`});i.push(o.toString())}if(s!=null&&s.queryParams){const a=new URLSearchParams(s.queryParams);i.push(a.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var s;const{data:i,error:a}=n;return a?this._returnResult({data:null,error:a}):await R(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(n){if(M(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var s,i;const{data:a,error:r}=n;if(r)return this._returnResult({data:null,error:r});const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await R(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=a==null?void 0:a.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((i=l==null?void 0:l.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(n){if(M(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var s;const{data:i,error:a}=n;if(a)return this._returnResult({data:null,error:a});const r=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?ff(e.webauthn.credential_response):gf(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:l}=await R(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:r,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:l}))})}catch(n){if(M(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var s;const{data:i,error:a}=n;if(a)return this._returnResult({data:null,error:a});const r=await R(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});if(r.error)return r;const{data:o}=r;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:uf(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:hf(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(M(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:s}=await this.getUser();if(s)return{data:null,error:s};const i={all:[],phone:[],totp:[],webauthn:[]};for(const a of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])i.all.push(a),a.status==="verified"&&i[a.factor_type].push(a);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(e){var n,s,i,a;if(e)try{const{payload:f}=As(e);let p=null;f.aal&&(p=f.aal);let g=p;const{data:{user:m},error:_}=await this.getUser(e);if(_)return this._returnResult({data:null,error:_});((s=(n=m==null?void 0:m.factors)===null||n===void 0?void 0:n.filter(v=>v.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(g="aal2");const b=f.amr||[];return{data:{currentLevel:p,nextLevel:g,currentAuthenticationMethods:b},error:null}}catch(f){if(M(f))return this._returnResult({data:null,error:f});throw f}const{data:{session:r},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=As(r.access_token);let c=null;l.aal&&(c=l.aal);let d=c;((a=(i=r.user.factors)===null||i===void 0?void 0:i.filter(f=>f.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(d="aal2");const h=l.amr||[];return{data:{currentLevel:c,nextLevel:d,currentAuthenticationMethods:h},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;return i?this._returnResult({data:null,error:i}):s?await R(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new Me})})}catch(n){if(M(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async s=>{const{data:{session:i},error:a}=s;if(a)return this._returnResult({data:null,error:a});if(!i)return this._returnResult({data:null,error:new Me});const r=await R(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return r.data&&r.data.redirect_url&&ge()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(r.data.redirect_url),r})}catch(s){if(M(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,n){try{return await this._useSession(async s=>{const{data:{session:i},error:a}=s;if(a)return this._returnResult({data:null,error:a});if(!i)return this._returnResult({data:null,error:new Me});const r=await R(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return r.data&&r.data.redirect_url&&ge()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(r.data.redirect_url),r})}catch(s){if(M(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:s}=e;return s?this._returnResult({data:null,error:s}):n?await R(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Me})})}catch(e){if(M(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;return i?this._returnResult({data:null,error:i}):s?(await R(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Me})})}catch(n){if(M(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let s=n.keys.find(o=>o.kid===e);if(s)return s;const i=Date.now();if(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+wh>i)return s;const{data:a,error:r}=await R(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(r)throw r;return!a.keys||a.keys.length===0||(this.jwks=a,this.jwks_cached_at=i,s=a.keys.find(o=>o.kid===e),!s)?null:s}async getClaims(e,n={}){try{let s=e;if(!s){const{data:f,error:p}=await this.getSession();if(p||!f.session)return this._returnResult({data:null,error:p});s=f.session.access_token}const{header:i,payload:a,signature:r,raw:{header:o,payload:l}}=As(s);n!=null&&n.allowExpired||Hh(a.exp);const c=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!c){const{error:f}=await this.getUser(s);if(f)throw f;return{data:{claims:a,header:i,signature:r},error:null}}const d=Uh(i.alg),u=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,u,r,Rh(`${o}.${l}`)))throw new Ca("Invalid JWT signature");return{data:{claims:a,header:i,signature:r},error:null}}catch(s){if(M(s))return this._returnResult({data:null,error:s});throw s}}}ss.nextInstanceID={};const Sf=ss,xf="2.95.3";let In="";typeof Deno<"u"?In="deno":typeof document<"u"?In="web":typeof navigator<"u"&&navigator.product==="ReactNative"?In="react-native":In="node";const Cf={"X-Client-Info":`supabase-js-${In}/${xf}`},Ef={headers:Cf},Af={schema:"public"},Mf={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Tf={};function is(t){"@babel/helpers - typeof";return is=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},is(t)}function Rf(t,e){if(is(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(is(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Df(t){var e=Rf(t,"string");return is(e)=="symbol"?e:e+""}function If(t,e,n){return(e=Df(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function eo(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,s)}return n}function ne(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?eo(Object(n),!0).forEach(function(s){If(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):eo(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}const Lf=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Of=()=>Headers,Pf=(t,e,n)=>{const s=Lf(n),i=Of();return async(a,r)=>{var o;const l=(o=await e())!==null&&o!==void 0?o:t;let c=new i(r==null?void 0:r.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(a,ne(ne({},r),{},{headers:c}))}};function $f(t){return t.endsWith("/")?t:t+"/"}function Nf(t,e){var n,s;const{db:i,auth:a,realtime:r,global:o}=t,{db:l,auth:c,realtime:d,global:u}=e,h={db:ne(ne({},l),i),auth:ne(ne({},c),a),realtime:ne(ne({},d),r),storage:{},global:ne(ne(ne({},u),o),{},{headers:ne(ne({},(n=u==null?void 0:u.headers)!==null&&n!==void 0?n:{}),(s=o==null?void 0:o.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}function Bf(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL($f(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var jf=class extends Sf{constructor(t){super(t)}},Ff=class{constructor(t,e,n){var s,i;this.supabaseUrl=t,this.supabaseKey=e;const a=Bf(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const r=`sb-${a.hostname.split(".")[0]}-auth-token`,o={db:Af,realtime:Tf,auth:ne(ne({},Mf),{},{storageKey:r}),global:Ef},l=Nf(n??{},o);if(this.storageKey=(s=l.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=l.global.headers)!==null&&i!==void 0?i:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(d,u)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(u)} is not possible`)}});else{var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch)}this.fetch=Pf(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(ne({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new Su(new URL("rest/v1",a).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch,timeout:l.db.timeout,urlLengthLimit:l.db.urlLengthLimit}),this.storage=new mh(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new pu(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:s}=await t.auth.getSession();return(e=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:s,userStorage:i,storageKey:a,flowType:r,lock:o,debug:l,throwOnError:c},d,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new jf({url:this.authUrl.href,headers:ne(ne({},h),d),storageKey:a,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:s,userStorage:i,flowType:r,lock:o,debug:l,throwOnError:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new Fu(this.realtimeUrl.href,ne(ne({},t),{},{params:ne(ne({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Wf=(t,e,n)=>new Ff(t,e,n);function Gf(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(e==null)return!1;const n=e.match(/^v(\d+)\./);return n?parseInt(n[1],10)<=18:!1}Gf()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function ms(t){return t+.5|0}const dt=(t,e,n)=>Math.max(Math.min(t,n),e);function Ln(t){return dt(ms(t*2.55),0,255)}function gt(t){return dt(ms(t*255),0,255)}function Ze(t){return dt(ms(t/2.55)/100,0,1)}function to(t){return dt(ms(t*100),0,100)}const Le={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Ea=[..."0123456789ABCDEF"],Hf=t=>Ea[t&15],Uf=t=>Ea[(t&240)>>4]+Ea[t&15],Ms=t=>(t&240)>>4===(t&15),qf=t=>Ms(t.r)&&Ms(t.g)&&Ms(t.b)&&Ms(t.a);function Vf(t){var e=t.length,n;return t[0]==="#"&&(e===4||e===5?n={r:255&Le[t[1]]*17,g:255&Le[t[2]]*17,b:255&Le[t[3]]*17,a:e===5?Le[t[4]]*17:255}:(e===7||e===9)&&(n={r:Le[t[1]]<<4|Le[t[2]],g:Le[t[3]]<<4|Le[t[4]],b:Le[t[5]]<<4|Le[t[6]],a:e===9?Le[t[7]]<<4|Le[t[8]]:255})),n}const zf=(t,e)=>t<255?e(t):"";function Kf(t){var e=qf(t)?Hf:Uf;return t?"#"+e(t.r)+e(t.g)+e(t.b)+zf(t.a,e):void 0}const Yf=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function ac(t,e,n){const s=e*Math.min(n,1-n),i=(a,r=(a+t/30)%12)=>n-s*Math.max(Math.min(r-3,9-r,1),-1);return[i(0),i(8),i(4)]}function Jf(t,e,n){const s=(i,a=(i+t/60)%6)=>n-n*e*Math.max(Math.min(a,4-a,1),0);return[s(5),s(3),s(1)]}function Xf(t,e,n){const s=ac(t,1,.5);let i;for(e+n>1&&(i=1/(e+n),e*=i,n*=i),i=0;i<3;i++)s[i]*=1-e-n,s[i]+=e;return s}function Qf(t,e,n,s,i){return t===i?(e-n)/s+(e<n?6:0):e===i?(n-t)/s+2:(t-e)/s+4}function Ka(t){const n=t.r/255,s=t.g/255,i=t.b/255,a=Math.max(n,s,i),r=Math.min(n,s,i),o=(a+r)/2;let l,c,d;return a!==r&&(d=a-r,c=o>.5?d/(2-a-r):d/(a+r),l=Qf(n,s,i,d,a),l=l*60+.5),[l|0,c||0,o]}function Ya(t,e,n,s){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,s)).map(gt)}function Ja(t,e,n){return Ya(ac,t,e,n)}function Zf(t,e,n){return Ya(Xf,t,e,n)}function eg(t,e,n){return Ya(Jf,t,e,n)}function rc(t){return(t%360+360)%360}function tg(t){const e=Yf.exec(t);let n=255,s;if(!e)return;e[5]!==s&&(n=e[6]?Ln(+e[5]):gt(+e[5]));const i=rc(+e[2]),a=+e[3]/100,r=+e[4]/100;return e[1]==="hwb"?s=Zf(i,a,r):e[1]==="hsv"?s=eg(i,a,r):s=Ja(i,a,r),{r:s[0],g:s[1],b:s[2],a:n}}function ng(t,e){var n=Ka(t);n[0]=rc(n[0]+e),n=Ja(n),t.r=n[0],t.g=n[1],t.b=n[2]}function sg(t){if(!t)return;const e=Ka(t),n=e[0],s=to(e[1]),i=to(e[2]);return t.a<255?`hsla(${n}, ${s}%, ${i}%, ${Ze(t.a)})`:`hsl(${n}, ${s}%, ${i}%)`}const no={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},so={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function ig(){const t={},e=Object.keys(so),n=Object.keys(no);let s,i,a,r,o;for(s=0;s<e.length;s++){for(r=o=e[s],i=0;i<n.length;i++)a=n[i],o=o.replace(a,no[a]);a=parseInt(so[r],16),t[o]=[a>>16&255,a>>8&255,a&255]}return t}let Ts;function ag(t){Ts||(Ts=ig(),Ts.transparent=[0,0,0,0]);const e=Ts[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const rg=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function og(t){const e=rg.exec(t);let n=255,s,i,a;if(e){if(e[7]!==s){const r=+e[7];n=e[8]?Ln(r):dt(r*255,0,255)}return s=+e[1],i=+e[3],a=+e[5],s=255&(e[2]?Ln(s):dt(s,0,255)),i=255&(e[4]?Ln(i):dt(i,0,255)),a=255&(e[6]?Ln(a):dt(a,0,255)),{r:s,g:i,b:a,a:n}}}function lg(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${Ze(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}const ta=t=>t<=.0031308?t*12.92:Math.pow(t,1/2.4)*1.055-.055,Jt=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function cg(t,e,n){const s=Jt(Ze(t.r)),i=Jt(Ze(t.g)),a=Jt(Ze(t.b));return{r:gt(ta(s+n*(Jt(Ze(e.r))-s))),g:gt(ta(i+n*(Jt(Ze(e.g))-i))),b:gt(ta(a+n*(Jt(Ze(e.b))-a))),a:t.a+n*(e.a-t.a)}}function Rs(t,e,n){if(t){let s=Ka(t);s[e]=Math.max(0,Math.min(s[e]+s[e]*n,e===0?360:1)),s=Ja(s),t.r=s[0],t.g=s[1],t.b=s[2]}}function oc(t,e){return t&&Object.assign(e||{},t)}function io(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=gt(t[3]))):(e=oc(t,{r:0,g:0,b:0,a:1}),e.a=gt(e.a)),e}function dg(t){return t.charAt(0)==="r"?og(t):tg(t)}class as{constructor(e){if(e instanceof as)return e;const n=typeof e;let s;n==="object"?s=io(e):n==="string"&&(s=Vf(e)||ag(e)||dg(e)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var e=oc(this._rgb);return e&&(e.a=Ze(e.a)),e}set rgb(e){this._rgb=io(e)}rgbString(){return this._valid?lg(this._rgb):void 0}hexString(){return this._valid?Kf(this._rgb):void 0}hslString(){return this._valid?sg(this._rgb):void 0}mix(e,n){if(e){const s=this.rgb,i=e.rgb;let a;const r=n===a?.5:n,o=2*r-1,l=s.a-i.a,c=((o*l===-1?o:(o+l)/(1+o*l))+1)/2;a=1-c,s.r=255&c*s.r+a*i.r+.5,s.g=255&c*s.g+a*i.g+.5,s.b=255&c*s.b+a*i.b+.5,s.a=r*s.a+(1-r)*i.a,this.rgb=s}return this}interpolate(e,n){return e&&(this._rgb=cg(this._rgb,e._rgb,n)),this}clone(){return new as(this.rgb)}alpha(e){return this._rgb.a=gt(e),this}clearer(e){const n=this._rgb;return n.a*=1-e,this}greyscale(){const e=this._rgb,n=ms(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=n,this}opaquer(e){const n=this._rgb;return n.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Rs(this._rgb,2,e),this}darken(e){return Rs(this._rgb,2,-e),this}saturate(e){return Rs(this._rgb,1,e),this}desaturate(e){return Rs(this._rgb,1,-e),this}rotate(e){return ng(this._rgb,e),this}}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */function Ke(){}const ug=(()=>{let t=0;return()=>t++})();function H(t){return t===null||typeof t>"u"}function Q(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function W(t){return t!==null&&Object.prototype.toString.call(t)==="[object Object]"}function se(t){return(typeof t=="number"||t instanceof Number)&&isFinite(+t)}function Te(t,e){return se(t)?t:e}function P(t,e){return typeof t>"u"?e:t}const hg=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100:+t/e,lc=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100*e:+t;function K(t,e,n){if(t&&typeof t.call=="function")return t.apply(n,e)}function q(t,e,n,s){let i,a,r;if(Q(t))for(a=t.length,i=0;i<a;i++)e.call(n,t[i],i);else if(W(t))for(r=Object.keys(t),a=r.length,i=0;i<a;i++)e.call(n,t[r[i]],r[i])}function hi(t,e){let n,s,i,a;if(!t||!e||t.length!==e.length)return!1;for(n=0,s=t.length;n<s;++n)if(i=t[n],a=e[n],i.datasetIndex!==a.datasetIndex||i.index!==a.index)return!1;return!0}function fi(t){if(Q(t))return t.map(fi);if(W(t)){const e=Object.create(null),n=Object.keys(t),s=n.length;let i=0;for(;i<s;++i)e[n[i]]=fi(t[n[i]]);return e}return t}function cc(t){return["__proto__","prototype","constructor"].indexOf(t)===-1}function fg(t,e,n,s){if(!cc(t))return;const i=e[t],a=n[t];W(i)&&W(a)?rs(i,a,s):e[t]=fi(a)}function rs(t,e,n){const s=Q(e)?e:[e],i=s.length;if(!W(t))return t;n=n||{};const a=n.merger||fg;let r;for(let o=0;o<i;++o){if(r=s[o],!W(r))continue;const l=Object.keys(r);for(let c=0,d=l.length;c<d;++c)a(l[c],t,r,n)}return t}function Hn(t,e){return rs(t,e,{merger:gg})}function gg(t,e,n){if(!cc(t))return;const s=e[t],i=n[t];W(s)&&W(i)?Hn(s,i):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=fi(i))}const ao={"":t=>t,x:t=>t.x,y:t=>t.y};function pg(t){const e=t.split("."),n=[];let s="";for(const i of e)s+=i,s.endsWith("\\")?s=s.slice(0,-1)+".":(n.push(s),s="");return n}function mg(t){const e=pg(t);return n=>{for(const s of e){if(s==="")break;n=n&&n[s]}return n}}function mt(t,e){return(ao[e]||(ao[e]=mg(e)))(t)}function Xa(t){return t.charAt(0).toUpperCase()+t.slice(1)}const os=t=>typeof t<"u",_t=t=>typeof t=="function",ro=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0};function _g(t){return t.type==="mouseup"||t.type==="click"||t.type==="contextmenu"}const X=Math.PI,J=2*X,yg=J+X,gi=Number.POSITIVE_INFINITY,bg=X/180,ae=X/2,wt=X/4,oo=X*2/3,ut=Math.log10,ze=Math.sign;function Un(t,e,n){return Math.abs(t-e)<n}function lo(t){const e=Math.round(t);t=Un(t,e,t/1e3)?e:t;const n=Math.pow(10,Math.floor(ut(t))),s=t/n;return(s<=1?1:s<=2?2:s<=5?5:10)*n}function vg(t){const e=[],n=Math.sqrt(t);let s;for(s=1;s<n;s++)t%s===0&&(e.push(s),e.push(t/s));return n===(n|0)&&e.push(n),e.sort((i,a)=>i-a).pop(),e}function on(t){return!isNaN(parseFloat(t))&&isFinite(t)}function wg(t,e){const n=Math.round(t);return n-e<=t&&n+e>=t}function dc(t,e,n){let s,i,a;for(s=0,i=t.length;s<i;s++)a=t[s][n],isNaN(a)||(e.min=Math.min(e.min,a),e.max=Math.max(e.max,a))}function Ne(t){return t*(X/180)}function Qa(t){return t*(180/X)}function co(t){if(!se(t))return;let e=1,n=0;for(;Math.round(t*e)/e!==t;)e*=10,n++;return n}function uc(t,e){const n=e.x-t.x,s=e.y-t.y,i=Math.sqrt(n*n+s*s);let a=Math.atan2(s,n);return a<-.5*X&&(a+=J),{angle:a,distance:i}}function Aa(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function kg(t,e){return(t-e+yg)%J-X}function Re(t){return(t%J+J)%J}function ls(t,e,n,s){const i=Re(t),a=Re(e),r=Re(n),o=Re(a-i),l=Re(r-i),c=Re(i-a),d=Re(i-r);return i===a||i===r||s&&a===r||o>l&&c<d}function ue(t,e,n){return Math.max(e,Math.min(n,t))}function Sg(t){return ue(t,-32768,32767)}function nt(t,e,n,s=1e-6){return t>=Math.min(e,n)-s&&t<=Math.max(e,n)+s}function Za(t,e,n){n=n||(r=>t[r]<e);let s=t.length-1,i=0,a;for(;s-i>1;)a=i+s>>1,n(a)?i=a:s=a;return{lo:i,hi:s}}const st=(t,e,n,s)=>Za(t,n,s?i=>{const a=t[i][e];return a<n||a===n&&t[i+1][e]===n}:i=>t[i][e]<n),xg=(t,e,n)=>Za(t,n,s=>t[s][e]>=n);function Cg(t,e,n){let s=0,i=t.length;for(;s<i&&t[s]<e;)s++;for(;i>s&&t[i-1]>n;)i--;return s>0||i<t.length?t.slice(s,i):t}const hc=["push","pop","shift","splice","unshift"];function Eg(t,e){if(t._chartjs){t._chartjs.listeners.push(e);return}Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),hc.forEach(n=>{const s="_onData"+Xa(n),i=t[n];Object.defineProperty(t,n,{configurable:!0,enumerable:!1,value(...a){const r=i.apply(this,a);return t._chartjs.listeners.forEach(o=>{typeof o[s]=="function"&&o[s](...a)}),r}})})}function uo(t,e){const n=t._chartjs;if(!n)return;const s=n.listeners,i=s.indexOf(e);i!==-1&&s.splice(i,1),!(s.length>0)&&(hc.forEach(a=>{delete t[a]}),delete t._chartjs)}function fc(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const gc=function(){return typeof window>"u"?function(t){return t()}:window.requestAnimationFrame}();function pc(t,e){let n=[],s=!1;return function(...i){n=i,s||(s=!0,gc.call(window,()=>{s=!1,t.apply(e,n)}))}}function Ag(t,e){let n;return function(...s){return e?(clearTimeout(n),n=setTimeout(t,e,s)):t.apply(this,s),e}}const er=t=>t==="start"?"left":t==="end"?"right":"center",me=(t,e,n)=>t==="start"?e:t==="end"?n:(e+n)/2,Mg=(t,e,n,s)=>t===(s?"left":"right")?n:t==="center"?(e+n)/2:e;function mc(t,e,n){const s=e.length;let i=0,a=s;if(t._sorted){const{iScale:r,_parsed:o}=t,l=r.axis,{min:c,max:d,minDefined:u,maxDefined:h}=r.getUserBounds();u&&(i=ue(Math.min(st(o,l,c).lo,n?s:st(e,l,r.getPixelForValue(c)).lo),0,s-1)),h?a=ue(Math.max(st(o,r.axis,d,!0).hi+1,n?0:st(e,l,r.getPixelForValue(d),!0).hi+1),i,s)-i:a=s-i}return{start:i,count:a}}function _c(t){const{xScale:e,yScale:n,_scaleRanges:s}=t,i={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!s)return t._scaleRanges=i,!0;const a=s.xmin!==e.min||s.xmax!==e.max||s.ymin!==n.min||s.ymax!==n.max;return Object.assign(s,i),a}const Ds=t=>t===0||t===1,ho=(t,e,n)=>-(Math.pow(2,10*(t-=1))*Math.sin((t-e)*J/n)),fo=(t,e,n)=>Math.pow(2,-10*t)*Math.sin((t-e)*J/n)+1,qn={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>-Math.cos(t*ae)+1,easeOutSine:t=>Math.sin(t*ae),easeInOutSine:t=>-.5*(Math.cos(X*t)-1),easeInExpo:t=>t===0?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>t===1?1:-Math.pow(2,-10*t)+1,easeInOutExpo:t=>Ds(t)?t:t<.5?.5*Math.pow(2,10*(t*2-1)):.5*(-Math.pow(2,-10*(t*2-1))+2),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>Ds(t)?t:ho(t,.075,.3),easeOutElastic:t=>Ds(t)?t:fo(t,.075,.3),easeInOutElastic(t){return Ds(t)?t:t<.5?.5*ho(t*2,.1125,.45):.5+.5*fo(t*2-1,.1125,.45)},easeInBack(t){return t*t*((1.70158+1)*t-1.70158)},easeOutBack(t){return(t-=1)*t*((1.70158+1)*t+1.70158)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:t=>1-qn.easeOutBounce(1-t),easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInOutBounce:t=>t<.5?qn.easeInBounce(t*2)*.5:qn.easeOutBounce(t*2-1)*.5+.5};function tr(t){if(t&&typeof t=="object"){const e=t.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function go(t){return tr(t)?t:new as(t)}function na(t){return tr(t)?t:new as(t).saturate(.5).darken(.1).hexString()}const Tg=["x","y","borderWidth","radius","tension"],Rg=["color","borderColor","backgroundColor"];function Dg(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),t.set("animations",{colors:{type:"color",properties:Rg},numbers:{type:"number",properties:Tg}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function Ig(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const po=new Map;function Lg(t,e){e=e||{};const n=t+JSON.stringify(e);let s=po.get(n);return s||(s=new Intl.NumberFormat(t,e),po.set(n,s)),s}function _s(t,e,n){return Lg(e,n).format(t)}const yc={values(t){return Q(t)?t:""+t},numeric(t,e,n){if(t===0)return"0";const s=this.chart.options.locale;let i,a=t;if(n.length>1){const c=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(c<1e-4||c>1e15)&&(i="scientific"),a=Og(t,n)}const r=ut(Math.abs(a)),o=isNaN(r)?1:Math.max(Math.min(-1*Math.floor(r),20),0),l={notation:i,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(l,this.options.ticks.format),_s(t,s,l)},logarithmic(t,e,n){if(t===0)return"0";const s=n[e].significand||t/Math.pow(10,Math.floor(ut(t)));return[1,2,3,5,10,15].includes(s)||e>.8*n.length?yc.numeric.call(this,t,e,n):""}};function Og(t,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t)),n}var Di={formatters:yc};function Pg(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,n)=>n.lineWidth,tickColor:(e,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Di.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const Ot=Object.create(null),Ma=Object.create(null);function Vn(t,e){if(!e)return t;const n=e.split(".");for(let s=0,i=n.length;s<i;++s){const a=n[s];t=t[a]||(t[a]=Object.create(null))}return t}function sa(t,e,n){return typeof e=="string"?rs(Vn(t,e),n):rs(Vn(t,""),e)}class $g{constructor(e,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=s=>s.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(s,i)=>na(i.backgroundColor),this.hoverBorderColor=(s,i)=>na(i.borderColor),this.hoverColor=(s,i)=>na(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(n)}set(e,n){return sa(this,e,n)}get(e){return Vn(this,e)}describe(e,n){return sa(Ma,e,n)}override(e,n){return sa(Ot,e,n)}route(e,n,s,i){const a=Vn(this,e),r=Vn(this,s),o="_"+n;Object.defineProperties(a,{[o]:{value:a[n],writable:!0},[n]:{enumerable:!0,get(){const l=this[o],c=r[i];return W(l)?Object.assign({},c,l):P(l,c)},set(l){this[o]=l}}})}apply(e){e.forEach(n=>n(this))}}var ie=new $g({_scriptable:t=>!t.startsWith("on"),_indexable:t=>t!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Dg,Ig,Pg]);function Ng(t){return!t||H(t.size)||H(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function pi(t,e,n,s,i){let a=e[i];return a||(a=e[i]=t.measureText(i).width,n.push(i)),a>s&&(s=a),s}function Bg(t,e,n,s){s=s||{};let i=s.data=s.data||{},a=s.garbageCollect=s.garbageCollect||[];s.font!==e&&(i=s.data={},a=s.garbageCollect=[],s.font=e),t.save(),t.font=e;let r=0;const o=n.length;let l,c,d,u,h;for(l=0;l<o;l++)if(u=n[l],u!=null&&!Q(u))r=pi(t,i,a,r,u);else if(Q(u))for(c=0,d=u.length;c<d;c++)h=u[c],h!=null&&!Q(h)&&(r=pi(t,i,a,r,h));t.restore();const f=a.length/2;if(f>n.length){for(l=0;l<f;l++)delete i[a[l]];a.splice(0,f)}return r}function kt(t,e,n){const s=t.currentDevicePixelRatio,i=n!==0?Math.max(n/2,.5):0;return Math.round((e-i)*s)/s+i}function mo(t,e){e=e||t.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function Ta(t,e,n,s){bc(t,e,n,s,null)}function bc(t,e,n,s,i){let a,r,o,l,c,d,u,h;const f=e.pointStyle,p=e.rotation,g=e.radius;let m=(p||0)*bg;if(f&&typeof f=="object"&&(a=f.toString(),a==="[object HTMLImageElement]"||a==="[object HTMLCanvasElement]")){t.save(),t.translate(n,s),t.rotate(m),t.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),t.restore();return}if(!(isNaN(g)||g<=0)){switch(t.beginPath(),f){default:i?t.ellipse(n,s,i/2,g,0,0,J):t.arc(n,s,g,0,J),t.closePath();break;case"triangle":d=i?i/2:g,t.moveTo(n+Math.sin(m)*d,s-Math.cos(m)*g),m+=oo,t.lineTo(n+Math.sin(m)*d,s-Math.cos(m)*g),m+=oo,t.lineTo(n+Math.sin(m)*d,s-Math.cos(m)*g),t.closePath();break;case"rectRounded":c=g*.516,l=g-c,r=Math.cos(m+wt)*l,u=Math.cos(m+wt)*(i?i/2-c:l),o=Math.sin(m+wt)*l,h=Math.sin(m+wt)*(i?i/2-c:l),t.arc(n-u,s-o,c,m-X,m-ae),t.arc(n+h,s-r,c,m-ae,m),t.arc(n+u,s+o,c,m,m+ae),t.arc(n-h,s+r,c,m+ae,m+X),t.closePath();break;case"rect":if(!p){l=Math.SQRT1_2*g,d=i?i/2:l,t.rect(n-d,s-l,2*d,2*l);break}m+=wt;case"rectRot":u=Math.cos(m)*(i?i/2:g),r=Math.cos(m)*g,o=Math.sin(m)*g,h=Math.sin(m)*(i?i/2:g),t.moveTo(n-u,s-o),t.lineTo(n+h,s-r),t.lineTo(n+u,s+o),t.lineTo(n-h,s+r),t.closePath();break;case"crossRot":m+=wt;case"cross":u=Math.cos(m)*(i?i/2:g),r=Math.cos(m)*g,o=Math.sin(m)*g,h=Math.sin(m)*(i?i/2:g),t.moveTo(n-u,s-o),t.lineTo(n+u,s+o),t.moveTo(n+h,s-r),t.lineTo(n-h,s+r);break;case"star":u=Math.cos(m)*(i?i/2:g),r=Math.cos(m)*g,o=Math.sin(m)*g,h=Math.sin(m)*(i?i/2:g),t.moveTo(n-u,s-o),t.lineTo(n+u,s+o),t.moveTo(n+h,s-r),t.lineTo(n-h,s+r),m+=wt,u=Math.cos(m)*(i?i/2:g),r=Math.cos(m)*g,o=Math.sin(m)*g,h=Math.sin(m)*(i?i/2:g),t.moveTo(n-u,s-o),t.lineTo(n+u,s+o),t.moveTo(n+h,s-r),t.lineTo(n-h,s+r);break;case"line":r=i?i/2:Math.cos(m)*g,o=Math.sin(m)*g,t.moveTo(n-r,s-o),t.lineTo(n+r,s+o);break;case"dash":t.moveTo(n,s),t.lineTo(n+Math.cos(m)*(i?i/2:g),s+Math.sin(m)*g);break;case!1:t.closePath();break}t.fill(),e.borderWidth>0&&t.stroke()}}function it(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function Ii(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function Li(t){t.restore()}function jg(t,e,n,s,i){if(!e)return t.lineTo(n.x,n.y);if(i==="middle"){const a=(e.x+n.x)/2;t.lineTo(a,e.y),t.lineTo(a,n.y)}else i==="after"!=!!s?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function Fg(t,e,n,s){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(s?e.cp1x:e.cp2x,s?e.cp1y:e.cp2y,s?n.cp2x:n.cp1x,s?n.cp2y:n.cp1y,n.x,n.y)}function Wg(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),H(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}function Gg(t,e,n,s,i){if(i.strikethrough||i.underline){const a=t.measureText(s),r=e-a.actualBoundingBoxLeft,o=e+a.actualBoundingBoxRight,l=n-a.actualBoundingBoxAscent,c=n+a.actualBoundingBoxDescent,d=i.strikethrough?(l+c)/2:c;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=i.decorationWidth||2,t.moveTo(r,d),t.lineTo(o,d),t.stroke()}}function Hg(t,e){const n=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=n}function Pt(t,e,n,s,i,a={}){const r=Q(e)?e:[e],o=a.strokeWidth>0&&a.strokeColor!=="";let l,c;for(t.save(),t.font=i.string,Wg(t,a),l=0;l<r.length;++l)c=r[l],a.backdrop&&Hg(t,a.backdrop),o&&(a.strokeColor&&(t.strokeStyle=a.strokeColor),H(a.strokeWidth)||(t.lineWidth=a.strokeWidth),t.strokeText(c,n,s,a.maxWidth)),t.fillText(c,n,s,a.maxWidth),Gg(t,n,s,c,a),s+=Number(i.lineHeight);t.restore()}function cs(t,e){const{x:n,y:s,w:i,h:a,radius:r}=e;t.arc(n+r.topLeft,s+r.topLeft,r.topLeft,1.5*X,X,!0),t.lineTo(n,s+a-r.bottomLeft),t.arc(n+r.bottomLeft,s+a-r.bottomLeft,r.bottomLeft,X,ae,!0),t.lineTo(n+i-r.bottomRight,s+a),t.arc(n+i-r.bottomRight,s+a-r.bottomRight,r.bottomRight,ae,0,!0),t.lineTo(n+i,s+r.topRight),t.arc(n+i-r.topRight,s+r.topRight,r.topRight,0,-ae,!0),t.lineTo(n+r.topLeft,s)}const Ug=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,qg=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Vg(t,e){const n=(""+t).match(Ug);if(!n||n[1]==="normal")return e*1.2;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100;break}return e*t}const zg=t=>+t||0;function nr(t,e){const n={},s=W(e),i=s?Object.keys(e):e,a=W(t)?s?r=>P(t[r],t[e[r]]):r=>t[r]:()=>t;for(const r of i)n[r]=zg(a(r));return n}function vc(t){return nr(t,{top:"y",right:"x",bottom:"y",left:"x"})}function It(t){return nr(t,["topLeft","topRight","bottomLeft","bottomRight"])}function be(t){const e=vc(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function de(t,e){t=t||{},e=e||ie.font;let n=P(t.size,e.size);typeof n=="string"&&(n=parseInt(n,10));let s=P(t.style,e.style);s&&!(""+s).match(qg)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const i={family:P(t.family,e.family),lineHeight:Vg(P(t.lineHeight,e.lineHeight),n),size:n,style:s,weight:P(t.weight,e.weight),string:""};return i.string=Ng(i),i}function On(t,e,n,s){let i,a,r;for(i=0,a=t.length;i<a;++i)if(r=t[i],r!==void 0&&r!==void 0)return r}function Kg(t,e,n){const{min:s,max:i}=t,a=lc(e,(i-s)/2),r=(o,l)=>n&&o===0?0:o+l;return{min:r(s,-Math.abs(a)),max:r(i,a)}}function yt(t,e){return Object.assign(Object.create(t),e)}function sr(t,e=[""],n,s,i=()=>t[0]){const a=n||t;typeof s>"u"&&(s=xc("_fallback",t));const r={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:a,_fallback:s,_getTarget:i,override:o=>sr([o,...t],e,a,s)};return new Proxy(r,{deleteProperty(o,l){return delete o[l],delete o._keys,delete t[0][l],!0},get(o,l){return kc(o,l,()=>np(l,e,t,o))},getOwnPropertyDescriptor(o,l){return Reflect.getOwnPropertyDescriptor(o._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(t[0])},has(o,l){return yo(o).includes(l)},ownKeys(o){return yo(o)},set(o,l,c){const d=o._storage||(o._storage=i());return o[l]=d[l]=c,delete o._keys,!0}})}function ln(t,e,n,s){const i={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:wc(t,s),setContext:a=>ln(t,a,n,s),override:a=>ln(t.override(a),e,n,s)};return new Proxy(i,{deleteProperty(a,r){return delete a[r],delete t[r],!0},get(a,r,o){return kc(a,r,()=>Jg(a,r,o))},getOwnPropertyDescriptor(a,r){return a._descriptors.allKeys?Reflect.has(t,r)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,r)},getPrototypeOf(){return Reflect.getPrototypeOf(t)},has(a,r){return Reflect.has(t,r)},ownKeys(){return Reflect.ownKeys(t)},set(a,r,o){return t[r]=o,delete a[r],!0}})}function wc(t,e={scriptable:!0,indexable:!0}){const{_scriptable:n=e.scriptable,_indexable:s=e.indexable,_allKeys:i=e.allKeys}=t;return{allKeys:i,scriptable:n,indexable:s,isScriptable:_t(n)?n:()=>n,isIndexable:_t(s)?s:()=>s}}const Yg=(t,e)=>t?t+Xa(e):e,ir=(t,e)=>W(e)&&t!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function kc(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];const s=n();return t[e]=s,s}function Jg(t,e,n){const{_proxy:s,_context:i,_subProxy:a,_descriptors:r}=t;let o=s[e];return _t(o)&&r.isScriptable(e)&&(o=Xg(e,o,t,n)),Q(o)&&o.length&&(o=Qg(e,o,t,r.isIndexable)),ir(e,o)&&(o=ln(o,i,a&&a[e],r)),o}function Xg(t,e,n,s){const{_proxy:i,_context:a,_subProxy:r,_stack:o}=n;if(o.has(t))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+t);o.add(t);let l=e(a,r||s);return o.delete(t),ir(t,l)&&(l=ar(i._scopes,i,t,l)),l}function Qg(t,e,n,s){const{_proxy:i,_context:a,_subProxy:r,_descriptors:o}=n;if(typeof a.index<"u"&&s(t))return e[a.index%e.length];if(W(e[0])){const l=e,c=i._scopes.filter(d=>d!==l);e=[];for(const d of l){const u=ar(c,i,t,d);e.push(ln(u,a,r&&r[t],o))}}return e}function Sc(t,e,n){return _t(t)?t(e,n):t}const Zg=(t,e)=>t===!0?e:typeof t=="string"?mt(e,t):void 0;function ep(t,e,n,s,i){for(const a of e){const r=Zg(n,a);if(r){t.add(r);const o=Sc(r._fallback,n,i);if(typeof o<"u"&&o!==n&&o!==s)return o}else if(r===!1&&typeof s<"u"&&n!==s)return null}return!1}function ar(t,e,n,s){const i=e._rootScopes,a=Sc(e._fallback,n,s),r=[...t,...i],o=new Set;o.add(s);let l=_o(o,r,n,a||n,s);return l===null||typeof a<"u"&&a!==n&&(l=_o(o,r,a,l,s),l===null)?!1:sr(Array.from(o),[""],i,a,()=>tp(e,n,s))}function _o(t,e,n,s,i){for(;n;)n=ep(t,e,n,s,i);return n}function tp(t,e,n){const s=t._getTarget();e in s||(s[e]={});const i=s[e];return Q(i)&&W(n)?n:i||{}}function np(t,e,n,s){let i;for(const a of e)if(i=xc(Yg(a,t),n),typeof i<"u")return ir(t,i)?ar(n,s,t,i):i}function xc(t,e){for(const n of e){if(!n)continue;const s=n[t];if(typeof s<"u")return s}}function yo(t){let e=t._keys;return e||(e=t._keys=sp(t._scopes)),e}function sp(t){const e=new Set;for(const n of t)for(const s of Object.keys(n).filter(i=>!i.startsWith("_")))e.add(s);return Array.from(e)}function Cc(t,e,n,s){const{iScale:i}=t,{key:a="r"}=this._parsing,r=new Array(s);let o,l,c,d;for(o=0,l=s;o<l;++o)c=o+n,d=e[c],r[o]={r:i.parse(mt(d,a),c)};return r}const ip=Number.EPSILON||1e-14,cn=(t,e)=>e<t.length&&!t[e].skip&&t[e],Ec=t=>t==="x"?"y":"x";function ap(t,e,n,s){const i=t.skip?e:t,a=e,r=n.skip?e:n,o=Aa(a,i),l=Aa(r,a);let c=o/(o+l),d=l/(o+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=s*c,h=s*d;return{previous:{x:a.x-u*(r.x-i.x),y:a.y-u*(r.y-i.y)},next:{x:a.x+h*(r.x-i.x),y:a.y+h*(r.y-i.y)}}}function rp(t,e,n){const s=t.length;let i,a,r,o,l,c=cn(t,0);for(let d=0;d<s-1;++d)if(l=c,c=cn(t,d+1),!(!l||!c)){if(Un(e[d],0,ip)){n[d]=n[d+1]=0;continue}i=n[d]/e[d],a=n[d+1]/e[d],o=Math.pow(i,2)+Math.pow(a,2),!(o<=9)&&(r=3/Math.sqrt(o),n[d]=i*r*e[d],n[d+1]=a*r*e[d])}}function op(t,e,n="x"){const s=Ec(n),i=t.length;let a,r,o,l=cn(t,0);for(let c=0;c<i;++c){if(r=o,o=l,l=cn(t,c+1),!o)continue;const d=o[n],u=o[s];r&&(a=(d-r[n])/3,o[`cp1${n}`]=d-a,o[`cp1${s}`]=u-a*e[c]),l&&(a=(l[n]-d)/3,o[`cp2${n}`]=d+a,o[`cp2${s}`]=u+a*e[c])}}function lp(t,e="x"){const n=Ec(e),s=t.length,i=Array(s).fill(0),a=Array(s);let r,o,l,c=cn(t,0);for(r=0;r<s;++r)if(o=l,l=c,c=cn(t,r+1),!!l){if(c){const d=c[e]-l[e];i[r]=d!==0?(c[n]-l[n])/d:0}a[r]=o?c?ze(i[r-1])!==ze(i[r])?0:(i[r-1]+i[r])/2:i[r-1]:i[r]}rp(t,i,a),op(t,a,e)}function Is(t,e,n){return Math.max(Math.min(t,n),e)}function cp(t,e){let n,s,i,a,r,o=it(t[0],e);for(n=0,s=t.length;n<s;++n)r=a,a=o,o=n<s-1&&it(t[n+1],e),a&&(i=t[n],r&&(i.cp1x=Is(i.cp1x,e.left,e.right),i.cp1y=Is(i.cp1y,e.top,e.bottom)),o&&(i.cp2x=Is(i.cp2x,e.left,e.right),i.cp2y=Is(i.cp2y,e.top,e.bottom)))}function dp(t,e,n,s,i){let a,r,o,l;if(e.spanGaps&&(t=t.filter(c=>!c.skip)),e.cubicInterpolationMode==="monotone")lp(t,i);else{let c=s?t[t.length-1]:t[0];for(a=0,r=t.length;a<r;++a)o=t[a],l=ap(c,o,t[Math.min(a+1,r-(s?0:1))%r],e.tension),o.cp1x=l.previous.x,o.cp1y=l.previous.y,o.cp2x=l.next.x,o.cp2y=l.next.y,c=o}e.capBezierPoints&&cp(t,n)}function Ac(){return typeof window<"u"&&typeof document<"u"}function rr(t){let e=t.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function mi(t,e,n){let s;return typeof t=="string"?(s=parseInt(t,10),t.indexOf("%")!==-1&&(s=s/100*e.parentNode[n])):s=t,s}const Oi=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);function up(t,e){return Oi(t).getPropertyValue(e)}const hp=["top","right","bottom","left"];function Lt(t,e,n){const s={};n=n?"-"+n:"";for(let i=0;i<4;i++){const a=hp[i];s[a]=parseFloat(t[e+"-"+a+n])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const fp=(t,e,n)=>(t>0||e>0)&&(!n||!n.shadowRoot);function gp(t,e){const n=t.touches,s=n&&n.length?n[0]:t,{offsetX:i,offsetY:a}=s;let r=!1,o,l;if(fp(i,a,t.target))o=i,l=a;else{const c=e.getBoundingClientRect();o=s.clientX-c.left,l=s.clientY-c.top,r=!0}return{x:o,y:l,box:r}}function Et(t,e){if("native"in t)return t;const{canvas:n,currentDevicePixelRatio:s}=e,i=Oi(n),a=i.boxSizing==="border-box",r=Lt(i,"padding"),o=Lt(i,"border","width"),{x:l,y:c,box:d}=gp(t,n),u=r.left+(d&&o.left),h=r.top+(d&&o.top);let{width:f,height:p}=e;return a&&(f-=r.width+o.width,p-=r.height+o.height),{x:Math.round((l-u)/f*n.width/s),y:Math.round((c-h)/p*n.height/s)}}function pp(t,e,n){let s,i;if(e===void 0||n===void 0){const a=rr(t);if(!a)e=t.clientWidth,n=t.clientHeight;else{const r=a.getBoundingClientRect(),o=Oi(a),l=Lt(o,"border","width"),c=Lt(o,"padding");e=r.width-c.width-l.width,n=r.height-c.height-l.height,s=mi(o.maxWidth,a,"clientWidth"),i=mi(o.maxHeight,a,"clientHeight")}}return{width:e,height:n,maxWidth:s||gi,maxHeight:i||gi}}const Ls=t=>Math.round(t*10)/10;function mp(t,e,n,s){const i=Oi(t),a=Lt(i,"margin"),r=mi(i.maxWidth,t,"clientWidth")||gi,o=mi(i.maxHeight,t,"clientHeight")||gi,l=pp(t,e,n);let{width:c,height:d}=l;if(i.boxSizing==="content-box"){const h=Lt(i,"border","width"),f=Lt(i,"padding");c-=f.width+h.width,d-=f.height+h.height}return c=Math.max(0,c-a.width),d=Math.max(0,s?c/s:d-a.height),c=Ls(Math.min(c,r,l.maxWidth)),d=Ls(Math.min(d,o,l.maxHeight)),c&&!d&&(d=Ls(c/2)),(e!==void 0||n!==void 0)&&s&&l.height&&d>l.height&&(d=l.height,c=Ls(Math.floor(d*s))),{width:c,height:d}}function bo(t,e,n){const s=e||1,i=Math.floor(t.height*s),a=Math.floor(t.width*s);t.height=Math.floor(t.height),t.width=Math.floor(t.width);const r=t.canvas;return r.style&&(n||!r.style.height&&!r.style.width)&&(r.style.height=`${t.height}px`,r.style.width=`${t.width}px`),t.currentDevicePixelRatio!==s||r.height!==i||r.width!==a?(t.currentDevicePixelRatio=s,r.height=i,r.width=a,t.ctx.setTransform(s,0,0,s,0,0),!0):!1}const _p=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch{}return t}();function vo(t,e){const n=up(t,e),s=n&&n.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function At(t,e,n,s){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function yp(t,e,n,s){return{x:t.x+n*(e.x-t.x),y:s==="middle"?n<.5?t.y:e.y:s==="after"?n<1?t.y:e.y:n>0?e.y:t.y}}function bp(t,e,n,s){const i={x:t.cp2x,y:t.cp2y},a={x:e.cp1x,y:e.cp1y},r=At(t,i,n),o=At(i,a,n),l=At(a,e,n),c=At(r,o,n),d=At(o,l,n);return At(c,d,n)}const vp=function(t,e){return{x(n){return t+t+e-n},setWidth(n){e=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,s){return n-s},leftForLtr(n,s){return n-s}}},wp=function(){return{x(t){return t},setWidth(t){},textAlign(t){return t},xPlus(t,e){return t+e},leftForLtr(t,e){return t}}};function an(t,e,n){return t?vp(e,n):wp()}function Mc(t,e){let n,s;(e==="ltr"||e==="rtl")&&(n=t.canvas.style,s=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=s)}function Tc(t,e){e!==void 0&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function Rc(t){return t==="angle"?{between:ls,compare:kg,normalize:Re}:{between:nt,compare:(e,n)=>e-n,normalize:e=>e}}function wo({start:t,end:e,count:n,loop:s,style:i}){return{start:t%n,end:e%n,loop:s&&(e-t+1)%n===0,style:i}}function kp(t,e,n){const{property:s,start:i,end:a}=n,{between:r,normalize:o}=Rc(s),l=e.length;let{start:c,end:d,loop:u}=t,h,f;if(u){for(c+=l,d+=l,h=0,f=l;h<f&&r(o(e[c%l][s]),i,a);++h)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:u,style:t.style}}function Dc(t,e,n){if(!n)return[t];const{property:s,start:i,end:a}=n,r=e.length,{compare:o,between:l,normalize:c}=Rc(s),{start:d,end:u,loop:h,style:f}=kp(t,e,n),p=[];let g=!1,m=null,_,y,b;const v=()=>l(i,b,_)&&o(i,b)!==0,w=()=>o(a,_)===0||l(a,b,_),k=()=>g||v(),S=()=>!g||w();for(let x=d,E=d;x<=u;++x)y=e[x%r],!y.skip&&(_=c(y[s]),_!==b&&(g=l(_,i,a),m===null&&k()&&(m=o(_,i)===0?x:E),m!==null&&S()&&(p.push(wo({start:m,end:x,loop:h,count:r,style:f})),m=null),E=x,b=_));return m!==null&&p.push(wo({start:m,end:u,loop:h,count:r,style:f})),p}function Ic(t,e){const n=[],s=t.segments;for(let i=0;i<s.length;i++){const a=Dc(s[i],t.points,e);a.length&&n.push(...a)}return n}function Sp(t,e,n,s){let i=0,a=e-1;if(n&&!s)for(;i<e&&!t[i].skip;)i++;for(;i<e&&t[i].skip;)i++;for(i%=e,n&&(a+=i);a>i&&t[a%e].skip;)a--;return a%=e,{start:i,end:a}}function xp(t,e,n,s){const i=t.length,a=[];let r=e,o=t[e],l;for(l=e+1;l<=n;++l){const c=t[l%i];c.skip||c.stop?o.skip||(s=!1,a.push({start:e%i,end:(l-1)%i,loop:s}),e=r=c.stop?l:null):(r=l,o.skip&&(e=l)),o=c}return r!==null&&a.push({start:e%i,end:r%i,loop:s}),a}function Cp(t,e){const n=t.points,s=t.options.spanGaps,i=n.length;if(!i)return[];const a=!!t._loop,{start:r,end:o}=Sp(n,i,a,s);if(s===!0)return ko(t,[{start:r,end:o,loop:a}],n,e);const l=o<r?o+i:o,c=!!t._fullLoop&&r===0&&o===i-1;return ko(t,xp(n,r,l,c),n,e)}function ko(t,e,n,s){return!s||!s.setContext||!n?e:Ep(t,e,n,s)}function Ep(t,e,n,s){const i=t._chart.getContext(),a=So(t.options),{_datasetIndex:r,options:{spanGaps:o}}=t,l=n.length,c=[];let d=a,u=e[0].start,h=u;function f(p,g,m,_){const y=o?-1:1;if(p!==g){for(p+=l;n[p%l].skip;)p-=y;for(;n[g%l].skip;)g+=y;p%l!==g%l&&(c.push({start:p%l,end:g%l,loop:m,style:_}),d=_,u=g%l)}}for(const p of e){u=o?u:p.start;let g=n[u%l],m;for(h=u+1;h<=p.end;h++){const _=n[h%l];m=So(s.setContext(yt(i,{type:"segment",p0:g,p1:_,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:r}))),Ap(m,d)&&f(u,h-1,p.loop,d),g=_,d=m}u<h-1&&f(u,h-1,p.loop,d)}return c}function So(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function Ap(t,e){if(!e)return!1;const n=[],s=function(i,a){return tr(a)?(n.includes(a)||n.push(a),n.indexOf(a)):a};return JSON.stringify(t,s)!==JSON.stringify(e,s)}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */class Mp{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,n,s,i){const a=n.listeners[i],r=n.duration;a.forEach(o=>o({chart:e,initial:n.initial,numSteps:r,currentStep:Math.min(s-n.start,r)}))}_refresh(){this._request||(this._running=!0,this._request=gc.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let n=0;this._charts.forEach((s,i)=>{if(!s.running||!s.items.length)return;const a=s.items;let r=a.length-1,o=!1,l;for(;r>=0;--r)l=a[r],l._active?(l._total>s.duration&&(s.duration=l._total),l.tick(e),o=!0):(a[r]=a[a.length-1],a.pop());o&&(i.draw(),this._notify(i,s,e,"progress")),a.length||(s.running=!1,this._notify(i,s,e,"complete"),s.initial=!1),n+=a.length}),this._lastDate=e,n===0&&(this._running=!1)}_getAnims(e){const n=this._charts;let s=n.get(e);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(e,s)),s}listen(e,n,s){this._getAnims(e).listeners[n].push(s)}add(e,n){!n||!n.length||this._getAnims(e).items.push(...n)}has(e){return this._getAnims(e).items.length>0}start(e){const n=this._charts.get(e);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((s,i)=>Math.max(s,i._duration),0),this._refresh())}running(e){if(!this._running)return!1;const n=this._charts.get(e);return!(!n||!n.running||!n.items.length)}stop(e){const n=this._charts.get(e);if(!n||!n.items.length)return;const s=n.items;let i=s.length-1;for(;i>=0;--i)s[i].cancel();n.items=[],this._notify(e,n,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Ye=new Mp;const xo="transparent",Tp={boolean(t,e,n){return n>.5?e:t},color(t,e,n){const s=go(t||xo),i=s.valid&&go(e||xo);return i&&i.valid?i.mix(s,n).hexString():e},number(t,e,n){return t+(e-t)*n}};class Rp{constructor(e,n,s,i){const a=n[s];i=On([e.to,i,a,e.from]);const r=On([e.from,a,i]);this._active=!0,this._fn=e.fn||Tp[e.type||typeof r],this._easing=qn[e.easing]||qn.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=n,this._prop=s,this._from=r,this._to=i,this._promises=void 0}active(){return this._active}update(e,n,s){if(this._active){this._notify(!1);const i=this._target[this._prop],a=s-this._start,r=this._duration-a;this._start=s,this._duration=Math.floor(Math.max(r,e.duration)),this._total+=a,this._loop=!!e.loop,this._to=On([e.to,n,i,e.from]),this._from=On([e.from,i,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const n=e-this._start,s=this._duration,i=this._prop,a=this._from,r=this._loop,o=this._to;let l;if(this._active=a!==o&&(r||n<s),!this._active){this._target[i]=o,this._notify(!0);return}if(n<0){this._target[i]=a;return}l=n/s%2,l=r&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[i]=this._fn(a,o,l)}wait(){const e=this._promises||(this._promises=[]);return new Promise((n,s)=>{e.push({res:n,rej:s})})}_notify(e){const n=e?"res":"rej",s=this._promises||[];for(let i=0;i<s.length;i++)s[i][n]()}}class Lc{constructor(e,n){this._chart=e,this._properties=new Map,this.configure(n)}configure(e){if(!W(e))return;const n=Object.keys(ie.animation),s=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const a=e[i];if(!W(a))return;const r={};for(const o of n)r[o]=a[o];(Q(a.properties)&&a.properties||[i]).forEach(o=>{(o===i||!s.has(o))&&s.set(o,r)})})}_animateOptions(e,n){const s=n.options,i=Ip(e,s);if(!i)return[];const a=this._createAnimations(i,s);return s.$shared&&Dp(e.options.$animations,s).then(()=>{e.options=s},()=>{}),a}_createAnimations(e,n){const s=this._properties,i=[],a=e.$animations||(e.$animations={}),r=Object.keys(n),o=Date.now();let l;for(l=r.length-1;l>=0;--l){const c=r[l];if(c.charAt(0)==="$")continue;if(c==="options"){i.push(...this._animateOptions(e,n));continue}const d=n[c];let u=a[c];const h=s.get(c);if(u)if(h&&u.active()){u.update(h,d,o);continue}else u.cancel();if(!h||!h.duration){e[c]=d;continue}a[c]=u=new Rp(h,e,c,d),i.push(u)}return i}update(e,n){if(this._properties.size===0){Object.assign(e,n);return}const s=this._createAnimations(e,n);if(s.length)return Ye.add(this._chart,s),!0}}function Dp(t,e){const n=[],s=Object.keys(e);for(let i=0;i<s.length;i++){const a=t[s[i]];a&&a.active()&&n.push(a.wait())}return Promise.all(n)}function Ip(t,e){if(!e)return;let n=t.options;if(!n){t.options=e;return}return n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function Co(t,e){const n=t&&t.options||{},s=n.reverse,i=n.min===void 0?e:0,a=n.max===void 0?e:0;return{start:s?a:i,end:s?i:a}}function Lp(t,e,n){if(n===!1)return!1;const s=Co(t,n),i=Co(e,n);return{top:i.end,right:s.end,bottom:i.start,left:s.start}}function Op(t){let e,n,s,i;return W(t)?(e=t.top,n=t.right,s=t.bottom,i=t.left):e=n=s=i=t,{top:e,right:n,bottom:s,left:i,disabled:t===!1}}function Oc(t,e){const n=[],s=t._getSortedDatasetMetas(e);let i,a;for(i=0,a=s.length;i<a;++i)n.push(s[i].index);return n}function Eo(t,e,n,s={}){const i=t.keys,a=s.mode==="single";let r,o,l,c;if(e!==null){for(r=0,o=i.length;r<o;++r){if(l=+i[r],l===n){if(s.all)continue;break}c=t.values[l],se(c)&&(a||e===0||ze(e)===ze(c))&&(e+=c)}return e}}function Pp(t){const e=Object.keys(t),n=new Array(e.length);let s,i,a;for(s=0,i=e.length;s<i;++s)a=e[s],n[s]={x:a,y:t[a]};return n}function Ao(t,e){const n=t&&t.options.stacked;return n||n===void 0&&e.stack!==void 0}function $p(t,e,n){return`${t.id}.${e.id}.${n.stack||n.type}`}function Np(t){const{min:e,max:n,minDefined:s,maxDefined:i}=t.getUserBounds();return{min:s?e:Number.NEGATIVE_INFINITY,max:i?n:Number.POSITIVE_INFINITY}}function Bp(t,e,n){const s=t[e]||(t[e]={});return s[n]||(s[n]={})}function Mo(t,e,n,s){for(const i of e.getMatchingVisibleMetas(s).reverse()){const a=t[i.index];if(n&&a>0||!n&&a<0)return i.index}return null}function To(t,e){const{chart:n,_cachedMeta:s}=t,i=n._stacks||(n._stacks={}),{iScale:a,vScale:r,index:o}=s,l=a.axis,c=r.axis,d=$p(a,r,s),u=e.length;let h;for(let f=0;f<u;++f){const p=e[f],{[l]:g,[c]:m}=p,_=p._stacks||(p._stacks={});h=_[c]=Bp(i,d,g),h[o]=m,h._top=Mo(h,r,!0,s.type),h._bottom=Mo(h,r,!1,s.type);const y=h._visualValues||(h._visualValues={});y[o]=m}}function ia(t,e){const n=t.scales;return Object.keys(n).filter(s=>n[s].axis===e).shift()}function jp(t,e){return yt(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function Fp(t,e,n){return yt(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}function Sn(t,e){const n=t.controller.index,s=t.vScale&&t.vScale.axis;if(s){e=e||t._parsed;for(const i of e){const a=i._stacks;if(!a||a[s]===void 0||a[s][n]===void 0)return;delete a[s][n],a[s]._visualValues!==void 0&&a[s]._visualValues[n]!==void 0&&delete a[s]._visualValues[n]}}}const aa=t=>t==="reset"||t==="none",Ro=(t,e)=>e?t:Object.assign({},t),Wp=(t,e,n)=>t&&!e.hidden&&e._stacked&&{keys:Oc(n,!0),values:null};class je{constructor(e,n){this.chart=e,this._ctx=e.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=Ao(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&Sn(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,n=this._cachedMeta,s=this.getDataset(),i=(u,h,f,p)=>u==="x"?h:u==="r"?p:f,a=n.xAxisID=P(s.xAxisID,ia(e,"x")),r=n.yAxisID=P(s.yAxisID,ia(e,"y")),o=n.rAxisID=P(s.rAxisID,ia(e,"r")),l=n.indexAxis,c=n.iAxisID=i(l,a,r,o),d=n.vAxisID=i(l,r,a,o);n.xScale=this.getScaleForId(a),n.yScale=this.getScaleForId(r),n.rScale=this.getScaleForId(o),n.iScale=this.getScaleForId(c),n.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const n=this._cachedMeta;return e===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&uo(this._data,this),e._stacked&&Sn(e)}_dataCheck(){const e=this.getDataset(),n=e.data||(e.data=[]),s=this._data;if(W(n))this._data=Pp(n);else if(s!==n){if(s){uo(s,this);const i=this._cachedMeta;Sn(i),i._parsed=[]}n&&Object.isExtensible(n)&&Eg(n,this),this._syncList=[],this._data=n}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const n=this._cachedMeta,s=this.getDataset();let i=!1;this._dataCheck();const a=n._stacked;n._stacked=Ao(n.vScale,n),n.stack!==s.stack&&(i=!0,Sn(n),n.stack=s.stack),this._resyncElements(e),(i||a!==n._stacked)&&To(this,n._parsed)}configure(){const e=this.chart.config,n=e.datasetScopeKeys(this._type),s=e.getOptionScopes(this.getDataset(),n,!0);this.options=e.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,n){const{_cachedMeta:s,_data:i}=this,{iScale:a,_stacked:r}=s,o=a.axis;let l=e===0&&n===i.length?!0:s._sorted,c=e>0&&s._parsed[e-1],d,u,h;if(this._parsing===!1)s._parsed=i,s._sorted=!0,h=i;else{Q(i[e])?h=this.parseArrayData(s,i,e,n):W(i[e])?h=this.parseObjectData(s,i,e,n):h=this.parsePrimitiveData(s,i,e,n);const f=()=>u[o]===null||c&&u[o]<c[o];for(d=0;d<n;++d)s._parsed[d+e]=u=h[d],l&&(f()&&(l=!1),c=u);s._sorted=l}r&&To(this,h)}parsePrimitiveData(e,n,s,i){const{iScale:a,vScale:r}=e,o=a.axis,l=r.axis,c=a.getLabels(),d=a===r,u=new Array(i);let h,f,p;for(h=0,f=i;h<f;++h)p=h+s,u[h]={[o]:d||a.parse(c[p],p),[l]:r.parse(n[p],p)};return u}parseArrayData(e,n,s,i){const{xScale:a,yScale:r}=e,o=new Array(i);let l,c,d,u;for(l=0,c=i;l<c;++l)d=l+s,u=n[d],o[l]={x:a.parse(u[0],d),y:r.parse(u[1],d)};return o}parseObjectData(e,n,s,i){const{xScale:a,yScale:r}=e,{xAxisKey:o="x",yAxisKey:l="y"}=this._parsing,c=new Array(i);let d,u,h,f;for(d=0,u=i;d<u;++d)h=d+s,f=n[h],c[d]={x:a.parse(mt(f,o),h),y:r.parse(mt(f,l),h)};return c}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,n,s){const i=this.chart,a=this._cachedMeta,r=n[e.axis],o={keys:Oc(i,!0),values:n._stacks[e.axis]._visualValues};return Eo(o,r,a.index,{mode:s})}updateRangeFromParsed(e,n,s,i){const a=s[n.axis];let r=a===null?NaN:a;const o=i&&s._stacks[n.axis];i&&o&&(i.values=o,r=Eo(i,a,this._cachedMeta.index)),e.min=Math.min(e.min,r),e.max=Math.max(e.max,r)}getMinMax(e,n){const s=this._cachedMeta,i=s._parsed,a=s._sorted&&e===s.iScale,r=i.length,o=this._getOtherScale(e),l=Wp(n,s,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:u}=Np(o);let h,f;function p(){f=i[h];const g=f[o.axis];return!se(f[e.axis])||d>g||u<g}for(h=0;h<r&&!(!p()&&(this.updateRangeFromParsed(c,e,f,l),a));++h);if(a){for(h=r-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(c,e,f,l);break}}return c}getAllParsedValues(e){const n=this._cachedMeta._parsed,s=[];let i,a,r;for(i=0,a=n.length;i<a;++i)r=n[i][e.axis],se(r)&&s.push(r);return s}getMaxOverflow(){return!1}getLabelAndValue(e){const n=this._cachedMeta,s=n.iScale,i=n.vScale,a=this.getParsed(e);return{label:s?""+s.getLabelForValue(a[s.axis]):"",value:i?""+i.getLabelForValue(a[i.axis]):""}}_update(e){const n=this._cachedMeta;this.update(e||"default"),n._clip=Op(P(this.options.clip,Lp(n.xScale,n.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,n=this.chart,s=this._cachedMeta,i=s.data||[],a=n.chartArea,r=[],o=this._drawStart||0,l=this._drawCount||i.length-o,c=this.options.drawActiveElementsOnTop;let d;for(s.dataset&&s.dataset.draw(e,a,o,l),d=o;d<o+l;++d){const u=i[d];u.hidden||(u.active&&c?r.push(u):u.draw(e,a))}for(d=0;d<r.length;++d)r[d].draw(e,a)}getStyle(e,n){const s=n?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(e||0,s)}getContext(e,n,s){const i=this.getDataset();let a;if(e>=0&&e<this._cachedMeta.data.length){const r=this._cachedMeta.data[e];a=r.$context||(r.$context=Fp(this.getContext(),e,r)),a.parsed=this.getParsed(e),a.raw=i.data[e],a.index=a.dataIndex=e}else a=this.$context||(this.$context=jp(this.chart.getContext(),this.index)),a.dataset=i,a.index=a.datasetIndex=this.index;return a.active=!!n,a.mode=s,a}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,n){return this._resolveElementOptions(this.dataElementType.id,n,e)}_resolveElementOptions(e,n="default",s){const i=n==="active",a=this._cachedDataOpts,r=e+"-"+n,o=a[r],l=this.enableOptionSharing&&os(s);if(o)return Ro(o,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,e),u=i?[`${e}Hover`,"hover",e,""]:[e,""],h=c.getOptionScopes(this.getDataset(),d),f=Object.keys(ie.elements[e]),p=()=>this.getContext(s,i,n),g=c.resolveNamedOptions(h,f,p,u);return g.$shared&&(g.$shared=l,a[r]=Object.freeze(Ro(g,l))),g}_resolveAnimations(e,n,s){const i=this.chart,a=this._cachedDataOpts,r=`animation-${n}`,o=a[r];if(o)return o;let l;if(i.options.animation!==!1){const d=this.chart.config,u=d.datasetAnimationScopeKeys(this._type,n),h=d.getOptionScopes(this.getDataset(),u);l=d.createResolver(h,this.getContext(e,s,n))}const c=new Lc(i,l&&l.animations);return l&&l._cacheable&&(a[r]=Object.freeze(c)),c}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,n){return!n||aa(e)||this.chart._animationsDisabled}_getSharedOptions(e,n){const s=this.resolveDataElementOptions(e,n),i=this._sharedOptions,a=this.getSharedOptions(s),r=this.includeOptions(n,a)||a!==i;return this.updateSharedOptions(a,n,s),{sharedOptions:a,includeOptions:r}}updateElement(e,n,s,i){aa(i)?Object.assign(e,s):this._resolveAnimations(n,i).update(e,s)}updateSharedOptions(e,n,s){e&&!aa(n)&&this._resolveAnimations(void 0,n).update(e,s)}_setStyle(e,n,s,i){e.active=i;const a=this.getStyle(n,i);this._resolveAnimations(n,s,i).update(e,{options:!i&&this.getSharedOptions(a)||a})}removeHoverStyle(e,n,s){this._setStyle(e,s,"active",!1)}setHoverStyle(e,n,s){this._setStyle(e,s,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const n=this._data,s=this._cachedMeta.data;for(const[o,l,c]of this._syncList)this[o](l,c);this._syncList=[];const i=s.length,a=n.length,r=Math.min(a,i);r&&this.parse(0,r),a>i?this._insertElements(i,a-i,e):a<i&&this._removeElements(a,i-a)}_insertElements(e,n,s=!0){const i=this._cachedMeta,a=i.data,r=e+n;let o;const l=c=>{for(c.length+=n,o=c.length-1;o>=r;o--)c[o]=c[o-n]};for(l(a),o=e;o<r;++o)a[o]=new this.dataElementType;this._parsing&&l(i._parsed),this.parse(e,n),s&&this.updateElements(a,e,n,"reset")}updateElements(e,n,s,i){}_removeElements(e,n){const s=this._cachedMeta;if(this._parsing){const i=s._parsed.splice(e,n);s._stacked&&Sn(s,i)}s.data.splice(e,n)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[n,s,i]=e;this[n](s,i)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,n){n&&this._sync(["_removeElements",e,n]);const s=arguments.length-2;s&&this._sync(["_insertElements",e,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}C(je,"defaults",{}),C(je,"datasetElementType",null),C(je,"dataElementType",null);function Gp(t,e){if(!t._cache.$bar){const n=t.getMatchingVisibleMetas(e);let s=[];for(let i=0,a=n.length;i<a;i++)s=s.concat(n[i].controller.getAllParsedValues(t));t._cache.$bar=fc(s.sort((i,a)=>i-a))}return t._cache.$bar}function Hp(t){const e=t.iScale,n=Gp(e,t.type);let s=e._length,i,a,r,o;const l=()=>{r===32767||r===-32768||(os(o)&&(s=Math.min(s,Math.abs(r-o)||s)),o=r)};for(i=0,a=n.length;i<a;++i)r=e.getPixelForValue(n[i]),l();for(o=void 0,i=0,a=e.ticks.length;i<a;++i)r=e.getPixelForTick(i),l();return s}function Up(t,e,n,s){const i=n.barThickness;let a,r;return H(i)?(a=e.min*n.categoryPercentage,r=n.barPercentage):(a=i*s,r=1),{chunk:a/s,ratio:r,start:e.pixels[t]-a/2}}function qp(t,e,n,s){const i=e.pixels,a=i[t];let r=t>0?i[t-1]:null,o=t<i.length-1?i[t+1]:null;const l=n.categoryPercentage;r===null&&(r=a-(o===null?e.end-e.start:o-a)),o===null&&(o=a+a-r);const c=a-(a-Math.min(r,o))/2*l;return{chunk:Math.abs(o-r)/2*l/s,ratio:n.barPercentage,start:c}}function Vp(t,e,n,s){const i=n.parse(t[0],s),a=n.parse(t[1],s),r=Math.min(i,a),o=Math.max(i,a);let l=r,c=o;Math.abs(r)>Math.abs(o)&&(l=o,c=r),e[n.axis]=c,e._custom={barStart:l,barEnd:c,start:i,end:a,min:r,max:o}}function Pc(t,e,n,s){return Q(t)?Vp(t,e,n,s):e[n.axis]=n.parse(t,s),e}function Do(t,e,n,s){const i=t.iScale,a=t.vScale,r=i.getLabels(),o=i===a,l=[];let c,d,u,h;for(c=n,d=n+s;c<d;++c)h=e[c],u={},u[i.axis]=o||i.parse(r[c],c),l.push(Pc(h,u,a,c));return l}function ra(t){return t&&t.barStart!==void 0&&t.barEnd!==void 0}function zp(t,e,n){return t!==0?ze(t):(e.isHorizontal()?1:-1)*(e.min>=n?1:-1)}function Kp(t){let e,n,s,i,a;return t.horizontal?(e=t.base>t.x,n="left",s="right"):(e=t.base<t.y,n="bottom",s="top"),e?(i="end",a="start"):(i="start",a="end"),{start:n,end:s,reverse:e,top:i,bottom:a}}function Yp(t,e,n,s){let i=e.borderSkipped;const a={};if(!i){t.borderSkipped=a;return}if(i===!0){t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:r,end:o,reverse:l,top:c,bottom:d}=Kp(t);i==="middle"&&n&&(t.enableBorderRadius=!0,(n._top||0)===s?i=c:(n._bottom||0)===s?i=d:(a[Io(d,r,o,l)]=!0,i=c)),a[Io(i,r,o,l)]=!0,t.borderSkipped=a}function Io(t,e,n,s){return s?(t=Jp(t,e,n),t=Lo(t,n,e)):t=Lo(t,e,n),t}function Jp(t,e,n){return t===e?n:t===n?e:t}function Lo(t,e,n){return t==="start"?e:t==="end"?n:t}function Xp(t,{inflateAmount:e},n){t.inflateAmount=e==="auto"?n===1?.33:0:e}class Xs extends je{parsePrimitiveData(e,n,s,i){return Do(e,n,s,i)}parseArrayData(e,n,s,i){return Do(e,n,s,i)}parseObjectData(e,n,s,i){const{iScale:a,vScale:r}=e,{xAxisKey:o="x",yAxisKey:l="y"}=this._parsing,c=a.axis==="x"?o:l,d=r.axis==="x"?o:l,u=[];let h,f,p,g;for(h=s,f=s+i;h<f;++h)g=n[h],p={},p[a.axis]=a.parse(mt(g,c),h),u.push(Pc(mt(g,d),p,r,h));return u}updateRangeFromParsed(e,n,s,i){super.updateRangeFromParsed(e,n,s,i);const a=s._custom;a&&n===this._cachedMeta.vScale&&(e.min=Math.min(e.min,a.min),e.max=Math.max(e.max,a.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const n=this._cachedMeta,{iScale:s,vScale:i}=n,a=this.getParsed(e),r=a._custom,o=ra(r)?"["+r.start+", "+r.end+"]":""+i.getLabelForValue(a[i.axis]);return{label:""+s.getLabelForValue(a[s.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,e)}updateElements(e,n,s,i){const a=i==="reset",{index:r,_cachedMeta:{vScale:o}}=this,l=o.getBasePixel(),c=o.isHorizontal(),d=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(n,i);for(let f=n;f<n+s;f++){const p=this.getParsed(f),g=a||H(p[o.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,d),_=(p._stacks||{})[o.axis],y={horizontal:c,base:g.base,enableBorderRadius:!_||ra(p._custom)||r===_._top||r===_._bottom,x:c?g.head:m.center,y:c?m.center:g.head,height:c?m.size:Math.abs(g.size),width:c?Math.abs(g.size):m.size};h&&(y.options=u||this.resolveDataElementOptions(f,e[f].active?"active":i));const b=y.options||e[f].options;Yp(y,b,_,r),Xp(y,b,d.ratio),this.updateElement(e[f],f,y,i)}}_getStacks(e,n){const{iScale:s}=this._cachedMeta,i=s.getMatchingVisibleMetas(this._type).filter(l=>l.controller.options.grouped),a=s.options.stacked,r=[],o=l=>{const c=l.controller.getParsed(n),d=c&&c[l.vScale.axis];if(H(d)||isNaN(d))return!0};for(const l of i)if(!(n!==void 0&&o(l))&&((a===!1||r.indexOf(l.stack)===-1||a===void 0&&l.stack===void 0)&&r.push(l.stack),l.index===e))break;return r.length||r.push(void 0),r}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,n,s){const i=this._getStacks(e,s),a=n!==void 0?i.indexOf(n):-1;return a===-1?i.length-1:a}_getRuler(){const e=this.options,n=this._cachedMeta,s=n.iScale,i=[];let a,r;for(a=0,r=n.data.length;a<r;++a)i.push(s.getPixelForValue(this.getParsed(a)[s.axis],a));const o=e.barThickness;return{min:o||Hp(n),pixels:i,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:e.grouped,ratio:o?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:n,_stacked:s,index:i},options:{base:a,minBarLength:r}}=this,o=a||0,l=this.getParsed(e),c=l._custom,d=ra(c);let u=l[n.axis],h=0,f=s?this.applyStack(n,l,s):u,p,g;f!==u&&(h=f-u,f=u),d&&(u=c.barStart,f=c.barEnd-c.barStart,u!==0&&ze(u)!==ze(c.barEnd)&&(h=0),h+=u);const m=!H(a)&&!d?a:h;let _=n.getPixelForValue(m);if(this.chart.getDataVisibility(e)?p=n.getPixelForValue(h+f):p=_,g=p-_,Math.abs(g)<r){g=zp(g,n,o)*r,u===o&&(_-=g/2);const y=n.getPixelForDecimal(0),b=n.getPixelForDecimal(1),v=Math.min(y,b),w=Math.max(y,b);_=Math.max(Math.min(_,w),v),p=_+g,s&&!d&&(l._stacks[n.axis]._visualValues[i]=n.getValueForPixel(p)-n.getValueForPixel(_))}if(_===n.getPixelForValue(o)){const y=ze(g)*n.getLineWidthForValue(o)/2;_+=y,g-=y}return{size:g,base:_,head:p,center:p+g/2}}_calculateBarIndexPixels(e,n){const s=n.scale,i=this.options,a=i.skipNull,r=P(i.maxBarThickness,1/0);let o,l;if(n.grouped){const c=a?this._getStackCount(e):n.stackCount,d=i.barThickness==="flex"?qp(e,n,i,c):Up(e,n,i,c),u=this._getStackIndex(this.index,this._cachedMeta.stack,a?e:void 0);o=d.start+d.chunk*u+d.chunk/2,l=Math.min(r,d.chunk*d.ratio)}else o=s.getPixelForValue(this.getParsed(e)[s.axis],e),l=Math.min(r,n.min*n.ratio);return{base:o-l/2,head:o+l/2,center:o,size:l}}draw(){const e=this._cachedMeta,n=e.vScale,s=e.data,i=s.length;let a=0;for(;a<i;++a)this.getParsed(a)[n.axis]!==null&&s[a].draw(this._ctx)}}C(Xs,"id","bar"),C(Xs,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),C(Xs,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Qs extends je{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,n,s,i){const a=super.parsePrimitiveData(e,n,s,i);for(let r=0;r<a.length;r++)a[r]._custom=this.resolveDataElementOptions(r+s).radius;return a}parseArrayData(e,n,s,i){const a=super.parseArrayData(e,n,s,i);for(let r=0;r<a.length;r++){const o=n[s+r];a[r]._custom=P(o[2],this.resolveDataElementOptions(r+s).radius)}return a}parseObjectData(e,n,s,i){const a=super.parseObjectData(e,n,s,i);for(let r=0;r<a.length;r++){const o=n[s+r];a[r]._custom=P(o&&o.r&&+o.r,this.resolveDataElementOptions(r+s).radius)}return a}getMaxOverflow(){const e=this._cachedMeta.data;let n=0;for(let s=e.length-1;s>=0;--s)n=Math.max(n,e[s].size(this.resolveDataElementOptions(s))/2);return n>0&&n}getLabelAndValue(e){const n=this._cachedMeta,s=this.chart.data.labels||[],{xScale:i,yScale:a}=n,r=this.getParsed(e),o=i.getLabelForValue(r.x),l=a.getLabelForValue(r.y),c=r._custom;return{label:s[e]||"",value:"("+o+", "+l+(c?", "+c:"")+")"}}update(e){const n=this._cachedMeta.data;this.updateElements(n,0,n.length,e)}updateElements(e,n,s,i){const a=i==="reset",{iScale:r,vScale:o}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(n,i),d=r.axis,u=o.axis;for(let h=n;h<n+s;h++){const f=e[h],p=!a&&this.getParsed(h),g={},m=g[d]=a?r.getPixelForDecimal(.5):r.getPixelForValue(p[d]),_=g[u]=a?o.getBasePixel():o.getPixelForValue(p[u]);g.skip=isNaN(m)||isNaN(_),c&&(g.options=l||this.resolveDataElementOptions(h,f.active?"active":i),a&&(g.options.radius=0)),this.updateElement(f,h,g,i)}}resolveDataElementOptions(e,n){const s=this.getParsed(e);let i=super.resolveDataElementOptions(e,n);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const a=i.radius;return n!=="active"&&(i.radius=0),i.radius+=P(s&&s._custom,a),i}}C(Qs,"id","bubble"),C(Qs,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),C(Qs,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function Qp(t,e,n){let s=1,i=1,a=0,r=0;if(e<J){const o=t,l=o+e,c=Math.cos(o),d=Math.sin(o),u=Math.cos(l),h=Math.sin(l),f=(b,v,w)=>ls(b,o,l,!0)?1:Math.max(v,v*n,w,w*n),p=(b,v,w)=>ls(b,o,l,!0)?-1:Math.min(v,v*n,w,w*n),g=f(0,c,u),m=f(ae,d,h),_=p(X,c,u),y=p(X+ae,d,h);s=(g-_)/2,i=(m-y)/2,a=-(g+_)/2,r=-(m+y)/2}return{ratioX:s,ratioY:i,offsetX:a,offsetY:r}}class Dt extends je{constructor(e,n){super(e,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,n){const s=this.getDataset().data,i=this._cachedMeta;if(this._parsing===!1)i._parsed=s;else{let a=l=>+s[l];if(W(s[e])){const{key:l="value"}=this._parsing;a=c=>+mt(s[c],l)}let r,o;for(r=e,o=e+n;r<o;++r)i._parsed[r]=a(r)}}_getRotation(){return Ne(this.options.rotation-90)}_getCircumference(){return Ne(this.options.circumference)}_getRotationExtents(){let e=J,n=-J;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){const i=this.chart.getDatasetMeta(s).controller,a=i._getRotation(),r=i._getCircumference();e=Math.min(e,a),n=Math.max(n,a+r)}return{rotation:e,circumference:n-e}}update(e){const n=this.chart,{chartArea:s}=n,i=this._cachedMeta,a=i.data,r=this.getMaxBorderWidth()+this.getMaxOffset(a)+this.options.spacing,o=Math.max((Math.min(s.width,s.height)-r)/2,0),l=Math.min(hg(this.options.cutout,o),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:p,offsetY:g}=Qp(u,d,l),m=(s.width-r)/h,_=(s.height-r)/f,y=Math.max(Math.min(m,_)/2,0),b=lc(this.options.radius,y),v=Math.max(b*l,0),w=(b-v)/this._getVisibleDatasetWeightTotal();this.offsetX=p*b,this.offsetY=g*b,i.total=this.calculateTotal(),this.outerRadius=b-w*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-w*c,0),this.updateElements(a,0,a.length,e)}_circumference(e,n){const s=this.options,i=this._cachedMeta,a=this._getCircumference();return n&&s.animation.animateRotate||!this.chart.getDataVisibility(e)||i._parsed[e]===null||i.data[e].hidden?0:this.calculateCircumference(i._parsed[e]*a/J)}updateElements(e,n,s,i){const a=i==="reset",r=this.chart,o=r.chartArea,c=r.options.animation,d=(o.left+o.right)/2,u=(o.top+o.bottom)/2,h=a&&c.animateScale,f=h?0:this.innerRadius,p=h?0:this.outerRadius,{sharedOptions:g,includeOptions:m}=this._getSharedOptions(n,i);let _=this._getRotation(),y;for(y=0;y<n;++y)_+=this._circumference(y,a);for(y=n;y<n+s;++y){const b=this._circumference(y,a),v=e[y],w={x:d+this.offsetX,y:u+this.offsetY,startAngle:_,endAngle:_+b,circumference:b,outerRadius:p,innerRadius:f};m&&(w.options=g||this.resolveDataElementOptions(y,v.active?"active":i)),_+=b,this.updateElement(v,y,w,i)}}calculateTotal(){const e=this._cachedMeta,n=e.data;let s=0,i;for(i=0;i<n.length;i++){const a=e._parsed[i];a!==null&&!isNaN(a)&&this.chart.getDataVisibility(i)&&!n[i].hidden&&(s+=Math.abs(a))}return s}calculateCircumference(e){const n=this._cachedMeta.total;return n>0&&!isNaN(e)?J*(Math.abs(e)/n):0}getLabelAndValue(e){const n=this._cachedMeta,s=this.chart,i=s.data.labels||[],a=_s(n._parsed[e],s.options.locale);return{label:i[e]||"",value:a}}getMaxBorderWidth(e){let n=0;const s=this.chart;let i,a,r,o,l;if(!e){for(i=0,a=s.data.datasets.length;i<a;++i)if(s.isDatasetVisible(i)){r=s.getDatasetMeta(i),e=r.data,o=r.controller;break}}if(!e)return 0;for(i=0,a=e.length;i<a;++i)l=o.resolveDataElementOptions(i),l.borderAlign!=="inner"&&(n=Math.max(n,l.borderWidth||0,l.hoverBorderWidth||0));return n}getMaxOffset(e){let n=0;for(let s=0,i=e.length;s<i;++s){const a=this.resolveDataElementOptions(s);n=Math.max(n,a.offset||0,a.hoverOffset||0)}return n}_getRingWeightOffset(e){let n=0;for(let s=0;s<e;++s)this.chart.isDatasetVisible(s)&&(n+=this._getRingWeight(s));return n}_getRingWeight(e){return Math.max(P(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}C(Dt,"id","doughnut"),C(Dt,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),C(Dt,"descriptors",{_scriptable:e=>e!=="spacing",_indexable:e=>e!=="spacing"&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")}),C(Dt,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const n=e.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:s,color:i}}=e.legend.options;return n.labels.map((a,r)=>{const l=e.getDatasetMeta(0).controller.getStyle(r);return{text:a,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:i,lineWidth:l.borderWidth,pointStyle:s,hidden:!e.getDataVisibility(r),index:r}})}return[]}},onClick(e,n,s){s.chart.toggleDataVisibility(n.index),s.chart.update()}}}});class Zs extends je{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const n=this._cachedMeta,{dataset:s,data:i=[],_dataset:a}=n,r=this.chart._animationsDisabled;let{start:o,count:l}=mc(n,i,r);this._drawStart=o,this._drawCount=l,_c(n)&&(o=0,l=i.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!a._decimated,s.points=i;const c=this.resolveDatasetElementOptions(e);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(s,void 0,{animated:!r,options:c},e),this.updateElements(i,o,l,e)}updateElements(e,n,s,i){const a=i==="reset",{iScale:r,vScale:o,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:u}=this._getSharedOptions(n,i),h=r.axis,f=o.axis,{spanGaps:p,segment:g}=this.options,m=on(p)?p:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||a||i==="none",y=n+s,b=e.length;let v=n>0&&this.getParsed(n-1);for(let w=0;w<b;++w){const k=e[w],S=_?k:{};if(w<n||w>=y){S.skip=!0;continue}const x=this.getParsed(w),E=H(x[f]),D=S[h]=r.getPixelForValue(x[h],w),O=S[f]=a||E?o.getBasePixel():o.getPixelForValue(l?this.applyStack(o,x,l):x[f],w);S.skip=isNaN(D)||isNaN(O)||E,S.stop=w>0&&Math.abs(x[h]-v[h])>m,g&&(S.parsed=x,S.raw=c.data[w]),u&&(S.options=d||this.resolveDataElementOptions(w,k.active?"active":i)),_||this.updateElement(k,w,S,i),v=x}}getMaxOverflow(){const e=this._cachedMeta,n=e.dataset,s=n.options&&n.options.borderWidth||0,i=e.data||[];if(!i.length)return s;const a=i[0].size(this.resolveDataElementOptions(0)),r=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(s,a,r)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}C(Zs,"id","line"),C(Zs,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),C(Zs,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class zn extends je{constructor(e,n){super(e,n),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const n=this._cachedMeta,s=this.chart,i=s.data.labels||[],a=_s(n._parsed[e].r,s.options.locale);return{label:i[e]||"",value:a}}parseObjectData(e,n,s,i){return Cc.bind(this)(e,n,s,i)}update(e){const n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,e)}getMinMax(){const e=this._cachedMeta,n={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((s,i)=>{const a=this.getParsed(i).r;!isNaN(a)&&this.chart.getDataVisibility(i)&&(a<n.min&&(n.min=a),a>n.max&&(n.max=a))}),n}_updateRadius(){const e=this.chart,n=e.chartArea,s=e.options,i=Math.min(n.right-n.left,n.bottom-n.top),a=Math.max(i/2,0),r=Math.max(s.cutoutPercentage?a/100*s.cutoutPercentage:1,0),o=(a-r)/e.getVisibleDatasetCount();this.outerRadius=a-o*this.index,this.innerRadius=this.outerRadius-o}updateElements(e,n,s,i){const a=i==="reset",r=this.chart,l=r.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,u=c.yCenter,h=c.getIndexAngle(0)-.5*X;let f=h,p;const g=360/this.countVisibleElements();for(p=0;p<n;++p)f+=this._computeAngle(p,i,g);for(p=n;p<n+s;p++){const m=e[p];let _=f,y=f+this._computeAngle(p,i,g),b=r.getDataVisibility(p)?c.getDistanceFromCenterForValue(this.getParsed(p).r):0;f=y,a&&(l.animateScale&&(b=0),l.animateRotate&&(_=y=h));const v={x:d,y:u,innerRadius:0,outerRadius:b,startAngle:_,endAngle:y,options:this.resolveDataElementOptions(p,m.active?"active":i)};this.updateElement(m,p,v,i)}}countVisibleElements(){const e=this._cachedMeta;let n=0;return e.data.forEach((s,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&n++}),n}_computeAngle(e,n,s){return this.chart.getDataVisibility(e)?Ne(this.resolveDataElementOptions(e,n).angle||s):0}}C(zn,"id","polarArea"),C(zn,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),C(zn,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const n=e.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:s,color:i}}=e.legend.options;return n.labels.map((a,r)=>{const l=e.getDatasetMeta(0).controller.getStyle(r);return{text:a,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:i,lineWidth:l.borderWidth,pointStyle:s,hidden:!e.getDataVisibility(r),index:r}})}return[]}},onClick(e,n,s){s.chart.toggleDataVisibility(n.index),s.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Ra extends Dt{}C(Ra,"id","pie"),C(Ra,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class ei extends je{getLabelAndValue(e){const n=this._cachedMeta.vScale,s=this.getParsed(e);return{label:n.getLabels()[e],value:""+n.getLabelForValue(s[n.axis])}}parseObjectData(e,n,s,i){return Cc.bind(this)(e,n,s,i)}update(e){const n=this._cachedMeta,s=n.dataset,i=n.data||[],a=n.iScale.getLabels();if(s.points=i,e!=="resize"){const r=this.resolveDatasetElementOptions(e);this.options.showLine||(r.borderWidth=0);const o={_loop:!0,_fullLoop:a.length===i.length,options:r};this.updateElement(s,void 0,o,e)}this.updateElements(i,0,i.length,e)}updateElements(e,n,s,i){const a=this._cachedMeta.rScale,r=i==="reset";for(let o=n;o<n+s;o++){const l=e[o],c=this.resolveDataElementOptions(o,l.active?"active":i),d=a.getPointPositionForValue(o,this.getParsed(o).r),u=r?a.xCenter:d.x,h=r?a.yCenter:d.y,f={x:u,y:h,angle:d.angle,skip:isNaN(u)||isNaN(h),options:c};this.updateElement(l,o,f,i)}}}C(ei,"id","radar"),C(ei,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),C(ei,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class ti extends je{getLabelAndValue(e){const n=this._cachedMeta,s=this.chart.data.labels||[],{xScale:i,yScale:a}=n,r=this.getParsed(e),o=i.getLabelForValue(r.x),l=a.getLabelForValue(r.y);return{label:s[e]||"",value:"("+o+", "+l+")"}}update(e){const n=this._cachedMeta,{data:s=[]}=n,i=this.chart._animationsDisabled;let{start:a,count:r}=mc(n,s,i);if(this._drawStart=a,this._drawCount=r,_c(n)&&(a=0,r=s.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:o,_dataset:l}=n;o._chart=this.chart,o._datasetIndex=this.index,o._decimated=!!l._decimated,o.points=s;const c=this.resolveDatasetElementOptions(e);c.segment=this.options.segment,this.updateElement(o,void 0,{animated:!i,options:c},e)}else this.datasetElementType&&(delete n.dataset,this.datasetElementType=!1);this.updateElements(s,a,r,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,n,s,i){const a=i==="reset",{iScale:r,vScale:o,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(n,i),u=this.getSharedOptions(d),h=this.includeOptions(i,u),f=r.axis,p=o.axis,{spanGaps:g,segment:m}=this.options,_=on(g)?g:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||a||i==="none";let b=n>0&&this.getParsed(n-1);for(let v=n;v<n+s;++v){const w=e[v],k=this.getParsed(v),S=y?w:{},x=H(k[p]),E=S[f]=r.getPixelForValue(k[f],v),D=S[p]=a||x?o.getBasePixel():o.getPixelForValue(l?this.applyStack(o,k,l):k[p],v);S.skip=isNaN(E)||isNaN(D)||x,S.stop=v>0&&Math.abs(k[f]-b[f])>_,m&&(S.parsed=k,S.raw=c.data[v]),h&&(S.options=u||this.resolveDataElementOptions(v,w.active?"active":i)),y||this.updateElement(w,v,S,i),b=k}this.updateSharedOptions(u,i,d)}getMaxOverflow(){const e=this._cachedMeta,n=e.data||[];if(!this.options.showLine){let o=0;for(let l=n.length-1;l>=0;--l)o=Math.max(o,n[l].size(this.resolveDataElementOptions(l))/2);return o>0&&o}const s=e.dataset,i=s.options&&s.options.borderWidth||0;if(!n.length)return i;const a=n[0].size(this.resolveDataElementOptions(0)),r=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(i,a,r)/2}}C(ti,"id","scatter"),C(ti,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),C(ti,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var Zp=Object.freeze({__proto__:null,BarController:Xs,BubbleController:Qs,DoughnutController:Dt,LineController:Zs,PieController:Ra,PolarAreaController:zn,RadarController:ei,ScatterController:ti});function St(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class or{constructor(e){C(this,"options");this.options=e||{}}static override(e){Object.assign(or.prototype,e)}init(){}formats(){return St()}parse(){return St()}format(){return St()}add(){return St()}diff(){return St()}startOf(){return St()}endOf(){return St()}}var em={_date:or};function tm(t,e,n,s){const{controller:i,data:a,_sorted:r}=t,o=i._cachedMeta.iScale;if(o&&e===o.axis&&e!=="r"&&r&&a.length){const l=o._reversePixels?xg:st;if(s){if(i._sharedOptions){const c=a[0],d=typeof c.getRange=="function"&&c.getRange(e);if(d){const u=l(a,e,n-d),h=l(a,e,n+d);return{lo:u.lo,hi:h.hi}}}}else return l(a,e,n)}return{lo:0,hi:a.length-1}}function Pi(t,e,n,s,i){const a=t.getSortedVisibleDatasetMetas(),r=n[e];for(let o=0,l=a.length;o<l;++o){const{index:c,data:d}=a[o],{lo:u,hi:h}=tm(a[o],e,r,i);for(let f=u;f<=h;++f){const p=d[f];p.skip||s(p,c,f)}}}function nm(t){const e=t.indexOf("x")!==-1,n=t.indexOf("y")!==-1;return function(s,i){const a=e?Math.abs(s.x-i.x):0,r=n?Math.abs(s.y-i.y):0;return Math.sqrt(Math.pow(a,2)+Math.pow(r,2))}}function oa(t,e,n,s,i){const a=[];return!i&&!t.isPointInArea(e)||Pi(t,n,e,function(o,l,c){!i&&!it(o,t.chartArea,0)||o.inRange(e.x,e.y,s)&&a.push({element:o,datasetIndex:l,index:c})},!0),a}function sm(t,e,n,s){let i=[];function a(r,o,l){const{startAngle:c,endAngle:d}=r.getProps(["startAngle","endAngle"],s),{angle:u}=uc(r,{x:e.x,y:e.y});ls(u,c,d)&&i.push({element:r,datasetIndex:o,index:l})}return Pi(t,n,e,a),i}function im(t,e,n,s,i,a){let r=[];const o=nm(n);let l=Number.POSITIVE_INFINITY;function c(d,u,h){const f=d.inRange(e.x,e.y,i);if(s&&!f)return;const p=d.getCenterPoint(i);if(!(!!a||t.isPointInArea(p))&&!f)return;const m=o(e,p);m<l?(r=[{element:d,datasetIndex:u,index:h}],l=m):m===l&&r.push({element:d,datasetIndex:u,index:h})}return Pi(t,n,e,c),r}function la(t,e,n,s,i,a){return!a&&!t.isPointInArea(e)?[]:n==="r"&&!s?sm(t,e,n,i):im(t,e,n,s,i,a)}function Oo(t,e,n,s,i){const a=[],r=n==="x"?"inXRange":"inYRange";let o=!1;return Pi(t,n,e,(l,c,d)=>{l[r](e[n],i)&&(a.push({element:l,datasetIndex:c,index:d}),o=o||l.inRange(e.x,e.y,i))}),s&&!o?[]:a}var am={modes:{index(t,e,n,s){const i=Et(e,t),a=n.axis||"x",r=n.includeInvisible||!1,o=n.intersect?oa(t,i,a,s,r):la(t,i,a,!1,s,r),l=[];return o.length?(t.getSortedVisibleDatasetMetas().forEach(c=>{const d=o[0].index,u=c.data[d];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:d})}),l):[]},dataset(t,e,n,s){const i=Et(e,t),a=n.axis||"xy",r=n.includeInvisible||!1;let o=n.intersect?oa(t,i,a,s,r):la(t,i,a,!1,s,r);if(o.length>0){const l=o[0].datasetIndex,c=t.getDatasetMeta(l).data;o=[];for(let d=0;d<c.length;++d)o.push({element:c[d],datasetIndex:l,index:d})}return o},point(t,e,n,s){const i=Et(e,t),a=n.axis||"xy",r=n.includeInvisible||!1;return oa(t,i,a,s,r)},nearest(t,e,n,s){const i=Et(e,t),a=n.axis||"xy",r=n.includeInvisible||!1;return la(t,i,a,n.intersect,s,r)},x(t,e,n,s){const i=Et(e,t);return Oo(t,i,"x",n.intersect,s)},y(t,e,n,s){const i=Et(e,t);return Oo(t,i,"y",n.intersect,s)}}};const $c=["left","top","right","bottom"];function xn(t,e){return t.filter(n=>n.pos===e)}function Po(t,e){return t.filter(n=>$c.indexOf(n.pos)===-1&&n.box.axis===e)}function Cn(t,e){return t.sort((n,s)=>{const i=e?s:n,a=e?n:s;return i.weight===a.weight?i.index-a.index:i.weight-a.weight})}function rm(t){const e=[];let n,s,i,a,r,o;for(n=0,s=(t||[]).length;n<s;++n)i=t[n],{position:a,options:{stack:r,stackWeight:o=1}}=i,e.push({index:n,box:i,pos:a,horizontal:i.isHorizontal(),weight:i.weight,stack:r&&a+r,stackWeight:o});return e}function om(t){const e={};for(const n of t){const{stack:s,pos:i,stackWeight:a}=n;if(!s||!$c.includes(i))continue;const r=e[s]||(e[s]={count:0,placed:0,weight:0,size:0});r.count++,r.weight+=a}return e}function lm(t,e){const n=om(t),{vBoxMaxWidth:s,hBoxMaxHeight:i}=e;let a,r,o;for(a=0,r=t.length;a<r;++a){o=t[a];const{fullSize:l}=o.box,c=n[o.stack],d=c&&o.stackWeight/c.weight;o.horizontal?(o.width=d?d*s:l&&e.availableWidth,o.height=i):(o.width=s,o.height=d?d*i:l&&e.availableHeight)}return n}function cm(t){const e=rm(t),n=Cn(e.filter(c=>c.box.fullSize),!0),s=Cn(xn(e,"left"),!0),i=Cn(xn(e,"right")),a=Cn(xn(e,"top"),!0),r=Cn(xn(e,"bottom")),o=Po(e,"x"),l=Po(e,"y");return{fullSize:n,leftAndTop:s.concat(a),rightAndBottom:i.concat(l).concat(r).concat(o),chartArea:xn(e,"chartArea"),vertical:s.concat(i).concat(l),horizontal:a.concat(r).concat(o)}}function $o(t,e,n,s){return Math.max(t[n],e[n])+Math.max(t[s],e[s])}function Nc(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function dm(t,e,n,s){const{pos:i,box:a}=n,r=t.maxPadding;if(!W(i)){n.size&&(t[i]-=n.size);const u=s[n.stack]||{size:0,count:1};u.size=Math.max(u.size,n.horizontal?a.height:a.width),n.size=u.size/u.count,t[i]+=n.size}a.getPadding&&Nc(r,a.getPadding());const o=Math.max(0,e.outerWidth-$o(r,t,"left","right")),l=Math.max(0,e.outerHeight-$o(r,t,"top","bottom")),c=o!==t.w,d=l!==t.h;return t.w=o,t.h=l,n.horizontal?{same:c,other:d}:{same:d,other:c}}function um(t){const e=t.maxPadding;function n(s){const i=Math.max(e[s]-t[s],0);return t[s]+=i,i}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}function hm(t,e){const n=e.maxPadding;function s(i){const a={left:0,top:0,right:0,bottom:0};return i.forEach(r=>{a[r]=Math.max(e[r],n[r])}),a}return s(t?["left","right"]:["top","bottom"])}function Pn(t,e,n,s){const i=[];let a,r,o,l,c,d;for(a=0,r=t.length,c=0;a<r;++a){o=t[a],l=o.box,l.update(o.width||e.w,o.height||e.h,hm(o.horizontal,e));const{same:u,other:h}=dm(e,n,o,s);c|=u&&i.length,d=d||h,l.fullSize||i.push(o)}return c&&Pn(i,e,n,s)||d}function Os(t,e,n,s,i){t.top=n,t.left=e,t.right=e+s,t.bottom=n+i,t.width=s,t.height=i}function No(t,e,n,s){const i=n.padding;let{x:a,y:r}=e;for(const o of t){const l=o.box,c=s[o.stack]||{placed:0,weight:1},d=o.stackWeight/c.weight||1;if(o.horizontal){const u=e.w*d,h=c.size||l.height;os(c.start)&&(r=c.start),l.fullSize?Os(l,i.left,r,n.outerWidth-i.right-i.left,h):Os(l,e.left+c.placed,r,u,h),c.start=r,c.placed+=u,r=l.bottom}else{const u=e.h*d,h=c.size||l.width;os(c.start)&&(a=c.start),l.fullSize?Os(l,a,i.top,h,n.outerHeight-i.bottom-i.top):Os(l,a,e.top+c.placed,h,u),c.start=a,c.placed+=u,a=l.right}}e.x=a,e.y=r}var ye={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(n){e.draw(n)}}]},t.boxes.push(e)},removeBox(t,e){const n=t.boxes?t.boxes.indexOf(e):-1;n!==-1&&t.boxes.splice(n,1)},configure(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(t,e,n,s){if(!t)return;const i=be(t.options.layout.padding),a=Math.max(e-i.width,0),r=Math.max(n-i.height,0),o=cm(t.boxes),l=o.vertical,c=o.horizontal;q(t.boxes,g=>{typeof g.beforeLayout=="function"&&g.beforeLayout()});const d=l.reduce((g,m)=>m.box.options&&m.box.options.display===!1?g:g+1,0)||1,u=Object.freeze({outerWidth:e,outerHeight:n,padding:i,availableWidth:a,availableHeight:r,vBoxMaxWidth:a/2/d,hBoxMaxHeight:r/2}),h=Object.assign({},i);Nc(h,be(s));const f=Object.assign({maxPadding:h,w:a,h:r,x:i.left,y:i.top},i),p=lm(l.concat(c),u);Pn(o.fullSize,f,u,p),Pn(l,f,u,p),Pn(c,f,u,p)&&Pn(l,f,u,p),um(f),No(o.leftAndTop,f,u,p),f.x+=f.w,f.y+=f.h,No(o.rightAndBottom,f,u,p),t.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},q(o.chartArea,g=>{const m=g.box;Object.assign(m,t.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class Bc{acquireContext(e,n){}releaseContext(e){return!1}addEventListener(e,n,s){}removeEventListener(e,n,s){}getDevicePixelRatio(){return 1}getMaximumSize(e,n,s,i){return n=Math.max(0,n||e.width),s=s||e.height,{width:n,height:Math.max(0,i?Math.floor(n/i):s)}}isAttached(e){return!0}updateConfig(e){}}class fm extends Bc{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const ni="$chartjs",gm={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Bo=t=>t===null||t==="";function pm(t,e){const n=t.style,s=t.getAttribute("height"),i=t.getAttribute("width");if(t[ni]={initial:{height:s,width:i,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",Bo(i)){const a=vo(t,"width");a!==void 0&&(t.width=a)}if(Bo(s))if(t.style.height==="")t.height=t.width/(e||2);else{const a=vo(t,"height");a!==void 0&&(t.height=a)}return t}const jc=_p?{passive:!0}:!1;function mm(t,e,n){t.addEventListener(e,n,jc)}function _m(t,e,n){t.canvas.removeEventListener(e,n,jc)}function ym(t,e){const n=gm[t.type]||t.type,{x:s,y:i}=Et(t,e);return{type:n,chart:e,native:t,x:s!==void 0?s:null,y:i!==void 0?i:null}}function _i(t,e){for(const n of t)if(n===e||n.contains(e))return!0}function bm(t,e,n){const s=t.canvas,i=new MutationObserver(a=>{let r=!1;for(const o of a)r=r||_i(o.addedNodes,s),r=r&&!_i(o.removedNodes,s);r&&n()});return i.observe(document,{childList:!0,subtree:!0}),i}function vm(t,e,n){const s=t.canvas,i=new MutationObserver(a=>{let r=!1;for(const o of a)r=r||_i(o.removedNodes,s),r=r&&!_i(o.addedNodes,s);r&&n()});return i.observe(document,{childList:!0,subtree:!0}),i}const ds=new Map;let jo=0;function Fc(){const t=window.devicePixelRatio;t!==jo&&(jo=t,ds.forEach((e,n)=>{n.currentDevicePixelRatio!==t&&e()}))}function wm(t,e){ds.size||window.addEventListener("resize",Fc),ds.set(t,e)}function km(t){ds.delete(t),ds.size||window.removeEventListener("resize",Fc)}function Sm(t,e,n){const s=t.canvas,i=s&&rr(s);if(!i)return;const a=pc((o,l)=>{const c=i.clientWidth;n(o,l),c<i.clientWidth&&n()},window),r=new ResizeObserver(o=>{const l=o[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||a(c,d)});return r.observe(i),wm(t,a),r}function ca(t,e,n){n&&n.disconnect(),e==="resize"&&km(t)}function xm(t,e,n){const s=t.canvas,i=pc(a=>{t.ctx!==null&&n(ym(a,t))},t);return mm(s,e,i),i}class Cm extends Bc{acquireContext(e,n){const s=e&&e.getContext&&e.getContext("2d");return s&&s.canvas===e?(pm(e,n),s):null}releaseContext(e){const n=e.canvas;if(!n[ni])return!1;const s=n[ni].initial;["height","width"].forEach(a=>{const r=s[a];H(r)?n.removeAttribute(a):n.setAttribute(a,r)});const i=s.style||{};return Object.keys(i).forEach(a=>{n.style[a]=i[a]}),n.width=n.width,delete n[ni],!0}addEventListener(e,n,s){this.removeEventListener(e,n);const i=e.$proxies||(e.$proxies={}),r={attach:bm,detach:vm,resize:Sm}[n]||xm;i[n]=r(e,n,s)}removeEventListener(e,n){const s=e.$proxies||(e.$proxies={}),i=s[n];if(!i)return;({attach:ca,detach:ca,resize:ca}[n]||_m)(e,n,i),s[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,n,s,i){return mp(e,n,s,i)}isAttached(e){const n=rr(e);return!!(n&&n.isConnected)}}function Em(t){return!Ac()||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas?fm:Cm}class We{constructor(){C(this,"x");C(this,"y");C(this,"active",!1);C(this,"options");C(this,"$animations")}tooltipPosition(e){const{x:n,y:s}=this.getProps(["x","y"],e);return{x:n,y:s}}hasValue(){return on(this.x)&&on(this.y)}getProps(e,n){const s=this.$animations;if(!n||!s)return this;const i={};return e.forEach(a=>{i[a]=s[a]&&s[a].active()?s[a]._to:this[a]}),i}}C(We,"defaults",{}),C(We,"defaultRoutes");function Am(t,e){const n=t.options.ticks,s=Mm(t),i=Math.min(n.maxTicksLimit||s,s),a=n.major.enabled?Rm(e):[],r=a.length,o=a[0],l=a[r-1],c=[];if(r>i)return Dm(e,c,a,r/i),c;const d=Tm(a,e,i);if(r>0){let u,h;const f=r>1?Math.round((l-o)/(r-1)):null;for(Ps(e,c,d,H(f)?0:o-f,o),u=0,h=r-1;u<h;u++)Ps(e,c,d,a[u],a[u+1]);return Ps(e,c,d,l,H(f)?e.length:l+f),c}return Ps(e,c,d),c}function Mm(t){const e=t.options.offset,n=t._tickSize(),s=t._length/n+(e?0:1),i=t._maxLength/n;return Math.floor(Math.min(s,i))}function Tm(t,e,n){const s=Im(t),i=e.length/n;if(!s)return Math.max(i,1);const a=vg(s);for(let r=0,o=a.length-1;r<o;r++){const l=a[r];if(l>i)return l}return Math.max(i,1)}function Rm(t){const e=[];let n,s;for(n=0,s=t.length;n<s;n++)t[n].major&&e.push(n);return e}function Dm(t,e,n,s){let i=0,a=n[0],r;for(s=Math.ceil(s),r=0;r<t.length;r++)r===a&&(e.push(t[r]),i++,a=n[i*s])}function Ps(t,e,n,s,i){const a=P(s,0),r=Math.min(P(i,t.length),t.length);let o=0,l,c,d;for(n=Math.ceil(n),i&&(l=i-s,n=l/Math.floor(l/n)),d=a;d<0;)o++,d=Math.round(a+o*n);for(c=Math.max(a,0);c<r;c++)c===d&&(e.push(t[c]),o++,d=Math.round(a+o*n))}function Im(t){const e=t.length;let n,s;if(e<2)return!1;for(s=t[0],n=1;n<e;++n)if(t[n]-t[n-1]!==s)return!1;return s}const Lm=t=>t==="left"?"right":t==="right"?"left":t,Fo=(t,e,n)=>e==="top"||e==="left"?t[e]+n:t[e]-n,Wo=(t,e)=>Math.min(e||t,t);function Go(t,e){const n=[],s=t.length/e,i=t.length;let a=0;for(;a<i;a+=s)n.push(t[Math.floor(a)]);return n}function Om(t,e,n){const s=t.ticks.length,i=Math.min(e,s-1),a=t._startPixel,r=t._endPixel,o=1e-6;let l=t.getPixelForTick(i),c;if(!(n&&(s===1?c=Math.max(l-a,r-l):e===0?c=(t.getPixelForTick(1)-l)/2:c=(l-t.getPixelForTick(i-1))/2,l+=i<e?c:-c,l<a-o||l>r+o)))return l}function Pm(t,e){q(t,n=>{const s=n.gc,i=s.length/2;let a;if(i>e){for(a=0;a<i;++a)delete n.data[s[a]];s.splice(0,i)}})}function En(t){return t.drawTicks?t.tickLength:0}function Ho(t,e){if(!t.display)return 0;const n=de(t.font,e),s=be(t.padding);return(Q(t.text)?t.text.length:1)*n.lineHeight+s.height}function $m(t,e){return yt(t,{scale:e,type:"scale"})}function Nm(t,e,n){return yt(t,{tick:n,index:e,type:"tick"})}function Bm(t,e,n){let s=er(t);return(n&&e!=="right"||!n&&e==="right")&&(s=Lm(s)),s}function jm(t,e,n,s){const{top:i,left:a,bottom:r,right:o,chart:l}=t,{chartArea:c,scales:d}=l;let u=0,h,f,p;const g=r-i,m=o-a;if(t.isHorizontal()){if(f=me(s,a,o),W(n)){const _=Object.keys(n)[0],y=n[_];p=d[_].getPixelForValue(y)+g-e}else n==="center"?p=(c.bottom+c.top)/2+g-e:p=Fo(t,n,e);h=o-a}else{if(W(n)){const _=Object.keys(n)[0],y=n[_];f=d[_].getPixelForValue(y)-m+e}else n==="center"?f=(c.left+c.right)/2-m+e:f=Fo(t,n,e);p=me(s,r,i),u=n==="left"?-ae:ae}return{titleX:f,titleY:p,maxWidth:h,rotation:u}}class Ft extends We{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,n){return e}getUserBounds(){let{_userMin:e,_userMax:n,_suggestedMin:s,_suggestedMax:i}=this;return e=Te(e,Number.POSITIVE_INFINITY),n=Te(n,Number.NEGATIVE_INFINITY),s=Te(s,Number.POSITIVE_INFINITY),i=Te(i,Number.NEGATIVE_INFINITY),{min:Te(e,s),max:Te(n,i),minDefined:se(e),maxDefined:se(n)}}getMinMax(e){let{min:n,max:s,minDefined:i,maxDefined:a}=this.getUserBounds(),r;if(i&&a)return{min:n,max:s};const o=this.getMatchingVisibleMetas();for(let l=0,c=o.length;l<c;++l)r=o[l].controller.getMinMax(this,e),i||(n=Math.min(n,r.min)),a||(s=Math.max(s,r.max));return n=a&&n>s?s:n,s=i&&n>s?n:s,{min:Te(n,Te(s,n)),max:Te(s,Te(n,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){K(this.options.beforeUpdate,[this])}update(e,n,s){const{beginAtZero:i,grace:a,ticks:r}=this.options,o=r.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=n,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Kg(this,a,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=o<this.ticks.length;this._convertTicksToLabels(l?Go(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),r.display&&(r.autoSkip||r.source==="auto")&&(this.ticks=Am(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,n,s;this.isHorizontal()?(n=this.left,s=this.right):(n=this.top,s=this.bottom,e=!e),this._startPixel=n,this._endPixel=s,this._reversePixels=e,this._length=s-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){K(this.options.afterUpdate,[this])}beforeSetDimensions(){K(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){K(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),K(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){K(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const n=this.options.ticks;let s,i,a;for(s=0,i=e.length;s<i;s++)a=e[s],a.label=K(n.callback,[a.value,s,e],this)}afterTickToLabelConversion(){K(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){K(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,n=e.ticks,s=Wo(this.ticks.length,e.ticks.maxTicksLimit),i=n.minRotation||0,a=n.maxRotation;let r=i,o,l,c;if(!this._isVisible()||!n.display||i>=a||s<=1||!this.isHorizontal()){this.labelRotation=i;return}const d=this._getLabelSizes(),u=d.widest.width,h=d.highest.height,f=ue(this.chart.width-u,0,this.maxWidth);o=e.offset?this.maxWidth/s:f/(s-1),u+6>o&&(o=f/(s-(e.offset?.5:1)),l=this.maxHeight-En(e.grid)-n.padding-Ho(e.title,this.chart.options.font),c=Math.sqrt(u*u+h*h),r=Qa(Math.min(Math.asin(ue((d.highest.height+6)/o,-1,1)),Math.asin(ue(l/c,-1,1))-Math.asin(ue(h/c,-1,1)))),r=Math.max(i,Math.min(a,r))),this.labelRotation=r}afterCalculateLabelRotation(){K(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){K(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:n,options:{ticks:s,title:i,grid:a}}=this,r=this._isVisible(),o=this.isHorizontal();if(r){const l=Ho(i,n.options.font);if(o?(e.width=this.maxWidth,e.height=En(a)+l):(e.height=this.maxHeight,e.width=En(a)+l),s.display&&this.ticks.length){const{first:c,last:d,widest:u,highest:h}=this._getLabelSizes(),f=s.padding*2,p=Ne(this.labelRotation),g=Math.cos(p),m=Math.sin(p);if(o){const _=s.mirror?0:m*u.width+g*h.height;e.height=Math.min(this.maxHeight,e.height+_+f)}else{const _=s.mirror?0:g*u.width+m*h.height;e.width=Math.min(this.maxWidth,e.width+_+f)}this._calculatePadding(c,d,m,g)}}this._handleMargins(),o?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,n,s,i){const{ticks:{align:a,padding:r},position:o}=this.options,l=this.labelRotation!==0,c=o!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=i*e.width,f=s*n.height):(h=s*e.height,f=i*n.width):a==="start"?f=n.width:a==="end"?h=e.width:a!=="inner"&&(h=e.width/2,f=n.width/2),this.paddingLeft=Math.max((h-d+r)*this.width/(this.width-d),0),this.paddingRight=Math.max((f-u+r)*this.width/(this.width-u),0)}else{let d=n.height/2,u=e.height/2;a==="start"?(d=0,u=e.height):a==="end"&&(d=n.height,u=0),this.paddingTop=d+r,this.paddingBottom=u+r}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){K(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:n}=this.options;return n==="top"||n==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let n,s;for(n=0,s=e.length;n<s;n++)H(e[n].label)&&(e.splice(n,1),s--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const n=this.options.ticks.sampleSize;let s=this.ticks;n<s.length&&(s=Go(s,n)),this._labelSizes=e=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,n,s){const{ctx:i,_longestTextCache:a}=this,r=[],o=[],l=Math.floor(n/Wo(n,s));let c=0,d=0,u,h,f,p,g,m,_,y,b,v,w;for(u=0;u<n;u+=l){if(p=e[u].label,g=this._resolveTickFontOptions(u),i.font=m=g.string,_=a[m]=a[m]||{data:{},gc:[]},y=g.lineHeight,b=v=0,!H(p)&&!Q(p))b=pi(i,_.data,_.gc,b,p),v=y;else if(Q(p))for(h=0,f=p.length;h<f;++h)w=p[h],!H(w)&&!Q(w)&&(b=pi(i,_.data,_.gc,b,w),v+=y);r.push(b),o.push(v),c=Math.max(b,c),d=Math.max(v,d)}Pm(a,n);const k=r.indexOf(c),S=o.indexOf(d),x=E=>({width:r[E]||0,height:o[E]||0});return{first:x(0),last:x(n-1),widest:x(k),highest:x(S),widths:r,heights:o}}getLabelForValue(e){return e}getPixelForValue(e,n){return NaN}getValueForPixel(e){}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const n=this._startPixel+e*this._length;return Sg(this._alignToPixels?kt(this.chart,n,0):n)}getDecimalForPixel(e){const n=(e-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:n}=this;return e<0&&n<0?n:e>0&&n>0?e:0}getContext(e){const n=this.ticks||[];if(e>=0&&e<n.length){const s=n[e];return s.$context||(s.$context=Nm(this.getContext(),e,s))}return this.$context||(this.$context=$m(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,n=Ne(this.labelRotation),s=Math.abs(Math.cos(n)),i=Math.abs(Math.sin(n)),a=this._getLabelSizes(),r=e.autoSkipPadding||0,o=a?a.widest.width+r:0,l=a?a.highest.height+r:0;return this.isHorizontal()?l*s>o*i?o/s:l/i:l*i<o*s?l/s:o/i}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const n=this.axis,s=this.chart,i=this.options,{grid:a,position:r,border:o}=i,l=a.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),h=En(a),f=[],p=o.setContext(this.getContext()),g=p.display?p.width:0,m=g/2,_=function(G){return kt(s,G,g)};let y,b,v,w,k,S,x,E,D,O,$,Z;if(r==="top")y=_(this.bottom),S=this.bottom-h,E=y-m,O=_(e.top)+m,Z=e.bottom;else if(r==="bottom")y=_(this.top),O=e.top,Z=_(e.bottom)-m,S=y+m,E=this.top+h;else if(r==="left")y=_(this.right),k=this.right-h,x=y-m,D=_(e.left)+m,$=e.right;else if(r==="right")y=_(this.left),D=e.left,$=_(e.right)-m,k=y+m,x=this.left+h;else if(n==="x"){if(r==="center")y=_((e.top+e.bottom)/2+.5);else if(W(r)){const G=Object.keys(r)[0],N=r[G];y=_(this.chart.scales[G].getPixelForValue(N))}O=e.top,Z=e.bottom,S=y+m,E=S+h}else if(n==="y"){if(r==="center")y=_((e.left+e.right)/2);else if(W(r)){const G=Object.keys(r)[0],N=r[G];y=_(this.chart.scales[G].getPixelForValue(N))}k=y-m,x=k-h,D=e.left,$=e.right}const oe=P(i.ticks.maxTicksLimit,u),U=Math.max(1,Math.ceil(u/oe));for(b=0;b<u;b+=U){const G=this.getContext(b),N=a.setContext(G),ee=o.setContext(G),te=N.lineWidth,Gt=N.color,vs=ee.dash||[],Ht=ee.dashOffset,yn=N.tickWidth,bn=N.tickColor,vn=N.tickBorderDash||[],wn=N.tickBorderDashOffset;v=Om(this,b,l),v!==void 0&&(w=kt(s,v,te),c?k=x=D=$=w:S=E=O=Z=w,f.push({tx1:k,ty1:S,tx2:x,ty2:E,x1:D,y1:O,x2:$,y2:Z,width:te,color:Gt,borderDash:vs,borderDashOffset:Ht,tickWidth:yn,tickColor:bn,tickBorderDash:vn,tickBorderDashOffset:wn}))}return this._ticksLength=u,this._borderValue=y,f}_computeLabelItems(e){const n=this.axis,s=this.options,{position:i,ticks:a}=s,r=this.isHorizontal(),o=this.ticks,{align:l,crossAlign:c,padding:d,mirror:u}=a,h=En(s.grid),f=h+d,p=u?-d:f,g=-Ne(this.labelRotation),m=[];let _,y,b,v,w,k,S,x,E,D,O,$,Z="middle";if(i==="top")k=this.bottom-p,S=this._getXAxisLabelAlignment();else if(i==="bottom")k=this.top+p,S=this._getXAxisLabelAlignment();else if(i==="left"){const U=this._getYAxisLabelAlignment(h);S=U.textAlign,w=U.x}else if(i==="right"){const U=this._getYAxisLabelAlignment(h);S=U.textAlign,w=U.x}else if(n==="x"){if(i==="center")k=(e.top+e.bottom)/2+f;else if(W(i)){const U=Object.keys(i)[0],G=i[U];k=this.chart.scales[U].getPixelForValue(G)+f}S=this._getXAxisLabelAlignment()}else if(n==="y"){if(i==="center")w=(e.left+e.right)/2-f;else if(W(i)){const U=Object.keys(i)[0],G=i[U];w=this.chart.scales[U].getPixelForValue(G)}S=this._getYAxisLabelAlignment(h).textAlign}n==="y"&&(l==="start"?Z="top":l==="end"&&(Z="bottom"));const oe=this._getLabelSizes();for(_=0,y=o.length;_<y;++_){b=o[_],v=b.label;const U=a.setContext(this.getContext(_));x=this.getPixelForTick(_)+a.labelOffset,E=this._resolveTickFontOptions(_),D=E.lineHeight,O=Q(v)?v.length:1;const G=O/2,N=U.color,ee=U.textStrokeColor,te=U.textStrokeWidth;let Gt=S;r?(w=x,S==="inner"&&(_===y-1?Gt=this.options.reverse?"left":"right":_===0?Gt=this.options.reverse?"right":"left":Gt="center"),i==="top"?c==="near"||g!==0?$=-O*D+D/2:c==="center"?$=-oe.highest.height/2-G*D+D:$=-oe.highest.height+D/2:c==="near"||g!==0?$=D/2:c==="center"?$=oe.highest.height/2-G*D:$=oe.highest.height-O*D,u&&($*=-1),g!==0&&!U.showLabelBackdrop&&(w+=D/2*Math.sin(g))):(k=x,$=(1-O)*D/2);let vs;if(U.showLabelBackdrop){const Ht=be(U.backdropPadding),yn=oe.heights[_],bn=oe.widths[_];let vn=$-Ht.top,wn=0-Ht.left;switch(Z){case"middle":vn-=yn/2;break;case"bottom":vn-=yn;break}switch(S){case"center":wn-=bn/2;break;case"right":wn-=bn;break}vs={left:wn,top:vn,width:bn+Ht.width,height:yn+Ht.height,color:U.backdropColor}}m.push({label:v,font:E,textOffset:$,options:{rotation:g,color:N,strokeColor:ee,strokeWidth:te,textAlign:Gt,textBaseline:Z,translation:[w,k],backdrop:vs}})}return m}_getXAxisLabelAlignment(){const{position:e,ticks:n}=this.options;if(-Ne(this.labelRotation))return e==="top"?"left":"right";let i="center";return n.align==="start"?i="left":n.align==="end"?i="right":n.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(e){const{position:n,ticks:{crossAlign:s,mirror:i,padding:a}}=this.options,r=this._getLabelSizes(),o=e+a,l=r.widest.width;let c,d;return n==="left"?i?(d=this.right+a,s==="near"?c="left":s==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-o,s==="near"?c="right":s==="center"?(c="center",d-=l/2):(c="left",d=this.left)):n==="right"?i?(d=this.left+a,s==="near"?c="right":s==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+o,s==="near"?c="left":s==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:n},left:s,top:i,width:a,height:r}=this;n&&(e.save(),e.fillStyle=n,e.fillRect(s,i,a,r),e.restore())}getLineWidthForValue(e){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const i=this.ticks.findIndex(a=>a.value===e);return i>=0?n.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){const n=this.options.grid,s=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let a,r;const o=(l,c,d)=>{!d.width||!d.color||(s.save(),s.lineWidth=d.width,s.strokeStyle=d.color,s.setLineDash(d.borderDash||[]),s.lineDashOffset=d.borderDashOffset,s.beginPath(),s.moveTo(l.x,l.y),s.lineTo(c.x,c.y),s.stroke(),s.restore())};if(n.display)for(a=0,r=i.length;a<r;++a){const l=i[a];n.drawOnChartArea&&o({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),n.drawTicks&&o({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:n,options:{border:s,grid:i}}=this,a=s.setContext(this.getContext()),r=s.display?a.width:0;if(!r)return;const o=i.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,u,h;this.isHorizontal()?(c=kt(e,this.left,r)-r/2,d=kt(e,this.right,o)+o/2,u=h=l):(u=kt(e,this.top,r)-r/2,h=kt(e,this.bottom,o)+o/2,c=d=l),n.save(),n.lineWidth=a.width,n.strokeStyle=a.color,n.beginPath(),n.moveTo(c,u),n.lineTo(d,h),n.stroke(),n.restore()}drawLabels(e){if(!this.options.ticks.display)return;const s=this.ctx,i=this._computeLabelArea();i&&Ii(s,i);const a=this.getLabelItems(e);for(const r of a){const o=r.options,l=r.font,c=r.label,d=r.textOffset;Pt(s,c,0,d,l,o)}i&&Li(s)}drawTitle(){const{ctx:e,options:{position:n,title:s,reverse:i}}=this;if(!s.display)return;const a=de(s.font),r=be(s.padding),o=s.align;let l=a.lineHeight/2;n==="bottom"||n==="center"||W(n)?(l+=r.bottom,Q(s.text)&&(l+=a.lineHeight*(s.text.length-1))):l+=r.top;const{titleX:c,titleY:d,maxWidth:u,rotation:h}=jm(this,l,n,o);Pt(e,s.text,0,0,a,{color:s.color,maxWidth:u,rotation:h,textAlign:Bm(o,n,i),textBaseline:"middle",translation:[c,d]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,n=e.ticks&&e.ticks.z||0,s=P(e.grid&&e.grid.z,-1),i=P(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==Ft.prototype.draw?[{z:n,draw:a=>{this.draw(a)}}]:[{z:s,draw:a=>{this.drawBackground(),this.drawGrid(a),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:n,draw:a=>{this.drawLabels(a)}}]}getMatchingVisibleMetas(e){const n=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",i=[];let a,r;for(a=0,r=n.length;a<r;++a){const o=n[a];o[s]===this.id&&(!e||o.type===e)&&i.push(o)}return i}_resolveTickFontOptions(e){const n=this.options.ticks.setContext(this.getContext(e));return de(n.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class $s{constructor(e,n,s){this.type=e,this.scope=n,this.override=s,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const n=Object.getPrototypeOf(e);let s;Gm(n)&&(s=this.register(n));const i=this.items,a=e.id,r=this.scope+"."+a;if(!a)throw new Error("class does not have id: "+e);return a in i||(i[a]=e,Fm(e,r,s),this.override&&ie.override(e.id,e.overrides)),r}get(e){return this.items[e]}unregister(e){const n=this.items,s=e.id,i=this.scope;s in n&&delete n[s],i&&s in ie[i]&&(delete ie[i][s],this.override&&delete Ot[s])}}function Fm(t,e,n){const s=rs(Object.create(null),[n?ie.get(n):{},ie.get(e),t.defaults]);ie.set(e,s),t.defaultRoutes&&Wm(e,t.defaultRoutes),t.descriptors&&ie.describe(e,t.descriptors)}function Wm(t,e){Object.keys(e).forEach(n=>{const s=n.split("."),i=s.pop(),a=[t].concat(s).join("."),r=e[n].split("."),o=r.pop(),l=r.join(".");ie.route(a,i,l,o)})}function Gm(t){return"id"in t&&"defaults"in t}class Hm{constructor(){this.controllers=new $s(je,"datasets",!0),this.elements=new $s(We,"elements"),this.plugins=new $s(Object,"plugins"),this.scales=new $s(Ft,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,n,s){[...n].forEach(i=>{const a=s||this._getRegistryForType(i);s||a.isForType(i)||a===this.plugins&&i.id?this._exec(e,a,i):q(i,r=>{const o=s||this._getRegistryForType(r);this._exec(e,o,r)})})}_exec(e,n,s){const i=Xa(e);K(s["before"+i],[],s),n[e](s),K(s["after"+i],[],s)}_getRegistryForType(e){for(let n=0;n<this._typedRegistries.length;n++){const s=this._typedRegistries[n];if(s.isForType(e))return s}return this.plugins}_get(e,n,s){const i=n.get(e);if(i===void 0)throw new Error('"'+e+'" is not a registered '+s+".");return i}}var Ue=new Hm;class Um{constructor(){this._init=[]}notify(e,n,s,i){n==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const a=i?this._descriptors(e).filter(i):this._descriptors(e),r=this._notify(a,e,n,s);return n==="afterDestroy"&&(this._notify(a,e,"stop"),this._notify(this._init,e,"uninstall")),r}_notify(e,n,s,i){i=i||{};for(const a of e){const r=a.plugin,o=r[s],l=[n,i,a.options];if(K(o,l,r)===!1&&i.cancelable)return!1}return!0}invalidate(){H(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),n}_createDescriptors(e,n){const s=e&&e.config,i=P(s.options&&s.options.plugins,{}),a=qm(s);return i===!1&&!n?[]:zm(e,a,i,n)}_notifyStateChanges(e){const n=this._oldCache||[],s=this._cache,i=(a,r)=>a.filter(o=>!r.some(l=>o.plugin.id===l.plugin.id));this._notify(i(n,s),e,"stop"),this._notify(i(s,n),e,"start")}}function qm(t){const e={},n=[],s=Object.keys(Ue.plugins.items);for(let a=0;a<s.length;a++)n.push(Ue.getPlugin(s[a]));const i=t.plugins||[];for(let a=0;a<i.length;a++){const r=i[a];n.indexOf(r)===-1&&(n.push(r),e[r.id]=!0)}return{plugins:n,localIds:e}}function Vm(t,e){return!e&&t===!1?null:t===!0?{}:t}function zm(t,{plugins:e,localIds:n},s,i){const a=[],r=t.getContext();for(const o of e){const l=o.id,c=Vm(s[l],i);c!==null&&a.push({plugin:o,options:Km(t.config,{plugin:o,local:n[l]},c,r)})}return a}function Km(t,{plugin:e,local:n},s,i){const a=t.pluginScopeKeys(e),r=t.getOptionScopes(s,a);return n&&e.defaults&&r.push(e.defaults),t.createResolver(r,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Da(t,e){const n=ie.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function Ym(t,e){let n=t;return t==="_index_"?n=e:t==="_value_"&&(n=e==="x"?"y":"x"),n}function Jm(t,e){return t===e?"_index_":"_value_"}function Uo(t){if(t==="x"||t==="y"||t==="r")return t}function Xm(t){if(t==="top"||t==="bottom")return"x";if(t==="left"||t==="right")return"y"}function Ia(t,...e){if(Uo(t))return t;for(const n of e){const s=n.axis||Xm(n.position)||t.length>1&&Uo(t[0].toLowerCase());if(s)return s}throw new Error(`Cannot determine type of '${t}' axis. Please provide 'axis' or 'position' option.`)}function qo(t,e,n){if(n[e+"AxisID"]===t)return{axis:e}}function Qm(t,e){if(e.data&&e.data.datasets){const n=e.data.datasets.filter(s=>s.xAxisID===t||s.yAxisID===t);if(n.length)return qo(t,"x",n[0])||qo(t,"y",n[0])}return{}}function Zm(t,e){const n=Ot[t.type]||{scales:{}},s=e.scales||{},i=Da(t.type,e),a=Object.create(null);return Object.keys(s).forEach(r=>{const o=s[r];if(!W(o))return console.error(`Invalid scale configuration for scale: ${r}`);if(o._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${r}`);const l=Ia(r,o,Qm(r,t),ie.scales[o.type]),c=Jm(l,i),d=n.scales||{};a[r]=Hn(Object.create(null),[{axis:l},o,d[l],d[c]])}),t.data.datasets.forEach(r=>{const o=r.type||t.type,l=r.indexAxis||Da(o,e),d=(Ot[o]||{}).scales||{};Object.keys(d).forEach(u=>{const h=Ym(u,l),f=r[h+"AxisID"]||h;a[f]=a[f]||Object.create(null),Hn(a[f],[{axis:h},s[f],d[u]])})}),Object.keys(a).forEach(r=>{const o=a[r];Hn(o,[ie.scales[o.type],ie.scale])}),a}function Wc(t){const e=t.options||(t.options={});e.plugins=P(e.plugins,{}),e.scales=Zm(t,e)}function Gc(t){return t=t||{},t.datasets=t.datasets||[],t.labels=t.labels||[],t}function e_(t){return t=t||{},t.data=Gc(t.data),Wc(t),t}const Vo=new Map,Hc=new Set;function Ns(t,e){let n=Vo.get(t);return n||(n=e(),Vo.set(t,n),Hc.add(n)),n}const An=(t,e,n)=>{const s=mt(e,n);s!==void 0&&t.add(s)};class t_{constructor(e){this._config=e_(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=Gc(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),Wc(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Ns(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,n){return Ns(`${e}.transition.${n}`,()=>[[`datasets.${e}.transitions.${n}`,`transitions.${n}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,n){return Ns(`${e}-${n}`,()=>[[`datasets.${e}.elements.${n}`,`datasets.${e}`,`elements.${n}`,""]])}pluginScopeKeys(e){const n=e.id,s=this.type;return Ns(`${s}-plugin-${n}`,()=>[[`plugins.${n}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,n){const s=this._scopeCache;let i=s.get(e);return(!i||n)&&(i=new Map,s.set(e,i)),i}getOptionScopes(e,n,s){const{options:i,type:a}=this,r=this._cachedScopes(e,s),o=r.get(n);if(o)return o;const l=new Set;n.forEach(d=>{e&&(l.add(e),d.forEach(u=>An(l,e,u))),d.forEach(u=>An(l,i,u)),d.forEach(u=>An(l,Ot[a]||{},u)),d.forEach(u=>An(l,ie,u)),d.forEach(u=>An(l,Ma,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),Hc.has(n)&&r.set(n,c),c}chartOptionScopes(){const{options:e,type:n}=this;return[e,Ot[n]||{},ie.datasets[n]||{},{type:n},ie,Ma]}resolveNamedOptions(e,n,s,i=[""]){const a={$shared:!0},{resolver:r,subPrefixes:o}=zo(this._resolverCache,e,i);let l=r;if(s_(r,n)){a.$shared=!1,s=_t(s)?s():s;const c=this.createResolver(e,s,o);l=ln(r,s,c)}for(const c of n)a[c]=l[c];return a}createResolver(e,n,s=[""],i){const{resolver:a}=zo(this._resolverCache,e,s);return W(n)?ln(a,n,void 0,i):a}}function zo(t,e,n){let s=t.get(e);s||(s=new Map,t.set(e,s));const i=n.join();let a=s.get(i);return a||(a={resolver:sr(e,n),subPrefixes:n.filter(o=>!o.toLowerCase().includes("hover"))},s.set(i,a)),a}const n_=t=>W(t)&&Object.getOwnPropertyNames(t).reduce((e,n)=>e||_t(t[n]),!1);function s_(t,e){const{isScriptable:n,isIndexable:s}=wc(t);for(const i of e){const a=n(i),r=s(i),o=(r||a)&&t[i];if(a&&(_t(o)||n_(o))||r&&Q(o))return!0}return!1}var i_="4.4.0";const a_=["top","bottom","left","right","chartArea"];function Ko(t,e){return t==="top"||t==="bottom"||a_.indexOf(t)===-1&&e==="x"}function Yo(t,e){return function(n,s){return n[t]===s[t]?n[e]-s[e]:n[t]-s[t]}}function Jo(t){const e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),K(n&&n.onComplete,[t],e)}function r_(t){const e=t.chart,n=e.options.animation;K(n&&n.onProgress,[t],e)}function Uc(t){return Ac()&&typeof t=="string"?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const si={},Xo=t=>{const e=Uc(t);return Object.values(si).filter(n=>n.canvas===e).pop()};function o_(t,e,n){const s=Object.keys(t);for(const i of s){const a=+i;if(a>=e){const r=t[i];delete t[i],(n>0||a>e)&&(t[a+n]=r)}}}function l_(t,e,n,s){return!n||t.type==="mouseout"?null:s?e:t}function Bs(t,e,n){return t.options.clip?t[n]:e[n]}function c_(t,e){const{xScale:n,yScale:s}=t;return n&&s?{left:Bs(n,e,"left"),right:Bs(n,e,"right"),top:Bs(s,e,"top"),bottom:Bs(s,e,"bottom")}:e}class et{static register(...e){Ue.add(...e),Qo()}static unregister(...e){Ue.remove(...e),Qo()}constructor(e,n){const s=this.config=new t_(n),i=Uc(e),a=Xo(i);if(a)throw new Error("Canvas is already in use. Chart with ID '"+a.id+"' must be destroyed before the canvas with ID '"+a.canvas.id+"' can be reused.");const r=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||Em(i)),this.platform.updateConfig(s);const o=this.platform.acquireContext(i,r.aspectRatio),l=o&&o.canvas,c=l&&l.height,d=l&&l.width;if(this.id=ug(),this.ctx=o,this.canvas=l,this.width=d,this.height=c,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Um,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Ag(u=>this.update(u),r.resizeDelay||0),this._dataChanges=[],si[this.id]=this,!o||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Ye.listen(this,"complete",Jo),Ye.listen(this,"progress",r_),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:n},width:s,height:i,_aspectRatio:a}=this;return H(e)?n&&a?a:i?s/i:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return Ue}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():bo(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return mo(this.canvas,this.ctx),this}stop(){return Ye.stop(this),this}resize(e,n){Ye.running(this)?this._resizeBeforeDraw={width:e,height:n}:this._resize(e,n)}_resize(e,n){const s=this.options,i=this.canvas,a=s.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(i,e,n,a),o=s.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,bo(this,o,!0)&&(this.notifyPlugins("resize",{size:r}),K(s.onResize,[this,r],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};q(n,(s,i)=>{s.id=i})}buildOrUpdateScales(){const e=this.options,n=e.scales,s=this.scales,i=Object.keys(s).reduce((r,o)=>(r[o]=!1,r),{});let a=[];n&&(a=a.concat(Object.keys(n).map(r=>{const o=n[r],l=Ia(r,o),c=l==="r",d=l==="x";return{options:o,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),q(a,r=>{const o=r.options,l=o.id,c=Ia(l,o),d=P(o.type,r.dtype);(o.position===void 0||Ko(o.position,c)!==Ko(r.dposition))&&(o.position=r.dposition),i[l]=!0;let u=null;if(l in s&&s[l].type===d)u=s[l];else{const h=Ue.getScale(d);u=new h({id:l,type:d,ctx:this.ctx,chart:this}),s[u.id]=u}u.init(o,e)}),q(i,(r,o)=>{r||delete s[o]}),q(s,r=>{ye.configure(this,r,r.options),ye.addBox(this,r)})}_updateMetasets(){const e=this._metasets,n=this.data.datasets.length,s=e.length;if(e.sort((i,a)=>i.index-a.index),s>n){for(let i=n;i<s;++i)this._destroyDatasetMeta(i);e.splice(n,s-n)}this._sortedMetasets=e.slice(0).sort(Yo("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:n}}=this;e.length>n.length&&delete this._stacks,e.forEach((s,i)=>{n.filter(a=>a===s._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const e=[],n=this.data.datasets;let s,i;for(this._removeUnreferencedMetasets(),s=0,i=n.length;s<i;s++){const a=n[s];let r=this.getDatasetMeta(s);const o=a.type||this.config.type;if(r.type&&r.type!==o&&(this._destroyDatasetMeta(s),r=this.getDatasetMeta(s)),r.type=o,r.indexAxis=a.indexAxis||Da(o,this.options),r.order=a.order||0,r.index=s,r.label=""+a.label,r.visible=this.isDatasetVisible(s),r.controller)r.controller.updateIndex(s),r.controller.linkScales();else{const l=Ue.getController(o),{datasetElementType:c,dataElementType:d}=ie.datasets[o];Object.assign(l,{dataElementType:Ue.getElement(d),datasetElementType:c&&Ue.getElement(c)}),r.controller=new l(this,s),e.push(r.controller)}}return this._updateMetasets(),e}_resetElements(){q(this.data.datasets,(e,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const n=this.config;n.update();const s=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const a=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:u}=this.getDatasetMeta(c),h=!i&&a.indexOf(u)===-1;u.buildOrUpdateElements(h),r=Math.max(+u.getMaxOverflow(),r)}r=this._minPadding=s.layout.autoPadding?r:0,this._updateLayout(r),i||q(a,c=>{c.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(Yo("z","_idx"));const{_active:o,_lastEvent:l}=this;l?this._eventHandler(l,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){q(this.scales,e=>{ye.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,n=new Set(Object.keys(this._listeners)),s=new Set(e.events);(!ro(n,s)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,n=this._getUniformDataChanges()||[];for(const{method:s,start:i,count:a}of n){const r=s==="_removeElements"?-a:a;o_(e,i,r)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const n=this.data.datasets.length,s=a=>new Set(e.filter(r=>r[0]===a).map((r,o)=>o+","+r.splice(1).join(","))),i=s(0);for(let a=1;a<n;a++)if(!ro(i,s(a)))return;return Array.from(i).map(a=>a.split(",")).map(a=>({method:a[1],start:+a[2],count:+a[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;ye.update(this,this.width,this.height,e);const n=this.chartArea,s=n.width<=0||n.height<=0;this._layers=[],q(this.boxes,i=>{s&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,a)=>{i._idx=a}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let n=0,s=this.data.datasets.length;n<s;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,s=this.data.datasets.length;n<s;++n)this._updateDataset(n,_t(e)?e({datasetIndex:n}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,n){const s=this.getDatasetMeta(e),i={meta:s,index:e,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(s.controller._update(n),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Ye.has(this)?this.attached&&!Ye.running(this)&&Ye.start(this):(this.draw(),Jo({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:s,height:i}=this._resizeBeforeDraw;this._resize(s,i),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(e=0;e<n.length&&n[e].z<=0;++e)n[e].draw(this.chartArea);for(this._drawDatasets();e<n.length;++e)n[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const n=this._sortedMetasets,s=[];let i,a;for(i=0,a=n.length;i<a;++i){const r=n[i];(!e||r.visible)&&s.push(r)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let n=e.length-1;n>=0;--n)this._drawDataset(e[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const n=this.ctx,s=e._clip,i=!s.disabled,a=c_(e,this.chartArea),r={meta:e,index:e.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",r)!==!1&&(i&&Ii(n,{left:s.left===!1?0:a.left-s.left,right:s.right===!1?this.width:a.right+s.right,top:s.top===!1?0:a.top-s.top,bottom:s.bottom===!1?this.height:a.bottom+s.bottom}),e.controller.draw(),i&&Li(n),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(e){return it(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,n,s,i){const a=am.modes[n];return typeof a=="function"?a(this,e,s,i):[]}getDatasetMeta(e){const n=this.data.datasets[e],s=this._metasets;let i=s.filter(a=>a&&a._dataset===n).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:e,_dataset:n,_parsed:[],_sorted:!1},s.push(i)),i}getContext(){return this.$context||(this.$context=yt(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const n=this.data.datasets[e];if(!n)return!1;const s=this.getDatasetMeta(e);return typeof s.hidden=="boolean"?!s.hidden:!n.hidden}setDatasetVisibility(e,n){const s=this.getDatasetMeta(e);s.hidden=!n}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,n,s){const i=s?"show":"hide",a=this.getDatasetMeta(e),r=a.controller._resolveAnimations(void 0,i);os(n)?(a.data[n].hidden=!s,this.update()):(this.setDatasetVisibility(e,s),r.update(a,{visible:s}),this.update(o=>o.datasetIndex===e?i:void 0))}hide(e,n){this._updateVisibility(e,n,!1)}show(e,n){this._updateVisibility(e,n,!0)}_destroyDatasetMeta(e){const n=this._metasets[e];n&&n.controller&&n.controller._destroy(),delete this._metasets[e]}_stop(){let e,n;for(this.stop(),Ye.remove(this),e=0,n=this.data.datasets.length;e<n;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:n}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),mo(e,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete si[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,n=this.platform,s=(a,r)=>{n.addEventListener(this,a,r),e[a]=r},i=(a,r,o)=>{a.offsetX=r,a.offsetY=o,this._eventHandler(a)};q(this.options.events,a=>s(a,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,n=this.platform,s=(l,c)=>{n.addEventListener(this,l,c),e[l]=c},i=(l,c)=>{e[l]&&(n.removeEventListener(this,l,c),delete e[l])},a=(l,c)=>{this.canvas&&this.resize(l,c)};let r;const o=()=>{i("attach",o),this.attached=!0,this.resize(),s("resize",a),s("detach",r)};r=()=>{this.attached=!1,i("resize",a),this._stop(),this._resize(0,0),s("attach",o)},n.isAttached(this.canvas)?o():r()}unbindEvents(){q(this._listeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._listeners={},q(this._responsiveListeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,n,s){const i=s?"set":"remove";let a,r,o,l;for(n==="dataset"&&(a=this.getDatasetMeta(e[0].datasetIndex),a.controller["_"+i+"DatasetHoverStyle"]()),o=0,l=e.length;o<l;++o){r=e[o];const c=r&&this.getDatasetMeta(r.datasetIndex).controller;c&&c[i+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const n=this._active||[],s=e.map(({datasetIndex:a,index:r})=>{const o=this.getDatasetMeta(a);if(!o)throw new Error("No dataset found at index "+a);return{datasetIndex:a,element:o.data[r],index:r}});!hi(s,n)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,n))}notifyPlugins(e,n,s){return this._plugins.notify(this,e,n,s)}isPluginEnabled(e){return this._plugins._cache.filter(n=>n.plugin.id===e).length===1}_updateHoverStyles(e,n,s){const i=this.options.hover,a=(l,c)=>l.filter(d=>!c.some(u=>d.datasetIndex===u.datasetIndex&&d.index===u.index)),r=a(n,e),o=s?e:a(e,n);r.length&&this.updateHoverStyle(r,i.mode,!1),o.length&&i.mode&&this.updateHoverStyle(o,i.mode,!0)}_eventHandler(e,n){const s={event:e,replay:n,cancelable:!0,inChartArea:this.isPointInArea(e)},i=r=>(r.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",s,i)===!1)return;const a=this._handleEvent(e,n,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,i),(a||s.changed)&&this.render(),this}_handleEvent(e,n,s){const{_active:i=[],options:a}=this,r=n,o=this._getActiveElements(e,i,s,r),l=_g(e),c=l_(e,this._lastEvent,s,l);s&&(this._lastEvent=null,K(a.onHover,[e,o,this],this),l&&K(a.onClick,[e,o,this],this));const d=!hi(o,i);return(d||n)&&(this._active=o,this._updateHoverStyles(o,i,n)),this._lastEvent=c,d}_getActiveElements(e,n,s,i){if(e.type==="mouseout")return[];if(!s)return n;const a=this.options.hover;return this.getElementsAtEventForMode(e,a.mode,a,i)}}C(et,"defaults",ie),C(et,"instances",si),C(et,"overrides",Ot),C(et,"registry",Ue),C(et,"version",i_),C(et,"getChart",Xo);function Qo(){return q(et.instances,t=>t._plugins.invalidate())}function d_(t,e,n){const{startAngle:s,pixelMargin:i,x:a,y:r,outerRadius:o,innerRadius:l}=e;let c=i/o;t.beginPath(),t.arc(a,r,o,s-c,n+c),l>i?(c=i/l,t.arc(a,r,l,n+c,s-c,!0)):t.arc(a,r,i,n+ae,s-ae),t.closePath(),t.clip()}function u_(t){return nr(t,["outerStart","outerEnd","innerStart","innerEnd"])}function h_(t,e,n,s){const i=u_(t.options.borderRadius),a=(n-e)/2,r=Math.min(a,s*e/2),o=l=>{const c=(n-Math.min(a,l))*s/2;return ue(l,0,Math.min(a,c))};return{outerStart:o(i.outerStart),outerEnd:o(i.outerEnd),innerStart:ue(i.innerStart,0,r),innerEnd:ue(i.innerEnd,0,r)}}function Xt(t,e,n,s){return{x:n+t*Math.cos(e),y:s+t*Math.sin(e)}}function yi(t,e,n,s,i,a){const{x:r,y:o,startAngle:l,pixelMargin:c,innerRadius:d}=e,u=Math.max(e.outerRadius+s+n-c,0),h=d>0?d+s+n+c:0;let f=0;const p=i-l;if(s){const U=d>0?d-s:0,G=u>0?u-s:0,N=(U+G)/2,ee=N!==0?p*N/(N+s):p;f=(p-ee)/2}const g=Math.max(.001,p*u-n/X)/u,m=(p-g)/2,_=l+m+f,y=i-m-f,{outerStart:b,outerEnd:v,innerStart:w,innerEnd:k}=h_(e,h,u,y-_),S=u-b,x=u-v,E=_+b/S,D=y-v/x,O=h+w,$=h+k,Z=_+w/O,oe=y-k/$;if(t.beginPath(),a){const U=(E+D)/2;if(t.arc(r,o,u,E,U),t.arc(r,o,u,U,D),v>0){const te=Xt(x,D,r,o);t.arc(te.x,te.y,v,D,y+ae)}const G=Xt($,y,r,o);if(t.lineTo(G.x,G.y),k>0){const te=Xt($,oe,r,o);t.arc(te.x,te.y,k,y+ae,oe+Math.PI)}const N=(y-k/h+(_+w/h))/2;if(t.arc(r,o,h,y-k/h,N,!0),t.arc(r,o,h,N,_+w/h,!0),w>0){const te=Xt(O,Z,r,o);t.arc(te.x,te.y,w,Z+Math.PI,_-ae)}const ee=Xt(S,_,r,o);if(t.lineTo(ee.x,ee.y),b>0){const te=Xt(S,E,r,o);t.arc(te.x,te.y,b,_-ae,E)}}else{t.moveTo(r,o);const U=Math.cos(E)*u+r,G=Math.sin(E)*u+o;t.lineTo(U,G);const N=Math.cos(D)*u+r,ee=Math.sin(D)*u+o;t.lineTo(N,ee)}t.closePath()}function f_(t,e,n,s,i){const{fullCircles:a,startAngle:r,circumference:o}=e;let l=e.endAngle;if(a){yi(t,e,n,s,l,i);for(let c=0;c<a;++c)t.fill();isNaN(o)||(l=r+(o%J||J))}return yi(t,e,n,s,l,i),t.fill(),l}function g_(t,e,n,s,i){const{fullCircles:a,startAngle:r,circumference:o,options:l}=e,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:h}=l,f=l.borderAlign==="inner";if(!c)return;t.setLineDash(u||[]),t.lineDashOffset=h,f?(t.lineWidth=c*2,t.lineJoin=d||"round"):(t.lineWidth=c,t.lineJoin=d||"bevel");let p=e.endAngle;if(a){yi(t,e,n,s,p,i);for(let g=0;g<a;++g)t.stroke();isNaN(o)||(p=r+(o%J||J))}f&&d_(t,e,p),a||(yi(t,e,n,s,p,i),t.stroke())}class $n extends We{constructor(n){super();C(this,"circumference");C(this,"endAngle");C(this,"fullCircles");C(this,"innerRadius");C(this,"outerRadius");C(this,"pixelMargin");C(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,n&&Object.assign(this,n)}inRange(n,s,i){const a=this.getProps(["x","y"],i),{angle:r,distance:o}=uc(a,{x:n,y:s}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:u,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),f=(this.options.spacing+this.options.borderWidth)/2,g=P(h,c-l)>=J||ls(r,l,c),m=nt(o,d+f,u+f);return g&&m}getCenterPoint(n){const{x:s,y:i,startAngle:a,endAngle:r,innerRadius:o,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],n),{offset:c,spacing:d}=this.options,u=(a+r)/2,h=(o+l+d+c)/2;return{x:s+Math.cos(u)*h,y:i+Math.sin(u)*h}}tooltipPosition(n){return this.getCenterPoint(n)}draw(n){const{options:s,circumference:i}=this,a=(s.offset||0)/4,r=(s.spacing||0)/2,o=s.circular;if(this.pixelMargin=s.borderAlign==="inner"?.33:0,this.fullCircles=i>J?Math.floor(i/J):0,i===0||this.innerRadius<0||this.outerRadius<0)return;n.save();const l=(this.startAngle+this.endAngle)/2;n.translate(Math.cos(l)*a,Math.sin(l)*a);const c=1-Math.sin(Math.min(X,i||0)),d=a*c;n.fillStyle=s.backgroundColor,n.strokeStyle=s.borderColor,f_(n,this,d,r,o),g_(n,this,d,r,o),n.restore()}}C($n,"id","arc"),C($n,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),C($n,"defaultRoutes",{backgroundColor:"backgroundColor"}),C($n,"descriptors",{_scriptable:!0,_indexable:n=>n!=="borderDash"});function qc(t,e,n=e){t.lineCap=P(n.borderCapStyle,e.borderCapStyle),t.setLineDash(P(n.borderDash,e.borderDash)),t.lineDashOffset=P(n.borderDashOffset,e.borderDashOffset),t.lineJoin=P(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=P(n.borderWidth,e.borderWidth),t.strokeStyle=P(n.borderColor,e.borderColor)}function p_(t,e,n){t.lineTo(n.x,n.y)}function m_(t){return t.stepped?jg:t.tension||t.cubicInterpolationMode==="monotone"?Fg:p_}function Vc(t,e,n={}){const s=t.length,{start:i=0,end:a=s-1}=n,{start:r,end:o}=e,l=Math.max(i,r),c=Math.min(a,o),d=i<r&&a<r||i>o&&a>o;return{count:s,start:l,loop:e.loop,ilen:c<l&&!d?s+c-l:c-l}}function __(t,e,n,s){const{points:i,options:a}=e,{count:r,start:o,loop:l,ilen:c}=Vc(i,n,s),d=m_(a);let{move:u=!0,reverse:h}=s||{},f,p,g;for(f=0;f<=c;++f)p=i[(o+(h?c-f:f))%r],!p.skip&&(u?(t.moveTo(p.x,p.y),u=!1):d(t,g,p,h,a.stepped),g=p);return l&&(p=i[(o+(h?c:0))%r],d(t,g,p,h,a.stepped)),!!l}function y_(t,e,n,s){const i=e.points,{count:a,start:r,ilen:o}=Vc(i,n,s),{move:l=!0,reverse:c}=s||{};let d=0,u=0,h,f,p,g,m,_;const y=v=>(r+(c?o-v:v))%a,b=()=>{g!==m&&(t.lineTo(d,m),t.lineTo(d,g),t.lineTo(d,_))};for(l&&(f=i[y(0)],t.moveTo(f.x,f.y)),h=0;h<=o;++h){if(f=i[y(h)],f.skip)continue;const v=f.x,w=f.y,k=v|0;k===p?(w<g?g=w:w>m&&(m=w),d=(u*d+v)/++u):(b(),t.lineTo(v,w),p=k,u=0,g=m=w),_=w}b()}function La(t){const e=t.options,n=e.borderDash&&e.borderDash.length;return!t._decimated&&!t._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!n?y_:__}function b_(t){return t.stepped?yp:t.tension||t.cubicInterpolationMode==="monotone"?bp:At}function v_(t,e,n,s){let i=e._path;i||(i=e._path=new Path2D,e.path(i,n,s)&&i.closePath()),qc(t,e.options),t.stroke(i)}function w_(t,e,n,s){const{segments:i,options:a}=e,r=La(e);for(const o of i)qc(t,a,o.style),t.beginPath(),r(t,e,o,{start:n,end:n+s-1})&&t.closePath(),t.stroke()}const k_=typeof Path2D=="function";function S_(t,e,n,s){k_&&!e.options.segment?v_(t,e,n,s):w_(t,e,n,s)}class ht extends We{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,n){const s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){const i=s.spanGaps?this._loop:this._fullLoop;dp(this._points,s,e,i,n),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Cp(this,this.options.segment))}first(){const e=this.segments,n=this.points;return e.length&&n[e[0].start]}last(){const e=this.segments,n=this.points,s=e.length;return s&&n[e[s-1].end]}interpolate(e,n){const s=this.options,i=e[n],a=this.points,r=Ic(this,{property:n,start:i,end:i});if(!r.length)return;const o=[],l=b_(s);let c,d;for(c=0,d=r.length;c<d;++c){const{start:u,end:h}=r[c],f=a[u],p=a[h];if(f===p){o.push(f);continue}const g=Math.abs((i-f[n])/(p[n]-f[n])),m=l(f,p,g,s.stepped);m[n]=e[n],o.push(m)}return o.length===1?o[0]:o}pathSegment(e,n,s){return La(this)(e,this,n,s)}path(e,n,s){const i=this.segments,a=La(this);let r=this._loop;n=n||0,s=s||this.points.length-n;for(const o of i)r&=a(e,this,o,{start:n,end:n+s-1});return!!r}draw(e,n,s,i){const a=this.options||{};(this.points||[]).length&&a.borderWidth&&(e.save(),S_(e,this,s,i),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}C(ht,"id","line"),C(ht,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),C(ht,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),C(ht,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"});function Zo(t,e,n,s){const i=t.options,{[n]:a}=t.getProps([n],s);return Math.abs(e-a)<i.radius+i.hitRadius}class ii extends We{constructor(n){super();C(this,"parsed");C(this,"skip");C(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,n&&Object.assign(this,n)}inRange(n,s,i){const a=this.options,{x:r,y:o}=this.getProps(["x","y"],i);return Math.pow(n-r,2)+Math.pow(s-o,2)<Math.pow(a.hitRadius+a.radius,2)}inXRange(n,s){return Zo(this,n,"x",s)}inYRange(n,s){return Zo(this,n,"y",s)}getCenterPoint(n){const{x:s,y:i}=this.getProps(["x","y"],n);return{x:s,y:i}}size(n){n=n||this.options||{};let s=n.radius||0;s=Math.max(s,s&&n.hoverRadius||0);const i=s&&n.borderWidth||0;return(s+i)*2}draw(n,s){const i=this.options;this.skip||i.radius<.1||!it(this,s,this.size(i)/2)||(n.strokeStyle=i.borderColor,n.lineWidth=i.borderWidth,n.fillStyle=i.backgroundColor,Ta(n,i,this.x,this.y))}getRange(){const n=this.options||{};return n.radius+n.hitRadius}}C(ii,"id","point"),C(ii,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),C(ii,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function zc(t,e){const{x:n,y:s,base:i,width:a,height:r}=t.getProps(["x","y","base","width","height"],e);let o,l,c,d,u;return t.horizontal?(u=r/2,o=Math.min(n,i),l=Math.max(n,i),c=s-u,d=s+u):(u=a/2,o=n-u,l=n+u,c=Math.min(s,i),d=Math.max(s,i)),{left:o,top:c,right:l,bottom:d}}function ft(t,e,n,s){return t?0:ue(e,n,s)}function x_(t,e,n){const s=t.options.borderWidth,i=t.borderSkipped,a=vc(s);return{t:ft(i.top,a.top,0,n),r:ft(i.right,a.right,0,e),b:ft(i.bottom,a.bottom,0,n),l:ft(i.left,a.left,0,e)}}function C_(t,e,n){const{enableBorderRadius:s}=t.getProps(["enableBorderRadius"]),i=t.options.borderRadius,a=It(i),r=Math.min(e,n),o=t.borderSkipped,l=s||W(i);return{topLeft:ft(!l||o.top||o.left,a.topLeft,0,r),topRight:ft(!l||o.top||o.right,a.topRight,0,r),bottomLeft:ft(!l||o.bottom||o.left,a.bottomLeft,0,r),bottomRight:ft(!l||o.bottom||o.right,a.bottomRight,0,r)}}function E_(t){const e=zc(t),n=e.right-e.left,s=e.bottom-e.top,i=x_(t,n/2,s/2),a=C_(t,n/2,s/2);return{outer:{x:e.left,y:e.top,w:n,h:s,radius:a},inner:{x:e.left+i.l,y:e.top+i.t,w:n-i.l-i.r,h:s-i.t-i.b,radius:{topLeft:Math.max(0,a.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,a.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,a.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,a.bottomRight-Math.max(i.b,i.r))}}}}function da(t,e,n,s){const i=e===null,a=n===null,o=t&&!(i&&a)&&zc(t,s);return o&&(i||nt(e,o.left,o.right))&&(a||nt(n,o.top,o.bottom))}function A_(t){return t.topLeft||t.topRight||t.bottomLeft||t.bottomRight}function M_(t,e){t.rect(e.x,e.y,e.w,e.h)}function ua(t,e,n={}){const s=t.x!==n.x?-e:0,i=t.y!==n.y?-e:0,a=(t.x+t.w!==n.x+n.w?e:0)-s,r=(t.y+t.h!==n.y+n.h?e:0)-i;return{x:t.x+s,y:t.y+i,w:t.w+a,h:t.h+r,radius:t.radius}}class ai extends We{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:n,options:{borderColor:s,backgroundColor:i}}=this,{inner:a,outer:r}=E_(this),o=A_(r.radius)?cs:M_;e.save(),(r.w!==a.w||r.h!==a.h)&&(e.beginPath(),o(e,ua(r,n,a)),e.clip(),o(e,ua(a,-n,r)),e.fillStyle=s,e.fill("evenodd")),e.beginPath(),o(e,ua(a,n)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,n,s){return da(this,e,n,s)}inXRange(e,n){return da(this,e,null,n)}inYRange(e,n){return da(this,null,e,n)}getCenterPoint(e){const{x:n,y:s,base:i,horizontal:a}=this.getProps(["x","y","base","horizontal"],e);return{x:a?(n+i)/2:n,y:a?s:(s+i)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}C(ai,"id","bar"),C(ai,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),C(ai,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var T_=Object.freeze({__proto__:null,ArcElement:$n,BarElement:ai,LineElement:ht,PointElement:ii});const Oa=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],el=Oa.map(t=>t.replace("rgb(","rgba(").replace(")",", 0.5)"));function Kc(t){return Oa[t%Oa.length]}function Yc(t){return el[t%el.length]}function R_(t,e){return t.borderColor=Kc(e),t.backgroundColor=Yc(e),++e}function D_(t,e){return t.backgroundColor=t.data.map(()=>Kc(e++)),e}function I_(t,e){return t.backgroundColor=t.data.map(()=>Yc(e++)),e}function L_(t){let e=0;return(n,s)=>{const i=t.getDatasetMeta(s).controller;i instanceof Dt?e=D_(n,e):i instanceof zn?e=I_(n,e):i&&(e=R_(n,e))}}function tl(t){let e;for(e in t)if(t[e].borderColor||t[e].backgroundColor)return!0;return!1}function O_(t){return t&&(t.borderColor||t.backgroundColor)}var P_={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(t,e,n){if(!n.enabled)return;const{data:{datasets:s},options:i}=t.config,{elements:a}=i;if(!n.forceOverride&&(tl(s)||O_(i)||a&&tl(a)))return;const r=L_(t);s.forEach(r)}};function $_(t,e,n,s,i){const a=i.samples||s;if(a>=n)return t.slice(e,e+n);const r=[],o=(n-2)/(a-2);let l=0;const c=e+n-1;let d=e,u,h,f,p,g;for(r[l++]=t[d],u=0;u<a-2;u++){let m=0,_=0,y;const b=Math.floor((u+1)*o)+1+e,v=Math.min(Math.floor((u+2)*o)+1,n)+e,w=v-b;for(y=b;y<v;y++)m+=t[y].x,_+=t[y].y;m/=w,_/=w;const k=Math.floor(u*o)+1+e,S=Math.min(Math.floor((u+1)*o)+1,n)+e,{x,y:E}=t[d];for(f=p=-1,y=k;y<S;y++)p=.5*Math.abs((x-m)*(t[y].y-E)-(x-t[y].x)*(_-E)),p>f&&(f=p,h=t[y],g=y);r[l++]=h,d=g}return r[l++]=t[c],r}function N_(t,e,n,s){let i=0,a=0,r,o,l,c,d,u,h,f,p,g;const m=[],_=e+n-1,y=t[e].x,v=t[_].x-y;for(r=e;r<e+n;++r){o=t[r],l=(o.x-y)/v*s,c=o.y;const w=l|0;if(w===d)c<p?(p=c,u=r):c>g&&(g=c,h=r),i=(a*i+o.x)/++a;else{const k=r-1;if(!H(u)&&!H(h)){const S=Math.min(u,h),x=Math.max(u,h);S!==f&&S!==k&&m.push({...t[S],x:i}),x!==f&&x!==k&&m.push({...t[x],x:i})}r>0&&k!==f&&m.push(t[k]),m.push(o),d=w,a=0,p=g=c,u=h=f=r}}return m}function Jc(t){if(t._decimated){const e=t._data;delete t._decimated,delete t._data,Object.defineProperty(t,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function nl(t){t.data.datasets.forEach(e=>{Jc(e)})}function B_(t,e){const n=e.length;let s=0,i;const{iScale:a}=t,{min:r,max:o,minDefined:l,maxDefined:c}=a.getUserBounds();return l&&(s=ue(st(e,a.axis,r).lo,0,n-1)),c?i=ue(st(e,a.axis,o).hi+1,s,n)-s:i=n-s,{start:s,count:i}}var j_={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(t,e,n)=>{if(!n.enabled){nl(t);return}const s=t.width;t.data.datasets.forEach((i,a)=>{const{_data:r,indexAxis:o}=i,l=t.getDatasetMeta(a),c=r||i.data;if(On([o,t.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=t.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||t.options.parsing)return;let{start:u,count:h}=B_(l,c);const f=n.threshold||4*s;if(h<=f){Jc(i);return}H(r)&&(i._data=c,delete i.data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(g){this._data=g}}));let p;switch(n.algorithm){case"lttb":p=$_(c,u,h,s,n);break;case"min-max":p=N_(c,u,h,s);break;default:throw new Error(`Unsupported decimation algorithm '${n.algorithm}'`)}i._decimated=p})},destroy(t){nl(t)}};function F_(t,e,n){const s=t.segments,i=t.points,a=e.points,r=[];for(const o of s){let{start:l,end:c}=o;c=lr(l,c,i);const d=Pa(n,i[l],i[c],o.loop);if(!e.segments){r.push({source:o,target:d,start:i[l],end:i[c]});continue}const u=Ic(e,d);for(const h of u){const f=Pa(n,a[h.start],a[h.end],h.loop),p=Dc(o,i,f);for(const g of p)r.push({source:g,target:h,start:{[n]:sl(d,f,"start",Math.max)},end:{[n]:sl(d,f,"end",Math.min)}})}}return r}function Pa(t,e,n,s){if(s)return;let i=e[t],a=n[t];return t==="angle"&&(i=Re(i),a=Re(a)),{property:t,start:i,end:a}}function W_(t,e){const{x:n=null,y:s=null}=t||{},i=e.points,a=[];return e.segments.forEach(({start:r,end:o})=>{o=lr(r,o,i);const l=i[r],c=i[o];s!==null?(a.push({x:l.x,y:s}),a.push({x:c.x,y:s})):n!==null&&(a.push({x:n,y:l.y}),a.push({x:n,y:c.y}))}),a}function lr(t,e,n){for(;e>t;e--){const s=n[e];if(!isNaN(s.x)&&!isNaN(s.y))break}return e}function sl(t,e,n,s){return t&&e?s(t[n],e[n]):t?t[n]:e?e[n]:0}function Xc(t,e){let n=[],s=!1;return Q(t)?(s=!0,n=t):n=W_(t,e),n.length?new ht({points:n,options:{tension:0},_loop:s,_fullLoop:s}):null}function il(t){return t&&t.fill!==!1}function G_(t,e,n){let i=t[e].fill;const a=[e];let r;if(!n)return i;for(;i!==!1&&a.indexOf(i)===-1;){if(!se(i))return i;if(r=t[i],!r)return!1;if(r.visible)return i;a.push(i),i=r.fill}return!1}function H_(t,e,n){const s=z_(t);if(W(s))return isNaN(s.value)?!1:s;let i=parseFloat(s);return se(i)&&Math.floor(i)===i?U_(s[0],e,i,n):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}function U_(t,e,n,s){return(t==="-"||t==="+")&&(n=e+n),n===e||n<0||n>=s?!1:n}function q_(t,e){let n=null;return t==="start"?n=e.bottom:t==="end"?n=e.top:W(t)?n=e.getPixelForValue(t.value):e.getBasePixel&&(n=e.getBasePixel()),n}function V_(t,e,n){let s;return t==="start"?s=n:t==="end"?s=e.options.reverse?e.min:e.max:W(t)?s=t.value:s=e.getBaseValue(),s}function z_(t){const e=t.options,n=e.fill;let s=P(n&&n.target,n);return s===void 0&&(s=!!e.backgroundColor),s===!1||s===null?!1:s===!0?"origin":s}function K_(t){const{scale:e,index:n,line:s}=t,i=[],a=s.segments,r=s.points,o=Y_(e,n);o.push(Xc({x:null,y:e.bottom},s));for(let l=0;l<a.length;l++){const c=a[l];for(let d=c.start;d<=c.end;d++)J_(i,r[d],o)}return new ht({points:i,options:{}})}function Y_(t,e){const n=[],s=t.getMatchingVisibleMetas("line");for(let i=0;i<s.length;i++){const a=s[i];if(a.index===e)break;a.hidden||n.unshift(a.dataset)}return n}function J_(t,e,n){const s=[];for(let i=0;i<n.length;i++){const a=n[i],{first:r,last:o,point:l}=X_(a,e,"x");if(!(!l||r&&o)){if(r)s.unshift(l);else if(t.push(l),!o)break}}t.push(...s)}function X_(t,e,n){const s=t.interpolate(e,n);if(!s)return{};const i=s[n],a=t.segments,r=t.points;let o=!1,l=!1;for(let c=0;c<a.length;c++){const d=a[c],u=r[d.start][n],h=r[d.end][n];if(nt(i,u,h)){o=i===u,l=i===h;break}}return{first:o,last:l,point:s}}class Qc{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,n,s){const{x:i,y:a,radius:r}=this;return n=n||{start:0,end:J},e.arc(i,a,r,n.end,n.start,!0),!s.bounds}interpolate(e){const{x:n,y:s,radius:i}=this,a=e.angle;return{x:n+Math.cos(a)*i,y:s+Math.sin(a)*i,angle:a}}}function Q_(t){const{chart:e,fill:n,line:s}=t;if(se(n))return Z_(e,n);if(n==="stack")return K_(t);if(n==="shape")return!0;const i=ey(t);return i instanceof Qc?i:Xc(i,s)}function Z_(t,e){const n=t.getDatasetMeta(e);return n&&t.isDatasetVisible(e)?n.dataset:null}function ey(t){return(t.scale||{}).getPointPositionForValue?ny(t):ty(t)}function ty(t){const{scale:e={},fill:n}=t,s=q_(n,e);if(se(s)){const i=e.isHorizontal();return{x:i?s:null,y:i?null:s}}return null}function ny(t){const{scale:e,fill:n}=t,s=e.options,i=e.getLabels().length,a=s.reverse?e.max:e.min,r=V_(n,e,a),o=[];if(s.grid.circular){const l=e.getPointPositionForValue(0,a);return new Qc({x:l.x,y:l.y,radius:e.getDistanceFromCenterForValue(r)})}for(let l=0;l<i;++l)o.push(e.getPointPositionForValue(l,r));return o}function ha(t,e,n){const s=Q_(e),{line:i,scale:a,axis:r}=e,o=i.options,l=o.fill,c=o.backgroundColor,{above:d=c,below:u=c}=l||{};s&&i.points.length&&(Ii(t,n),sy(t,{line:i,target:s,above:d,below:u,area:n,scale:a,axis:r}),Li(t))}function sy(t,e){const{line:n,target:s,above:i,below:a,area:r,scale:o}=e,l=n._loop?"angle":e.axis;t.save(),l==="x"&&a!==i&&(al(t,s,r.top),rl(t,{line:n,target:s,color:i,scale:o,property:l}),t.restore(),t.save(),al(t,s,r.bottom)),rl(t,{line:n,target:s,color:a,scale:o,property:l}),t.restore()}function al(t,e,n){const{segments:s,points:i}=e;let a=!0,r=!1;t.beginPath();for(const o of s){const{start:l,end:c}=o,d=i[l],u=i[lr(l,c,i)];a?(t.moveTo(d.x,d.y),a=!1):(t.lineTo(d.x,n),t.lineTo(d.x,d.y)),r=!!e.pathSegment(t,o,{move:r}),r?t.closePath():t.lineTo(u.x,n)}t.lineTo(e.first().x,n),t.closePath(),t.clip()}function rl(t,e){const{line:n,target:s,property:i,color:a,scale:r}=e,o=F_(n,s,i);for(const{source:l,target:c,start:d,end:u}of o){const{style:{backgroundColor:h=a}={}}=l,f=s!==!0;t.save(),t.fillStyle=h,iy(t,r,f&&Pa(i,d,u)),t.beginPath();const p=!!n.pathSegment(t,l);let g;if(f){p?t.closePath():ol(t,s,u,i);const m=!!s.pathSegment(t,c,{move:p,reverse:!0});g=p&&m,g||ol(t,s,d,i)}t.closePath(),t.fill(g?"evenodd":"nonzero"),t.restore()}}function iy(t,e,n){const{top:s,bottom:i}=e.chart.chartArea,{property:a,start:r,end:o}=n||{};a==="x"&&(t.beginPath(),t.rect(r,s,o-r,i-s),t.clip())}function ol(t,e,n,s){const i=e.interpolate(n,s);i&&t.lineTo(i.x,i.y)}var ay={id:"filler",afterDatasetsUpdate(t,e,n){const s=(t.data.datasets||[]).length,i=[];let a,r,o,l;for(r=0;r<s;++r)a=t.getDatasetMeta(r),o=a.dataset,l=null,o&&o.options&&o instanceof ht&&(l={visible:t.isDatasetVisible(r),index:r,fill:H_(o,r,s),chart:t,axis:a.controller.options.indexAxis,scale:a.vScale,line:o}),a.$filler=l,i.push(l);for(r=0;r<s;++r)l=i[r],!(!l||l.fill===!1)&&(l.fill=G_(i,r,n.propagate))},beforeDraw(t,e,n){const s=n.drawTime==="beforeDraw",i=t.getSortedVisibleDatasetMetas(),a=t.chartArea;for(let r=i.length-1;r>=0;--r){const o=i[r].$filler;o&&(o.line.updateControlPoints(a,o.axis),s&&o.fill&&ha(t.ctx,o,a))}},beforeDatasetsDraw(t,e,n){if(n.drawTime!=="beforeDatasetsDraw")return;const s=t.getSortedVisibleDatasetMetas();for(let i=s.length-1;i>=0;--i){const a=s[i].$filler;il(a)&&ha(t.ctx,a,t.chartArea)}},beforeDatasetDraw(t,e,n){const s=e.meta.$filler;!il(s)||n.drawTime!=="beforeDatasetDraw"||ha(t.ctx,s,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const ll=(t,e)=>{let{boxHeight:n=e,boxWidth:s=e}=t;return t.usePointStyle&&(n=Math.min(n,e),s=t.pointStyleWidth||Math.min(s,e)),{boxWidth:s,boxHeight:n,itemHeight:Math.max(e,n)}},ry=(t,e)=>t!==null&&e!==null&&t.datasetIndex===e.datasetIndex&&t.index===e.index;class cl extends We{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n,s){this.maxWidth=e,this.maxHeight=n,this._margins=s,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let n=K(e.generateLabels,[this.chart],this)||[];e.filter&&(n=n.filter(s=>e.filter(s,this.chart.data))),e.sort&&(n=n.sort((s,i)=>e.sort(s,i,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:e,ctx:n}=this;if(!e.display){this.width=this.height=0;return}const s=e.labels,i=de(s.font),a=i.size,r=this._computeTitleHeight(),{boxWidth:o,itemHeight:l}=ll(s,a);let c,d;n.font=i.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(r,a,o,l)+10):(d=this.maxHeight,c=this._fitCols(r,i,o,l)+10),this.width=Math.min(c,e.maxWidth||this.maxWidth),this.height=Math.min(d,e.maxHeight||this.maxHeight)}_fitRows(e,n,s,i){const{ctx:a,maxWidth:r,options:{labels:{padding:o}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=i+o;let u=e;a.textAlign="left",a.textBaseline="middle";let h=-1,f=-d;return this.legendItems.forEach((p,g)=>{const m=s+n/2+a.measureText(p.text).width;(g===0||c[c.length-1]+m+2*o>r)&&(u+=d,c[c.length-(g>0?0:1)]=0,f+=d,h++),l[g]={left:0,top:f,row:h,width:m,height:i},c[c.length-1]+=m+o}),u}_fitCols(e,n,s,i){const{ctx:a,maxHeight:r,options:{labels:{padding:o}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=r-e;let u=o,h=0,f=0,p=0,g=0;return this.legendItems.forEach((m,_)=>{const{itemWidth:y,itemHeight:b}=oy(s,n,a,m,i);_>0&&f+b+2*o>d&&(u+=h+o,c.push({width:h,height:f}),p+=h+o,g++,h=f=0),l[_]={left:p,top:f,col:g,width:y,height:b},h=Math.max(h,y),f+=b+o}),u+=h,c.push({width:h,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:s,labels:{padding:i},rtl:a}}=this,r=an(a,this.left,this.width);if(this.isHorizontal()){let o=0,l=me(s,this.left+i,this.right-this.lineWidths[o]);for(const c of n)o!==c.row&&(o=c.row,l=me(s,this.left+i,this.right-this.lineWidths[o])),c.top+=this.top+e+i,c.left=r.leftForLtr(r.x(l),c.width),l+=c.width+i}else{let o=0,l=me(s,this.top+e+i,this.bottom-this.columnSizes[o].height);for(const c of n)c.col!==o&&(o=c.col,l=me(s,this.top+e+i,this.bottom-this.columnSizes[o].height)),c.top=l,c.left+=this.left+i,c.left=r.leftForLtr(r.x(c.left),c.width),l+=c.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;Ii(e,this),this._draw(),Li(e)}}_draw(){const{options:e,columnSizes:n,lineWidths:s,ctx:i}=this,{align:a,labels:r}=e,o=ie.color,l=an(e.rtl,this.left,this.width),c=de(r.font),{padding:d}=r,u=c.size,h=u/2;let f;this.drawTitle(),i.textAlign=l.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=c.string;const{boxWidth:p,boxHeight:g,itemHeight:m}=ll(r,u),_=function(k,S,x){if(isNaN(p)||p<=0||isNaN(g)||g<0)return;i.save();const E=P(x.lineWidth,1);if(i.fillStyle=P(x.fillStyle,o),i.lineCap=P(x.lineCap,"butt"),i.lineDashOffset=P(x.lineDashOffset,0),i.lineJoin=P(x.lineJoin,"miter"),i.lineWidth=E,i.strokeStyle=P(x.strokeStyle,o),i.setLineDash(P(x.lineDash,[])),r.usePointStyle){const D={radius:g*Math.SQRT2/2,pointStyle:x.pointStyle,rotation:x.rotation,borderWidth:E},O=l.xPlus(k,p/2),$=S+h;bc(i,D,O,$,r.pointStyleWidth&&p)}else{const D=S+Math.max((u-g)/2,0),O=l.leftForLtr(k,p),$=It(x.borderRadius);i.beginPath(),Object.values($).some(Z=>Z!==0)?cs(i,{x:O,y:D,w:p,h:g,radius:$}):i.rect(O,D,p,g),i.fill(),E!==0&&i.stroke()}i.restore()},y=function(k,S,x){Pt(i,x.text,k,S+m/2,c,{strikethrough:x.hidden,textAlign:l.textAlign(x.textAlign)})},b=this.isHorizontal(),v=this._computeTitleHeight();b?f={x:me(a,this.left+d,this.right-s[0]),y:this.top+d+v,line:0}:f={x:this.left+d,y:me(a,this.top+v+d,this.bottom-n[0].height),line:0},Mc(this.ctx,e.textDirection);const w=m+d;this.legendItems.forEach((k,S)=>{i.strokeStyle=k.fontColor,i.fillStyle=k.fontColor;const x=i.measureText(k.text).width,E=l.textAlign(k.textAlign||(k.textAlign=r.textAlign)),D=p+h+x;let O=f.x,$=f.y;l.setWidth(this.width),b?S>0&&O+D+d>this.right&&($=f.y+=w,f.line++,O=f.x=me(a,this.left+d,this.right-s[f.line])):S>0&&$+w>this.bottom&&(O=f.x=O+n[f.line].width+d,f.line++,$=f.y=me(a,this.top+v+d,this.bottom-n[f.line].height));const Z=l.x(O);if(_(Z,$,k),O=Mg(E,O+p+h,b?O+D:this.right,e.rtl),y(l.x(O),$,k),b)f.x+=D+d;else if(typeof k.text!="string"){const oe=c.lineHeight;f.y+=Zc(k,oe)+d}else f.y+=w}),Tc(this.ctx,e.textDirection)}drawTitle(){const e=this.options,n=e.title,s=de(n.font),i=be(n.padding);if(!n.display)return;const a=an(e.rtl,this.left,this.width),r=this.ctx,o=n.position,l=s.size/2,c=i.top+l;let d,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),d=this.top+c,u=me(e.align,u,this.right-h);else{const p=this.columnSizes.reduce((g,m)=>Math.max(g,m.height),0);d=c+me(e.align,this.top,this.bottom-p-e.labels.padding-this._computeTitleHeight())}const f=me(o,u,u+h);r.textAlign=a.textAlign(er(o)),r.textBaseline="middle",r.strokeStyle=n.color,r.fillStyle=n.color,r.font=s.string,Pt(r,n.text,f,d,s)}_computeTitleHeight(){const e=this.options.title,n=de(e.font),s=be(e.padding);return e.display?n.lineHeight+s.height:0}_getLegendItemAt(e,n){let s,i,a;if(nt(e,this.left,this.right)&&nt(n,this.top,this.bottom)){for(a=this.legendHitBoxes,s=0;s<a.length;++s)if(i=a[s],nt(e,i.left,i.left+i.width)&&nt(n,i.top,i.top+i.height))return this.legendItems[s]}return null}handleEvent(e){const n=this.options;if(!dy(e.type,n))return;const s=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const i=this._hoveredItem,a=ry(i,s);i&&!a&&K(n.onLeave,[e,i,this],this),this._hoveredItem=s,s&&!a&&K(n.onHover,[e,s,this],this)}else s&&K(n.onClick,[e,s,this],this)}}function oy(t,e,n,s,i){const a=ly(s,t,e,n),r=cy(i,s,e.lineHeight);return{itemWidth:a,itemHeight:r}}function ly(t,e,n,s){let i=t.text;return i&&typeof i!="string"&&(i=i.reduce((a,r)=>a.length>r.length?a:r)),e+n.size/2+s.measureText(i).width}function cy(t,e,n){let s=t;return typeof e.text!="string"&&(s=Zc(e,n)),s}function Zc(t,e){const n=t.text?t.text.length:0;return e*n}function dy(t,e){return!!((t==="mousemove"||t==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(t==="click"||t==="mouseup"))}var uy={id:"legend",_element:cl,start(t,e,n){const s=t.legend=new cl({ctx:t.ctx,options:n,chart:t});ye.configure(t,s,n),ye.addBox(t,s)},stop(t){ye.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,n){const s=t.legend;ye.configure(t,s,n),s.options=n},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,n){const s=e.datasetIndex,i=n.chart;i.isDatasetVisible(s)?(i.hide(s),e.hidden=!0):(i.show(s),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:n,pointStyle:s,textAlign:i,color:a,useBorderRadius:r,borderRadius:o}}=t.legend.options;return t._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(n?0:void 0),d=be(c.borderWidth);return{text:e[l.index].label,fillStyle:c.backgroundColor,fontColor:a,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:s||c.pointStyle,rotation:c.rotation,textAlign:i||c.textAlign,borderRadius:r&&(o||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class cr extends We{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n){const s=this.options;if(this.left=0,this.top=0,!s.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=n;const i=Q(s.text)?s.text.length:1;this._padding=be(s.padding);const a=i*de(s.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=a:this.width=a}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:n,left:s,bottom:i,right:a,options:r}=this,o=r.align;let l=0,c,d,u;return this.isHorizontal()?(d=me(o,s,a),u=n+e,c=a-s):(r.position==="left"?(d=s+e,u=me(o,i,n),l=X*-.5):(d=a-e,u=me(o,n,i),l=X*.5),c=i-n),{titleX:d,titleY:u,maxWidth:c,rotation:l}}draw(){const e=this.ctx,n=this.options;if(!n.display)return;const s=de(n.font),a=s.lineHeight/2+this._padding.top,{titleX:r,titleY:o,maxWidth:l,rotation:c}=this._drawArgs(a);Pt(e,n.text,0,0,s,{color:n.color,maxWidth:l,rotation:c,textAlign:er(n.align),textBaseline:"middle",translation:[r,o]})}}function hy(t,e){const n=new cr({ctx:t.ctx,options:e,chart:t});ye.configure(t,n,e),ye.addBox(t,n),t.titleBlock=n}var fy={id:"title",_element:cr,start(t,e,n){hy(t,n)},stop(t){const e=t.titleBlock;ye.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,n){const s=t.titleBlock;ye.configure(t,s,n),s.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const js=new WeakMap;var gy={id:"subtitle",start(t,e,n){const s=new cr({ctx:t.ctx,options:n,chart:t});ye.configure(t,s,n),ye.addBox(t,s),js.set(t,s)},stop(t){ye.removeBox(t,js.get(t)),js.delete(t)},beforeUpdate(t,e,n){const s=js.get(t);ye.configure(t,s,n),s.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Nn={average(t){if(!t.length)return!1;let e,n,s=0,i=0,a=0;for(e=0,n=t.length;e<n;++e){const r=t[e].element;if(r&&r.hasValue()){const o=r.tooltipPosition();s+=o.x,i+=o.y,++a}}return{x:s/a,y:i/a}},nearest(t,e){if(!t.length)return!1;let n=e.x,s=e.y,i=Number.POSITIVE_INFINITY,a,r,o;for(a=0,r=t.length;a<r;++a){const l=t[a].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=Aa(e,c);d<i&&(i=d,o=l)}}if(o){const l=o.tooltipPosition();n=l.x,s=l.y}return{x:n,y:s}}};function He(t,e){return e&&(Q(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function Je(t){return(typeof t=="string"||t instanceof String)&&t.indexOf(`
`)>-1?t.split(`
`):t}function py(t,e){const{element:n,datasetIndex:s,index:i}=e,a=t.getDatasetMeta(s).controller,{label:r,value:o}=a.getLabelAndValue(i);return{chart:t,label:r,parsed:a.getParsed(i),raw:t.data.datasets[s].data[i],formattedValue:o,dataset:a.getDataset(),dataIndex:i,datasetIndex:s,element:n}}function dl(t,e){const n=t.chart.ctx,{body:s,footer:i,title:a}=t,{boxWidth:r,boxHeight:o}=e,l=de(e.bodyFont),c=de(e.titleFont),d=de(e.footerFont),u=a.length,h=i.length,f=s.length,p=be(e.padding);let g=p.height,m=0,_=s.reduce((v,w)=>v+w.before.length+w.lines.length+w.after.length,0);if(_+=t.beforeBody.length+t.afterBody.length,u&&(g+=u*c.lineHeight+(u-1)*e.titleSpacing+e.titleMarginBottom),_){const v=e.displayColors?Math.max(o,l.lineHeight):l.lineHeight;g+=f*v+(_-f)*l.lineHeight+(_-1)*e.bodySpacing}h&&(g+=e.footerMarginTop+h*d.lineHeight+(h-1)*e.footerSpacing);let y=0;const b=function(v){m=Math.max(m,n.measureText(v).width+y)};return n.save(),n.font=c.string,q(t.title,b),n.font=l.string,q(t.beforeBody.concat(t.afterBody),b),y=e.displayColors?r+2+e.boxPadding:0,q(s,v=>{q(v.before,b),q(v.lines,b),q(v.after,b)}),y=0,n.font=d.string,q(t.footer,b),n.restore(),m+=p.width,{width:m,height:g}}function my(t,e){const{y:n,height:s}=e;return n<s/2?"top":n>t.height-s/2?"bottom":"center"}function _y(t,e,n,s){const{x:i,width:a}=s,r=n.caretSize+n.caretPadding;if(t==="left"&&i+a+r>e.width||t==="right"&&i-a-r<0)return!0}function yy(t,e,n,s){const{x:i,width:a}=n,{width:r,chartArea:{left:o,right:l}}=t;let c="center";return s==="center"?c=i<=(o+l)/2?"left":"right":i<=a/2?c="left":i>=r-a/2&&(c="right"),_y(c,t,e,n)&&(c="center"),c}function ul(t,e,n){const s=n.yAlign||e.yAlign||my(t,n);return{xAlign:n.xAlign||e.xAlign||yy(t,e,n,s),yAlign:s}}function by(t,e){let{x:n,width:s}=t;return e==="right"?n-=s:e==="center"&&(n-=s/2),n}function vy(t,e,n){let{y:s,height:i}=t;return e==="top"?s+=n:e==="bottom"?s-=i+n:s-=i/2,s}function hl(t,e,n,s){const{caretSize:i,caretPadding:a,cornerRadius:r}=t,{xAlign:o,yAlign:l}=n,c=i+a,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:f}=It(r);let p=by(e,o);const g=vy(e,l,c);return l==="center"?o==="left"?p+=c:o==="right"&&(p-=c):o==="left"?p-=Math.max(d,h)+i:o==="right"&&(p+=Math.max(u,f)+i),{x:ue(p,0,s.width-e.width),y:ue(g,0,s.height-e.height)}}function Fs(t,e,n){const s=be(n.padding);return e==="center"?t.x+t.width/2:e==="right"?t.x+t.width-s.right:t.x+s.left}function fl(t){return He([],Je(t))}function wy(t,e,n){return yt(t,{tooltip:e,tooltipItems:n,type:"tooltip"})}function gl(t,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}const ed={beforeTitle:Ke,title(t){if(t.length>0){const e=t[0],n=e.chart.data.labels,s=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(s>0&&e.dataIndex<s)return n[e.dataIndex]}return""},afterTitle:Ke,beforeBody:Ke,beforeLabel:Ke,label(t){if(this&&this.options&&this.options.mode==="dataset")return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const n=t.formattedValue;return H(n)||(e+=n),e},labelColor(t){const n=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const n=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:Ke,afterBody:Ke,beforeFooter:Ke,footer:Ke,afterFooter:Ke};function ve(t,e,n,s){const i=t[e].call(n,s);return typeof i>"u"?ed[e].call(n,s):i}class $a extends We{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const n=this.chart,s=this.options.setContext(this.getContext()),i=s.enabled&&n.options.animation&&s.animations,a=new Lc(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(a)),a}getContext(){return this.$context||(this.$context=wy(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,n){const{callbacks:s}=n,i=ve(s,"beforeTitle",this,e),a=ve(s,"title",this,e),r=ve(s,"afterTitle",this,e);let o=[];return o=He(o,Je(i)),o=He(o,Je(a)),o=He(o,Je(r)),o}getBeforeBody(e,n){return fl(ve(n.callbacks,"beforeBody",this,e))}getBody(e,n){const{callbacks:s}=n,i=[];return q(e,a=>{const r={before:[],lines:[],after:[]},o=gl(s,a);He(r.before,Je(ve(o,"beforeLabel",this,a))),He(r.lines,ve(o,"label",this,a)),He(r.after,Je(ve(o,"afterLabel",this,a))),i.push(r)}),i}getAfterBody(e,n){return fl(ve(n.callbacks,"afterBody",this,e))}getFooter(e,n){const{callbacks:s}=n,i=ve(s,"beforeFooter",this,e),a=ve(s,"footer",this,e),r=ve(s,"afterFooter",this,e);let o=[];return o=He(o,Je(i)),o=He(o,Je(a)),o=He(o,Je(r)),o}_createItems(e){const n=this._active,s=this.chart.data,i=[],a=[],r=[];let o=[],l,c;for(l=0,c=n.length;l<c;++l)o.push(py(this.chart,n[l]));return e.filter&&(o=o.filter((d,u,h)=>e.filter(d,u,h,s))),e.itemSort&&(o=o.sort((d,u)=>e.itemSort(d,u,s))),q(o,d=>{const u=gl(e.callbacks,d);i.push(ve(u,"labelColor",this,d)),a.push(ve(u,"labelPointStyle",this,d)),r.push(ve(u,"labelTextColor",this,d))}),this.labelColors=i,this.labelPointStyles=a,this.labelTextColors=r,this.dataPoints=o,o}update(e,n){const s=this.options.setContext(this.getContext()),i=this._active;let a,r=[];if(!i.length)this.opacity!==0&&(a={opacity:0});else{const o=Nn[s.position].call(this,i,this._eventPosition);r=this._createItems(s),this.title=this.getTitle(r,s),this.beforeBody=this.getBeforeBody(r,s),this.body=this.getBody(r,s),this.afterBody=this.getAfterBody(r,s),this.footer=this.getFooter(r,s);const l=this._size=dl(this,s),c=Object.assign({},o,l),d=ul(this.chart,s,c),u=hl(s,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,a={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:o.x,caretY:o.y}}this._tooltipItems=r,this.$context=void 0,a&&this._resolveAnimations().update(this,a),e&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(e,n,s,i){const a=this.getCaretPosition(e,s,i);n.lineTo(a.x1,a.y1),n.lineTo(a.x2,a.y2),n.lineTo(a.x3,a.y3)}getCaretPosition(e,n,s){const{xAlign:i,yAlign:a}=this,{caretSize:r,cornerRadius:o}=s,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:u}=It(o),{x:h,y:f}=e,{width:p,height:g}=n;let m,_,y,b,v,w;return a==="center"?(v=f+g/2,i==="left"?(m=h,_=m-r,b=v+r,w=v-r):(m=h+p,_=m+r,b=v-r,w=v+r),y=m):(i==="left"?_=h+Math.max(l,d)+r:i==="right"?_=h+p-Math.max(c,u)-r:_=this.caretX,a==="top"?(b=f,v=b-r,m=_-r,y=_+r):(b=f+g,v=b+r,m=_+r,y=_-r),w=b),{x1:m,x2:_,x3:y,y1:b,y2:v,y3:w}}drawTitle(e,n,s){const i=this.title,a=i.length;let r,o,l;if(a){const c=an(s.rtl,this.x,this.width);for(e.x=Fs(this,s.titleAlign,s),n.textAlign=c.textAlign(s.titleAlign),n.textBaseline="middle",r=de(s.titleFont),o=s.titleSpacing,n.fillStyle=s.titleColor,n.font=r.string,l=0;l<a;++l)n.fillText(i[l],c.x(e.x),e.y+r.lineHeight/2),e.y+=r.lineHeight+o,l+1===a&&(e.y+=s.titleMarginBottom-o)}}_drawColorBox(e,n,s,i,a){const r=this.labelColors[s],o=this.labelPointStyles[s],{boxHeight:l,boxWidth:c}=a,d=de(a.bodyFont),u=Fs(this,"left",a),h=i.x(u),f=l<d.lineHeight?(d.lineHeight-l)/2:0,p=n.y+f;if(a.usePointStyle){const g={radius:Math.min(c,l)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},m=i.leftForLtr(h,c)+c/2,_=p+l/2;e.strokeStyle=a.multiKeyBackground,e.fillStyle=a.multiKeyBackground,Ta(e,g,m,_),e.strokeStyle=r.borderColor,e.fillStyle=r.backgroundColor,Ta(e,g,m,_)}else{e.lineWidth=W(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,e.strokeStyle=r.borderColor,e.setLineDash(r.borderDash||[]),e.lineDashOffset=r.borderDashOffset||0;const g=i.leftForLtr(h,c),m=i.leftForLtr(i.xPlus(h,1),c-2),_=It(r.borderRadius);Object.values(_).some(y=>y!==0)?(e.beginPath(),e.fillStyle=a.multiKeyBackground,cs(e,{x:g,y:p,w:c,h:l,radius:_}),e.fill(),e.stroke(),e.fillStyle=r.backgroundColor,e.beginPath(),cs(e,{x:m,y:p+1,w:c-2,h:l-2,radius:_}),e.fill()):(e.fillStyle=a.multiKeyBackground,e.fillRect(g,p,c,l),e.strokeRect(g,p,c,l),e.fillStyle=r.backgroundColor,e.fillRect(m,p+1,c-2,l-2))}e.fillStyle=this.labelTextColors[s]}drawBody(e,n,s){const{body:i}=this,{bodySpacing:a,bodyAlign:r,displayColors:o,boxHeight:l,boxWidth:c,boxPadding:d}=s,u=de(s.bodyFont);let h=u.lineHeight,f=0;const p=an(s.rtl,this.x,this.width),g=function(x){n.fillText(x,p.x(e.x+f),e.y+h/2),e.y+=h+a},m=p.textAlign(r);let _,y,b,v,w,k,S;for(n.textAlign=r,n.textBaseline="middle",n.font=u.string,e.x=Fs(this,m,s),n.fillStyle=s.bodyColor,q(this.beforeBody,g),f=o&&m!=="right"?r==="center"?c/2+d:c+2+d:0,v=0,k=i.length;v<k;++v){for(_=i[v],y=this.labelTextColors[v],n.fillStyle=y,q(_.before,g),b=_.lines,o&&b.length&&(this._drawColorBox(n,e,v,p,s),h=Math.max(u.lineHeight,l)),w=0,S=b.length;w<S;++w)g(b[w]),h=u.lineHeight;q(_.after,g)}f=0,h=u.lineHeight,q(this.afterBody,g),e.y-=a}drawFooter(e,n,s){const i=this.footer,a=i.length;let r,o;if(a){const l=an(s.rtl,this.x,this.width);for(e.x=Fs(this,s.footerAlign,s),e.y+=s.footerMarginTop,n.textAlign=l.textAlign(s.footerAlign),n.textBaseline="middle",r=de(s.footerFont),n.fillStyle=s.footerColor,n.font=r.string,o=0;o<a;++o)n.fillText(i[o],l.x(e.x),e.y+r.lineHeight/2),e.y+=r.lineHeight+s.footerSpacing}}drawBackground(e,n,s,i){const{xAlign:a,yAlign:r}=this,{x:o,y:l}=e,{width:c,height:d}=s,{topLeft:u,topRight:h,bottomLeft:f,bottomRight:p}=It(i.cornerRadius);n.fillStyle=i.backgroundColor,n.strokeStyle=i.borderColor,n.lineWidth=i.borderWidth,n.beginPath(),n.moveTo(o+u,l),r==="top"&&this.drawCaret(e,n,s,i),n.lineTo(o+c-h,l),n.quadraticCurveTo(o+c,l,o+c,l+h),r==="center"&&a==="right"&&this.drawCaret(e,n,s,i),n.lineTo(o+c,l+d-p),n.quadraticCurveTo(o+c,l+d,o+c-p,l+d),r==="bottom"&&this.drawCaret(e,n,s,i),n.lineTo(o+f,l+d),n.quadraticCurveTo(o,l+d,o,l+d-f),r==="center"&&a==="left"&&this.drawCaret(e,n,s,i),n.lineTo(o,l+u),n.quadraticCurveTo(o,l,o+u,l),n.closePath(),n.fill(),i.borderWidth>0&&n.stroke()}_updateAnimationTarget(e){const n=this.chart,s=this.$animations,i=s&&s.x,a=s&&s.y;if(i||a){const r=Nn[e.position].call(this,this._active,this._eventPosition);if(!r)return;const o=this._size=dl(this,e),l=Object.assign({},r,this._size),c=ul(n,e,l),d=hl(e,l,c,n);(i._to!==d.x||a._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=o.width,this.height=o.height,this.caretX=r.x,this.caretY=r.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(e){const n=this.options.setContext(this.getContext());let s=this.opacity;if(!s)return;this._updateAnimationTarget(n);const i={width:this.width,height:this.height},a={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;const r=be(n.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&o&&(e.save(),e.globalAlpha=s,this.drawBackground(a,e,i,n),Mc(e,n.textDirection),a.y+=r.top,this.drawTitle(a,e,n),this.drawBody(a,e,n),this.drawFooter(a,e,n),Tc(e,n.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,n){const s=this._active,i=e.map(({datasetIndex:o,index:l})=>{const c=this.chart.getDatasetMeta(o);if(!c)throw new Error("Cannot find a dataset at index "+o);return{datasetIndex:o,element:c.data[l],index:l}}),a=!hi(s,i),r=this._positionChanged(i,n);(a||r)&&(this._active=i,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,n,s=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,a=this._active||[],r=this._getActiveElements(e,a,n,s),o=this._positionChanged(r,e),l=n||!hi(r,a)||o;return l&&(this._active=r,(i.enabled||i.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,n))),l}_getActiveElements(e,n,s,i){const a=this.options;if(e.type==="mouseout")return[];if(!i)return n;const r=this.chart.getElementsAtEventForMode(e,a.mode,a,s);return a.reverse&&r.reverse(),r}_positionChanged(e,n){const{caretX:s,caretY:i,options:a}=this,r=Nn[a.position].call(this,e,n);return r!==!1&&(s!==r.x||i!==r.y)}}C($a,"positioners",Nn);var ky={id:"tooltip",_element:$a,positioners:Nn,afterInit(t,e,n){n&&(t.tooltip=new $a({chart:t,options:n}))},beforeUpdate(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const n={tooltip:e};if(t.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0})===!1)return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n)}},afterEvent(t,e){if(t.tooltip){const n=e.replay;t.tooltip.handleEvent(e.event,n,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:ed},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>t!=="filter"&&t!=="itemSort"&&t!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Sy=Object.freeze({__proto__:null,Colors:P_,Decimation:j_,Filler:ay,Legend:uy,SubTitle:gy,Title:fy,Tooltip:ky});const xy=(t,e,n,s)=>(typeof e=="string"?(n=t.push(e)-1,s.unshift({index:n,label:e})):isNaN(e)&&(n=null),n);function Cy(t,e,n,s){const i=t.indexOf(e);if(i===-1)return xy(t,e,n,s);const a=t.lastIndexOf(e);return i!==a?n:i}const Ey=(t,e)=>t===null?null:ue(Math.round(t),0,e);function pl(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}class Na extends Ft{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const n=this._addedLabels;if(n.length){const s=this.getLabels();for(const{index:i,label:a}of n)s[i]===a&&s.splice(i,1);this._addedLabels=[]}super.init(e)}parse(e,n){if(H(e))return null;const s=this.getLabels();return n=isFinite(n)&&s[n]===e?n:Cy(s,e,P(n,e),this._addedLabels),Ey(n,s.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:s,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(s=0),n||(i=this.getLabels().length-1)),this.min=s,this.max=i}buildTicks(){const e=this.min,n=this.max,s=this.options.offset,i=[];let a=this.getLabels();a=e===0&&n===a.length-1?a:a.slice(e,n+1),this._valueRange=Math.max(a.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let r=e;r<=n;r++)i.push({value:r});return i}getLabelForValue(e){return pl.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}C(Na,"id","category"),C(Na,"defaults",{ticks:{callback:pl}});function Ay(t,e){const n=[],{bounds:i,step:a,min:r,max:o,precision:l,count:c,maxTicks:d,maxDigits:u,includeBounds:h}=t,f=a||1,p=d-1,{min:g,max:m}=e,_=!H(r),y=!H(o),b=!H(c),v=(m-g)/(u+1);let w=lo((m-g)/p/f)*f,k,S,x,E;if(w<1e-14&&!_&&!y)return[{value:g},{value:m}];E=Math.ceil(m/w)-Math.floor(g/w),E>p&&(w=lo(E*w/p/f)*f),H(l)||(k=Math.pow(10,l),w=Math.ceil(w*k)/k),i==="ticks"?(S=Math.floor(g/w)*w,x=Math.ceil(m/w)*w):(S=g,x=m),_&&y&&a&&wg((o-r)/a,w/1e3)?(E=Math.round(Math.min((o-r)/w,d)),w=(o-r)/E,S=r,x=o):b?(S=_?r:S,x=y?o:x,E=c-1,w=(x-S)/E):(E=(x-S)/w,Un(E,Math.round(E),w/1e3)?E=Math.round(E):E=Math.ceil(E));const D=Math.max(co(w),co(S));k=Math.pow(10,H(l)?D:l),S=Math.round(S*k)/k,x=Math.round(x*k)/k;let O=0;for(_&&(h&&S!==r?(n.push({value:r}),S<r&&O++,Un(Math.round((S+O*w)*k)/k,r,ml(r,v,t))&&O++):S<r&&O++);O<E;++O){const $=Math.round((S+O*w)*k)/k;if(y&&$>o)break;n.push({value:$})}return y&&h&&x!==o?n.length&&Un(n[n.length-1].value,o,ml(o,v,t))?n[n.length-1].value=o:n.push({value:o}):(!y||x===o)&&n.push({value:x}),n}function ml(t,e,{horizontal:n,minRotation:s}){const i=Ne(s),a=(n?Math.sin(i):Math.cos(i))||.001,r=.75*e*(""+t).length;return Math.min(e/a,r)}class bi extends Ft{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,n){return H(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:n,maxDefined:s}=this.getUserBounds();let{min:i,max:a}=this;const r=l=>i=n?i:l,o=l=>a=s?a:l;if(e){const l=ze(i),c=ze(a);l<0&&c<0?o(0):l>0&&c>0&&r(0)}if(i===a){let l=a===0?1:Math.abs(a*.05);o(a+l),e||r(i-l)}this.min=i,this.max=a}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:n,stepSize:s}=e,i;return s?(i=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),n=n||11),n&&(i=Math.min(n,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,n=e.ticks;let s=this.getTickLimit();s=Math.max(2,s);const i={maxTicks:s,bounds:e.bounds,min:e.min,max:e.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},a=this._range||this,r=Ay(i,a);return e.bounds==="ticks"&&dc(r,this,"value"),e.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){const e=this.ticks;let n=this.min,s=this.max;if(super.configure(),this.options.offset&&e.length){const i=(s-n)/Math.max(e.length-1,1)/2;n-=i,s+=i}this._startValue=n,this._endValue=s,this._valueRange=s-n}getLabelForValue(e){return _s(e,this.chart.options.locale,this.options.ticks.format)}}class Ba extends bi{determineDataLimits(){const{min:e,max:n}=this.getMinMax(!0);this.min=se(e)?e:0,this.max=se(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),n=e?this.width:this.height,s=Ne(this.options.ticks.minRotation),i=(e?Math.sin(s):Math.cos(s))||.001,a=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,a.lineHeight/i))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}C(Ba,"id","linear"),C(Ba,"defaults",{ticks:{callback:Di.formatters.numeric}});const us=t=>Math.floor(ut(t)),xt=(t,e)=>Math.pow(10,us(t)+e);function _l(t){return t/Math.pow(10,us(t))===1}function yl(t,e,n){const s=Math.pow(10,n),i=Math.floor(t/s);return Math.ceil(e/s)-i}function My(t,e){const n=e-t;let s=us(n);for(;yl(t,e,s)>10;)s++;for(;yl(t,e,s)<10;)s--;return Math.min(s,us(t))}function Ty(t,{min:e,max:n}){e=Te(t.min,e);const s=[],i=us(e);let a=My(e,n),r=a<0?Math.pow(10,Math.abs(a)):1;const o=Math.pow(10,a),l=i>a?Math.pow(10,i):0,c=Math.round((e-l)*r)/r,d=Math.floor((e-l)/o/10)*o*10;let u=Math.floor((c-d)/Math.pow(10,a)),h=Te(t.min,Math.round((l+d+u*Math.pow(10,a))*r)/r);for(;h<n;)s.push({value:h,major:_l(h),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(a++,u=2,r=a>=0?1:r),h=Math.round((l+d+u*Math.pow(10,a))*r)/r;const f=Te(t.max,h);return s.push({value:f,major:_l(f),significand:u}),s}class ja extends Ft{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,n){const s=bi.prototype.parse.apply(this,[e,n]);if(s===0){this._zero=!0;return}return se(s)&&s>0?s:null}determineDataLimits(){const{min:e,max:n}=this.getMinMax(!0);this.min=se(e)?Math.max(0,e):null,this.max=se(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!se(this._userMin)&&(this.min=e===xt(this.min,0)?xt(this.min,-1):xt(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:n}=this.getUserBounds();let s=this.min,i=this.max;const a=o=>s=e?s:o,r=o=>i=n?i:o;s===i&&(s<=0?(a(1),r(10)):(a(xt(s,-1)),r(xt(i,1)))),s<=0&&a(xt(i,-1)),i<=0&&r(xt(s,1)),this.min=s,this.max=i}buildTicks(){const e=this.options,n={min:this._userMin,max:this._userMax},s=Ty(n,this);return e.bounds==="ticks"&&dc(s,this,"value"),e.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}getLabelForValue(e){return e===void 0?"0":_s(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=ut(e),this._valueRange=ut(this.max)-ut(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(ut(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const n=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+n*this._valueRange)}}C(ja,"id","logarithmic"),C(ja,"defaults",{ticks:{callback:Di.formatters.logarithmic,major:{enabled:!0}}});function Fa(t){const e=t.ticks;if(e.display&&t.display){const n=be(e.backdropPadding);return P(e.font&&e.font.size,ie.font.size)+n.height}return 0}function Ry(t,e,n){return n=Q(n)?n:[n],{w:Bg(t,e.string,n),h:n.length*e.lineHeight}}function bl(t,e,n,s,i){return t===s||t===i?{start:e-n/2,end:e+n/2}:t<s||t>i?{start:e-n,end:e}:{start:e,end:e+n}}function Dy(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},n=Object.assign({},e),s=[],i=[],a=t._pointLabels.length,r=t.options.pointLabels,o=r.centerPointLabels?X/a:0;for(let l=0;l<a;l++){const c=r.setContext(t.getPointLabelContext(l));i[l]=c.padding;const d=t.getPointPosition(l,t.drawingArea+i[l],o),u=de(c.font),h=Ry(t.ctx,u,t._pointLabels[l]);s[l]=h;const f=Re(t.getIndexAngle(l)+o),p=Math.round(Qa(f)),g=bl(p,d.x,h.w,0,180),m=bl(p,d.y,h.h,90,270);Iy(n,e,f,g,m)}t.setCenterPoint(e.l-n.l,n.r-e.r,e.t-n.t,n.b-e.b),t._pointLabelItems=Py(t,s,i)}function Iy(t,e,n,s,i){const a=Math.abs(Math.sin(n)),r=Math.abs(Math.cos(n));let o=0,l=0;s.start<e.l?(o=(e.l-s.start)/a,t.l=Math.min(t.l,e.l-o)):s.end>e.r&&(o=(s.end-e.r)/a,t.r=Math.max(t.r,e.r+o)),i.start<e.t?(l=(e.t-i.start)/r,t.t=Math.min(t.t,e.t-l)):i.end>e.b&&(l=(i.end-e.b)/r,t.b=Math.max(t.b,e.b+l))}function Ly(t,e,n){const s=t.drawingArea,{extra:i,additionalAngle:a,padding:r,size:o}=n,l=t.getPointPosition(e,s+i+r,a),c=Math.round(Qa(Re(l.angle+ae))),d=By(l.y,o.h,c),u=$y(c),h=Ny(l.x,o.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:h,top:d,right:h+o.w,bottom:d+o.h}}function Oy(t,e){if(!e)return!0;const{left:n,top:s,right:i,bottom:a}=t;return!(it({x:n,y:s},e)||it({x:n,y:a},e)||it({x:i,y:s},e)||it({x:i,y:a},e))}function Py(t,e,n){const s=[],i=t._pointLabels.length,a=t.options,{centerPointLabels:r,display:o}=a.pointLabels,l={extra:Fa(a)/2,additionalAngle:r?X/i:0};let c;for(let d=0;d<i;d++){l.padding=n[d],l.size=e[d];const u=Ly(t,d,l);s.push(u),o==="auto"&&(u.visible=Oy(u,c),u.visible&&(c=u))}return s}function $y(t){return t===0||t===180?"center":t<180?"left":"right"}function Ny(t,e,n){return n==="right"?t-=e:n==="center"&&(t-=e/2),t}function By(t,e,n){return n===90||n===270?t-=e/2:(n>270||n<90)&&(t-=e),t}function jy(t,e,n){const{left:s,top:i,right:a,bottom:r}=n,{backdropColor:o}=e;if(!H(o)){const l=It(e.borderRadius),c=be(e.backdropPadding);t.fillStyle=o;const d=s-c.left,u=i-c.top,h=a-s+c.width,f=r-i+c.height;Object.values(l).some(p=>p!==0)?(t.beginPath(),cs(t,{x:d,y:u,w:h,h:f,radius:l}),t.fill()):t.fillRect(d,u,h,f)}}function Fy(t,e){const{ctx:n,options:{pointLabels:s}}=t;for(let i=e-1;i>=0;i--){const a=t._pointLabelItems[i];if(!a.visible)continue;const r=s.setContext(t.getPointLabelContext(i));jy(n,r,a);const o=de(r.font),{x:l,y:c,textAlign:d}=a;Pt(n,t._pointLabels[i],l,c+o.lineHeight/2,o,{color:r.color,textAlign:d,textBaseline:"middle"})}}function td(t,e,n,s){const{ctx:i}=t;if(n)i.arc(t.xCenter,t.yCenter,e,0,J);else{let a=t.getPointPosition(0,e);i.moveTo(a.x,a.y);for(let r=1;r<s;r++)a=t.getPointPosition(r,e),i.lineTo(a.x,a.y)}}function Wy(t,e,n,s,i){const a=t.ctx,r=e.circular,{color:o,lineWidth:l}=e;!r&&!s||!o||!l||n<0||(a.save(),a.strokeStyle=o,a.lineWidth=l,a.setLineDash(i.dash),a.lineDashOffset=i.dashOffset,a.beginPath(),td(t,n,r,s),a.closePath(),a.stroke(),a.restore())}function Gy(t,e,n){return yt(t,{label:n,index:e,type:"pointLabel"})}class Bn extends bi{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=be(Fa(this.options)/2),n=this.width=this.maxWidth-e.width,s=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+n/2+e.left),this.yCenter=Math.floor(this.top+s/2+e.top),this.drawingArea=Math.floor(Math.min(n,s)/2)}determineDataLimits(){const{min:e,max:n}=this.getMinMax(!1);this.min=se(e)&&!isNaN(e)?e:0,this.max=se(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Fa(this.options))}generateTickLabels(e){bi.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((n,s)=>{const i=K(this.options.pointLabels.callback,[n,s],this);return i||i===0?i:""}).filter((n,s)=>this.chart.getDataVisibility(s))}fit(){const e=this.options;e.display&&e.pointLabels.display?Dy(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,n,s,i){this.xCenter+=Math.floor((e-n)/2),this.yCenter+=Math.floor((s-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,n,s,i))}getIndexAngle(e){const n=J/(this._pointLabels.length||1),s=this.options.startAngle||0;return Re(e*n+Ne(s))}getDistanceFromCenterForValue(e){if(H(e))return NaN;const n=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*n:(e-this.min)*n}getValueForDistanceFromCenter(e){if(H(e))return NaN;const n=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-n:this.min+n}getPointLabelContext(e){const n=this._pointLabels||[];if(e>=0&&e<n.length){const s=n[e];return Gy(this.getContext(),e,s)}}getPointPosition(e,n,s=0){const i=this.getIndexAngle(e)-ae+s;return{x:Math.cos(i)*n+this.xCenter,y:Math.sin(i)*n+this.yCenter,angle:i}}getPointPositionForValue(e,n){return this.getPointPosition(e,this.getDistanceFromCenterForValue(n))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:n,top:s,right:i,bottom:a}=this._pointLabelItems[e];return{left:n,top:s,right:i,bottom:a}}drawBackground(){const{backgroundColor:e,grid:{circular:n}}=this.options;if(e){const s=this.ctx;s.save(),s.beginPath(),td(this,this.getDistanceFromCenterForValue(this._endValue),n,this._pointLabels.length),s.closePath(),s.fillStyle=e,s.fill(),s.restore()}}drawGrid(){const e=this.ctx,n=this.options,{angleLines:s,grid:i,border:a}=n,r=this._pointLabels.length;let o,l,c;if(n.pointLabels.display&&Fy(this,r),i.display&&this.ticks.forEach((d,u)=>{if(u!==0){l=this.getDistanceFromCenterForValue(d.value);const h=this.getContext(u),f=i.setContext(h),p=a.setContext(h);Wy(this,f,l,r,p)}}),s.display){for(e.save(),o=r-1;o>=0;o--){const d=s.setContext(this.getPointLabelContext(o)),{color:u,lineWidth:h}=d;!h||!u||(e.lineWidth=h,e.strokeStyle=u,e.setLineDash(d.borderDash),e.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(n.ticks.reverse?this.min:this.max),c=this.getPointPosition(o,l),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(c.x,c.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,n=this.options,s=n.ticks;if(!s.display)return;const i=this.getIndexAngle(0);let a,r;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(i),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((o,l)=>{if(l===0&&!n.reverse)return;const c=s.setContext(this.getContext(l)),d=de(c.font);if(a=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){e.font=d.string,r=e.measureText(o.label).width,e.fillStyle=c.backdropColor;const u=be(c.backdropPadding);e.fillRect(-r/2-u.left,-a-d.size/2-u.top,r+u.width,d.size+u.height)}Pt(e,o.label,0,-a,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),e.restore()}drawTitle(){}}C(Bn,"id","radialLinear"),C(Bn,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Di.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}}),C(Bn,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),C(Bn,"descriptors",{angleLines:{_fallback:"grid"}});const $i={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Ce=Object.keys($i);function vl(t,e){return t-e}function wl(t,e){if(H(e))return null;const n=t._adapter,{parser:s,round:i,isoWeekday:a}=t._parseOpts;let r=e;return typeof s=="function"&&(r=s(r)),se(r)||(r=typeof s=="string"?n.parse(r,s):n.parse(r)),r===null?null:(i&&(r=i==="week"&&(on(a)||a===!0)?n.startOf(r,"isoWeek",a):n.startOf(r,i)),+r)}function kl(t,e,n,s){const i=Ce.length;for(let a=Ce.indexOf(t);a<i-1;++a){const r=$i[Ce[a]],o=r.steps?r.steps:Number.MAX_SAFE_INTEGER;if(r.common&&Math.ceil((n-e)/(o*r.size))<=s)return Ce[a]}return Ce[i-1]}function Hy(t,e,n,s,i){for(let a=Ce.length-1;a>=Ce.indexOf(n);a--){const r=Ce[a];if($i[r].common&&t._adapter.diff(i,s,r)>=e-1)return r}return Ce[n?Ce.indexOf(n):0]}function Uy(t){for(let e=Ce.indexOf(t)+1,n=Ce.length;e<n;++e)if($i[Ce[e]].common)return Ce[e]}function Sl(t,e,n){if(!n)t[e]=!0;else if(n.length){const{lo:s,hi:i}=Za(n,e),a=n[s]>=e?n[s]:n[i];t[a]=!0}}function qy(t,e,n,s){const i=t._adapter,a=+i.startOf(e[0].value,s),r=e[e.length-1].value;let o,l;for(o=a;o<=r;o=+i.add(o,1,s))l=n[o],l>=0&&(e[l].major=!0);return e}function xl(t,e,n){const s=[],i={},a=e.length;let r,o;for(r=0;r<a;++r)o=e[r],i[o]=r,s.push({value:o,major:!1});return a===0||!n?s:qy(t,s,i,n)}class hs extends Ft{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,n={}){const s=e.time||(e.time={}),i=this._adapter=new em._date(e.adapters.date);i.init(n),Hn(s.displayFormats,i.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(e),this._normalized=n.normalized}parse(e,n){return e===void 0?null:wl(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,n=this._adapter,s=e.time.unit||"day";let{min:i,max:a,minDefined:r,maxDefined:o}=this.getUserBounds();function l(c){!r&&!isNaN(c.min)&&(i=Math.min(i,c.min)),!o&&!isNaN(c.max)&&(a=Math.max(a,c.max))}(!r||!o)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),i=se(i)&&!isNaN(i)?i:+n.startOf(Date.now(),s),a=se(a)&&!isNaN(a)?a:+n.endOf(Date.now(),s)+1,this.min=Math.min(i,a-1),this.max=Math.max(i+1,a)}_getLabelBounds(){const e=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return e.length&&(n=e[0],s=e[e.length-1]),{min:n,max:s}}buildTicks(){const e=this.options,n=e.time,s=e.ticks,i=s.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const a=this.min,r=this.max,o=Cg(i,a,r);return this._unit=n.unit||(s.autoSkip?kl(n.minUnit,this.min,this.max,this._getLabelCapacity(a)):Hy(this,o.length,n.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:Uy(this._unit),this.initOffsets(i),e.reverse&&o.reverse(),xl(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let n=0,s=0,i,a;this.options.offset&&e.length&&(i=this.getDecimalForValue(e[0]),e.length===1?n=1-i:n=(this.getDecimalForValue(e[1])-i)/2,a=this.getDecimalForValue(e[e.length-1]),e.length===1?s=a:s=(a-this.getDecimalForValue(e[e.length-2]))/2);const r=e.length<3?.5:.25;n=ue(n,0,r),s=ue(s,0,r),this._offsets={start:n,end:s,factor:1/(n+1+s)}}_generate(){const e=this._adapter,n=this.min,s=this.max,i=this.options,a=i.time,r=a.unit||kl(a.minUnit,n,s,this._getLabelCapacity(n)),o=P(i.ticks.stepSize,1),l=r==="week"?a.isoWeekday:!1,c=on(l)||l===!0,d={};let u=n,h,f;if(c&&(u=+e.startOf(u,"isoWeek",l)),u=+e.startOf(u,c?"day":r),e.diff(s,n,r)>1e5*o)throw new Error(n+" and "+s+" are too far apart with stepSize of "+o+" "+r);const p=i.ticks.source==="data"&&this.getDataTimestamps();for(h=u,f=0;h<s;h=+e.add(h,o,r),f++)Sl(d,h,p);return(h===s||i.bounds==="ticks"||f===1)&&Sl(d,h,p),Object.keys(d).sort(vl).map(g=>+g)}getLabelForValue(e){const n=this._adapter,s=this.options.time;return s.tooltipFormat?n.format(e,s.tooltipFormat):n.format(e,s.displayFormats.datetime)}format(e,n){const i=this.options.time.displayFormats,a=this._unit,r=n||i[a];return this._adapter.format(e,r)}_tickFormatFunction(e,n,s,i){const a=this.options,r=a.ticks.callback;if(r)return K(r,[e,n,s],this);const o=a.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&o[l],u=c&&o[c],h=s[n],f=c&&u&&h&&h.major;return this._adapter.format(e,i||(f?u:d))}generateTickLabels(e){let n,s,i;for(n=0,s=e.length;n<s;++n)i=e[n],i.label=this._tickFormatFunction(i.value,n,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const n=this._offsets,s=this.getDecimalForValue(e);return this.getPixelForDecimal((n.start+s)*n.factor)}getValueForPixel(e){const n=this._offsets,s=this.getDecimalForPixel(e)/n.factor-n.end;return this.min+s*(this.max-this.min)}_getLabelSize(e){const n=this.options.ticks,s=this.ctx.measureText(e).width,i=Ne(this.isHorizontal()?n.maxRotation:n.minRotation),a=Math.cos(i),r=Math.sin(i),o=this._resolveTickFontOptions(0).size;return{w:s*a+o*r,h:s*r+o*a}}_getLabelCapacity(e){const n=this.options.time,s=n.displayFormats,i=s[n.unit]||s.millisecond,a=this._tickFormatFunction(e,0,xl(this,[e],this._majorUnit),i),r=this._getLabelSize(a),o=Math.floor(this.isHorizontal()?this.width/r.w:this.height/r.h)-1;return o>0?o:1}getDataTimestamps(){let e=this._cache.data||[],n,s;if(e.length)return e;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(n=0,s=i.length;n<s;++n)e=e.concat(i[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let n,s;if(e.length)return e;const i=this.getLabels();for(n=0,s=i.length;n<s;++n)e.push(wl(this,i[n]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return fc(e.sort(vl))}}C(hs,"id","time"),C(hs,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Ws(t,e,n){let s=0,i=t.length-1,a,r,o,l;n?(e>=t[s].pos&&e<=t[i].pos&&({lo:s,hi:i}=st(t,"pos",e)),{pos:a,time:o}=t[s],{pos:r,time:l}=t[i]):(e>=t[s].time&&e<=t[i].time&&({lo:s,hi:i}=st(t,"time",e)),{time:a,pos:o}=t[s],{time:r,pos:l}=t[i]);const c=r-a;return c?o+(l-o)*(e-a)/c:o}class Wa extends hs{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(e);this._minPos=Ws(n,this.min),this._tableRange=Ws(n,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:n,max:s}=this,i=[],a=[];let r,o,l,c,d;for(r=0,o=e.length;r<o;++r)c=e[r],c>=n&&c<=s&&i.push(c);if(i.length<2)return[{time:n,pos:0},{time:s,pos:1}];for(r=0,o=i.length;r<o;++r)d=i[r+1],l=i[r-1],c=i[r],Math.round((d+l)/2)!==c&&a.push({time:c,pos:r/(o-1)});return a}_generate(){const e=this.min,n=this.max;let s=super.getDataTimestamps();return(!s.includes(e)||!s.length)&&s.splice(0,0,e),(!s.includes(n)||s.length===1)&&s.push(n),s.sort((i,a)=>i-a)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const n=this.getDataTimestamps(),s=this.getLabelTimestamps();return n.length&&s.length?e=this.normalize(n.concat(s)):e=n.length?n:s,e=this._cache.all=e,e}getDecimalForValue(e){return(Ws(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const n=this._offsets,s=this.getDecimalForPixel(e)/n.factor-n.end;return Ws(this._table,s*this._tableRange+this._minPos,!0)}}C(Wa,"id","timeseries"),C(Wa,"defaults",hs.defaults);var Vy=Object.freeze({__proto__:null,CategoryScale:Na,LinearScale:Ba,LogarithmicScale:ja,RadialLinearScale:Bn,TimeScale:hs,TimeSeriesScale:Wa});const zy=[Zp,T_,Sy,Vy];et.register(...zy);const Ky="https://lmftwznuhgphousfojpb.supabase.co",Cl="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtZnR3em51aGdwaG91c2ZvanBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1NTgyNTUsImV4cCI6MjA4MzEzNDI1NX0.ddjVeN3cL2B5kvE6mLNWS1hen8OBOoETPEIhioFxELk";if(!Cl.trim())console.warn("[Supabase] .env VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY ."),window.supabase=null;else try{window.supabase=Wf(Ky.trim(),Cl.trim())}catch(t){console.error("Supabase   :",t),window.supabase=null}window.Chart=et;const F={shared_manager:{data:null,timestamp:null,ttl:5*60*1e3},clients:new Map,clientTtl:5*60*1e3,dailyReport:{data:null,dateRange:null,timestamp:null,ttl:2*60*1e3},weeklyReport:{data:null,weeks:null,timestamp:null,ttl:2*60*1e3},holidays:{data:null,dateRange:null,timestamp:null,ttl:24*60*60*1e3},goalDetails:new Map,goalDetailTtl:1*60*1e3,actionItems:new Map,actionItemsTtl:1*60*1e3,domElements:new Map};function Kn(t,e){return!t||!t.timestamp?!1:Date.now()-t.timestamp<e}function Yy(){for(const[t,e]of F.clients)Kn(e,F.clientTtl)||F.clients.delete(t);for(const[t,e]of F.goalDetails)Kn(e,F.goalDetailTtl)||F.goalDetails.delete(t);for(const[t,e]of F.actionItems)Kn(e,F.actionItemsTtl)||F.actionItems.delete(t);for(const[t,e]of F.domElements)(!e||!(e instanceof Node)||!document.contains(e))&&F.domElements.delete(t)}function jn(t){if(F.domElements.has(t)){const n=F.domElements.get(t);if(n&&n instanceof Node&&document.contains(n))return n;F.domElements.delete(t)}const e=document.querySelector(t);return e&&F.domElements.set(t,e),e}function A(t){return jn(`#${t}`)}function Ie(t,e=!1){const n=`all:${t}`;if(F.domElements.has(n)){const a=F.domElements.get(n);if(a&&a.length>0&&document.contains(a[0]))return a;F.domElements.delete(n)}const s=document.querySelectorAll(t),i=e?s:Array.from(s);return i.length>0&&F.domElements.set(n,i),i}function Jy(){["goal-register-modal","daily-tab","weekly-tab","sales-report-page","dashboard-page","goal-page","setting-page","manager-setting-page"].forEach(n=>A(n)),[".Sidebar__navItem",".page",".tab-content"].forEach(n=>Ie(n))}typeof setInterval<"u"&&setInterval(Yy,5*60*1e3);function L(t){if(t!==0&&!t)return"";const e=Math.round(Number(t));return String(e).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function $t(t){if(!t)return"";let e=t.replace(/\s*\/\s*Daily\s+Trend\s*$/i,"");return e=e.replace(/^\d+\.\s*/,""),e=e.trim(),e}function nd(t){if(!t)return"";let e=t.replace(/\s*\/\s*Daily\s+Trend\s*$/i,"");return e=e.replace(/^\d+\.\s*/,""),e=e.replace(/\(([^)]+)\)/g,(n,s)=>/[a-zA-Z]/.test(s)?"":n),e=e.replace(/\s*/g,""),e=e.trim(),e.length>5&&(e=e.substring(0,5)+".."),e}function vi(t){return t?String(t).replace(/,/g,""):""}function he(t,e="YYYY-MM-DD"){if(!t)return"";const n=t instanceof Date?t:new Date(t);if(isNaN(n.getTime()))return"";const i={"YYYY-MM-DD":()=>{const a=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),o=String(n.getDate()).padStart(2,"0");return`${a}-${r}-${o}`},"MM.DD.":()=>{const a=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${a}. ${r}.`},"YY.MM.DD":()=>{const a=String(n.getFullYear()).slice(-2),r=String(n.getMonth()+1).padStart(2,"0"),o=String(n.getDate()).padStart(2,"0");return`${a}. ${r}. ${o}`}}[e];return i?i():""}function wi(t){return he(t,"YY.MM.DD")}function Ee(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return String(t).replace(/[&<>"']/g,n=>e[n]??n)}function B(...t){}const Ve={progress:{icon:"ri-loader-4-line",color:"#3b82f6"},done:{icon:"ri-check-line",color:"#10b981"},failed:{icon:"ri-close-line",color:"#ef4444"}},dn={upsales_big:" - ",upsales_smb:" - SMB",new:"",outbound:"",etc:""},Fe={upsales_big:0,upsales_smb:1,new:2,outbound:3,etc:4};function Nt(t,e,n=null){console.error(`[${e}]`,t),n&&alert(n)}function dr(t){const e=t.start_revenue??0,n=t.goal_revenue??0,s=t.currentRevenue??0,i=n-e,a=s-e,r=n>0?Math.round(s/n*100):0,o=n>0?Math.round(s/n*100*10)/10:0,l=e>0?Math.round(a/e*100*10)/10:0,c=e>0?Math.round((n/e-1)*100):0;let d="achieved-low";o>=110?d="achieved-excellent":o>=100?d="achieved-high":o>=90&&(d="achieved-mid");const u=l>=0?"growth-positive":"growth-negative";let h="achievement-low",f="bg-low";return r>=100?(h="achievement-high",f="bg-high"):r>=80&&(h="achievement-mid",f="bg-mid"),{startRevenue:e,goalRevenue:n,currentRevenue:s,targetGrowth:i,actualGrowth:a,achievementRate:r,achievementRateDecimal:o,growthRate:l,growthRatePercent:c,achievedColorClass:d,growthRateColorClass:u,colorClass:h,bgClass:f}}function Gs(t){return t<80?"metric-achievement-under80":t<90?"metric-achievement-under90":t<100?"metric-achievement-under100":t<110?"metric-achievement-over100":t<120?"metric-achievement-over110":"metric-achievement-over120"}function ur(t,e){const{goalRevenue:n,currentRevenue:s,targetGrowth:i,actualGrowth:a,growthRate:r,achievementRateDecimal:o}=e,l=n>0?s/n*100:0;let c;i===0?c=a<0?85:115:c=a/i*100;const d=100+r,u=o;return{achievedRevenueClass:Gs(l),achievedGrowthClass:Gs(c),weeklyGrowthClass:Gs(d),goalAchievementClass:Gs(u)}}class Xy{constructor(){C(this,"cache",new Map);C(this,"DEFAULT_TTL",5*60*1e3)}getById(e){const n=`#${e}`,s=this.cache.get(n);if(s&&document.contains(s.element))return s.element;const i=document.getElementById(e);return i?this.cache.set(n,{element:i,timestamp:Date.now()}):this.cache.delete(n),i}getBySelector(e){const n=`qs:${e}`,s=this.cache.get(n);if(s&&document.contains(s.element))return s.element;const i=document.querySelector(e);return i?this.cache.set(n,{element:i,timestamp:Date.now()}):this.cache.delete(n),i}invalidate(e){this.cache.delete(e),this.cache.delete(`#${e}`),this.cache.delete(`qs:${e}`)}invalidateByPrefix(e){const n=[];for(const s of this.cache.keys())s.includes(e)&&n.push(s);n.forEach(s=>this.cache.delete(s))}cleanup(){const e=[];for(const[n,s]of this.cache)document.contains(s.element)||e.push(n);e.length>0&&e.forEach(n=>this.cache.delete(n))}clear(){this.cache.clear()}get size(){return this.cache.size}preCacheCommon(){["goal-register-modal","daily-tab","weekly-tab","sales-report-page","dashboard-page","goal-page","setting-page","manager-setting-page","dashboard-month-display","dashboard-prev-month","dashboard-next-month"].forEach(n=>this.getById(n))}}const Ga=new Xy;typeof setInterval<"u"&&setInterval(()=>Ga.cleanup(),5*60*1e3);class Qy{constructor(){C(this,"pending",new Map);C(this,"cache",new Map)}async execute(e,n,s={}){const{cacheTtl:i=0,forceRefresh:a=!1}=s;if(!a&&i>0){const l=this.cache.get(e);if(l&&Date.now()-l.timestamp<i)return l.data}const r=this.pending.get(e);if(r)return r.promise;const o=n();this.pending.set(e,{promise:o,timestamp:Date.now()});try{const l=await o;return i>0&&this.cache.set(e,{data:l,timestamp:Date.now()}),l}finally{this.pending.delete(e)}}invalidateCache(e){this.cache.delete(e)}invalidateCacheByPrefix(e){const n=[];for(const s of this.cache.keys())s.startsWith(e)&&n.push(s);n.forEach(s=>this.cache.delete(s))}clearCache(){this.cache.size,this.cache.clear()}isPending(e){return this.pending.has(e)}get pendingCount(){return this.pending.size}get cacheSize(){return this.cache.size}cleanupExpiredCache(e=10*60*1e3){const n=Date.now(),s=[];for(const[i,a]of this.cache)n-a.timestamp>e&&s.push(i);s.forEach(i=>this.cache.delete(i))}}const Ni=new Qy;typeof setInterval<"u"&&setInterval(()=>Ni.cleanupExpiredCache(),10*60*1e3);function sd(t,...e){return`${t}:${e.filter(n=>n!=null).join(":")}`}class Zy{constructor(){C(this,"charts",new Map)}register(e,n){this.destroy(e),this.charts.set(e,n)}get(e){return this.charts.get(e)}has(e){return this.charts.has(e)}destroy(e){const n=this.charts.get(e);if(n){try{n.destroy(),B(`[ChartRegistry] Destroyed chart: ${e}`)}catch{}this.charts.delete(e)}}destroyByPrefix(e){const n=[];for(const s of this.charts.keys())s.startsWith(e)&&n.push(s);n.forEach(s=>this.destroy(s))}destroyAll(){this.charts.size;for(const[,e]of this.charts)try{e.destroy()}catch{}this.charts.clear()}get size(){return this.charts.size}getIds(){return Array.from(this.charts.keys())}update(e,n){const s=this.charts.get(e);if(s)try{s.update(n)}catch{}}resizeAll(){for(const[e,n]of this.charts)try{n.resize()}catch{}}}const id=new Zy;let fa=null;typeof window<"u"&&window.addEventListener("resize",()=>{fa&&clearTimeout(fa),fa=setTimeout(()=>id.resizeAll(),250)});function hr(){if(!window.supabase)throw new Error("Supabase   .");return window.supabase}function T(){return window.supabase?window.supabase:null}const eb=5*60*1e3,tb=5*60*1e3;async function ad(){const t=T();if(!t)return null;const e=sd("shared_manager","ads");try{return await Ni.execute(e,async()=>{const{data:n,error:s}=await t.from("shared_manager").select("id, manager_name").eq("manager_team","ads").order("id",{ascending:!0});return s?(console.error("Manager   :",s),null):n??[]},{cacheTtl:eb})}catch(n){return console.error("Manager   :",n),null}}async function nb(t){if(!t)return null;const e=T();if(!e)return null;const n=sd("clients",t);try{return await Ni.execute(n,async()=>{const{data:s,error:i}=await e.from("ads_data_client").select("client_id, client_name").eq("manager_id",t).order("client_id",{ascending:!0});return i?(console.error("   :",i),null):s??[]},{cacheTtl:tb})}catch(s){return console.error("   :",s),null}}async function rd(){const t=T();if(!t){const a=new Date;return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`}const{data:e,error:n}=await t.from("ads_data_daily").select("date").order("date",{ascending:!1}).limit(1).single();if(n||!e||!e.date){const a=new Date;return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`}const s=e.date,i=new Date(s);return`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`}const Yn=typeof document<"u"?new EventTarget:null;function ga(t,e){Yn&&Yn.dispatchEvent(new CustomEvent(String(t),{detail:e}))}function od(t,e){if(!Yn)return()=>{};const n=s=>e(s.detail);return Yn.addEventListener(String(t),n),()=>Yn.removeEventListener(String(t),n)}async function sb(t,e,n){if(n===null)return 0;try{const s=await t.from("ads_data_daily").update({manager_id:n}).eq("client_id",e).is("manager_id",null);if(s.error)return console.error(`[Backfill] client_id=${e}  :`,s.error),0;const i=typeof s.count=="number"?s.count:-1;return B(`[Backfill] client_id=${e}: manager_id=${n}    `+(i>=0?` (${i})`:"")),i>=0?i:0}catch(s){return console.error(`[Backfill] client_id=${e}  :`,s),0}}async function ib(t,e,n){if(n===null||e.length===0)return 0;try{const s=await t.from("ads_data_daily").update({manager_id:n}).in("client_id",e).is("manager_id",null);if(s.error)return console.error("[Backfill]   :",s.error),0;const i=typeof s.count=="number"?s.count:-1;return B(`[Backfill] ${e.length} : manager_id=${n}    `+(i>=0?` (${i})`:"")),i>=0?i:0}catch(s){return console.error("[Backfill]   :",s),0}}function ld(t){const e=t.split(`
`).filter(i=>i.trim());if(e.length===0)return[];const n=e[0].split(",").map(i=>i.trim()),s=[];for(let i=1;i<e.length;i++){const a=e[i],r=[];let o="",l=!1;for(let c=0;c<a.length;c++){const d=a[c];d==='"'?l=!l:d===","&&!l?(r.push(o.trim()),o=""):o+=d}if(r.push(o.trim()),r.length===n.length){const c={};n.forEach((d,u)=>{c[d]=r[u]??""}),s.push(c)}}return s}function ab(t){if(!t)return null;const e=t.trim();if(e.includes("-")){const r=e.split("-").map(d=>d.trim()).filter(Boolean);if(r.length!==3)return null;const[o,l,c]=r.map(d=>parseInt(d,10));return Number.isNaN(o)||Number.isNaN(l)||Number.isNaN(c)?null:`${o}-${String(l).padStart(2,"0")}-${String(c).padStart(2,"0")}`}if(e.includes("/")){const r=e.split("/").map(d=>d.trim()).filter(Boolean);if(r.length!==3)return null;const[o,l,c]=r.map(d=>parseInt(d,10));return Number.isNaN(o)||Number.isNaN(l)||Number.isNaN(c)?null:`${o}-${String(l).padStart(2,"0")}-${String(c).padStart(2,"0")}`}const n=e.split(".").map(r=>r.trim()).filter(Boolean);if(n.length!==3)return null;const[s,i,a]=n.map(r=>parseInt(r,10));return Number.isNaN(s)||Number.isNaN(i)||Number.isNaN(a)?null:`${s}-${String(i).padStart(2,"0")}-${String(a).padStart(2,"0")}`}const rb="https://docs.google.com/spreadsheets/d/1NRIdkAOBdemFO7_6AIocIcynH7c6iH82xMLURDOG9iU/edit?gid=3921937#gid=3921937",cd="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4e6zINwh9KgG1Io80NtwYcT0c4tIC4fszfXiAbtq41RvVinQmeqbJORmmibTcu9sG5zNUAB6jNikR/pub?gid=3921937&single=true&output=csv";function dd(t,e){const{dateFilter:n,clientManagerMap:s,existingClientIds:i,holidays:a}=e,r=[],o=[],l=new Set;for(let c=t.length-1;c>=0;c--){const d=t[c],u=ab(d.date);if(!u){B(`  : ${d.date}`);continue}if(!n(u))continue;const h=parseInt(d.client_id,10);if(Number.isNaN(h)){B(`client_id  : ${d.client_id}`);continue}const f=parseInt((d.amount??"0").replace(/,/g,""),10);if(Number.isNaN(f)){B(`amount  : ${d.amount}`);continue}const p=$t(d.client_name),g=a.has(u),m=d.vimp?parseInt((d.vimp??"0").replace(/,/g,""),10):void 0,_=d.click?parseInt((d.click??"0").replace(/,/g,""),10):void 0,y=d.conversion?parseInt((d.conversion??"0").replace(/,/g,""),10):void 0;!i.has(h)&&!l.has(h)&&(o.push({client_id:h,client_name:p,manager_id:null}),l.add(h),i.add(h));const b={date:u,client_id:h,client_name:p,amount:f,manager_id:s[h]??null,is_holiday:g};!Number.isNaN(m)&&m!==void 0&&(b.vimp=m),!Number.isNaN(_)&&_!==void 0&&(b.click=_),!Number.isNaN(y)&&y!==void 0&&(b.conversion=y),r.push(b)}return{recordsToInsert:r,newClientsToInsert:o}}const Mn=1e3,El=55,ob=95;async function lb(t,e,n){if(e.length===0)return;const s=[],i=new Set;for(const u of e)i.has(u.client_id)||(s.push(u),i.add(u.client_id));const a=s.map(u=>u.client_id),{data:r,error:o}=await t.from("ads_data_client").select("client_id").in("client_id",a);o&&B(`   : ${o.message}`);const l=new Set((r??[]).map(u=>u.client_id)),c=s.filter(u=>!l.has(u.client_id)),d=s.filter(u=>l.has(u.client_id));if(c.length>0){const{error:u}=await t.from("ads_data_client").insert(c);if(u){B(`   : ${u.message}`);for(const h of c){const{error:f}=await t.from("ads_data_client").insert([h]);f&&B(` ${h.client_id}  : ${f.message}`)}}else B(`  ${c.length}  `)}if(d.length>0){for(const u of d){const{error:h}=await t.from("ads_data_client").update({client_name:u.client_name}).eq("client_id",u.client_id);h&&B(` ${u.client_id}  : ${h.message}`)}B(`  ${d.length}  `)}}async function ud(t,e,n){const s=Math.ceil(e.length/Mn);for(let i=0;i<e.length;i+=Mn){const a=Math.floor(i/Mn),r=e.slice(i,i+Mn),o=El+(a+1)/s*(ob-El);n("  ...",Math.round(o),`${Math.min(i+Mn,e.length).toLocaleString()} / ${e.length.toLocaleString()} `);const{error:l}=await t.from("ads_data_daily").insert(r);if(l)throw new Error(`   ( ${a+1}): ${l.message}`);B(` ${a+1}: ${r.length}   `)}}async function cb(t){const e=(y,b,v)=>{t==null||t({stage:y,percent:b,detail:v})};e("CSV   ...",5);const n=hr(),s=await fetch(cd);if(!s.ok)throw new Error("CSV    .");const i=await s.text();e("CSV  ...",15);const a=ld(i);B(` ${a.length}   `),e("   ...",20);const{data:r,error:o}=await n.from("ads_data_daily").select("date").order("date",{ascending:!1}).limit(1).single();if(o&&o.code!=="PGRST116")throw new Error(`   : ${o.message}`);const l=r!=null&&r.date?new Date(r.date):null;e("   ...",30);const{data:c,error:d}=await n.from("ads_data_client").select("client_id, manager_id");if(d)throw new Error(`   : ${d.message}`);const u={},h=new Set;for(const y of c)u[y.client_id]=y.manager_id,h.add(y.client_id);const{data:f,error:p}=await n.from("shared_holiday").select("holiday_date");if(p)throw new Error(`   : ${p.message}`);const g=new Set;for(const y of f){const b=y.holiday_date instanceof Date?y.holiday_date.toISOString().split("T")[0]:String(y.holiday_date).split("T")[0];g.add(b)}e("   ...",40);const{recordsToInsert:m,newClientsToInsert:_}=dd(a,{dateFilter:y=>!l||new Date(y)>l,clientManagerMap:u,existingClientIds:h,holidays:g});if(m.length===0){e("  .",100," ");return}e("   ...",50,`  ${m.length.toLocaleString()} `),await lb(n,_),await ud(n,m,e),e("!",100,`${m.length.toLocaleString()}   `)}async function db(t,e,n){const s=(y,b,v)=>{n==null||n({stage:y,percent:b,detail:v})};s("CSV   ...",5);const i=hr(),a=await fetch(cd);if(!a.ok)throw new Error("CSV    .");const r=await a.text();s("CSV  ...",15);const o=ld(r);B(` ${o.length}   `),s("   ...",25,`${t} ~ ${e}`);const{error:l}=await i.from("ads_data_daily").delete().gte("date",t).lte("date",e);if(l)throw new Error(`   : ${l.message}`);s("   ...",35);const{data:c,error:d}=await i.from("ads_data_client").select("client_id, manager_id");if(d)throw new Error(`   : ${d.message}`);const u={},h=new Set;for(const y of c)u[y.client_id]=y.manager_id,h.add(y.client_id);const{data:f,error:p}=await i.from("shared_holiday").select("holiday_date");if(p)throw new Error(`   : ${p.message}`);const g=new Set;for(const y of f){const b=y.holiday_date instanceof Date?y.holiday_date.toISOString().split("T")[0]:String(y.holiday_date).split("T")[0];g.add(b)}s("   ...",45);const{recordsToInsert:m,newClientsToInsert:_}=dd(o,{dateFilter:y=>y>=t&&y<=e,clientManagerMap:u,existingClientIds:h,holidays:g});if(m.length===0){s("  CSV  .",100,`${t} ~ ${e}`);return}if(s("   ...",50,`  ${m.length.toLocaleString()}`),_.length>0){const y=_.filter((S,x,E)=>E.findIndex(D=>D.client_id===S.client_id)===x),b=y.map(S=>S.client_id),{data:v}=await i.from("ads_data_client").select("client_id").in("client_id",b),w=new Set((v??[]).map(S=>S.client_id)),k=y.filter(S=>!w.has(S.client_id));if(k.length>0){const{error:S}=await i.from("ads_data_client").insert(k);if(S){B(`   : ${S.message}`);for(const x of k){const{error:E}=await i.from("ads_data_client").insert([x]);E&&B(` ${x.client_id}  : ${E.message}`)}}else B(`  ${k.length}  `)}}await ud(i,m,s),s("!",100,`${m.length.toLocaleString()}    `)}async function ub(){const t={success:!1,totalClientsProcessed:0,totalRowsUpdated:0,errors:[]};try{const e=hr(),{data:n,error:s}=await e.from("ads_data_client").select("client_id, manager_id").not("manager_id","is",null);if(s)return t.errors.push(`  : ${s.message}`),t;const i=n;if(!(i!=null&&i.length))return B("[Migration]    ."),t.success=!0,t;B(`[Migration]    ${i.length} `);const a=new Map;for(const r of i)a.has(r.manager_id)||a.set(r.manager_id,[]),a.get(r.manager_id).push(r.client_id);B(`[Migration] ${a.size}     `);for(const[r,o]of a)try{const{error:l}=await e.from("ads_data_daily").update({manager_id:r}).in("client_id",o).is("manager_id",null);l?(t.errors.push(`manager_id=${r}  : ${l.message}`),B(`[Migration] manager_id=${r}:  - ${l.message}`)):(t.totalClientsProcessed+=o.length,B(`[Migration] manager_id=${r}: ${o.length}   `))}catch(l){const c=l.message;t.errors.push(`manager_id=${r} : ${c}`)}t.success=t.errors.length===0,B(`[Migration]  : ${t.totalClientsProcessed}  `+(t.errors.length>0?`, ${t.errors.length} `:""))}catch(e){t.errors.push(` : ${e.message}`)}return t}typeof window<"u"&&(window.migrateNullManagerIds=ub);function Y(t){let e=document.getElementById("toast-container");e||(e=document.createElement("div"),e.id="toast-container",e.className="Toast__container",document.body.appendChild(e));const n=document.createElement("div");n.className="Toast__item",n.innerHTML=`<i class="ri-checkbox-circle-fill"></i><span>${t}</span>`,e.appendChild(n),setTimeout(()=>{n.remove(),e&&e.children.length===0&&e.remove()},4e3)}function hb(t,e){const n=document.querySelectorAll("#daily-tab .StatusCards__card");n.forEach(i=>{i.addEventListener("click",function(){const a=this.getAttribute("data-status")??"";let r=A("daily-status-filter");if(!r){r=document.createElement("input"),r.type="hidden",r.id="daily-status-filter";const o=A("daily-tab");o&&o.appendChild(r)}r.value===a?(r.value="",n.forEach(o=>o.classList.remove("active"))):(r.value=a,n.forEach(o=>o.classList.remove("active")),this.classList.add("active")),t()})});const s=document.querySelectorAll("#weekly-tab .StatusCards__card");s.forEach(i=>{i.addEventListener("click",function(){const a=this.getAttribute("data-status")??"";let r=A("weekly-status-filter");if(!r){r=document.createElement("input"),r.type="hidden",r.id="weekly-status-filter";const o=A("weekly-tab");o&&o.appendChild(r)}r.value===a?(r.value="",s.forEach(o=>o.classList.remove("active"))):(r.value=a,s.forEach(o=>o.classList.remove("active")),this.classList.add("active")),e()})})}function fb(t,e=10,n="daily-report-thead"){t.innerHTML="";const s=A(n);let i=18;s&&(i=s.querySelectorAll("th").length);for(let a=0;a<e;a++){const r=document.createElement("tr");r.className="skeleton-row";for(let o=0;o<i;o++){const l=document.createElement("td"),c=document.createElement("div");c.className="skeleton",o===0?c.style.width="80px":o===1?c.style.width="150px":o===2||o===3?c.style.width="90px":c.style.width="100px",l.appendChild(c),r.appendChild(l)}t.appendChild(r)}}async function gb(t){const e=A(t);if(!e)return;const n=await ad();if(!(n!=null&&n.length)){e.innerHTML='<option value=""></option>';return}e.innerHTML='<option value=""></option>';for(const s of n){const i=document.createElement("option");i.value=String(s.id),i.textContent=s.manager_name??`Manager ${s.id}`,e.appendChild(i)}}async function hd(t,e){const n=e==null?void 0:e.trim();if(!n)return new Set;const s=t.from("ads_data_client").select("client_id").not("manager_id","is",null);let i=s;if(n.includes(",")){const o=n.split(",").map(l=>parseInt(l,10)).filter(l=>!isNaN(l));o.includes(99)&&s.or?i=s.or(`manager_id.in.(${o.join(",")}),manager_id.is.null`):s.in&&(i=s.in("manager_id",o))}else{const o=parseInt(n,10);if(isNaN(o))return new Set;o===99&&s.or?i=s.or("manager_id.eq.99,manager_id.is.null"):s.eq&&(i=s.eq("manager_id",o))}const{data:a,error:r}=await i;return r?(console.error("   :",r),new Set):a!=null&&a.length?new Set(a.map(o=>o.client_id)):new Set}async function fd(t){if(!T()){Nt(new Error("Supabase   ."),t.reportName,t.errorMessage);return}const n=A(t.tbodyId),s=A(t.theadId);if(!n||!s){console.error(`${t.reportName}     .`);return}if(t.activeTabId){const i=A(t.activeTabId);if(!(i!=null&&i.classList.contains("active")))return}try{const i=await t.fetchData();if(!i){const u=t.emptyColspan??2;n.innerHTML=`<tr><td colspan="${u}" class="empty-state">${t.emptyMessage}</td></tr>`;return}const{clients:a}=i,r=t.getRange(i),o=s.querySelector("tr");if(!o)return;if(t.renderHeader(o,i,()=>void t.filterTable()),fb(n,10,t.theadId),a.length===0){const u=t.emptyColspan??r.length+5;n.innerHTML=`<tr><td colspan="${u}" class="empty-state">${t.emptyMessage}</td></tr>`;return}const l=t.calculateStatus(a,r);t.updateStatusCards(l),t.setWindowCache(i);const c=await t.applyFilters(a),d=t.sortClients(c,t.getSortState().column);n.innerHTML="",t.renderBody(n,d,i),await gb(t.managerFilterId)}catch(i){Nt(i,t.reportName,t.errorMessage);const a=t.emptyColspan??6;n.innerHTML=`<tr><td colspan="${a}" class="empty-state">${t.errorMessage}: ${i.message}</td></tr>`}}const Hs=1e3,Al=4;async function pb(t){const{data:e,error:n}=await t.from("ads_data_daily").select("date").order("date",{ascending:!1}).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(`   : ${n.message}`);return e&&e.date?e.date:null}async function mb(t,e){const{data:n}=await t.from("shared_holiday").select("holiday_date").in("holiday_date",e),s=new Set;if(n)for(const i of n){const a=i.holiday_date instanceof Date?i.holiday_date.toISOString().split("T")[0]:String(i.holiday_date).split("T")[0];s.add(a)}return s}async function _b(t,e){const n=[];let s=0;for(;;){const i=[];for(let o=0;o<Al;o++){const l=s+o*Hs,c=l+Hs-1,d=t.from("ads_data_daily").select("client_id, client_name, manager_id, date, amount").in("date",e).order("client_id",{ascending:!0}).order("date",{ascending:!1}).range(l,c);i.push(d)}const a=await Promise.all(i);let r=!1;for(const o of a){if(o.error)throw new Error(`  : ${o.error.message}`);const l=o.data??[];n.push(...l),l.length>=Hs&&(r=!0)}if(!r)break;s+=Al*Hs}return n}async function yb(t){const{data:e,error:n}=await t.from("ads_data_v_weekly").select("client_id, client_name, manager_id, week_start, week_end, weekly_amount").order("week_start",{ascending:!1}).order("client_id",{ascending:!0}).limit(1e4);if(n)throw new Error(`   : ${n.message}`);return e??[]}let gd=null;function bb(){return gd??[]}function vb(t){const n=new Date(t).getDay();return n===0||n===6}async function wb(t){const e=await pb(t);if(!e)return null;const n=[],s=new Date(e);for(let d=0;d<14;d++){const u=new Date(s);u.setDate(u.getDate()-d),n.push(u.toISOString().split("T")[0])}gd=n;const i=await mb(t,n),a=await _b(t,n),r=new Map;for(const d of a){const u=d.client_id;r.has(u)||r.set(u,{client_id:u,client_name:d.client_name??"",manager_id:d.manager_id??null,amounts:new Map}),r.get(u).amounts.set(d.date,d.amount??0)}const o=n[0],l=n[1],c=Array.from(r.values()).map(d=>{const u=d.amounts.get(o)??0,h=d.amounts.get(l)??0,f=u-h;let p,g;h>0?(g=u/h*100-100,p=g.toFixed(1)):u>0?(g=1/0,p=""):(g=0,p="0.0");const m=[];for(let v=1;v<n.length;v++){const w=n[v];if(!vb(w)){const k=d.amounts.get(w)??0;k>0&&m.push(k)}}const _=m.length>0?m.reduce((v,w)=>v+w,0)/m.length:0;let y,b;return _>0?(b=u/_*100-100,y=b.toFixed(1)):u>0?(b=1/0,y=""):(b=0,y="0.0"),{...d,mostRecentAmount:u,changeAmount:f,dayBeforeRatio:p,dayBeforeValue:g,avgRatio:y,avgValue:b}});return c.sort((d,u)=>(u.mostRecentAmount??0)-(d.mostRecentAmount??0)),{clients:c,dateRange:n,holidays:i}}async function kb(){const t=T();return t?wb(t):null}function fr(t,e){const n=e[0],s=e[1],i={active:{today:[],yesterday:[]},new:{clients:[],totalAmount:0},stopped:{clients:[],totalAmount:0},rising:{clients:[],totalAmount:0},falling:{clients:[],totalAmount:0}};for(const a of t){const r=a.amounts.get(n)??0,o=a.amounts.get(s)??0;r>0&&i.active.today.push(a),o>0&&i.active.yesterday.push(a),o===0&&r>0?(i.new.clients.push(a),i.new.totalAmount+=r):o>0&&r===0?(i.stopped.clients.push(a),i.stopped.totalAmount+=o):r>0&&o>0&&r-o>0?(i.rising.clients.push(a),i.rising.totalAmount+=r-o):r>0&&o>0&&r-o<0&&(i.falling.clients.push(a),i.falling.totalAmount+=o-r)}return i}function pd(t){const e=t.active.yesterday.length,n=t.active.today.length,s=A("summary-active-count");s&&(s.textContent=`${e}  ${n}`);const i=A("summary-new-count"),a=A("summary-new-amount");i&&(i.textContent=String(t.new.clients.length)),a&&(a.textContent=t.new.totalAmount.toLocaleString("ko-KR"));const r=A("summary-stopped-count"),o=A("summary-stopped-amount");r&&(r.textContent=String(t.stopped.clients.length)),o&&(o.textContent=t.stopped.totalAmount.toLocaleString("ko-KR"));const l=A("summary-rising-count"),c=A("summary-rising-amount");l&&(l.textContent=String(t.rising.clients.length)),c&&(c.textContent=t.rising.totalAmount.toLocaleString("ko-KR"));const d=A("summary-falling-count"),u=A("summary-falling-amount");d&&(d.textContent=String(t.falling.clients.length)),u&&(u.textContent=t.falling.totalAmount.toLocaleString("ko-KR"))}function md(t,e,n){const s=(e==null?void 0:e.trim())??"";if(!s)return t;const i=s.split(",").map(a=>a.trim().toLowerCase()).filter(a=>a.length>0);return i.length===0?t:t.filter(a=>{const r=n(a).toLowerCase();return i.some(o=>r.includes(o))})}async function _d(t){const e=A("daily-search-input"),n=A("daily-manager-filter"),s=A("daily-status-filter");let i=[...t];if(s!=null&&s.value){const a=bb(),r=fr(t,a),o=s.value;o==="active"?i=r.active.today:o==="new"?i=r.new.clients:o==="stopped"?i=r.stopped.clients:o==="rising"?i=r.rising.clients:o==="falling"&&(i=r.falling.clients)}if(e!=null&&e.value.trim()&&(i=md(i,e.value.trim(),a=>`${a.client_id} ${$t(a.client_name)}`)),n!=null&&n.value){const a=T();if(!a)return i;try{const r=await hd(a,n.value);r.size>0?i=i.filter(o=>r.has(o.client_id)):i=[]}catch(r){console.error("   :",r)}}return i}const ke={column:"changeAmount",order:"asc"};function yd(){return{...ke}}function bd(t,e){if(!ke.order)return[...t].sort((i,a)=>(a.mostRecentAmount??0)-(i.mostRecentAmount??0));const n=[...t],s=ke.order;return n.sort((i,a)=>{let r,o;switch(e){case"client_id":r=i.client_id,o=a.client_id;break;case"client_name":r=i.client_name,o=a.client_name;break;case"avgValue":r=i.avgValue===1/0?Number.MAX_VALUE:i.avgValue??0,o=a.avgValue===1/0?Number.MAX_VALUE:a.avgValue??0;break;case"dayBeforeValue":r=i.dayBeforeValue===1/0?Number.MAX_VALUE:i.dayBeforeValue??0,o=a.dayBeforeValue===1/0?Number.MAX_VALUE:a.dayBeforeValue??0;break;case"changeAmount":r=i.changeAmount??0,o=a.changeAmount??0;break;case"mostRecentAmount":r=i.mostRecentAmount??0,o=a.mostRecentAmount??0;break;default:r=i.amounts.get(e)??0,o=a.amounts.get(e)??0}return s==="asc"?typeof r=="string"?r.localeCompare(String(o)):r-o:typeof r=="string"?String(o).localeCompare(r):o-r}),n}function Sb(t){ke.column===t?ke.order==="asc"?ke.order="desc":ke.order==="desc"?ke.order=null:ke.order="asc":(ke.column=t,ke.order="asc")}function vd(t,e){const n=t.querySelector(".sort-icon");if(n&&n.remove(),ke.column===e&&ke.order){const s=document.createElement("span");s.className="sort-icon",s.style.marginLeft="4px",s.style.fontSize="10px",s.textContent=ke.order==="asc"?"":"",t.appendChild(s)}}function xb(){const t=A("daily-report-thead");t&&t.querySelectorAll("th[data-column]").forEach(e=>{const n=e.dataset.column;n&&vd(e,n)})}function Qt(t,e,n,s){t.textContent=n,t.style.textAlign="center",t.style.cursor="pointer",t.style.userSelect="none",t.dataset.column=e,vd(t,e),t.addEventListener("click",()=>{Sb(e),s()})}function Cb(t){const e=new Date(t);return e.getDay()===0||e.getDay()===6}function Eb(t,e){const n=document.createElement("tr");n.className="summary-row";const s=new Map;e.forEach(v=>s.set(v,0)),t.forEach(v=>{e.forEach(w=>{s.set(w,(s.get(w)??0)+(v.amounts.get(w)??0))})});const i=e[0],a=s.get(i)??0,r=e[1],o=s.get(r)??0;let l,c;o>0?(c=a/o*100-100,l=c.toFixed(1)):a>0?(c=1/0,l=""):(c=0,l="0.0");const d=[];for(let v=1;v<e.length;v++){const w=e[v];if(!Cb(w)){const k=s.get(w)??0;k>0&&d.push(k)}}const u=d.length>0?d.reduce((v,w)=>v+w,0)/d.length:0;let h,f;u>0?(f=a/u*100-100,h=f.toFixed(1)):a>0?(f=1/0,h=""):(f=0,h="0.0");const p=document.createElement("td");p.textContent="",p.style.textAlign="center",n.appendChild(p);const g=document.createElement("td");g.textContent="",g.style.textAlign="center",g.style.fontWeight="600",n.appendChild(g);const m=document.createElement("td");m.textContent=`${h}%`,m.style.textAlign="center",typeof f=="number"&&!isNaN(f)&&isFinite(f)&&(f<0?m.style.color="#3b82f6":f>0&&(m.style.color="#ef4444")),n.appendChild(m);const _=document.createElement("td");_.textContent=`${l}%`,_.style.textAlign="center",typeof c=="number"&&!isNaN(c)&&isFinite(c)&&(c<0?_.style.color="#3b82f6":c>0&&(_.style.color="#ef4444")),n.appendChild(_);const y=a-o,b=document.createElement("td");return b.textContent=y.toLocaleString("ko-KR"),b.style.textAlign="right",b.style.fontWeight="600",y<0?b.style.color="#3b82f6":y>0&&(b.style.color="#ef4444"),n.appendChild(b),e.forEach((v,w)=>{const k=document.createElement("td");k.textContent=(s.get(v)??0).toLocaleString("ko-KR"),k.style.textAlign="right",k.style.fontWeight="600",w===0&&(k.style.backgroundColor="#fef9e7"),n.appendChild(k)}),n}function Ab(t,e,n,s){t.innerHTML="";const i=document.createElement("th");Qt(i,"client_id","Client ID",s),t.appendChild(i);const a=document.createElement("th");Qt(a,"client_name","Client",s),t.appendChild(a);const r=document.createElement("th");Qt(r,"avgValue"," ",s),t.appendChild(r);const o=document.createElement("th");Qt(o,"dayBeforeValue"," ",s),t.appendChild(o);const l=document.createElement("th");Qt(l,"changeAmount","",s),t.appendChild(l),e.forEach(c=>{const d=document.createElement("th"),u=new Date(c),h=String(u.getMonth()+1).padStart(2,"0"),f=String(u.getDate()).padStart(2,"0");Qt(d,c,`${h}. ${f}.`,s),d.title=c,n.has(c)&&(d.style.color="#ef4444",d.style.fontWeight="bold"),t.appendChild(d)})}function wd(t,e,n,s){t.innerHTML="",t.appendChild(Eb(e,n));for(const i of e){const a=document.createElement("tr"),r=document.createElement("td");r.textContent=String(i.client_id),r.style.textAlign="center",a.appendChild(r);const o=document.createElement("td");o.textContent=$t(i.client_name),o.style.textAlign="center",o.style.maxWidth="250px",o.style.overflow="hidden",o.style.textOverflow="ellipsis",o.style.whiteSpace="nowrap",a.appendChild(o);const l=document.createElement("td");l.textContent=`${i.avgRatio??""}%`,l.style.textAlign="center";const c=i.avgValue;typeof c=="number"&&!isNaN(c)&&isFinite(c)&&(c<0?l.style.color="#3b82f6":c>0&&(l.style.color="#ef4444")),a.appendChild(l);const d=document.createElement("td");d.textContent=`${i.dayBeforeRatio??""}%`,d.style.textAlign="center";const u=i.dayBeforeValue;typeof u=="number"&&!isNaN(u)&&isFinite(u)&&(u<0?d.style.color="#3b82f6":u>0&&(d.style.color="#ef4444")),a.appendChild(d);const h=document.createElement("td");h.textContent=(i.changeAmount??0).toLocaleString("ko-KR"),h.style.textAlign="right";const f=i.changeAmount??0;f<0?h.style.color="#3b82f6":f>0&&(h.style.color="#ef4444"),a.appendChild(h),n.forEach((p,g)=>{const m=document.createElement("td"),_=i.amounts.get(p)??0;m.textContent=_.toLocaleString("ko-KR"),m.style.textAlign="right",g===0&&(m.style.backgroundColor="#fef9e7");const y=new Date(p),b=y.getDay();if(!(b===0||b===6)&&g>=0){let w;if(g===0)w=n[1];else if(b===1){const S=new Date(y);S.setDate(S.getDate()-3),w=S.toISOString().split("T")[0]}else w=n[g-1];const k=i.amounts.get(w)??0;k>0&&(_>k?m.style.color="#ef4444":_<k&&(m.style.color="#3b82f6"))}s.has(p)&&(m.style.color="#94a3b8"),a.appendChild(m)}),t.appendChild(a)}}async function ri(){const t=A("daily-report-tbody"),e=A("daily-report-thead");if(!t||!e)return;const n=window.dailyReportDataCache;if(!(n!=null&&n.clients)){await kd();return}const{clients:s,dateRange:i}=n,a=new Set,r=await _d(s),o=fr(r,i);pd(o);const l=yd(),c=bd(r,l.column);xb(),t.innerHTML="",wd(t,c,i,a)}async function kd(){await fd({reportName:"loadDailyReport",tbodyId:"daily-report-tbody",theadId:"daily-report-thead",managerFilterId:"daily-manager-filter",fetchData:kb,getRange:t=>t.dateRange,calculateStatus:fr,updateStatusCards:pd,applyFilters:_d,sortClients:bd,getSortState:yd,renderHeader:(t,e,n)=>Ab(t,e.dateRange,e.holidays,n),renderBody:(t,e,n)=>wd(t,e,n.dateRange,n.holidays),filterTable:ri,setWindowCache:t=>{window.dailyReportDataCache={clients:t.clients,dateRange:t.dateRange}},emptyMessage:" ",errorMessage:"    ."})}async function Mb(t){const e=await yb(t);if(!(e!=null&&e.length))return null;const n=[...new Set(e.map(r=>r.week_start))];n.sort((r,o)=>new Date(o).getTime()-new Date(r).getTime());const s=n.slice(0,8);if(s.length===0)return null;const i=new Map;for(const r of e){const o=s.indexOf(r.week_start);if(o===-1)continue;const l=r.client_id;i.has(l)||i.set(l,{client_id:l,client_name:r.client_name??"",manager_id:r.manager_id??null,weeklyAmounts:new Map}),i.get(l).weeklyAmounts.set(o,r.weekly_amount??0)}const a=Array.from(i.values()).map(r=>{const o=r.weeklyAmounts.get(0)??0,l=r.weeklyAmounts.get(1)??0,c=o-l;let d,u;l>0?(u=o/l*100-100,d=u.toFixed(1)):o>0?(u=1/0,d=""):(u=0,d="0.0");const h=[];for(let m=1;m<s.length;m++){const _=r.weeklyAmounts.get(m)??0;_>0&&h.push(_)}const f=h.length>0?h.reduce((m,_)=>m+_,0)/h.length:0;let p,g;return f>0?(g=o/f*100-100,p=g.toFixed(1)):o>0?(g=1/0,p=""):(g=0,p="0.0"),{...r,mostRecentWeekAmount:o,changeAmount:c,weekCompareRatio:d,weekCompareValue:u,avgRatio:p,avgValue:g}});return a.sort((r,o)=>(o.mostRecentWeekAmount??0)-(r.mostRecentWeekAmount??0)),{clients:a,weeks:s}}async function Tb(){const t=T();return t?Mb(t):null}function gr(t,e){const i={active:{currentWeek:[],previousWeek:[]},new:{clients:[],totalAmount:0},stopped:{clients:[],totalAmount:0},rising:{clients:[],totalAmount:0},falling:{clients:[],totalAmount:0}};for(const a of t){const r=a.weeklyAmounts.get(0)??0,o=a.weeklyAmounts.get(1)??0;r>0&&i.active.currentWeek.push(a),o>0&&i.active.previousWeek.push(a),o===0&&r>0?(i.new.clients.push(a),i.new.totalAmount+=r):o>0&&r===0?(i.stopped.clients.push(a),i.stopped.totalAmount+=o):r>0&&o>0&&r-o>0?(i.rising.clients.push(a),i.rising.totalAmount+=r-o):r>0&&o>0&&r-o<0&&(i.falling.clients.push(a),i.falling.totalAmount+=o-r)}return i}function Sd(t){const e=t.active.previousWeek.length,n=t.active.currentWeek.length,s=A("weekly-summary-active-count");s&&(s.textContent=`${e}  ${n}`);const i=A("weekly-summary-new-count"),a=A("weekly-summary-new-amount");i&&(i.textContent=String(t.new.clients.length)),a&&(a.textContent=t.new.totalAmount.toLocaleString("ko-KR"));const r=A("weekly-summary-stopped-count"),o=A("weekly-summary-stopped-amount");r&&(r.textContent=String(t.stopped.clients.length)),o&&(o.textContent=t.stopped.totalAmount.toLocaleString("ko-KR"));const l=A("weekly-summary-rising-count"),c=A("weekly-summary-rising-amount");l&&(l.textContent=String(t.rising.clients.length)),c&&(c.textContent=t.rising.totalAmount.toLocaleString("ko-KR"));const d=A("weekly-summary-falling-count"),u=A("weekly-summary-falling-amount");d&&(d.textContent=String(t.falling.clients.length)),u&&(u.textContent=t.falling.totalAmount.toLocaleString("ko-KR"))}async function xd(t){const e=A("weekly-search-input"),n=A("weekly-manager-filter"),s=A("weekly-status-filter");let i=[...t];if(s!=null&&s.value){const a=gr(t),r=s.value;r==="active"?i=a.active.currentWeek:r==="new"?i=a.new.clients:r==="stopped"?i=a.stopped.clients:r==="rising"?i=a.rising.clients:r==="falling"&&(i=a.falling.clients)}if(e!=null&&e.value.trim()&&(i=md(i,e.value.trim(),a=>`${a.client_id} ${$t(a.client_name)}`)),n!=null&&n.value){const a=T();if(!a)return i;try{const r=await hd(a,n.value);r.size>0?i=i.filter(o=>r.has(o.client_id)):i=[]}catch(r){console.error("   :",r)}}return i}const Se={column:"changeAmount",order:"asc"};function Cd(){return{...Se}}function Ed(t,e){if(!Se.order)return[...t].sort((i,a)=>(a.mostRecentWeekAmount??0)-(i.mostRecentWeekAmount??0));const n=[...t],s=Se.order;return n.sort((i,a)=>{let r,o;switch(e){case"client_id":r=i.client_id,o=a.client_id;break;case"client_name":r=i.client_name,o=a.client_name;break;case"avgValue":r=i.avgValue===1/0?Number.MAX_VALUE:i.avgValue??0,o=a.avgValue===1/0?Number.MAX_VALUE:a.avgValue??0;break;case"weekCompareValue":r=i.weekCompareValue===1/0?Number.MAX_VALUE:i.weekCompareValue??0,o=a.weekCompareValue===1/0?Number.MAX_VALUE:a.weekCompareValue??0;break;case"changeAmount":r=i.changeAmount??0,o=a.changeAmount??0;break;case"mostRecentWeekAmount":r=i.mostRecentWeekAmount??0,o=a.mostRecentWeekAmount??0;break;default:{const l=parseInt(e,10);if(!isNaN(l))r=i.weeklyAmounts.get(l)??0,o=a.weeklyAmounts.get(l)??0;else return 0}}return s==="asc"?typeof r=="string"?r.localeCompare(String(o)):r-o:typeof r=="string"?String(o).localeCompare(r):o-r}),n}function Rb(t){Se.column===t?Se.order==="asc"?Se.order="desc":Se.order==="desc"?Se.order=null:Se.order="asc":(Se.column=t,Se.order="asc")}function Ad(t,e){const n=t.querySelector(".sort-icon");if(n&&n.remove(),Se.column===e&&Se.order){const s=document.createElement("span");s.className="sort-icon",s.style.marginLeft="4px",s.style.fontSize="10px",s.textContent=Se.order==="asc"?"":"",t.appendChild(s)}}function Db(){const t=A("weekly-report-thead");t&&t.querySelectorAll("th[data-column]").forEach(e=>{const n=e.dataset.column;n&&Ad(e,n)})}function Ml(t,e,n,s){t.textContent=n,t.style.textAlign="center",t.style.cursor="pointer",t.style.userSelect="none",t.dataset.column=e,Ad(t,e),t.addEventListener("click",()=>{Rb(e),s()})}function Ib(t,e){const n=document.createElement("tr");n.className="summary-row";const s=new Map;e.forEach((_,y)=>s.set(y,0)),t.forEach(_=>{e.forEach((y,b)=>{s.set(b,(s.get(b)??0)+(_.weeklyAmounts.get(b)??0))})});const i=s.get(0)??0,a=s.get(1)??0;let r,o;a>0?(o=i/a*100-100,r=o.toFixed(1)):i>0?(o=1/0,r=""):(o=0,r="0.0");const l=[];for(let _=1;_<e.length;_++){const y=s.get(_)??0;y>0&&l.push(y)}const c=l.length>0?l.reduce((_,y)=>_+y,0)/l.length:0;let d,u;c>0?(u=i/c*100-100,d=u.toFixed(1)):i>0?(u=1/0,d=""):(u=0,d="0.0");const h=(_,y,b)=>{const v=document.createElement("td");v.textContent=_,v.style.textAlign=y,b&&Object.assign(v.style,b),n.appendChild(v)};h("","center"),h("","center",{fontWeight:"600"}),h(`${d}%`,"center");const f=n.lastElementChild;typeof u=="number"&&!isNaN(u)&&isFinite(u)&&(u<0?f.style.color="#3b82f6":u>0&&(f.style.color="#ef4444")),h(`${r}%`,"center");const p=n.lastElementChild;typeof o=="number"&&!isNaN(o)&&isFinite(o)&&(o<0?p.style.color="#3b82f6":o>0&&(p.style.color="#ef4444"));const g=i-a;h(g.toLocaleString("ko-KR"),"right",{fontWeight:"600"});const m=n.lastElementChild;return g<0?m.style.color="#3b82f6":g>0&&(m.style.color="#ef4444"),e.forEach((_,y)=>{const b=document.createElement("td");b.textContent=(s.get(y)??0).toLocaleString("ko-KR"),b.style.textAlign="right",b.style.fontWeight="600",y===0&&(b.style.backgroundColor="#fef9e7"),n.appendChild(b)}),n}function Lb(t,e,n){t.innerHTML="";const s=[["client_id","Client ID"],["client_name","Client"],["avgValue"," "],["weekCompareValue"," "],["changeAmount",""]];for(const[i,a]of s){const r=document.createElement("th");Ml(r,i,a,n),t.appendChild(r)}e.forEach((i,a)=>{const r=document.createElement("th"),o=a===0?"":`${a+1} `;Ml(r,String(a),o,n),t.appendChild(r)})}function Md(t,e,n){if(t.innerHTML="",e.length===0){t.innerHTML=`<tr><td colspan="${5+n.length}" class="empty-state">  </td></tr>`;return}t.appendChild(Ib(e,n));for(const s of e){const i=document.createElement("tr"),a=document.createElement("td");a.textContent=String(s.client_id),a.style.textAlign="center",i.appendChild(a);const r=document.createElement("td");r.textContent=$t(s.client_name),r.style.textAlign="center",r.style.maxWidth="350px",r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.style.whiteSpace="nowrap",i.appendChild(r);const o=document.createElement("td");o.textContent=`${s.avgRatio??""}%`,o.style.textAlign="center";const l=s.avgValue;typeof l=="number"&&!isNaN(l)&&isFinite(l)&&(l<0?o.style.color="#3b82f6":l>0&&(o.style.color="#ef4444")),i.appendChild(o);const c=document.createElement("td");c.textContent=`${s.weekCompareRatio??""}%`,c.style.textAlign="center";const d=s.weekCompareValue;typeof d=="number"&&!isNaN(d)&&isFinite(d)&&(d<0?c.style.color="#3b82f6":d>0&&(c.style.color="#ef4444")),i.appendChild(c);const u=document.createElement("td");u.textContent=(s.changeAmount??0).toLocaleString("ko-KR"),u.style.textAlign="right";const h=s.changeAmount??0;h<0?u.style.color="#3b82f6":h>0&&(u.style.color="#ef4444"),i.appendChild(u),n.forEach((f,p)=>{const g=document.createElement("td"),m=s.weeklyAmounts.get(p)??0;if(g.textContent=m.toLocaleString("ko-KR"),g.style.textAlign="right",p===0&&(g.style.backgroundColor="#fef9e7"),p>=0&&p<n.length-1){const _=s.weeklyAmounts.get(p+1)??0;_>0&&(m>_?g.style.color="#ef4444":m<_&&(g.style.color="#3b82f6"))}i.appendChild(g)}),t.appendChild(i)}}async function oi(){const t=A("weekly-report-tbody"),e=A("weekly-report-thead");if(!t||!e)return;const n=window.weeklyReportDataCache;if(!(n!=null&&n.clients)){await Td();return}const{clients:s,weeks:i}=n,a=await xd(s),r=Cd(),o=Ed(a,r.column),l=gr(o);Sd(l),Db(),t.innerHTML="",Md(t,o,i)}async function Td(){await fd({reportName:"loadWeeklyReport",tbodyId:"weekly-report-tbody",theadId:"weekly-report-thead",managerFilterId:"weekly-manager-filter",activeTabId:"weekly-tab",fetchData:Tb,getRange:t=>t.weeks,calculateStatus:gr,updateStatusCards:Sd,applyFilters:xd,sortClients:Ed,getSortState:Cd,renderHeader:(t,e,n)=>Lb(t,e.weeks,n),renderBody:(t,e,n)=>Md(t,e,n.weeks),filterTable:oi,setWindowCache:t=>{window.weeklyReportDataCache={clients:t.clients,weeks:t.weeks}},emptyMessage:"  ",errorMessage:"    .",emptyColspan:6})}function Ob(){const t=document.getElementById("daily-search-input"),e=A("daily-search-clear"),n=document.getElementById("daily-manager-filter");let s=null;t&&(t.addEventListener("input",function(){e&&(e.style.display=this.value.trim()?"block":"none"),s&&clearTimeout(s),s=setTimeout(()=>void ri(),300)}),e&&e.addEventListener("click",()=>{t.value="",e.style.display="none",ri()})),n&&n.addEventListener("change",()=>void ri())}function Pb(){const t=document.getElementById("weekly-search-input"),e=A("weekly-search-clear"),n=document.getElementById("weekly-manager-filter");let s=null;t&&(t.addEventListener("input",function(){e&&(e.style.display=this.value.trim()?"block":"none"),s&&clearTimeout(s),s=setTimeout(()=>void oi(),300)}),e&&e.addEventListener("click",()=>{t.value="",e.style.display="none",oi()})),n&&n.addEventListener("change",()=>void oi())}async function $b(){const t=T();if(!t)return[];const{data:e,error:n}=await t.from("shared_manager").select("id, manager_name").eq("manager_team","ads").neq("id",98).neq("id",99).order("id",{ascending:!0});return n?(console.error("   :",n),[]):e??[]}async function Nb(t,e,n){const s=T();if(!s)return[];const{data:i,error:a}=await s.from("ads_data_goal").select("start_date, goal_revenue").is("manager_id",null).eq("period_type","monthly").gte("start_date",e).lte("start_date",n).order("start_date",{ascending:!0});return a?(console.error("   :",a),[]):i??[]}async function Bb(t,e,n){const s=T();if(!s||!t.length)return[];const{data:i,error:a}=await s.from("ads_data_goal").select("manager_id, start_date, goal_revenue").in("manager_id",t).eq("period_type","monthly").gte("start_date",e).lte("start_date",n).order("start_date",{ascending:!0});return a?(console.error("    :",a),[]):i??[]}async function jb(t){const e=T();if(!e||!t.length)return[];const{data:n,error:s}=await e.from("ads_data_goal_targetclient").select("goal_id, client_id").in("goal_id",t);return s?(console.error("   :",s),[]):n??[]}async function Fb(t){const e=T(),n=new Map;if(!e||!t.length)return n;const s=t.map(r=>String(r)),{data:i,error:a}=await e.from("ads_data_client").select("client_id, client_name").in("client_id",s);if(a||!i)return n;for(const r of i)n.set(r.client_id,r.client_name??"");return n}async function Wb(t){const e=T();if(!e||!t.length)return[];const{data:n,error:s}=await e.from("ads_data_goal_actionitem").select("goal_id, id, action_item, status, done_memo").in("goal_id",t).order("id",{ascending:!0});if(s)return[];const i=n??[],a=new Map;for(const r of i)a.has(r.goal_id)||a.set(r.goal_id,[]),a.get(r.goal_id).push({id:r.id,action_item:r.action_item,status:r.status,done_memo:r.done_memo??null});return t.map(r=>({goalId:r,items:a.get(r)??[]}))}async function Gb(t,e,n){const s=T();if(!s||!t.length)return 0;const i=t.map(o=>String(o)),{data:a,error:r}=await s.from("ads_data_daily").select("amount").in("client_id",i).gte("date",e).lte("date",n);return r?0:(a==null?void 0:a.reduce((o,l)=>o+(l.amount??0),0))??0}async function G0(){if(!T()){Nt(new Error("Supabase   ."),"loadGoalSetting");return}const e=A("goal-setting-tbody"),n=A("goal-setting-thead");if(!e||!n){console.error("Goal Setting     .");return}e.innerHTML='<tr><td colspan="100" class="empty-state">  ...</td></tr>';try{const s=await $b(),i=await Nb(2026,"2026-01-01","2026-12-31"),a=s.map(d=>d.id),r=await Bb(a,"2026-01-01","2026-12-31"),o=new Map;for(const d of i){const u=new Date(d.start_date),h=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}`;o.set(h,d.goal_revenue??0)}const l=new Map;for(const d of r){const u=new Date(d.start_date),h=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}`;l.set(`${d.manager_id}-${h}`,d.goal_revenue??0)}const c=n.querySelector("tr");if(c){c.innerHTML="";const d=["","Team","Total","Gap"];for(const u of d){const h=document.createElement("th");h.textContent=u,h.style.textAlign="center",c.appendChild(h)}for(const u of s){const h=document.createElement("th");h.textContent=u.manager_name??`Manager ${u.id}`,h.style.textAlign="center",h.style.fontFamily="'Roboto Mono', monospace",c.appendChild(h)}}e.innerHTML="";for(let d=1;d<=12;d++){const u=`2026-${String(d).padStart(2,"0")}`,h=`2026 ${String(d).padStart(2,"0")}`,f=o.get(u)??0,p=document.createElement("tr");p.dataset.monthKey=u;const g=document.createElement("td");g.textContent=h,g.style.textAlign="center",g.style.fontFamily="'Roboto Mono', monospace",p.appendChild(g);const m=document.createElement("td");m.textContent=f>0?L(f):"",m.style.fontFamily="'Roboto Mono', monospace",m.style.textAlign="right",m.className="readonly-cell",p.appendChild(m);const _=document.createElement("td");_.className="total-cell readonly-cell",_.style.fontFamily="'Roboto Mono', monospace",_.style.textAlign="right",p.appendChild(_);const y=document.createElement("td");y.className="gap-cell readonly-cell",y.style.fontFamily="'Roboto Mono', monospace",y.style.textAlign="right",p.appendChild(y);let b=0;for(const w of s){const k=`${w.id}-${u}`,S=l.get(k)??0;b+=S;const x=document.createElement("td");x.textContent=S>0?L(S):"",x.style.fontFamily="'Roboto Mono', monospace",x.style.textAlign="right",x.className="editable-cell",x.dataset.managerId=String(w.id),x.dataset.monthKey=u,p.appendChild(x)}_.textContent=b>0?L(b):"",s.filter(w=>{const k=`${w.id}-${u}`;return(l.get(k)??0)>0}).length===s.length&&s.length>0?y.textContent=b-f!==0?L(b-f):"":y.textContent="",e.appendChild(p)}}catch(s){Nt(s,"loadGoalSetting","    ."),e.innerHTML='<tr><td colspan="100" class="empty-state">    : '+s.message+"</td></tr>"}return e}async function Bi(t,e=!1,n=[]){if(!(t!=null&&t.length)||!T())return t;const i=he(new Date),a=`goal_revenue_updated_${i}`,r=JSON.parse(localStorage.getItem(a)??"[]"),o=new Set(n),l=e?new Set:new Set(r),c=t.map(u=>u.id),d=e?t:t.filter(u=>!l.has(u.id)||o.has(u.id));try{const u=await jb(c),h=new Map,f=new Set;for(const v of u)h.has(v.goal_id)||h.set(v.goal_id,[]),h.get(v.goal_id).push(v.client_id),f.add(v.client_id);const p=await Fb(Array.from(f)),g=new Map;p.forEach((v,w)=>{g.set(w,nd(v??""))});const m=await Wb(c),_=new Map,y=new Map;for(const{goalId:v,items:w}of m)_.set(v,w.length),y.set(v,w);const b=await Promise.all(t.map(async v=>{const w=h.get(v.id)??[],k=[];for(let G=0;G<Math.min(w.length,3);G++){const N=g.get(w[G]);N&&k.push(N)}const S=_.get(v.id)??0,x=y.get(v.id)??[];if(!e&&l.has(v.id)&&!o.has(v.id)){const G=`goal_revenue_${v.id}_${i}`,N=localStorage.getItem(G);if(N)try{const ee=JSON.parse(N);return{...v,currentRevenue:ee.currentRevenue??0,achievementRate:ee.achievementRate??0,growthRate:ee.growthRate??0,actionItemCount:ee.actionItemCount??0,actionItems:x,targetClientsInfo:{clientNames:k,totalCount:w.length}}}catch{}}if(w.length===0){const G={...v,currentRevenue:0,achievementRate:0,growthRate:0,actionItemCount:S,actionItems:x,targetClientsInfo:{clientNames:[],totalCount:0}};return d.includes(v)&&(localStorage.setItem(`goal_revenue_${v.id}_${i}`,JSON.stringify({currentRevenue:0,achievementRate:0,growthRate:0,actionItemCount:0})),r.push(v.id)),G}const E=v.end_date&&new Date(v.end_date)<=new Date(i)?v.end_date:i,D=await Gb(w,v.start_date,E),O=v.goal_revenue??0,$=v.start_revenue??0,Z=O>0?D/O*100:0,oe=$>0?(O-$)/$*100:0,U={...v,currentRevenue:D,achievementRate:Z,growthRate:oe,actionItemCount:S,actionItems:x,targetClientsInfo:{clientNames:k,totalCount:w.length}};return d.includes(v)&&(localStorage.setItem(`goal_revenue_${v.id}_${i}`,JSON.stringify({currentRevenue:D,achievementRate:Z,growthRate:oe,actionItemCount:S,actionItems:x})),r.push(v.id)),U}));return d.length>0&&localStorage.setItem(a,JSON.stringify(r)),b}catch(u){return console.error("   :",u),t}}const rt={currentManagerTabId:null,datePickerState:{currentDate:new Date,selectedDate:null,targetInputId:null},weekNavigationState:{weeksOffset:0,nextWeekOffset:0,loadedRange:{startOffset:-2,endOffset:2}},allWeeksData:null,currentContentArea:null,currentShowSummary:!1};function Hb(){window.weeklyGoalState=rt}function Rd(t){rt.currentManagerTabId=t}function H0(t){const e=new Map;t.forEach(s=>{const i=new Date(s.start_date),a=Dd(i);e.has(a)||e.set(a,{weekKey:a,startDate:i,goals:[]}),e.get(a).goals.push(s)});const n=Array.from(e.values()).sort((s,i)=>s.startDate.getTime()-i.startDate.getTime());return n.forEach(s=>{s.goals.sort((i,a)=>{const r=Fe[i.goal_category]??999,o=Fe[a.goal_category]??999;return r-o})}),n}function U0(t){if(t.length===0)return[];const e=new Date;e.setHours(0,0,0,0);const n=e.getDay(),s=e.getDate()-n+(n===0?-6:1),i=new Date(e);i.setDate(s),i.setHours(0,0,0,0);let a=-1,r=1/0;t.forEach((c,d)=>{const u=new Date(c.startDate);u.setHours(0,0,0,0);const h=Math.abs(u.getTime()-i.getTime());h<r&&(r=h,a=d)}),a===-1&&(a=0);const o=Math.max(0,a-1),l=Math.min(t.length,o+3);return t.slice(o,l)}function q0(t,e){if(!t||t.length===0)return{weeks:[],layout:"3col",columnConfig:{col1:" ",col2:" ",col3:" "}};const n=new Date;n.setHours(0,0,0,0);const s=n.getDay(),i=n.getDate()-s+(s===0?-6:1),a=new Date(n);a.setDate(i),a.setHours(0,0,0,0);let r=-1;if(t.forEach((m,_)=>{const y=new Date(m.startDate);y.setHours(0,0,0,0),y.getTime()===a.getTime()&&(r=_)}),r===-1)return{weeks:t.slice(0,Math.min(3,t.length)),layout:"3col",columnConfig:{col1:"1",col2:"2",col3:"3"}};const{weeksOffset:o}=e,l=m=>t.find(y=>{const b=new Date(y.startDate);return b.setHours(0,0,0,0),b.getTime()===m.getTime()})??{startDate:m,goals:[],weekKey:""},c=new Date(a);c.setDate(c.getDate()+o*7),c.setHours(0,0,0,0);const d=new Date(c);d.setDate(d.getDate()-7),d.setHours(0,0,0,0);const u=new Date(c);u.setDate(u.getDate()+7),u.setHours(0,0,0,0);const h=l(d),f=l(c),p=l(u),g=m=>m===0?" ":m===-1?" ":m===1?" ":m<-1?`${Math.abs(m)} `:`${m} `;return{weeks:[h,f,p],layout:"3col",columnConfig:{col1:g(o-1),col2:g(o),col3:g(o+1)}}}async function V0(t,e,n,s){if(!e||!s())return;const{weeksOffset:a,nextWeekOffset:r,loadedRange:o}=n,l=new Date;l.setHours(0,0,0,0);const c=l.getDay(),d=l.getDate()-c+(c===0?-6:1),u=new Date(l);u.setDate(d),u.setHours(0,0,0,0);const h=a,f=a+r;t==="prev"&&h<o.startOffset?n.loadedRange.startOffset=h:t==="next"&&f>o.endOffset&&(n.loadedRange.endOffset=f)}function Dd(t){const e=new Date(t);e.setHours(0,0,0,0);const n=e.getDay(),s=e.getDate()-n+(n===0?-6:1),i=new Date(e);i.setDate(s);const a=i.getFullYear(),r=new Date(a,0,1),o=Math.floor((i.getTime()-r.getTime())/(24*60*60*1e3)),l=Math.ceil((o+r.getDay()+1)/7);return`${a}-W${String(l).padStart(2,"0")}`}function Ub(t){const e=new Date(t),n=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${n}.${s}.${i} `}function qb(t){return t===0?" ":t===-1?" ":t===1?" ":t<-1?`${Math.abs(t)} `:`${t} `}function Vb(t){const n=zb(new Date),s=new Date(n);return s.setDate(n.getDate()+t*7),s.setHours(0,0,0,0),s}function Tl(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${s}`}function ki(t){const e=Vb(t),n=new Date(e);return n.setDate(e.getDate()+6),{week_id:Dd(e),start_date:Tl(e),end_date:Tl(n),week_label:Ub(e)}}function zb(t){const e=new Date(t);e.setHours(0,0,0,0);const n=e.getDay(),s=e.getDate()-n+(n===0?-6:1);return new Date(e.setDate(s))}async function Kb(t,e,n){const s=A("manager-tabs");if(!s)return;let i=await ad();i&&(i=i.filter(a=>a.id!==98&&a.id!==99),s.innerHTML="",i.length>0&&(i.forEach(a=>{const r=a.manager_name?a.manager_name.split(" ")[0]:`Manager ${a.id}`,o=document.createElement("button");o.className="manager-tab",o.dataset.managerId=String(a.id),o.textContent=r,o.addEventListener("click",()=>{o.classList.contains("active")?(o.classList.remove("active"),n.currentManagerTabId=null,t()):(document.querySelectorAll(".manager-tab").forEach(l=>l.classList.remove("active")),o.classList.add("active"),n.currentManagerTabId=a.id,e(a.id))}),s.appendChild(o)}),requestAnimationFrame(()=>{const a=s.querySelectorAll(".manager-tab");let r=0;a.forEach(o=>{const l=o.getBoundingClientRect().width;l>r&&(r=l)}),r>0&&a.forEach(o=>{o.style.minWidth=`${Math.ceil(r)}px`})}),t()))}const V={offset:0,currentWeekDate:new Date,loadedWeeks:new Map,maxOffset:1};function Ge(t){return{layout:"3-column",weeks:[{offset:t-1,width:"33%",isCurrentWeek:t-1===0},{offset:t,width:"33%",isCurrentWeek:t===0},{offset:t+1,width:"33%",isCurrentWeek:t+1===0}]}}function Yb(){return V.offset--,!0}function Jb(){return V.offset<V.maxOffset?(V.offset++,!0):!1}function Id(){V.offset=0,V.currentWeekDate=new Date,V.loadedWeeks.clear()}function pr(t,e){V.loadedWeeks.set(t,e)}function un(t){return V.loadedWeeks.get(t)??null}function Xb(t){const n=Ge(t).weeks,s=!0,i=n[0].offset,a=t<V.maxOffset,r=n[n.length-1].offset;return{showLeft:s,showRight:a,leftWeekOffset:i,rightWeekOffset:r}}function Qb(t){const e=document.createElement("div");return e.className=`WeekNavigation__layout ${t}`,e}function Zb(t,e,n){const s=document.createElement("div");s.className=`WeekNavigation__cardSlot WeekNavigation__cardSlot--${t.width.replace("%","pct")}`,s.setAttribute("data-week-offset",String(t.offset));const i=document.createElement("div");i.className=t.isCurrentWeek?"WeekHeader__root current-week":"WeekHeader__root",i.setAttribute("data-week-offset",String(t.offset));const a=Xb(e),o=Ge(e).weeks;if(t.offset===o[0].offset&&a.showLeft){const h=document.createElement("span");h.className="WeekHeader__navArrow",h.textContent="",h.setAttribute("data-direction","left"),i.appendChild(h)}else{const h=document.createElement("span");h.className="WeekHeader__navArrow WeekHeader__navArrow--hidden",h.textContent="",i.appendChild(h)}const c=document.createElement("span");if(c.className="WeekHeader__text",c.textContent=qb(t.offset),i.appendChild(c),n){const h=document.createElement("span");h.className="WeekHeader__cloneBtn",h.innerHTML='<i class="ri-file-copy-line"></i>',h.setAttribute("data-week-offset",String(t.offset)),h.title="   ",i.appendChild(h)}if(t.offset===o[o.length-1].offset&&a.showRight){const h=document.createElement("span");h.className="WeekHeader__navArrow",h.textContent="",h.setAttribute("data-direction","right"),i.appendChild(h)}else{const h=document.createElement("span");h.className="WeekHeader__navArrow WeekHeader__navArrow--hidden",h.textContent="",i.appendChild(h)}s.appendChild(i);const u=document.createElement("div");return u.className="WeekNavigation__cardContainer",u.setAttribute("data-week-offset",String(t.offset)),s.appendChild(u),s}function pn(t,e,n=!1){if(!t)return;t.innerHTML="";const s=Ge(e),i=Qb(s.layout);s.weeks.forEach(a=>{const r=Zb(a,e,n);i.appendChild(r)}),t.appendChild(i)}async function mr(t,e){const n=t.rpc;if(!n)return null;try{const{data:s,error:i}=await n("get_week_by_offset",{week_offset:e});if(i)return null;const a=s;return a&&a.length>0?a[0]:null}catch{return null}}function _r(t){return ki(t)}function Si(t){if(t==null)return"";const e=typeof t=="string"?new Date(t):t;if(Number.isNaN(e.getTime()))return"";const n=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${n}-${s}-${i}`}async function yr(t,e=-2,n=2){const s=T();if(!s)return new Map;if(!t)return new Map;const i=[];for(let h=e;h<=n;h++){const f=await mr(s,h)??_r(h);i.push({offset:h,week_id:f.week_id,startDate:f.start_date,endDate:f.end_date,week_label:f.week_label,weekData:{offset:h,goals:[],startDate:new Date(f.start_date),endDate:new Date(f.end_date),week_id:f.week_id,week_label:f.week_label}})}const a=i[0].startDate,r=i[i.length-1].endDate,{data:o,error:l}=await s.from("ads_data_goal").select("id, manager_id, period_type, start_date, end_date, goal_category, memo, start_revenue, goal_revenue, activate, created_at, updated_at").eq("manager_id",t).eq("period_type","weekly").eq("activate",!0).gte("start_date",a).lte("start_date",r).order("start_date",{ascending:!0});if(l)return B("[loadWeeklyGoals] ads_data_goal  :",l.message),new Map;const c=o??[];let d=[];c.length>0&&(d=await Bi(c)),B("[loadWeeklyGoals] managerId:",t,"  :",c.length,"",d.length);const u=new Map;return i.forEach(({offset:h,weekData:f})=>{u.set(h,f)}),d.forEach(h=>{const f=Si(h.start_date),p=Si(h.end_date);for(const{offset:g,startDate:m,endDate:_,weekData:y}of i)if(f===m&&p===_){const b=u.get(g);b&&!b.goals.some(v=>v.id===h.id)&&b.goals.push(h);break}}),u.forEach(h=>{B("[loadWeeklyGoals] offset",h.offset," :",h.goals.length),h.goals.sort((f,p)=>{const g=Fe[f.goal_category]??999,m=Fe[p.goal_category]??999;return g-m}),pr(h.offset,h)}),u}async function ys(t=-2,e=2){const n=T();if(!n)return new Map;const{data:s,error:i}=await n.from("shared_manager").select("id, manager_name, manager_team").eq("manager_team","ads").order("id",{ascending:!0});if(i||!(s!=null&&s.length))return B("[loadAllManagersWeeklyGoals]   (manager_team=ads)",i==null?void 0:i.message),new Map;const r=s.filter(g=>g.id!==98&&g.id!==99).map(g=>g.id);if(r.length===0)return new Map;B("[loadAllManagersWeeklyGoals]  :",r.length,"ids:",r);const o=[];for(let g=t;g<=e;g++){const m=await mr(n,g)??_r(g);o.push({offset:g,week_id:m.week_id,startDate:m.start_date,endDate:m.end_date,week_label:m.week_label,weekData:{offset:g,goals:[],startDate:new Date(m.start_date),endDate:new Date(m.end_date),week_id:m.week_id,week_label:m.week_label}})}const l=o[0].startDate,c=o[o.length-1].endDate,{data:d,error:u}=await n.from("ads_data_goal").select("id, manager_id, period_type, start_date, end_date, goal_category, memo, start_revenue, goal_revenue, activate, created_at, updated_at").in("manager_id",r).eq("period_type","weekly").eq("activate",!0).gte("start_date",l).lte("start_date",c).order("start_date",{ascending:!0});if(u)return B("[loadAllManagersWeeklyGoals] ads_data_goal  :",u.message),new Map;const h=d??[];let f=[];h.length>0&&(f=await Bi(h)),B("[loadAllManagersWeeklyGoals]   :",h.length," revenue  :",f.length);const p=new Map;return o.forEach(({offset:g,weekData:m})=>p.set(g,m)),f.forEach(g=>{const m=Si(g.start_date),_=Si(g.end_date);for(const{offset:y,startDate:b,endDate:v}of o)if(m===b&&_===v){const w=p.get(y);w&&w.goals.push(g);break}}),p.forEach(g=>{B("[loadAllManagersWeeklyGoals] offset",g.offset," :",g.goals.length),g.goals.sort((m,_)=>{const y=Fe[m.goal_category]??999,b=Fe[_.goal_category]??999;return y-b}),pr(g.offset,g)}),p}async function Ld(t,e){const n=T();if(!n||!t)return{offset:e,goals:[],startDate:new Date};const s=await mr(n,e)??_r(e),{data:i,error:a}=await n.from("ads_data_goal").select("id, manager_id, period_type, start_date, end_date, goal_category, memo, start_revenue, goal_revenue, activate, created_at, updated_at").eq("manager_id",t).eq("period_type","weekly").eq("activate",!0).eq("start_date",s.start_date).eq("end_date",s.end_date).order("goal_category",{ascending:!0});if(a)return{offset:e,goals:[],startDate:new Date(s.start_date)};const r=i??[];let o=[];r.length>0&&(o=await Bi(r));const l=o.sort((d,u)=>{const h=Fe[d.goal_category]??999,f=Fe[u.goal_category]??999;return h-f}),c={offset:e,goals:l,startDate:new Date(s.start_date),endDate:new Date(s.end_date),week_id:s.week_id,week_label:s.week_label};return pr(e,c),c}async function ev(t,e){const n=un(t);if(!n||!n.goals||n.goals.length===0){Y("  ");return}const s=document.querySelector(".week-clone-modal");s&&s.remove();const i=tv(n.goals,t);document.body.appendChild(i),i.style.display="flex",sv(i,n.goals,t,e)}function tv(t,e){const n=document.createElement("div");n.className="week-clone-modal";const s=ki(e),i=`${Us(s.start_date)} ~ ${Us(s.end_date)}`,a=e+1,r=ki(a),o=`${Us(r.start_date)} ~ ${Us(r.end_date)} /  `,l=t.map((c,d)=>{const u=c.goal_category||"etc",h=dn[u]??u,f=c.memo||"( )",p=c.goal_revenue?`${L(c.goal_revenue)}`:"-";return`
      <label class="week-clone-modal__goal-item" data-goal-id="${c.id}">
        <input type="checkbox" class="week-clone-modal__goal-check" data-index="${d}" checked />
        <span class="goal-category-badge goal-category-${u}" style="font-size:11px;">${h}</span>
        <span class="week-clone-modal__goal-memo">${nv(f)}</span>
        <span class="week-clone-modal__goal-revenue">${p}</span>
      </label>
    `}).join("");return n.innerHTML=`
    <div class="week-clone-modal__overlay"></div>
    <div class="week-clone-modal__container">
      <div class="week-clone-modal__header">
        <h2 class="week-clone-modal__title">
          <i class="ri-file-copy-line"></i>  
        </h2>
        <button class="week-clone-modal__close-btn">
          <i class="ri-close-line"></i>
        </button>
      </div>
      <div class="week-clone-modal__body">
        <div class="week-clone-modal__info-row">
          <span class="week-clone-modal__info-label"></span>
          <span class="week-clone-modal__info-value">${i}</span>
        </div>
        <div class="week-clone-modal__info-row">
          <span class="week-clone-modal__info-label"></span>
          <span class="week-clone-modal__info-value">${o}</span>
          <input type="hidden" class="week-clone-modal__target-select" value="${a}" />
        </div>

        <div class="week-clone-modal__divider"></div>

        <div class="week-clone-modal__section-title">
            
          <button class="week-clone-modal__select-all-btn"> /</button>
        </div>
        <div class="week-clone-modal__goal-list">
          ${l}
        </div>

        <div class="week-clone-modal__divider"></div>

        <div class="week-clone-modal__section-title"></div>
        <div class="week-clone-modal__options">
          <label class="week-clone-modal__option">
            <input type="checkbox" id="clone-opt-clients" checked />
            <span>( ) </span>
          </label>
          <label class="week-clone-modal__option">
            <input type="checkbox" id="clone-opt-revenue" />
            <span>   </span>
          </label>
          <label class="week-clone-modal__option">
            <input type="checkbox" id="clone-opt-actions" />
            <span>   <small>( )</small></span>
          </label>
        </div>
      </div>
      <div class="week-clone-modal__footer">
        <button class="week-clone-modal__cancel-btn"></button>
        <button class="week-clone-modal__submit-btn">
          <i class="ri-file-copy-line"></i> 
        </button>
      </div>
    </div>
  `,n}function Us(t){const e=new Date(t),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${n}.${s}`}function nv(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function sv(t,e,n,s){const i=t.querySelector(".week-clone-modal__close-btn"),a=t.querySelector(".week-clone-modal__overlay"),r=t.querySelector(".week-clone-modal__cancel-btn"),o=t.querySelector(".week-clone-modal__submit-btn"),l=t.querySelector(".week-clone-modal__select-all-btn"),c=()=>{t.style.display="none",setTimeout(()=>t.remove(),200)};i==null||i.addEventListener("click",c),a==null||a.addEventListener("click",c),r==null||r.addEventListener("click",c),l==null||l.addEventListener("click",()=>{const u=t.querySelectorAll(".week-clone-modal__goal-check"),h=Array.from(u).every(f=>f.checked);u.forEach(f=>f.checked=!h)}),o==null||o.addEventListener("click",async()=>{var y,b,v;const u=t.querySelectorAll(".week-clone-modal__goal-check"),h=Array.from(u).filter(w=>w.checked).map(w=>parseInt(w.getAttribute("data-index")??"-1",10)).filter(w=>w>=0);if(h.length===0){Y("  ");return}const f=t.querySelector(".week-clone-modal__target-select"),p=parseInt(f.value,10),g=ki(p),m={includeClients:((y=t.querySelector("#clone-opt-clients"))==null?void 0:y.checked)??!0,includeActionItems:((b=t.querySelector("#clone-opt-actions"))==null?void 0:b.checked)??!1,keepGoalRevenue:((v=t.querySelector("#clone-opt-revenue"))==null?void 0:v.checked)??!0},_=h.map(w=>e[w]).filter(Boolean);o.disabled=!0,o.textContent=" ...";try{await iv(_,s,g,m),Y(`${_.length}  `),c(),window.dispatchEvent(new CustomEvent("week-goals-cloned",{detail:{managerId:s,targetOffset:p}}))}catch(w){console.error("[weekClone]  :",w),Y("   "),o.disabled=!1,o.innerHTML='<i class="ri-file-copy-line"></i> '}});const d=u=>{u.key==="Escape"&&(c(),document.removeEventListener("keydown",d))};document.addEventListener("keydown",d)}async function iv(t,e,n,s){const i=T();if(!i)throw new Error("Supabase  ");for(const a of t)await av(i,a,e,n,s)}async function av(t,e,n,s,i){var c;const a={manager_id:n,period_type:"weekly",start_date:s.start_date,end_date:s.end_date,goal_category:e.goal_category||"etc",memo:e.memo||null,goal_revenue:i.keepGoalRevenue?e.goal_revenue??0:0,start_revenue:0,activate:!0},r=await t.from("ads_data_goal").insert(a).select("id").single();if(r.error||!r.data)throw new Error(`  : ${((c=r.error)==null?void 0:c.message)??"unknown"}`);const o=r.data.id;let l=[];if(i.includeClients){const d=await t.from("ads_data_goal_targetclient").select("client_id").eq("goal_id",e.id);if(d.data&&d.data.length>0){l=d.data.map(f=>String(f.client_id));const u=l.map(f=>({goal_id:o,client_id:f})),h=await t.from("ads_data_goal_targetclient").insert(u);h.error&&console.error("[weekClone]   :",h.error)}}if(i.includeActionItems){const d=await t.from("ads_data_goal_actionitem").select("action_item").eq("goal_id",e.id);if(d.data&&d.data.length>0){const u=d.data.map(f=>({goal_id:o,action_item:f.action_item,status:"progress"})),h=await t.from("ads_data_goal_actionitem").insert(u);h.error&&console.error("[weekClone]    :",h.error)}}l.length>0&&await rv(t,o,s.start_date,l)}async function rv(t,e,n,s){var i;try{const a=new Date(n),r=new Date(a);r.setDate(a.getDate()-7);const o=new Date(a);o.setDate(a.getDate()-1);const l=he(r),c=he(o),u=await t.from("ads_data_daily").select("amount").in("client_id",s).gte("date",l).lte("date",c);if(u.error){console.error("[weekClone] start_revenue  :",u.error);return}const h=((i=u.data)==null?void 0:i.reduce((f,p)=>f+(p.amount??0),0))??0;await t.from("ads_data_goal").update({start_revenue:h}).eq("id",e)}catch(a){console.error("[weekClone] start_revenue  :",a)}}function Od(t,e){const n=t.status??"progress",s=Ve[n]??Ve.progress,i=t.done_memo??"",a=n!=="progress"&&!!i;return`
        <div class="GoalCard__action-item" data-action-item-id="${t.id}" data-status="${n}" data-goal-id="${e}">
      <i class="${s.icon} action-item-icon" style="color: ${s.color}; cursor: pointer;"></i>
      <div class="GoalDetailModal__actionContent">
        <span class="GoalDetailModal__actionText">${t.action_item??""}</span>
        ${a?`<div class="GoalDetailModal__actionMemoDisplay" style="font-size: 11px; color: var(--text-muted); margin-top: 4px;"><i class="ri-sticky-note-line"></i> ${i}</div>`:""}
      </div>
    </div>
  `}async function Pd(t,e,n){var a,r;if(!t)return;const s=T();if(!s)return;let i;if(e==="progress"?i="done":e==="done"?i="failed":i="progress",i==="progress"){const{error:o}=await s.from("ads_data_goal_actionitem").update({status:i}).eq("id",t);if(o){console.error("    :",o),alert("      .");return}F.actionItems.delete(n),F.goalDetails.delete(n),(a=window.weeklyGoalState)!=null&&a.lastLoadedGoals&&(window.weeklyGoalState.lastLoadedGoals=null);const l=document.querySelector(`[data-action-item-id="${t}"]`);(r=l==null?void 0:l.querySelector(".GoalDetailModal__actionMemoInputWrapper"))==null||r.remove();const{data:c,error:d}=await s.from("ads_data_goal_actionitem").select("status, done_memo").eq("id",t).single(),u=c;!d&&u?pt(t,u.status??i,u.done_memo??null):pt(t,i,null)}else br(t,i,n)}async function br(t,e,n,s=null){var m,_;const i=s??document.querySelector(`[data-action-item-id="${t}"]`);if(!i)return;(m=i.querySelector(".GoalDetailModal__actionMemoInputWrapper"))==null||m.remove();const a=Ve[e]??Ve.progress,r=i.querySelector(".action-item-icon");r&&(r.className=`${a.icon} action-item-icon`,r.style.color=a.color),i.setAttribute("data-status",e);const o=T();if(o){const{error:y}=await o.from("ads_data_goal_actionitem").update({status:e}).eq("id",t);if(y){console.error("    :",y),alert("      .");const k=i.getAttribute("data-status")??"progress",S=Ve[k]??Ve.progress;r&&(r.className=`${S.icon} action-item-icon`,r.style.color=S.color),i.setAttribute("data-status",k);return}F.actionItems.delete(n),F.goalDetails.delete(n),(_=window.weeklyGoalState)!=null&&_.lastLoadedGoals&&(window.weeklyGoalState.lastLoadedGoals=null);const{data:b,error:v}=await o.from("ads_data_goal_actionitem").select("status").eq("id",t).single(),w=b;if(!v&&(w!=null&&w.status)){const k=w.status,S=Ve[k]??Ve.progress;r&&(r.className=`${S.icon} action-item-icon`,r.style.color=S.color),i.setAttribute("data-status",k)}}let l=null;const c=T();if(c){const{data:y}=await c.from("ads_data_goal_actionitem").select("done_memo").eq("id",t).single(),b=y;b&&(l=b.done_memo??null)}const d=document.createElement("div");d.className="GoalDetailModal__actionMemoInputWrapper",d.style.cssText="margin-top: 6px; display: flex; gap: 4px; align-items: center;",d.addEventListener("click",y=>y.stopPropagation());const u=document.createElement("input");u.type="text",u.className="GoalDetailModal__actionMemoInput",u.placeholder=" ",u.value=l??"",u.style.cssText="flex: 1; padding: 4px 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px;",u.addEventListener("click",y=>y.stopPropagation());const h=document.createElement("button");h.textContent="",h.className="GoalDetailModal__actionMemoSaveBtn",h.style.cssText="padding: 4px 12px; background: var(--primary); color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;";const f=()=>{d.remove(),pt(t,e,l)},p=async()=>{var w;const y=u.value.trim(),b=window.supabase;if(!b)return;const{error:v}=await b.from("ads_data_goal_actionitem").update({done_memo:y||null}).eq("id",t);if(v){console.error("    :",v),alert("    .");return}F.actionItems.delete(n),F.goalDetails.delete(n),(w=window.weeklyGoalState)!=null&&w.lastLoadedGoals&&(window.weeklyGoalState.lastLoadedGoals=null),document.querySelectorAll(".GoalDetailModal__actionMemoInputWrapper").forEach(k=>{k.closest(`[data-action-item-id="${t}"]`)&&k.remove()}),setTimeout(async()=>{const{data:k,error:S}=await b.from("ads_data_goal_actionitem").select("status, done_memo").eq("id",t).single(),x=k;!S&&x?pt(t,x.status??e,x.done_memo??null):pt(t,e,y||null)},100)};h.addEventListener("click",y=>{y.preventDefault(),y.stopPropagation(),p()}),u.addEventListener("keypress",y=>{y.key==="Enter"&&(y.preventDefault(),y.stopPropagation(),p())}),u.addEventListener("keydown",y=>{y.key==="Escape"&&(y.preventDefault(),y.stopPropagation(),f())}),setTimeout(()=>{const y=b=>{const v=b.target;!d.contains(v)&&r&&!r.contains(v)&&(f(),document.removeEventListener("click",y))};document.addEventListener("click",y)},100),d.appendChild(u),d.appendChild(h);const g=i.querySelector(".GoalDetailModal__actionContent");g?g.appendChild(d):i.appendChild(d),setTimeout(()=>u.focus(),0),l&&u.select()}function pt(t,e,n){const s=document.querySelectorAll(`[data-action-item-id="${t}"]`);if(!(s!=null&&s.length))return;const i=Ve[e]??Ve.progress;s.forEach(a=>{a.setAttribute("data-status",e);let r=a.querySelector(".action-item-icon");if(!r){const l=a.querySelector(".GoalDetailModal__actionContent"),c=l==null?void 0:l.previousElementSibling;(c==null?void 0:c.tagName)==="I"?r=c:c&&(r=c.querySelector("i"))}r||(r=a.querySelector("i")),r&&(r.className=`${i.icon} action-item-icon`,r.style.color=i.color,r.style.cursor||(r.style.cursor="pointer"));const o=a.querySelector(".GoalDetailModal__actionContent");if(o){const l=o.querySelector(".GoalDetailModal__actionMemoDisplay");if(e==="progress")l==null||l.remove();else if(n)if(l)l.innerHTML=`<i class="ri-sticky-note-line"></i> ${Ee(n)}`;else{const c=document.createElement("div");c.className="GoalDetailModal__actionMemoDisplay",c.style.cssText="font-size: 11px; color: var(--text-muted); margin-top: 4px;",c.innerHTML=`<i class="ri-sticky-note-line"></i> ${Ee(n)}`,o.appendChild(c)}else l==null||l.remove()}})}async function ov(t,e,n=null){if(!t||t.length===0)return;const s=lv();document.body.appendChild(s);const i=await cv(t);hv(s,i,e,n),s.style.display="flex",pv(s)}function lv(){const t=document.createElement("div");return t.className="week-summary-modal",t.innerHTML=`
    <div class="week-summary-modal__overlay"></div>
    <div class="week-summary-modal__container">
      <div class="week-summary-modal__header">
        <h2 class="week-summary-modal__title">  </h2>
        <button class="week-summary-modal__close-btn">
          <i class="ri-close-line"></i>
        </button>
      </div>
      <div class="week-summary-modal__body"></div>
    </div>
  `,t}async function cv(t){const e=Object.keys(dn),n={};for(const a of e)n[a]=[];t.forEach(a=>{const r=a.goal_category||"etc";n[r]?n[r].push(a):(n.etc||(n.etc=[]),n.etc.push(a))});const s={};for(const a of e)s[a]=await dv(n[a]??[]);const i=await uv(t);return{categories:s,actionItems:i}}async function dv(t){if(!t||t.length===0)return{count:0,startRevenue:0,goalRevenue:0,currentRevenue:0,difference:0,achievementRate:0,growthRate:0};let e=0,n=0,s=0;for(const o of t){const l=dr(o);e+=l.startRevenue,n+=l.goalRevenue,s+=l.currentRevenue}const i=s-e,a=n>0?Math.round(s/n*100*10)/10:0,r=e>0?Math.round(i/e*100*10)/10:0;return{count:t.length,startRevenue:e,goalRevenue:n,currentRevenue:s,difference:i,achievementRate:a,growthRate:r}}async function uv(t){const e=T();if(!e)return{total:0,done:0,inProgress:0,failed:0};const n=t.map(r=>r.id),{data:s,error:i}=await e.from("ads_data_goal_actionitem").select("status").in("goal_id",n);if(i||!s)return{total:0,done:0,inProgress:0,failed:0};const a={total:s.length,done:0,inProgress:0,failed:0};return s.forEach(r=>{r.status==="done"?a.done++:r.status==="failed"?a.failed++:a.inProgress++}),a}function hv(t,e,n,s){const i=t.querySelector(".week-summary-modal__body");if(!i)return;const a=n.startDate?Rl(n.startDate):"",r=n.endDate?Rl(n.endDate):"",o=`${a} - ${r}`,l=s??" ",c=Object.keys(dn);let d=`
    <div class="week-summary-modal__info">
      <div class="week-summary-modal__info-item">
        <span class="week-summary-modal__info-label"> :</span>
        <span class="week-summary-modal__info-value">${o}</span>
      </div>
      <div class="week-summary-modal__info-item">
        <span class="week-summary-modal__info-label">:</span>
        <span class="week-summary-modal__info-value">${l}</span>
      </div>
    </div>
    <div class="week-summary-modal__divider"></div>
  `;c.forEach(u=>{const h=e.categories[u];if(!h)return;const f=dn[u]??u;d+=fv(u,f,h)}),d+='<div class="week-summary-modal__divider"></div>',d+=gv(e.actionItems),i.innerHTML=d}function fv(t,e,n){const s=n.difference>=0?"+":"-",i=n.growthRate>=0?"+":"-",a=n.difference>=0?"positive":"negative",r=n.achievementRate>=100?"high":"low",o=n.growthRate>=0?"positive":"negative";return`
    <div class="week-summary-section">
      ${n.count>0?`
        <div class="week-summary-section__main-line">
          <div class="week-summary-section__left">
            <span class="goal-category-badge goal-category-${t}">${e}</span>
            <span class="week-summary-section__count">${n.count} Action Item</span>
          </div>
          <div class="week-summary-section__right">
            <span class="week-summary-metric__revenue">
              ${L(n.startRevenue)} <i class="ri-arrow-right-line week-summary-arrow"></i> ${L(n.goalRevenue)} <span class="week-summary-divider">|</span> ${L(n.currentRevenue)}
            </span>
            <span class="week-summary-metric__diff ${a}">${s}${L(Math.abs(n.difference))}</span>
          </div>
        </div>
        <div class="week-summary-section__body">
          <div class="week-summary-rates">
            <span class="week-summary-rate-badge week-summary-rate-badge--${r}"> ${n.achievementRate}%</span>
            <span class="week-summary-rate-divider">|</span>
            <span class="week-summary-rate-badge week-summary-rate-badge--${o}"> ${i}${Math.abs(n.growthRate)}%</span>
          </div>
        </div>
      `:`
        <div class="week-summary-section__main-line">
          <div class="week-summary-section__left">
            <span class="goal-category-badge goal-category-${t}">${e}</span>
            <span class="week-summary-section__empty">0 Action Item</span>
          </div>
        </div>
      `}
    </div>
  `}function gv(t){return`
    <div class="week-summary-section">
      <div class="week-summary-section__header">
        <span class="week-summary-section__title"> </span>
      </div>
      <div class="week-summary-section__body">
        <div class="week-summary-action-items">
          <div class="week-summary-action-item">
            <span class="week-summary-action-item__label"></span>
            <span class="week-summary-action-item__value">${t.total}</span>
          </div>
          <div class="week-summary-action-item">
            <span class="week-summary-action-item__label"></span>
            <span class="week-summary-action-item__value week-summary-action-item__value--done">${t.done}</span>
          </div>
          <div class="week-summary-action-item">
            <span class="week-summary-action-item__label"> </span>
            <span class="week-summary-action-item__value week-summary-action-item__value--progress">${t.inProgress}</span>
          </div>
          <div class="week-summary-action-item">
            <span class="week-summary-action-item__label"></span>
            <span class="week-summary-action-item__value week-summary-action-item__value--failed">${t.failed}</span>
          </div>
        </div>
      </div>
    </div>
  `}function Rl(t){const e=t instanceof Date?t:new Date(t),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${n}.${s}`}function pv(t){const e=t.querySelector(".week-summary-modal__close-btn"),n=t.querySelector(".week-summary-modal__overlay"),s=()=>{t.style.display="none",setTimeout(()=>t.remove(),300)};e==null||e.addEventListener("click",s),n==null||n.addEventListener("click",s);const i=a=>{a.key==="Escape"&&(s(),document.removeEventListener("keydown",i))};document.addEventListener("keydown",i)}const $d=Object.keys(Fe).sort((t,e)=>(Fe[t]??999)-(Fe[e]??999)),xi=new Map,mv=5*60*1e3;function _v(t){const e={};for(const n of $d)e[n]=[];return t.forEach(n=>{const s=n.goal_category||"etc";e[s]?e[s].push(n):(e.etc||(e.etc=[]),e.etc.push(n))}),e}async function yv(t,e){const n=document.createElement("div");n.className="WeekNavigation__categorySection",n.setAttribute("data-category",t);const s=document.createElement("div");s.className="WeekNavigation__categoryContent";const i=e.filter(a=>!a.actionItems||a.actionItems.length===0);i.length>0&&await bv(i);for(const a of e)try{const r=tu(a);s.appendChild(r)}catch(r){console.error(`[createCategorySection] goal ${a.id}:`,r)}return n.appendChild(s),n}async function bv(t){const e=Date.now(),n=[];for(const o of t){const l=xi.get(o.id);l&&e-l.ts<mv?o.actionItems=l.data:n.push(o)}if(n.length===0)return;const s=T();if(!s)return;const i=n.map(o=>o.id),a=await s.from("ads_data_goal_actionitem").select("goal_id, id, action_item, status, done_memo").in("goal_id",i).order("id",{ascending:!0});if(a.error||!a.data)return;const r=new Map;for(const o of a.data)r.has(o.goal_id)||r.set(o.goal_id,[]),r.get(o.goal_id).push(o);for(const o of n){const l=r.get(o.id)??[];o.actionItems=l,xi.set(o.id,{data:l,ts:e})}}function vv(t){t!=null?xi.delete(t):xi.clear()}async function Wt(t,e){if(!t)return;const n=Ge(V.offset);for(const s of n.weeks){const i=un(s.offset),a=t.querySelector(`.WeekNavigation__cardContainer[data-week-offset="${s.offset}"]`);if(a)if(a.innerHTML="",!i||!i.goals||i.goals.length===0){const r=document.createElement("div");r.className="EmptyWeekCard__root",r.innerHTML=`
        <div class="empty-card-icon"><i class="ri-inbox-line"></i></div>
        <div class="empty-card-title">  </div>
        <div class="empty-card-description">   </div>
      `,a.appendChild(r)}else{const r=_v(i.goals);for(const o of $d){const l=r[o]??[];if(l.length===0)continue;const c=await yv(o,l);a.appendChild(c)}}}wv(t),kv(t)}let qs=null,Vs=null,zs=null;function wv(t){t&&(qs&&t.removeEventListener("click",qs),Vs&&t.removeEventListener("click",Vs),qs=async e=>{if(e.target.closest(".GoalCard__action-item"))return;const n=e.target.closest(".GoalCard__root");if(!n)return;const s=n.getAttribute("data-goal-id");if(!s)return;const i=T();if(!i)return;const{data:a,error:r}=await i.from("ads_data_goal").select("*").eq("id",s).single();r||!a||await Vi(a,n)},Vs=async e=>{const n=e.target.closest(".GoalCard__action-item");if(!n)return;e.stopPropagation();const s=n.getAttribute("data-action-item-id"),i=n.getAttribute("data-status"),a=n.getAttribute("data-goal-id");!s||!i||!a||await Pd(parseInt(s,10),i,parseInt(a,10))},t.addEventListener("click",qs),t.addEventListener("click",Vs))}function kv(t){t&&(zs&&t.removeEventListener("click",zs),zs=async e=>{var o;if(e.target.closest(".WeekHeader__navArrow")||e.target.closest(".WeekHeader__cloneBtn"))return;const n=e.target.closest(".WeekHeader__root");if(!n)return;const s=parseInt(n.getAttribute("data-week-offset")??"",10);if(isNaN(s))return;const i=un(s);if(!i)return;const a=document.querySelector(".manager-tab.active");let r=null;a&&!a.classList.contains("manager-tab--all")&&(r=((o=a.textContent)==null?void 0:o.trim())??null),await ov(i.goals??[],{startDate:i.startDate,endDate:i.endDate??i.startDate,week_id:i.week_id},r)},t.addEventListener("click",zs))}const z0=vv;let Ks=null,Ys=null,Ae=null;async function K0(t,e){!t||!e||(Ae=e,Id(),await yr(e),pn(t,V.offset,!0),await Wt(t),mn(t),ji(t))}async function Y0(t){t&&(Ae=null,Id(),await ys(),pn(t,V.offset,!1),await Wt(t),mn(t))}function mn(t){t&&(Ks&&t.removeEventListener("click",Ks),Ks=async e=>{const n=e.target.closest(".WeekHeader__navArrow");if(!n)return;e.stopPropagation(),e.preventDefault();const s=n.getAttribute("data-direction");s==="left"?await Sv(t):s==="right"&&await xv(t)},t.addEventListener("click",Ks))}async function Sv(t){Yb();const e=Ge(V.offset);await Nd(e.weeks.map(s=>s.offset));const n=Ae!==null;pn(t,V.offset,n),await Wt(t),mn(t),n&&ji(t),Bd(V.offset)}async function xv(t){if(!Jb())return;const e=Ge(V.offset);await Nd(e.weeks.map(s=>s.offset));const n=Ae!==null;pn(t,V.offset,n),await Wt(t),mn(t),n&&ji(t),Bd(V.offset)}async function Nd(t){const e=t.filter(s=>!un(s));if(e.length===0)return;const n=Ae;await Promise.all(e.map(s=>n?Ld(n,s):ys(s,s)))}function Bd(t){const n=Ge(t).weeks.map(o=>o.offset),s=Math.min(...n),i=Math.max(...n),a=[];if(un(s-1)||a.push(s-1),i+1<=V.maxOffset&&!un(i+1)&&a.push(i+1),a.length===0)return;const r=Ae;Promise.all(a.map(o=>r?Ld(r,o):ys(o,o))).catch(()=>{})}function J0(){return{offset:V.offset,layoutConfig:Ge(V.offset)}}function ji(t){t&&(Ys&&t.removeEventListener("click",Ys),Ys=async e=>{const n=e.target.closest(".WeekHeader__cloneBtn");if(!n)return;e.stopPropagation(),e.preventDefault();const s=parseInt(n.getAttribute("data-week-offset")??"",10);isNaN(s)||Ae!==null&&await ev(s,Ae)},t.addEventListener("click",Ys),t._cloneRefreshBound||(t._cloneRefreshBound=!0,window.addEventListener("week-goals-cloned",async e=>{const n=e.detail;n!=null&&n.managerId&&n.managerId===Ae&&await jd(t,Ae)})))}async function jd(t,e){const s=Ge(V.offset).weeks.map(r=>r.offset),i=Math.min(...s,-2),a=Math.max(...s,2);e?(Ae=e,await yr(e,i,a)):(Ae=null,await ys(i,a)),t&&await Wt(t)}async function Cv(t,e){if(!t||!e)return;Ae=e,V.loadedWeeks.clear();const s=Ge(V.offset).weeks.map(r=>r.offset),i=Math.min(...s,-2),a=Math.max(...s,2);await yr(e,i,a),pn(t,V.offset,!0),await Wt(t),mn(t),ji(t)}async function Ev(t){if(!t)return;Ae=null,V.loadedWeeks.clear();const n=Ge(V.offset).weeks.map(a=>a.offset),s=Math.min(...n,-2),i=Math.max(...n,2);await ys(s,i),pn(t,V.offset,!1),await Wt(t),mn(t)}function Fd(t,e){t.hasAttribute("data-action-delegated")||(t.setAttribute("data-action-delegated","true"),t.addEventListener("click",async n=>{if(!n.target.closest(".action-item-icon"))return;n.stopPropagation();const i=n.target.closest(".GoalCard__action-item");if(i){const a=i.getAttribute("data-action-item-id"),r=i.getAttribute("data-status")??"progress",o=i.getAttribute("data-goal-id")??String(e);let l;r==="progress"?l="done":r==="done"?l="failed":l="progress",l==="progress"?await Pd(parseInt(a,10),r,parseInt(o,10)):await br(parseInt(a,10),l,parseInt(o,10),i)}}))}function Wd(t){const{goal:e,actionItems:n,detailMetrics:s,categoryLabel:i,descriptionText:a,dateRangeStr:r,totalCount:o,clientNames:l}=t,c=ur(e,s),{goalRevenue:d,currentRevenue:u,targetGrowth:h,actualGrowth:f,achievementRateDecimal:p,growthRate:g,growthRatePercent:m}=s,_=h>=0?"+":"";return`
    <div class="GoalCard__root GoalCard__root--currentWeek">
      <div class="GoalCard__header">
        <div class="GoalCard__header-left">
          <span class="GoalCard__categoryBadge goal-category-${e.goal_category??"etc"}">${Ee(i)}</span>
          <span class="GoalCard__objective">${Ee(e.memo??"  ")}</span>
        </div>
        ${r?`<span class="GoalCard__date-range">${Ee(r)}</span>`:""}
      </div>
      <div class="GoalCard__description" style="--achievement-rate: ${p}">
        ${a}
      </div>
      <div class="GoalCard__body">
        <div class="GoalCard__body-left">
          <div class="GoalCard__metrics">
            <div class="GoalCard__metric-group">
              <div class="GoalCard__metric-row">
                <div class="GoalCard__metric-item GoalCard__metric-item--target">
                  <span class="GoalCard__metric-label"></span>
                  <span class="GoalCard__metric-value GoalCard__metric-value--target">${L(d)}</span>
                </div>
                <div class="GoalCard__metric-item GoalCard__metric-item--achieved ${c.achievedRevenueClass}">
                  <span class="GoalCard__metric-label"></span>
                  <span class="GoalCard__metric-value ${c.achievedRevenueClass}">${L(u)}</span>
                </div>
              </div>
              <div class="GoalCard__metric-row">
                <div class="GoalCard__metric-item GoalCard__metric-item--target">
                  <span class="GoalCard__metric-label"> </span>
                  <span class="GoalCard__metric-value GoalCard__metric-value--target">${_}${L(h)}</span>
                </div>
                <div class="GoalCard__metric-item ${c.achievedGrowthClass}">
                  <span class="GoalCard__metric-label"> </span>
                  <span class="GoalCard__metric-value ${c.achievedGrowthClass}">${f>=0?"+":""}${L(f)}</span>
                </div>
              </div>
              <div class="GoalCard__metric-row">
                <div class="GoalCard__rate-item ${c.weeklyGrowthClass}">
                  <span class="GoalCard__rate-label">  </span>
                  <span class="GoalCard__rate-value ${c.weeklyGrowthClass}">${g>=0?"+":""}${g}%</span>
                </div>
                <div class="GoalCard__rate-item ${c.goalAchievementClass}">
                  <span class="GoalCard__rate-label"> </span>
                  <span class="GoalCard__rate-value ${c.goalAchievementClass}">${p}%</span>
                </div>
              </div>
              <div class="GoalCard__clients">
                <div class="GoalCard__section-title">
                  <i class="ri-focus-2-line"></i>
                  <span> </span>
                </div>
                <div class="GoalCard__clients-list">
                  ${o===0?'<div class="GoalCard__empty-state">  </div>':`<div class="GoalCard__client-item"><i class="ri-building-4-line"></i><span>${l.map(Ee).join(", ")}${o>=4?" ":""}  ${o}</span></div>`}
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="GoalCard__body-right">
          <div class="GoalCard__actions">
            <div class="GoalCard__section-title">
              <i class="ri-list-check-2"></i>
              <span> </span>
            </div>
            <div class="GoalCard__actions-list">
              ${n.length===0?'<div class="GoalCard__empty-state">  </div>':n.map(y=>Od(y,e.id)).join("")}
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function Av(t,e,n){n.innerHTML=Wd(t),Fd(n,t.goal.id)}async function Mv(t,e,n){const s=T();if(!s)throw new Error("   .  .");const[i,a]=await Promise.all([s.from("ads_data_goal_targetclient").select("client_id").eq("goal_id",t.id),(async()=>{const N=F.actionItems.get(t.id);if(N&&Kn(N,F.actionItemsTtl))return{data:N.data,error:null};const{data:ee,error:te}=await s.from("ads_data_goal_actionitem").select("id, action_item, status, done_memo").eq("goal_id",t.id).order("id",{ascending:!0});return!te&&ee&&F.actionItems.set(t.id,{data:ee,timestamp:Date.now()}),{data:ee??[],error:te}})()]),{data:r,error:o}=i,l=(r==null?void 0:r.map(N=>N.client_id))??[];let c=[];if(l.length>0&&!o){const{data:N,error:ee}=await s.from("ads_data_client").select("client_id, client_name").in("client_id",l);!ee&&N&&(c=N.map(te=>({id:te.client_id,name:nd(te.client_name??"")})))}const{data:d,error:u}=a,h=u?[]:d??[];if(n!=null&&n.checkRace&&!n.checkRace(t.id))throw new Error("RACE_ABORT");if(!document.contains(e))throw new Error("RACE_ABORT");const f=dr(t);ur(t,f);const{startRevenue:p,goalRevenue:g,currentRevenue:m,targetGrowth:_,actualGrowth:y,achievementRateDecimal:b,growthRate:v,growthRatePercent:w}=f,k=c.map(N=>N.name).filter(Boolean),S=k.length,x=k.slice(0,3),E=dn[t.goal_category]??t.goal_category??"",D=w>=0?"+":"",O=_>=0?"+":"",$=`  <strong>${L(p)}</strong> <strong>${D}${w}%</strong> / <strong>${O}${L(_)}</strong>  <strong>${L(g)}</strong>  .`,Z=t.start_date?wi(t.start_date):"",oe=t.end_date?wi(t.end_date):"",U=Z&&oe?`${Z} - ${oe}`:"",G={goal:t,clients:c,actionItems:h,detailMetrics:f,categoryLabel:E,descriptionText:$,dateRangeStr:U,totalCount:S,clientNames:x};F.goalDetails.set(t.id,{data:G,timestamp:Date.now()}),e.innerHTML=Wd(G),Fd(e,t.id)}let at=null;function Tv(t){at=t}function Gd(){return at?{isEditMode:at.isEditMode,editGoalId:at.editGoalId,originalGoalData:at.originalGoalData}:{isEditMode:!1,editGoalId:null,originalGoalData:null}}function vr(t,e=null,n=null){at&&(at.isEditMode=t,at.editGoalId=e,at.originalGoalData=n,console.log("[ ]  :",t,"Goal ID:",e))}function wr(){const t=document.querySelector("#goal-register-modal .modal-title");t&&(t.textContent="NEW OBJECTIVE");const e=document.querySelector("#goal-register-form .btn-submit");e&&(e.textContent="");const n=document.getElementById("goal-date-input");n&&(n.disabled=!1)}function Fi(t){const e=t.getDay(),n=e===0?-6:1-e,s=new Date(t);s.setDate(t.getDate()+n),s.setHours(0,0,0,0);const i=new Date(s);return i.setDate(s.getDate()+6),i.setHours(23,59,59,999),{start_date:he(s),end_date:he(i)}}function Wi(t){const e=t.getFullYear(),n=t.getMonth(),s=new Date(e,n,1);s.setHours(0,0,0,0);const i=new Date(e,n+1,0);return i.setHours(23,59,59,999),{start_date:he(s),end_date:he(i)}}function Rv(t){const{managerId:e,dateInput:n,category:s,goalRevenue:i}=t;return!e||!n||!s||!i?{isValid:!1,message:"   ."}:{isValid:!0,message:""}}function Dv(t){return!t||!t.trim()?{isValid:!1,message:" ."}:{isValid:!0,message:""}}function Iv(t,e,n=!1){const s=Rv(t);if(!s.isValid)return s;const i=Dv(t.memo);return i.isValid?{isValid:!0,message:""}:i}async function Hd(t){const e=T();if(!e)throw new Error("Supabase   .");const{data:n,error:s}=await e.from("ads_data_goal_actionitem").select("id, action_item, status, done_memo").eq("goal_id",t).order("id",{ascending:!0});return s?(console.error("   :",s),[]):n||[]}function Lv(t){const e=document.getElementById("goal-manager-select");if(!e)return;e._changeHandler&&e.removeEventListener("change",e._changeHandler);const n=async function(s){const i=s.target.value;if(console.log("[ ] :",i),i&&t.loadClientList){console.log("[ ]    "),t.selectedClientIds.clear(),await t.loadClientList(parseInt(i,10)),console.log("[ ]    "),t.renderSelectedClients&&t.renderSelectedClients(),t.updateClientSelectCount&&t.updateClientSelectCount(),t.updateHiddenInput&&t.updateHiddenInput();const a=document.getElementById("start-revenue-input");a&&(a.value="");const r=document.getElementById("goal-revenue-input");r&&(r.value=""),t.lastPercentage&&(t.lastPercentage.value=null)}else{console.log("[ ]    loadClientList  ");const a=document.getElementById("client-select-options");a&&(a.innerHTML='<li class="multi-select-option loading">  .</li>')}};e._changeHandler=n,e.addEventListener("change",n)}function Ud(t){var a;const e=document.getElementById("goal-manager-select");if(!e)return;const n=e.value,s=e.disabled,i=e.cloneNode(!0);i.value=n,i.disabled=s,(a=e.parentNode)==null||a.replaceChild(i,e),i.addEventListener("change",async function(r){const o=r.target.value;if(console.log("[ ] :",o),o&&t.loadClientList){console.log("[ ]    "),t.selectedClientIds.clear(),await t.loadClientList(parseInt(o,10)),console.log("[ ]    "),t.renderSelectedClients&&t.renderSelectedClients(),t.updateClientSelectCount&&t.updateClientSelectCount(),t.updateHiddenInput&&t.updateHiddenInput();const l=document.getElementById("start-revenue-input");l&&(l.value="");const c=document.getElementById("goal-revenue-input");c&&(c.value=""),t.lastPercentage&&(t.lastPercentage.value=null)}else console.log("[ ]    loadClientList  ")})}let Js=null;function kr(t){Js&&Js.abort(),Js=new AbortController;const{signal:e}=Js,n=document.getElementById("open-date-picker-btn");n&&n.addEventListener("click",i=>{var a;i.preventDefault(),i.stopPropagation(),(a=t.openDatePicker)==null||a.call(t)},{signal:e});const s=document.getElementById("goal-date-input");s&&s.addEventListener("click",i=>{var a;s.disabled||(i.preventDefault(),i.stopPropagation(),(a=t.openDatePicker)==null||a.call(t))},{signal:e})}function Sr(t){var o;const e=document.getElementById("client-select-dropdown"),n=document.getElementById("client-select-toggle"),s=document.getElementById("client-search-input");if(console.log("[  ]",{dropdown:!!e,toggle:!!n,searchInput:!!s}),n){const l=n.cloneNode(!0);(o=n.parentNode)==null||o.replaceChild(l,n),l.addEventListener("click",async function(c){var f,p;console.log("[ ] !"),c.stopPropagation();const d=document.getElementById("client-select-dropdown"),u=document.getElementById("client-select-toggle"),h=document.getElementById("client-search-input");if(d){const g=d.classList.contains("active");if(console.log("[ ]  :",g?"":""),g)d.classList.remove("active"),u&&u.classList.remove("active"),console.log("[ ]  ");else{d.classList.add("active"),u&&u.classList.add("active"),console.log("[ ]  "),h&&(h.value="");let m=((f=window.goalRegisterState)==null?void 0:f.availableClients)??t.availableClients??[];if(m.length===0&&t.loadClientList){const _=document.getElementById("goal-manager-select"),y=_?parseInt(_.value,10):NaN;y&&(await t.loadClientList(y),m=((p=window.goalRegisterState)==null?void 0:p.availableClients)??[])}t.renderClientOptions&&m.length>0&&t.renderClientOptions(m,"")}}})}if(s){s.onfocus=null,s.addEventListener("focus",async function(){var c,d;if(this.value="",e){e.classList.add("active"),n&&n.classList.add("active");let u=((c=window.goalRegisterState)==null?void 0:c.availableClients)??t.availableClients??[];if(u.length===0&&t.loadClientList){const h=document.getElementById("goal-manager-select"),f=h?parseInt(h.value,10):NaN;f&&(await t.loadClientList(f),u=((d=window.goalRegisterState)==null?void 0:d.availableClients)??[])}t.renderClientOptions&&u.length>0&&t.renderClientOptions(u,"")}});let l;s.addEventListener("input",async function(c){clearTimeout(l);const d=c.target.value.trim();l=setTimeout(async()=>{var u,h;if(t.renderClientOptions){let f=((u=window.goalRegisterState)==null?void 0:u.availableClients)??t.availableClients??[];if(f.length===0&&t.loadClientList){const p=document.getElementById("goal-manager-select"),g=p?parseInt(p.value,10):NaN;g&&(await t.loadClientList(g),f=((h=window.goalRegisterState)==null?void 0:h.availableClients)??[])}if(!d){t.renderClientOptions(f,"");return}d.includes(",")?d.split(",").map(g=>g.trim()).filter(g=>g.length>=2).length>0&&t.renderClientOptions(f,d):d.length>=2?t.renderClientOptions(f,d):t.renderClientOptions(f,"")}},300)}),s.addEventListener("click",async function(){var c,d;if(e){const u=e.classList.contains("active");if(e.classList.add("active"),n&&n.classList.add("active"),!u&&t.renderClientOptions){let h=((c=window.goalRegisterState)==null?void 0:c.availableClients)??t.availableClients??[];if(h.length===0&&t.loadClientList){const f=document.getElementById("goal-manager-select"),p=f?parseInt(f.value,10):NaN;p&&(await t.loadClientList(p),h=((d=window.goalRegisterState)==null?void 0:d.availableClients)??[])}t.renderClientOptions(h,"")}}})}const i=document.getElementById("client-select-done");i&&(i.onclick=null,i.addEventListener("click",function(l){l.stopPropagation(),e&&e.classList.remove("active"),n&&n.classList.remove("active"),s&&(s.value="")}));const a=document.getElementById("client-select-clear-all");a&&(a.onclick=null,a.addEventListener("click",function(l){l.stopPropagation(),t.clearAllClients&&t.clearAllClients()})),e&&(e.onclick=null,e.addEventListener("click",function(l){l.stopPropagation()}));const r=document.getElementById("client-select-wrapper");r&&(r.onclick=null,r.addEventListener("click",function(l){var c;if(!l.target.closest(".client-tag")&&l.target!==n){const d=(e==null?void 0:e.classList.contains("active"))??!1;if(e&&!d&&(e.classList.add("active"),t.renderClientOptions)){const u=((c=window.goalRegisterState)==null?void 0:c.availableClients)??t.availableClients??[];t.renderClientOptions(u,"")}n&&n.classList.add("active"),s&&l.target!==s&&setTimeout(()=>s.focus(),0)}})),window.goalRegisterDropdownCloseHandler||(window.goalRegisterDropdownCloseHandler=function(l){e&&r&&!r.contains(l.target)&&!e.contains(l.target)&&(e.classList.remove("active"),n&&n.classList.remove("active"))},document.addEventListener("click",window.goalRegisterDropdownCloseHandler))}function _n(t){const e=A("goal-register-modal");e&&e.classList.remove("active"),document.body.style.overflow="";const n=document.querySelector("#goal-register-modal .modal-title");n&&(n.textContent="NEW OBJECTIVE");const s=document.querySelector("#goal-register-form .btn-submit");s&&(s.textContent=""),t!=null&&t.resetModalState&&t.resetModalState(t)}function qd(t){const e=document.querySelector("#goal-register-modal .modal-title");e&&(e.textContent=t)}function Vd(t){const e=document.querySelector("#goal-register-form .btn-submit");e&&(e.textContent=t)}const Ov="modulepreload",Pv=function(t){return"/"+t},Dl={},Xe=function(e,n,s){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),o=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));i=Promise.allSettled(n.map(l=>{if(l=Pv(l),l in Dl)return;Dl[l]=!0;const c=l.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":Ov,c||(u.as="script"),u.crossOrigin="",u.href=l,o&&u.setAttribute("nonce",o),document.head.appendChild(u),c)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(r){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r}return i.then(r=>{for(const o of r||[])o.status==="rejected"&&a(o.reason);return e().catch(a)})},j={isEditMode:!1,editGoalId:null,originalGoalData:null,selectedClientIds:new Set,availableClients:[],lastPercentage:{value:null}};function X0(){j.isEditMode=!1,j.editGoalId=null,j.originalGoalData=null,j.selectedClientIds.clear(),j.availableClients=[],j.lastPercentage.value=null}function Q0(t,e,n){j.isEditMode=t,j.editGoalId=e,j.originalGoalData=n}function Z0(t){j.selectedClientIds.add(t)}function ek(t){j.selectedClientIds.delete(t)}function tk(){j.selectedClientIds.clear()}function nk(){return Array.from(j.selectedClientIds)}async function $v(){const t=T();if(!t)return;const e=document.getElementById("goal-manager-select");if(e)try{const{data:n,error:s}=await t.from("shared_manager").select("id, manager_name").eq("manager_team","ads").not("id","in","(98,99)").order("id",{ascending:!0});if(s){console.error("   :",s);return}if(e.innerHTML='<option value=""> </option>',n!=null&&n.length)for(const i of n){const a=document.createElement("option");a.value=String(i.id),a.textContent=i.manager_name??`Manager ${i.id}`,e.appendChild(a)}}catch(n){console.error("   :",n)}}async function Nv(t,e,n){const s=A("client-select-options");if(!s){console.error("[loadClientList] optionsContainer   ");return}const i=await nb(t);if(!i){s.innerHTML='<li class="multi-select-option empty">    .</li>';return}const a=await Bv(i);if(a.sort((r,o)=>(o.lastWeekRevenue??0)-(r.lastWeekRevenue??0)),e.length=0,e.push(...a),e.length===0){s.innerHTML='<li class="multi-select-option empty">  .</li>',n(e);return}n(e)}async function Bv(t){if(!(t!=null&&t.length))return t.map(l=>({...l,lastWeekRevenue:0}));const e=T();if(!e)return t.map(l=>({...l,lastWeekRevenue:0}));const n=new Date,s=new Date(n);s.setDate(n.getDate()-n.getDay()-6);const i=new Date(s);i.setDate(s.getDate()+6);const a=he(s),r=he(i),o=t.map(l=>l.client_id);try{const{data:l,error:c}=await e.from("ads_data_daily").select("client_id, amount").in("client_id",o).gte("date",a).lte("date",r);if(c)return console.error("    :",c),t.map(u=>({...u,lastWeekRevenue:0}));const d=new Map;for(const u of l??[]){const h=String(u.client_id);d.set(h,(d.get(h)??0)+(u.amount??0))}return t.map(u=>({...u,lastWeekRevenue:d.get(String(u.client_id))??0}))}catch(l){return console.error("    :",l),t.map(c=>({...c,lastWeekRevenue:0}))}}async function jv(t,e,n,s,i,a,r){const o=String(t);if(e.has(o)?e.delete(o):e.add(o),await n(),s(),i&&i(),a&&r){const l=document.getElementById("client-search-input"),c=(l==null?void 0:l.value)??"";a(r,c)}}function Fv(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function zd(t,e){t.querySelectorAll(".multi-select-option:not(.empty)").forEach(n=>{n.addEventListener("click",function(s){s.stopPropagation();const i=this.dataset.clientId;i&&e(i)})})}function Il(t,e,n,s){s.innerHTML=t.map(i=>{const a=String(i.client_id);return`
        <li class="multi-select-option ${e.has(a)||e.has(String(i.client_id))?"selected":""}" data-client-id="${i.client_id}">
          <div class="multi-select-checkbox">
            <i class="ri-check-line multi-select-checkbox-icon"></i>
          </div>
          <div class="multi-select-option-label">
            <span class="multi-select-option-client-id">${i.client_id}.</span>
            <span class="multi-select-option-client-name">${i.client_name??""}</span>
          </div>
        </li>
      `}).join(""),zd(s,n)}function Wv(t,e,n,s,i){s.innerHTML=t.map(a=>{const r=String(a.client_id),o=e.has(r)||e.has(String(a.client_id));let l=r,c=a.client_name??"";for(const d of i){const u=d.toLowerCase(),h=new RegExp(`(${Fv(d)})`,"gi");r.toLowerCase().includes(u)&&(l=r.replace(h,"<mark>$1</mark>")),c.toLowerCase().includes(u)&&(c=c.replace(h,"<mark>$1</mark>"))}return`
        <li class="multi-select-option ${o?"selected":""}" data-client-id="${a.client_id}">
          <div class="multi-select-checkbox">
            <i class="ri-check-line multi-select-checkbox-icon"></i>
          </div>
          <div class="multi-select-option-label">
            <span class="multi-select-option-client-id">${l}.</span>
            <span class="multi-select-option-client-name">${c}</span>
          </div>
        </li>
      `}).join(""),zd(s,n)}function Gv(t,e="",n,s){const i=document.getElementById("client-select-options");if(!i){console.error("[renderClientOptions] optionsContainer   ");return}if(!t||!Array.isArray(t)){i.innerHTML='<li class="multi-select-option empty">    .</li>';return}if(t.length===0){i.innerHTML='<li class="multi-select-option empty"> .</li>';return}const a=e.trim(),r=n??new Set,o=s??(()=>{});if(!a){Il(t,r,o,i);return}const l=a.split(",").map(d=>d.trim()).filter(d=>d.length>=2);if(l.length===0){Il(t,r,o,i);return}const c=t.filter(d=>l.some(u=>{const h=u.toLowerCase(),f=String(d.client_id),p=(d.client_name??"").toLowerCase();return f.includes(h)||p.includes(h)}));if(c.length===0){i.innerHTML=`<li class="multi-select-option empty"> "${l.join(", ")}"   </li>`;return}Wv(c,r,o,i,l)}function Hv(t,e,n){B(`[renderSelectedClients] . selectedClientIds.size: ${t.size}`);const s=document.getElementById("selected-clients-tags"),i=document.getElementById("client-select-wrapper");s&&(s.innerHTML="",i&&i.classList.remove("has-tags"))}function Uv(t,e,n){const s=document.querySelector("#goal-register-modal .Modal__container"),i=document.getElementById("modal-right-section");if(!s||!i)return;if(t.size===0){i.classList.remove("expanded"),i.style.display="none",s.classList.remove("has-right-panel");return}const a=e.filter(r=>{const o=String(r.client_id);return t.has(o)||t.has(String(r.client_id))});if(a.length===0){i.classList.remove("expanded"),i.style.display="none",s.classList.remove("has-right-panel");return}i.style.display="flex",i.classList.add("expanded"),s.classList.add("has-right-panel"),i.innerHTML=`
    <div class="modal-right-header">
      <h3 class="modal-right-title">  (${a.length})</h3>
    </div>
    <div class="modal-right-content">
      ${a.map(r=>`
        <div class="selected-client-item" data-client-id="${r.client_id}">
          <div class="selected-client-info">
            <span class="selected-client-id">${r.client_id}.</span>
            <span class="selected-client-name">${r.client_name??""}</span>
          </div>
          <button type="button" class="selected-client-remove" data-client-id="${r.client_id}">
            <i class="ri-close-line"></i>
          </button>
        </div>
      `).join("")}
    </div>
  `,i.querySelectorAll(".selected-client-remove").forEach(r=>{r.addEventListener("click",function(o){o.stopPropagation();const l=this.dataset.clientId;l&&n(l)})})}function qv(t,e){const n=document.getElementById("start-revenue-input"),s=document.getElementById("goal-revenue-input");if(!n||!s)return!1;const i=t.match(/^(\d+(?:\.\d+)?)\s*%?$/);if(i){const a=parseFloat(i[1]),r=parseInt(n.value.replace(/,/g,""),10)||0;if(r>0){const o=Math.round(r*(a/100));return s.value=o.toLocaleString(),e.value=a,!0}}return!1}async function Vv(t,e,n,s,i){if(!t)return;const a=T();if(a)try{const{data:r}=await a.from("ads_data_goal_targetclient").select("client_id").eq("goal_id",t);if(!(r!=null&&r.length)){await a.from("ads_data_goal").update({start_revenue:0}).eq("id",t);return}const o=r.map(m=>String(m.client_id)),l=new Date(e);let c,d;if(n==="weekly"){const m=s(l),_=new Date(m.start_date);c=new Date(_),c.setDate(_.getDate()-7),d=new Date(c),d.setDate(c.getDate()+6)}else{const m=i(l),_=new Date(m.start_date);c=new Date(_),c.setMonth(_.getMonth()-1),d=new Date(_),d.setDate(0)}const u=he(c),h=he(d),{data:f,error:p}=await a.from("ads_data_daily").select("amount").in("client_id",o).gte("date",u).lte("date",h);if(p){console.error(" /   :",p);return}const g=(f==null?void 0:f.reduce((m,_)=>m+(_.amount??0),0))??0;await a.from("ads_data_goal").update({start_revenue:g}).eq("id",t)}catch(r){console.error("start_revenue  :",r)}}async function zv(t,e,n){var r;const s=T();if(!s||t.size===0){const o=document.getElementById("start-revenue-input");o&&(o.value="");return}const i=(r=window.weeklyGoalState)==null?void 0:r.datePickerState,a=i==null?void 0:i.selectedDate;if(a)try{const o="weekly";let l,c;if(o==="weekly"){const _=e(a),y=new Date(_.start_date);l=new Date(y),l.setDate(y.getDate()-7),c=new Date(l),c.setDate(l.getDate()+6)}const d=he(l),u=he(c),h=Array.from(t).map(_=>String(_)),{data:f,error:p}=await s.from("ads_data_daily").select("amount").in("client_id",h).gte("date",d).lte("date",u);if(p){console.error(" /   :",p);return}const g=(f==null?void 0:f.reduce((_,y)=>_+(y.amount??0),0))??0,m=document.getElementById("start-revenue-input");m&&(m.value=L(String(g)))}catch(o){console.error(" /   :",o)}}let we=null;function Kv(){const t=document.createElement("div");return t.className="date-picker-overlay",t.innerHTML=`
    <div class="date-picker-panel">
      <div class="date-picker-panel__header">
        <button type="button" class="date-picker-panel__nav" data-action="prev">
          <i class="ri-arrow-left-s-line"></i>
        </button>
        <h4 class="date-picker-panel__title"></h4>
        <button type="button" class="date-picker-panel__nav" data-action="next">
          <i class="ri-arrow-right-s-line"></i>
        </button>
      </div>
      <div class="date-picker-panel__grid"></div>
      <div class="date-picker-panel__footer">
        <button type="button" class="date-picker-panel__btn date-picker-panel__btn--cancel"></button>
        <button type="button" class="date-picker-panel__btn date-picker-panel__btn--today"></button>
      </div>
    </div>
  `,t}function Yv(t,e,n){const s=e.currentDate.getFullYear(),i=e.currentDate.getMonth(),a=new Date,r=new Date(s,i,1),o=new Date(s,i+1,0),l=r.getDay();let c="";const d=["","","","","","",""];for(const g of d)c+=`<div class="date-picker-panel__weekday">${g}</div>`;const u=new Date(s,i,0).getDate();for(let g=l-1;g>=0;g--)c+=`<div class="date-picker-panel__day date-picker-panel__day--other">${u-g}</div>`;for(let g=1;g<=o.getDate();g++){const m=new Date(s,i,g),_=m.toDateString()===a.toDateString(),y=e.selectedDate?m.toDateString()===e.selectedDate.toDateString():!1;let b="date-picker-panel__day";y?b+=" date-picker-panel__day--selected":_&&(b+=" date-picker-panel__day--today"),c+=`<div class="${b}" data-date="${s}-${String(i+1).padStart(2,"0")}-${String(g).padStart(2,"0")}">${g}</div>`}const h=l+o.getDate(),p=Math.ceil(h/7)*7-h;for(let g=1;g<=p;g++)c+=`<div class="date-picker-panel__day date-picker-panel__day--other">${g}</div>`;t.innerHTML=c,t.onclick=g=>{const m=g.target.closest(".date-picker-panel__day:not(.date-picker-panel__day--other)");if(!(m!=null&&m.dataset.date))return;const[_,y,b]=m.dataset.date.split("-").map(Number);n(new Date(_,y-1,b))}}function Jv(t,e){const n=t.querySelector(".date-picker-panel__title");if(n){const s=e.currentDate.getFullYear(),i=e.currentDate.getMonth()+1;n.textContent=`${s} ${i}`}}function Xv(t,e){we&&fs();const n=new Date;t.currentDate=new Date(n),t.targetInputId="goal-date-input",e()}function fs(){we&&(we.remove(),we=null)}function Kd(t,e){var s,i;we||(we=Kv(),document.body.appendChild(we),we.addEventListener("click",a=>{a.target===we&&fs()}),we.querySelectorAll(".date-picker-panel__nav").forEach(a=>{a.addEventListener("click",r=>{r.stopPropagation();const l=a.dataset.action==="prev"?-1:1;Yd(l,t,()=>{Kd(t,e)})})}),(s=we.querySelector(".date-picker-panel__btn--cancel"))==null||s.addEventListener("click",a=>{a.stopPropagation(),fs()}),(i=we.querySelector(".date-picker-panel__btn--today"))==null||i.addEventListener("click",a=>{a.stopPropagation(),e(new Date)})),Jv(we,t);const n=we.querySelector(".date-picker-panel__grid");n&&Yv(n,t,e)}async function Qv(t,e,n,s,i,a){e.selectedDate=t;const r=document.getElementById("goal-date-input");if(r){const o=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0");if(r.value=`${o}-${l}-${c}`,n.size>0&&(await s(),i.value!==null)){const d=document.getElementById("start-revenue-input"),u=document.getElementById("goal-revenue-input");if(d&&u&&d.value){const h=parseInt(vi(d.value),10);if(!isNaN(h)){const f=Math.round(h+h*i.value/100);u.value=L(String(f))}}}}fs()}function Yd(t,e,n){const s=new Date(e.currentDate);s.setMonth(s.getMonth()+t),e.currentDate=s,n()}function Zv(t){t(new Date)}let Ha=null;function ew(t){Ha=t}async function Jd(){return $v()}async function tw(t){return Nv(t,j.availableClients,Gi)}function Gi(t,e=""){return Gv(t,e,j.selectedClientIds,Xd)}async function Xd(t){return jv(t,j.selectedClientIds,Hi,xr,Ui,Gi,j.availableClients)}async function nw(t,e,n){return Vv(t,e,n,Fi,Wi)}async function Hi(){return zv(j.selectedClientIds,Fi,Wi)}function xr(){return Hv(j.selectedClientIds,j.availableClients)}function sw(t){return qv(t,j.lastPercentage)}function Ui(){return Uv(j.selectedClientIds,j.availableClients,Xd)}function Qd(){const t=document.getElementById("client-select-count");t&&(t.textContent=`${j.selectedClientIds.size} `),Ui()}function Zd(){const t=document.getElementById("selected-client-ids");t&&(t.value=Array.from(j.selectedClientIds).join(","))}function iw(){j.selectedClientIds.clear(),xr(),Ui();const t=document.getElementById("client-search-input");Gi(j.availableClients,(t==null?void 0:t.value)||""),Qd(),Zd()}function bs(){const t=document.getElementById("action-items-container");if(!t)return;const e=t.querySelectorAll(".action-item-row").length,n=document.createElement("div");n.className="action-item-row",n.innerHTML=`
    <input type="text" class="form-input action-item-input" placeholder="Add Your Action Item" data-action-index="${e}" autocomplete="off">
    <button type="button" class="action-item-remove-btn remove-action-item-btn">
      <i class="ri-close-line"></i>
    </button>
    <button type="button" class="action-item-add-btn add-action-item-btn">
      <i class="ri-add-line"></i>
    </button>
  `,t.appendChild(n);const s=n.querySelector(".remove-action-item-btn");s&&s.addEventListener("click",function(){n.remove()});const i=n.querySelector(".add-action-item-btn");i&&i.addEventListener("click",function(){bs()})}function aw(){const t=document.getElementById("action-items-container");if(!t)return;t.innerHTML=`
    <div class="action-item-row">
      <input type="text" class="form-input action-item-input" placeholder="Add Your Action Item" data-action-index="0">
      <button type="button" class="action-item-add-btn" id="add-action-item-btn">
        <i class="ri-add-line"></i>
      </button>
    </div>
  `;const e=document.getElementById("add-action-item-btn");e&&e.addEventListener("click",bs)}function rw(t){const e=document.getElementById("action-items-container");if(!e)return;e.innerHTML="",t.forEach((s,i)=>{const a=document.createElement("div");a.className="action-item-row",a.innerHTML=`
      <input type="text" 
        class="form-input action-item-input" 
        value="${Ee(String(s.action_item||""))}"
        data-action-index="${i}"
        data-action-item-id="${s.id}"
        readonly
        style="background: #f5f5f5; color: #666;">
      ${i===0?`
      <button type="button" class="action-item-add-btn" id="add-action-item-btn">
        <i class="ri-add-line"></i>
      </button>
      `:""}
    `,e.appendChild(a)});const n=document.getElementById("add-action-item-btn");n&&(n.onclick=null,n.addEventListener("click",bs))}function Ua(){return Xv(rt.datePickerState,Cr)}function ow(){return fs()}function Cr(){return Kd(rt.datePickerState,Er)}async function Er(t){return Qv(t,rt.datePickerState,j.selectedClientIds,Hi,j.lastPercentage)}function lw(t){return Yd(t,rt.datePickerState,Cr)}function cw(){return Zv(Er)}function dw(t){return Y(t)}async function uw(t,e){if(Ha)return Ha(t,e)}function Ar(){return{selectedClientIds:j.selectedClientIds,availableClients:j.availableClients,currentManagerTabId:rt.currentManagerTabId,lastPercentage:j.lastPercentage,datePickerState:rt.datePickerState,isEditMode:j.isEditMode,editGoalId:j.editGoalId,originalGoalData:j.originalGoalData,loadGoalManagerOptions:Jd,loadClientList:tw,renderClientOptions:Gi,renderSelectedClients:xr,updateClientSelectCount:Qd,updateHiddenInput:Zd,renderSelectedClientsInRightPanel:Ui,clearAllClients:iw,calculateStartRevenue:Hi,resetActionItems:aw,addActionItemInput:bs,renderExistingActionItems:rw,showToast:dw,loadManagerGoals:uw,recalculateStartRevenueForEdit:nw,closeGoalDetailModal:Lw,async onGoalSaved(){const t=A("goal-monthly-tab");if(t!=null&&t.classList.contains("active")){const{initGoalMonthly:e}=await Xe(async()=>{const{initGoalMonthly:n}=await import("./index-CoKPUul2.js");return{initGoalMonthly:n}},__vite__mapDeps([0,1,2]));await e()}},openDatePicker:Ua,closeDatePicker:ow,renderDatePicker:Cr,selectDate:Er,changeDatePickerMonth:lw,selectTodayDate:cw}}function eu(){window.goalRegisterContext=Ar(),_n(window.goalRegisterContext)}function hw(){window.goalRegisterContext=null,window.createGoalRegisterContext=Ar,window.closeGoalModalWrapper=eu}function fw(){const t=document.getElementById("goal-manager-select").value,e="weekly",n=document.getElementById("goal-date-input").value,s=document.getElementById("goal-category-select").value,i=document.getElementById("goal-memo-input").value.trim(),a=document.getElementById("start-revenue-input"),r=document.getElementById("goal-revenue-input"),o=a?vi(a.value):null,l=vi(r.value),c=document.querySelectorAll(".action-item-input");return{managerId:t,periodType:e,dateInput:n,category:s,memo:i,startRevenue:o,goalRevenue:l,actionItemInputs:c}}async function gw(t){var w;const{supabase:e,editGoalId:n,category:s,memo:i,goalRevenue:a,context:r,dates:o,periodType:l}=t,{error:c}=await e.from("ads_data_goal").update({goal_category:s,memo:i||null,goal_revenue:parseInt(a,10),activate:!0}).eq("id",n);if(c)throw new Error(`  : ${c.message}`);const{error:d}=await e.from("ads_data_goal_targetclient").delete().eq("goal_id",n);if(d&&console.error("   :",d),r.selectedClientIds.size>0){const k=Array.from(r.selectedClientIds).map(x=>({goal_id:n,client_id:String(x)})),{error:S}=await e.from("ads_data_goal_targetclient").insert(k);S&&console.error("  :",S)}r.recalculateStartRevenueForEdit&&await r.recalculateStartRevenueForEdit(n,o.start_date,l,Fi,Wi);const u=document.querySelectorAll(".action-item-input:not([readonly])"),h=[];if(u.forEach(k=>{const S=k.value.trim();S&&h.push({goal_id:n,action_item:S,status:"progress"})}),h.length>0){const{error:k}=await e.from("ads_data_goal_actionitem").insert(h);k&&console.error("   :",k)}F.goalDetails.delete(n),F.actionItems.delete(n);const f=he(new Date),p=`goal_revenue_updated_${f}`,g=JSON.parse(localStorage.getItem(p)||"[]"),m=g.indexOf(n);m>-1&&(g.splice(m,1),localStorage.setItem(p,JSON.stringify(g))),localStorage.removeItem(`goal_revenue_${n}_${f}`);const{data:_,error:y}=await e.from("ads_data_goal").select("id, manager_id, period_type, start_date, end_date, goal_category, memo, start_revenue, goal_revenue, activate, updated_at").eq("id",n).single();y&&console.error("    :",y);const b=A("goal-detail-modal"),v=(b==null?void 0:b.classList.contains("active"))??!1;if(r.showToast&&r.showToast("OBJECTIVE   "),_n(r),wr(),_){const k=await Bi([_]),S=(k==null?void 0:k.length)>0?k[0]:_,x=document.querySelector(`.GoalCard__root[data-goal-id="${n}"]`);if(x){const E=x.parentElement;if(E){const D=tu(S);E.replaceChild(D,x)}}else r.currentManagerTabId&&r.loadManagerGoals?await r.loadManagerGoals(r.currentManagerTabId):r.loadAllManagersGoals&&await r.loadAllManagersGoals();await((w=r.onGoalSaved)==null?void 0:w.call(r)),v&&await Vi(S)}return n}async function pw(t){var g;const{supabase:e,managerId:n,periodType:s,dates:i,category:a,memo:r,startRevenue:o,goalRevenue:l,context:c}=t,{data:d,error:u}=await e.from("ads_data_goal").insert({manager_id:parseInt(n,10),period_type:s,start_date:i.start_date,end_date:i.end_date,goal_category:a,memo:r||null,start_revenue:o?parseInt(o,10):null,goal_revenue:parseInt(l,10),activate:!0}).select().single();if(u)throw new Error(`  : ${u.message}`);const h=d.id;if(c.selectedClientIds.size>0){const m=Array.from(c.selectedClientIds).map(y=>({goal_id:h,client_id:String(y)})),{error:_}=await e.from("ads_data_goal_targetclient").insert(m);_&&console.error("  :",_)}const f=document.querySelectorAll(".action-item-input"),p=[];if(f.forEach(m=>{const _=m.value.trim();_&&p.push({goal_id:h,action_item:_,status:"progress"})}),p.length>0){const{error:m}=await e.from("ads_data_goal_actionitem").insert(p);m&&console.error("   :",m)}return c.showToast&&c.showToast("OBJECTIVE  "),_n(c),c.currentManagerTabId&&c.loadManagerGoals&&await c.loadManagerGoals(c.currentManagerTabId),await((g=c.onGoalSaved)==null?void 0:g.call(c)),h}async function Mr(t,e){t.preventDefault();const n=T();if(!n){Nt(new Error("Supabase   ."),"saveGoal","Supabase   .");return}const s=Gd(),{isEditMode:i,editGoalId:a}=s,r=fw(),{managerId:o,periodType:l,dateInput:c,category:d,memo:u,startRevenue:h,goalRevenue:f,actionItemInputs:p}=r,g=Iv({managerId:o,dateInput:c,category:d,goalRevenue:f,memo:u},p,i);if(!g.isValid){alert(g.message);return}try{const m=new Date(c),_=l==="weekly"?Fi(m):Wi(m);i&&a?await gw({supabase:n,editGoalId:a,category:d,memo:u,goalRevenue:f,context:e,dates:_,periodType:l}):await pw({supabase:n,managerId:o,periodType:l,dates:_,category:d,memo:u,startRevenue:h,goalRevenue:f,context:e})}catch(m){console.error(" / :",m),alert(" /   : "+(m instanceof Error?m.message:String(m)))}}function Ll(t){t&&(t.addEventListener("input",function(e){const n=e.target,s=n.value.replace(/[^\d]/g,"");n.value=L(s)}),t.addEventListener("keypress",function(e){const n=String.fromCharCode(e.which);/[0-9]/.test(n)||e.preventDefault()}))}function mw(){od("goal:modal:close-requested",()=>{const s=Gd();s.isEditMode&&s.originalGoalData&&Vi(s.originalGoalData),eu()});const t=document.getElementById("close-goal-modal-btn"),e=document.getElementById("cancel-goal-modal-btn");t&&t.addEventListener("click",()=>ga("goal:modal:close-requested",void 0)),e&&e.addEventListener("click",()=>ga("goal:modal:close-requested",void 0));const n=document.getElementById("goal-register-modal");n&&n.addEventListener("click",s=>{s.target===n&&ga("goal:modal:close-requested",void 0)})}function _w(){const t=document.getElementById("open-date-picker-btn");t&&t.addEventListener("click",Ua);const e=document.getElementById("goal-date-input");e&&e.addEventListener("click",Ua)}function yw(){const t=document.getElementById("goal-category-dropdown");if(!t)return;const e=t.querySelector(".GoalRegisterForm__categoryTrigger"),n=t.querySelector(".GoalRegisterForm__categoryMenu"),s=document.getElementById("goal-category-select");!e||!n||!s||(e.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),t.classList.toggle("open")}),n.querySelectorAll(".GoalRegisterForm__categoryItem").forEach(i=>{i.addEventListener("click",a=>{var d;a.stopPropagation();const r=i.dataset.value??"",o=((d=i.textContent)==null?void 0:d.trim())??"";s.value=r,t.setAttribute("data-value",r);const l=e.querySelector(".GoalRegisterForm__categoryValue"),c=e.querySelector(".GoalRegisterForm__categoryDot");l&&(l.textContent=o),c&&c.setAttribute("data-category",r),n.querySelectorAll(".GoalRegisterForm__categoryItem").forEach(u=>u.classList.remove("active")),i.classList.add("active"),t.classList.remove("open")})}),document.addEventListener("click",i=>{t.contains(i.target)||t.classList.remove("open")}))}function qi(t){const e=document.getElementById("goal-category-dropdown");if(!e)return;const n={upsales_big:" - ",upsales_smb:" - SMB",new:"",outbound:"",etc:""};e.setAttribute("data-value",t);const s=e.querySelector(".GoalRegisterForm__categoryTrigger");if(s){const a=s.querySelector(".GoalRegisterForm__categoryValue"),r=s.querySelector(".GoalRegisterForm__categoryDot");a&&(a.textContent=n[t]??t),r&&r.setAttribute("data-category",t)}const i=e.querySelector(".GoalRegisterForm__categoryMenu");i&&i.querySelectorAll(".GoalRegisterForm__categoryItem").forEach(a=>{const r=a.dataset.value===t;a.classList.toggle("active",r)})}function bw(){od("goal:category-dropdown:update",t=>{t!=null&&t.value&&qi(t.value)})}function vw(){const t=document.getElementById("start-revenue-input"),e=document.getElementById("goal-revenue-input");Ll(t),Ll(e);const n=document.getElementById("goal-memo-input");n&&(n.addEventListener("keydown",function(a){a.key==="Enter"&&a.preventDefault()}),n.addEventListener("input",function(a){const r=a.target;r.value=r.value.replace(/\n/g,""),sw(r.value)}));const s=document.getElementById("goal-date-input");s&&s.addEventListener("change",async function(){var r;await Hi();const a=(r=j.lastPercentage)==null?void 0:r.value;if(a!=null){const o=document.getElementById("start-revenue-input"),l=document.getElementById("goal-revenue-input");if(o&&l&&o.value){const c=parseInt(vi(o.value),10);Number.isNaN(c)||(l.value=L(String(Math.round(c+c*a/100))))}}});const i=document.getElementById("goal-revenue-input");i&&i.addEventListener("input",function(a){const r=a.target,l=r.value.trim().match(/^(\d+(?:\.\d+)?)\s*%?$/);if(l){const c=parseFloat(l[1]),d=document.getElementById("start-revenue-input");if(d!=null&&d.value){const u=parseInt(d.value.replace(/,/g,""),10)||0;if(u>0){const h=Math.round(u*(c/100));setTimeout(()=>{r.value=h.toLocaleString()},0),j.lastPercentage.value=c,B(`[ ] ${c}%  ${h.toLocaleString()}`)}}}}),yw()}function ww(){const t=document.getElementById("add-action-item-btn");t&&t.addEventListener("click",bs)}function kw(){bw(),mw(),_w(),vw(),ww()}function Tr(t){const e=t.selectedClientIds.size;t.selectedClientIds.clear(),t.availableClients=[],B(`[resetModalState] selectedClientIds : ${e} -> ${t.selectedClientIds.size}`),["goal-manager-select","start-revenue-input","goal-revenue-input","goal-memo-input","client-search-input"].forEach(u=>{const h=document.getElementById(u);if(h){const f=h;f.value="",f.disabled=!1,f.style.background="",f.style.color=""}});const s=document.getElementById("goal-date-input"),i=document.getElementById("open-date-picker-btn");s&&(s.value="",s.disabled=!1,s.style.background="",s.style.color=""),i&&(i.style.opacity="",i.style.cursor="",i.style.pointerEvents="");const a=document.getElementById("goal-category-select");a&&(a.value="upsales_big"),qi("upsales_big");const r=document.getElementById("selected-clients-tags"),o=document.getElementById("client-select-wrapper"),l=document.getElementById("client-select-options");r&&(r.innerHTML=""),o&&o.classList.remove("has-tags"),l&&(l.innerHTML='<li class="multi-select-option loading"> ...</li>');const c=document.getElementById("modal-right-section"),d=document.querySelector("#goal-register-modal .Modal__container");c&&(c.classList.remove("expanded"),c.style.display="none",c.innerHTML=""),d&&d.classList.remove("expanded","has-right-panel"),t.resetActionItems&&t.resetActionItems(),t.updateHiddenInput&&t.updateHiddenInput(),t.updateClientSelectCount&&t.updateClientSelectCount()}async function Sw(t){const e=A("goal-register-modal");if(!e)return;Tr(t),vr(!1,null,null),t.lastPercentage&&(t.lastPercentage.value=null),wr(),t.loadGoalManagerOptions&&await t.loadGoalManagerOptions(),Lv(t);const n=document.getElementById("goal-manager-select");if(n)if(t.currentManagerTabId)n.value=t.currentManagerTabId,n.disabled=!0,t.loadClientList&&await t.loadClientList(parseInt(t.currentManagerTabId,10));else{n.disabled=!1,n.value="";const o=document.getElementById("client-select-options");o&&(o.innerHTML='<li class="multi-select-option loading">  .</li>')}kr(t),Sr(t),await xw(t),e.classList.add("active"),document.body.style.overflow="hidden";const s=document.getElementById("goal-register-form");if(s){const o=s;o._submitHandler&&s.removeEventListener("submit",o._submitHandler);const l=async c=>{await Mr(c,t)};o._submitHandler=l,s.addEventListener("submit",l)}const i=document.getElementById("close-goal-modal-btn"),a=document.getElementById("cancel-goal-modal-btn"),r=()=>{_n(t)};i&&(i.onclick=null,i.addEventListener("click",r)),a&&(a.onclick=null,a.addEventListener("click",r)),e.onclick=null,e.addEventListener("click",o=>{o.target===e&&(o.stopPropagation(),r())})}async function xw(t){try{const e=new Date,n=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),a=`${n}-${s}-${i}`,r=document.getElementById("goal-date-input");r&&(r.value=a),t.datePickerState&&(t.datePickerState.selectedDate=e)}catch(e){console.error("[setTodayDate] :",e)}}async function Cw(t,e){const n=T();if(!n){console.error("[openGoalEditModal] Supabase  ");return}e.closeGoalDetailModal&&e.closeGoalDetailModal(),Tr(e),vr(!0,t.id,{...t});const s=A("goal-register-modal");if(!s)return;qd("EDIT OBJECTIVE"),Vd("");let i=t.manager_id;if(!i){const{data:v}=await n.from("ads_data_goal").select("manager_id").eq("id",t.id).single();v&&(i=v.manager_id)}if(document.getElementById("goal-manager-select")){e.loadGoalManagerOptions&&await e.loadGoalManagerOptions(),Ud(e);const v=document.getElementById("goal-manager-select");v&&(v.value=String(i??""),v.disabled=!0,v.style.background="#f5f5f5",v.style.color="#666"),e.loadClientList&&i!=null&&await e.loadClientList(i)}const r=document.getElementById("goal-date-input"),o=document.getElementById("open-date-picker-btn");r&&t.start_date&&(r.value=he(new Date(t.start_date)),r.disabled=!0,r.style.background="#f5f5f5",r.style.color="#666"),o&&(o.style.opacity="0.5",o.style.cursor="not-allowed",o.style.pointerEvents="none"),kr(e);const l=t.goal_category??"upsales_big",c=document.getElementById("goal-category-select");c&&(c.value=l),qi(l);const d=document.getElementById("goal-memo-input");d&&(d.value=t.memo??"");const u=document.getElementById("start-revenue-input");u&&(t.start_revenue!==null&&t.start_revenue!==void 0?u.value=L(t.start_revenue):u.value="",u.disabled=!0,u.style.background="#f5f5f5",u.style.color="#666");const h=document.getElementById("goal-revenue-input");h&&t.goal_revenue!=null&&(h.value=L(t.goal_revenue));const{data:f,error:p}=await n.from("ads_data_goal_targetclient").select("client_id").eq("goal_id",t.id);if(!p&&f){for(const v of f)e.selectedClientIds.add(String(v.client_id));e.renderSelectedClients&&e.renderSelectedClients(),e.updateClientSelectCount&&e.updateClientSelectCount(),e.updateHiddenInput&&e.updateHiddenInput()}Sr(e);const g=await Hd(t.id);(g==null?void 0:g.length)>0&&e.renderExistingActionItems&&e.renderExistingActionItems(g),s.classList.add("active"),document.body.style.overflow="hidden";const m=document.getElementById("goal-register-form");if(m){const v=m;v._submitHandler&&m.removeEventListener("submit",v._submitHandler);const w=async k=>{await Mr(k,e)};v._submitHandler=w,m.addEventListener("submit",w)}const _=document.getElementById("close-goal-modal-btn"),y=document.getElementById("cancel-goal-modal-btn"),b=async()=>{_n(e),t&&await Vi(t)};_&&(_.onclick=null,_.addEventListener("click",b)),y&&(y.onclick=null,y.addEventListener("click",b)),s.onclick=null,s.addEventListener("click",v=>{v.target===s&&(v.stopPropagation(),b())})}function Ew(t){const e=t?new Date(t):new Date,n=new Date(e);n.setDate(e.getDate()+7);const s=n.getDay(),i=s===0?-6:1-s;n.setDate(n.getDate()+i);const a=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),o=String(n.getDate()).padStart(2,"0");return`${a}-${r}-${o}`}async function Aw(t,e){const n=T();if(!n){console.error("[openGoalCloneModal] Supabase  ");return}e.closeGoalDetailModal&&e.closeGoalDetailModal(),Tr(e),vr(!1,null,null),wr();const s=A("goal-register-modal");if(!s)return;qd("CLONE OBJECTIVE"),Vd("");let i=t.manager_id;if(!i){const{data:S}=await n.from("ads_data_goal").select("manager_id").eq("id",t.id).single();S&&(i=S.manager_id)}if(document.getElementById("goal-manager-select")){e.loadGoalManagerOptions&&await e.loadGoalManagerOptions(),Ud(e);const S=document.getElementById("goal-manager-select");S&&i&&(S.value=String(i),S.disabled=!0,S.style.background="#f5f5f5",S.style.color="#666"),e.loadClientList&&i!=null&&await e.loadClientList(i)}const r=Ew(t.start_date),o=document.getElementById("goal-date-input"),l=document.getElementById("open-date-picker-btn");o&&(o.value=r,o.disabled=!1,o.style.background="",o.style.color=""),l&&(l.style.opacity="",l.style.cursor="",l.style.pointerEvents=""),e.datePickerState&&(e.datePickerState.selectedDate=new Date(r)),kr(e);const c=t.goal_category??"upsales_big",d=document.getElementById("goal-category-select");d&&(d.value=c),qi(c);const u=document.getElementById("goal-memo-input");u&&(u.value=t.memo??"");const h=document.getElementById("start-revenue-input");h&&(h.value="",h.disabled=!1,h.style.background="",h.style.color="");const f=document.getElementById("goal-revenue-input");f&&t.goal_revenue!=null&&(f.value=L(t.goal_revenue));const{data:p,error:g}=await n.from("ads_data_goal_targetclient").select("client_id").eq("goal_id",t.id);if(!g&&p){for(const S of p)e.selectedClientIds.add(String(S.client_id));e.renderSelectedClients&&e.renderSelectedClients(),e.updateClientSelectCount&&e.updateClientSelectCount(),e.updateHiddenInput&&e.updateHiddenInput()}Sr(e);const m=await Hd(t.id);if((m==null?void 0:m.length)>0&&e.renderExistingActionItems){const S=m.map(x=>({...x,status:"progress",done_memo:null}));e.renderExistingActionItems(S)}const y=e.calculateStartRevenue;y&&await y(),s.classList.add("active"),document.body.style.overflow="hidden";const b=document.getElementById("goal-register-form");if(b){const S=b;S._submitHandler&&b.removeEventListener("submit",S._submitHandler);const x=async E=>{await Mr(E,e)};S._submitHandler=x,b.addEventListener("submit",x)}const v=document.getElementById("close-goal-modal-btn"),w=document.getElementById("cancel-goal-modal-btn"),k=()=>{_n(e)};v&&(v.onclick=null,v.addEventListener("click",k)),w&&(w.onclick=null,w.addEventListener("click",k)),s.onclick=null,s.addEventListener("click",S=>{S.target===s&&(S.stopPropagation(),k())})}function Mw(){return`
<div id="goal-register-modal" class="Modal__overlay">
  <div class="Modal__container">
    <div class="Modal__contentWrapper">
      <div class="Modal__leftSection">
        <div class="Modal__header">
          <h3 class="Modal__title">NEW OBJECTIVE</h3>
          <button class="Modal__closeBtn" id="close-goal-modal-btn">
            <i class="ri-close-line"></i>
          </button>
        </div>
        <form id="goal-register-form" class="Modal__body" autocomplete="off">
          <div class="GoalRegisterForm__group">
            <label class="form-label"> <span class="required-asterisk">*</span></label>
            <div class="GoalRegisterForm__row">
              <div class="form-col half-col">
                <select id="goal-manager-select" class="form-input form-glass-select" required disabled>
                  <option value=""> </option>
                </select>
              </div>
              <div class="form-col half-col">
                <div class="date-picker-wrapper" id="date-picker-anchor">
                  <input type="text" id="goal-date-input" class="form-input date-input" readonly
                      placeholder=" ">
                  <i class="ri-calendar-line date-input-icon" id="open-date-picker-btn"></i>
                </div>
              </div>
            </div>
          </div>

          <div class="GoalRegisterForm__group">
            <label class="form-label">Target Client</label>
            <div class="multi-select-container">
              <div class="multi-select-input-wrapper" id="client-select-wrapper">
                <div class="selected-clients-tags" id="selected-clients-tags"></div>
                <input type="text" id="client-search-input" class="client-search-input"
                    placeholder="" autocomplete="off">
                <button type="button" class="multi-select-toggle-btn" id="client-select-toggle">
                  <i class="ri-arrow-down-s-line"></i>
                </button>
              </div>
              <div class="multi-select-dropdown" id="client-select-dropdown">
                <div class="multi-select-header">
                  <span class="multi-select-count" id="client-select-count">0 </span>
                  <div class="multi-select-header-actions">
                    <button type="button" class="multi-select-clear-all"
                        id="client-select-clear-all"> </button>
                    <span class="multi-select-separator">|</span>
                    <button type="button" class="multi-select-done" id="client-select-done"> </button>
                  </div>
                </div>
                <ul class="multi-select-options" id="client-select-options">
                  <li class="multi-select-option loading"> ...</li>
                </ul>
              </div>
            </div>
            <input type="hidden" id="selected-client-ids" name="selected-client-ids">
          </div>

          <div class="GoalRegisterForm__group">
            <label class="form-label">Target & Revenue <span class="required-asterisk">*</span></label>
            <div class="GoalRegisterForm__row">
              <div class="form-col third-col">
                <input type="hidden" id="goal-category-select" name="goal_category" value="upsales_big">
                <div class="GoalRegisterForm__categoryDropdown" id="goal-category-dropdown" data-value="upsales_big">
                  <button type="button" class="GoalRegisterForm__categoryTrigger">
                    <span class="GoalRegisterForm__categoryDot" data-category="upsales_big"></span>
                    <span class="GoalRegisterForm__categoryValue"> - </span>
                    <i class="ri-arrow-down-s-line GoalRegisterForm__categoryChevron"></i>
                  </button>
                  <div class="GoalRegisterForm__categoryMenu">
                    <div class="GoalRegisterForm__categoryItem active" data-value="upsales_big">
                      <span class="GoalRegisterForm__categoryDot" data-category="upsales_big"></span>
                       - 
                    </div>
                    <div class="GoalRegisterForm__categoryItem" data-value="upsales_smb">
                      <span class="GoalRegisterForm__categoryDot" data-category="upsales_smb"></span>
                       - SMB
                    </div>
                    <div class="GoalRegisterForm__categoryItem" data-value="new">
                      <span class="GoalRegisterForm__categoryDot" data-category="new"></span>
                      
                    </div>
                    <div class="GoalRegisterForm__categoryItem" data-value="outbound">
                      <span class="GoalRegisterForm__categoryDot" data-category="outbound"></span>
                      
                    </div>
                    <div class="GoalRegisterForm__categoryItem" data-value="etc">
                      <span class="GoalRegisterForm__categoryDot" data-category="etc"></span>
                      
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-col third-col">
                <input type="text" id="start-revenue-input" class="form-input"
                    placeholder="Ads Revenue" inputmode="numeric" autocomplete="off">
              </div>
              <div class="form-col third-col">
                <input type="text" id="goal-revenue-input" class="form-input" required
                    placeholder="Revenue Goal" inputmode="numeric" autocomplete="off">
              </div>
            </div>
          </div>

          <div class="GoalRegisterForm__group">
            <label class="form-label">Objective <span class="required-asterisk">*</span></label>
            <input type="text" id="goal-memo-input" class="form-input form-single-line"
                placeholder="Set Your Objective" maxlength="200" autocomplete="off" autocapitalize="off"
                autocorrect="off" spellcheck="false">
          </div>

          <div class="GoalRegisterForm__group">
            <label class="form-label">Action Item</label>
            <div id="action-items-container">
              <div class="action-item-row">
                <input type="text" class="form-input action-item-input"
                    placeholder="Add Your Action Item" data-action-index="0" autocomplete="off">
                <button type="button" class="action-item-add-btn" id="add-action-item-btn">
                  <i class="ri-add-line"></i>
                </button>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-cancel" id="cancel-goal-modal-btn"></button>
            <button type="submit" class="btn-submit"></button>
          </div>
        </form>
      </div>
      <div class="modal-right-section" id="modal-right-section">
        <div class="modal-right-header">
          <h3 class="modal-right-title">  (0)</h3>
        </div>
        <div class="modal-right-content">
          <p class="empty-selection-message"> </p>
        </div>
      </div>
    </div>
  </div>
</div>
`}function Tw(t){t.insertAdjacentHTML("beforeend",Mw())}function Tn(t,e){const n=t.querySelector(".Modal__closeBtn");n&&(n.onclick=()=>e()),t.onclick=s=>{s.target===t&&e()}}function pa(t,e){const n=t.querySelector(".Modal__editBtn");n&&(n.onclick=async()=>{!window.goalRegisterContext&&window.createGoalRegisterContext&&(window.goalRegisterContext=window.createGoalRegisterContext()),window.goalRegisterContext&&Cw(e,window.goalRegisterContext)});let s=t.querySelector(".Modal__cloneBtn");if(!s){const i=t.querySelector(".Modal__headerActions"),a=t.querySelector(".Modal__closeBtn");i&&(s=document.createElement("button"),s.className="Modal__cloneBtn",s.id="clone-goal-detail-btn",s.title="  ",s.innerHTML='<i class="ri-file-copy-line"></i>',a?i.insertBefore(s,a):i.appendChild(s))}s&&(s.onclick=async()=>{!window.goalRegisterContext&&window.createGoalRegisterContext&&(window.goalRegisterContext=window.createGoalRegisterContext()),window.goalRegisterContext&&Aw(e,window.goalRegisterContext)})}async function Rw(t,e,n,s){var r;const i=T();if(!i||!s)return;let a;if(e==="progress"?a="done":e==="done"?a="failed":a="progress",a==="progress"){const{error:o}=await i.from("ads_data_goal_actionitem").update({status:a}).eq("id",t);if(o){console.error("    :",o),alert("      .");return}(r=s.querySelector(".GoalDetailModal__actionMemoInputWrapper"))==null||r.remove();const{data:l}=await i.from("ads_data_goal_actionitem").select("status, done_memo").eq("id",t).single(),c=l;c&&pt(t,c.status??a,c.done_memo??null)}else await br(t,a,n,s)}async function Dw(t,e){const n=T();if(!n){e.innerHTML='<div class="GoalCard__empty-state">   </div>';return}try{const{data:s,error:i}=await n.from("ads_data_goal_actionitem").select("id, action_item, status, done_memo").eq("goal_id",t).order("id",{ascending:!0});if(i){e.innerHTML='<div class="GoalCard__empty-state">  </div>';return}const a=s??[];if(a.length===0){e.innerHTML='<div class="GoalCard__empty-state">  </div>';return}e.innerHTML=a.map(r=>Od(r,t)).join("")}catch(s){console.error("   :",s),e.innerHTML='<div class="GoalCard__empty-state"> </div>'}}function Iw(t,e,n,s){let i=A("summary-detail-modal");if(!i){i=document.createElement("div"),i.id="summary-detail-modal",i.className="Modal__overlay",i.innerHTML=`
      <div class="Modal__container">
        <div class="Modal__header">
          <h2 class="Modal__title"> </h2>
          <button class="Modal__closeBtn" id="close-summary-detail-modal-btn"></button>
        </div>
        <div class="Modal__body" id="summary-detail-modal-body"></div>
      </div>
    `,document.body.appendChild(i);const v=A("close-summary-detail-modal-btn");v&&v.addEventListener("click",()=>{i.style.display="none"}),i.addEventListener("click",w=>{w.target===i&&(i.style.display="none")})}let a=0;t.totalStartRevenue>0&&(a=(t.totalCurrentRevenue/t.totalStartRevenue-1)*100);const r=t.totalGoalRevenue-t.totalStartRevenue,o=t.growthAmount>=0?"+":"-",l=r>=0?"+":"",c=a>=0?"+":"-",d=L(t.totalStartRevenue),u=L(Math.abs(t.growthAmount)),h=L(Math.abs(r)),f=L(t.totalCurrentRevenue),p=L(t.totalGoalRevenue),g=Math.round(Math.abs(a)),m=Math.round(t.achievementRate),_=a>=0?"summary-badge-growth":"summary-badge-decline";let y="summary-badge-low";t.achievementRate>=100&&(y="summary-badge-high");const b=A("summary-detail-modal-body");b&&(b.innerHTML=`
      <div class="summary-card-detail goal-category-${n}">
        <div class="summary-card-detail-content">
          <span class="GoalCard__categoryBadge goal-category-${n}">${Ee(s)}</span>
          <div class="summary-detail-text">
            <span>${f}</span> <span class="summary-text-muted">(${p})</span> = <span>${d}</span> <span>${o} ${u}</span> <span class="summary-text-muted">(${l}${h})</span>
          </div>
          <div class="summary-rate-group">
            <span class="summary-rate-badge ${_}">  ${c}${g}%</span>
            <span class="summary-rate-badge ${y}">  ${m}%</span>
          </div>
        </div>
      </div>
    `),i.style.display="flex"}function sk(t,e){if(!t||!e)return;t.classList.contains("expanded")?(t.classList.remove("expanded"),e.textContent=""):(t.classList.add("expanded"),e.textContent="")}async function Vi(t,e=null,n){var c,d;const s=document.getElementById("goal-detail-modal"),i=document.getElementById("goal-detail-body");if(!s||!i)return;const a=async()=>{var u;s.classList.remove("active"),document.body.style.overflow="";try{const h=document.getElementById("manager-content-area"),f=((u=window.weeklyGoalState)==null?void 0:u.currentManagerTabId)??null;await jd(h,f)}catch(h){console.error("  :",h)}};let r=e;if(r||(r=document.querySelector(`.GoalCard__root[data-goal-id="${t.id}"]`)),r){const u=r.cloneNode(!0);u.classList.add("GoalCard__root--currentWeek");const h=u.querySelector(".GoalCard__body");h&&(h.style.flexDirection="row",h.style.display="flex"),(c=u.querySelector(".GoalCard__description--compact"))==null||c.classList.remove("GoalCard__description--compact"),(d=u.querySelector(".GoalCard__objective--compact"))==null||d.classList.remove("GoalCard__objective--compact");const f=u.querySelector(".GoalCard__body-left");let p=u.querySelector(".GoalCard__body-right");f&&(f.style.flex="1",f.style.minWidth="0"),!p&&h?(p=document.createElement("div"),p.className="GoalCard__body-right",p.style.flex="1",p.style.minWidth="0",p.innerHTML=`
        <div class="GoalCard__actions">
          <div class="GoalCard__section-title">
            <i class="ri-list-check-2"></i>
            <span> </span>
          </div>
          <div class="GoalCard__actions-list" data-actions-container>
            <div class="GoalCard__empty-state"> ...</div>
          </div>
        </div>
      `,h.appendChild(p)):p&&(p.style.flex="1",p.style.minWidth="0"),i.innerHTML="",i.appendChild(u),u.addEventListener("click",async m=>{const y=m.target.closest(".action-item-icon");if(!y)return;m.preventDefault(),m.stopPropagation();const b=y.closest(".GoalCard__action-item");if(b){const v=b.getAttribute("data-action-item-id"),w=b.getAttribute("data-status")??"progress",k=u.getAttribute("data-goal-id");v&&k&&await Rw(parseInt(v,10),w,parseInt(k,10),b)}}),Tn(s,a),pa(s,t),s.classList.add("active"),document.body.style.overflow="hidden";const g=u.querySelector("[data-actions-container]")??u.querySelector(".GoalCard__actions-list");g&&t.id&&Dw(t.id,g);return}const o=F.goalDetails.get(t.id);if(o&&Kn(o,F.goalDetailTtl)){const u=o.data;Av(u,s,i),s.classList.add("active"),document.body.style.overflow="hidden",Tn(s,a),pa(s,u.goal);return}if(!T()){i.innerHTML='<p class="empty-state">   .  .</p>',s.classList.add("active"),document.body.style.overflow="hidden",Tn(s,a);return}i.innerHTML='<p class="empty-state">  ...</p>',s.classList.add("active"),document.body.style.overflow="hidden";try{await Mv(t,i,n),Tn(s,a),pa(s,t)}catch(u){const h=u.message;if(h==="RACE_ABORT")return;Y("   "),i.innerHTML=`<p class="empty-state">    .<br><small>${Ee(h)}</small></p>`,s.classList.add("active"),document.body.style.overflow="hidden",Tn(s,a)}}function Lw(){const t=A("goal-detail-modal");t&&t.classList.remove("active"),document.body.style.overflow=""}function tu(t){const e=dr(t),{achievementRateDecimal:n,startRevenue:s,goalRevenue:i,currentRevenue:a,targetGrowth:r,actualGrowth:o,growthRate:l,growthRatePercent:c}=e,d=`goal-category-${t.goal_category??"etc"}`,u=dn[t.goal_category]??t.goal_category??"",h=ur(t,e),f=t.targetClientsInfo??{clientNames:[],totalCount:0},p=f.clientNames??[],g=f.totalCount??0,m=c>=0?"+":"",_=r>=0?"+":"",y=`  <strong>${L(s)}</strong> <strong>${m}${c}%</strong> / <strong>${_}${L(r)}</strong>  <strong>${L(i)}</strong>  .`,b=t.start_date?wi(t.start_date):"",v=t.end_date?wi(t.end_date):"",w=b&&v?`${b} - ${v}`:"",k=document.createElement("div");return k.className=`GoalCard__root ${d}`.trim(),k.setAttribute("data-goal-id",String(t.id)),k.innerHTML=`
        <div class="GoalCard__header">
            <div class="GoalCard__header-left">
                <span class="goal-category-badge goal-category-${t.goal_category??"etc"}">${Ee(u)}</span>
                <span class="GoalCard__objective GoalCard__objective--compact">${Ee(t.memo??"  ")}</span>
            </div>
            ${w?`<span class="GoalCard__date-range">${Ee(w)}</span>`:""}
        </div>
        <div class="GoalCard__description GoalCard__description--compact" style="--achievement-rate: ${n}">
            ${y}
        </div>
        <div class="GoalCard__body GoalCard__body--simple">
            <div class="GoalCard__body-left">
                <div class="GoalCard__metrics">
                    <div class="GoalCard__metric-group">
                        <div class="GoalCard__metric-row">
                            <div class="GoalCard__metric-item GoalCard__metric-item--target">
                                <span class="GoalCard__metric-label"></span>
                                <span class="GoalCard__metric-value">${L(i)}</span>
                            </div>
                            <div class="GoalCard__metric-item GoalCard__metric-item--achieved ${h.achievedRevenueClass}">
                                <span class="GoalCard__metric-label"></span>
                                <span class="GoalCard__metric-value">${L(a)}</span>
                            </div>
                        </div>
                        <div class="GoalCard__metric-row">
                            <div class="GoalCard__metric-item GoalCard__metric-item--target">
                                <span class="GoalCard__metric-label"> </span>
                                <span class="GoalCard__metric-value">${_}${L(r)}</span>
                            </div>
                            <div class="GoalCard__metric-item ${h.achievedGrowthClass}">
                                <span class="GoalCard__metric-label"> </span>
                                <span class="GoalCard__metric-value">${o>=0?"+":""}${L(o)}</span>
                            </div>
                        </div>
                        <div class="GoalCard__metric-row">
                            <div class="GoalCard__rate-item ${h.weeklyGrowthClass}">
                                <span class="GoalCard__rate-label">  </span>
                                <span class="GoalCard__rate-value">${l>=0?"+":""}${l}%</span>
                            </div>
                            <div class="GoalCard__rate-item ${h.goalAchievementClass}">
                                <span class="GoalCard__rate-label"> </span>
                                <span class="GoalCard__rate-value">${n}%</span>
                            </div>
                        </div>
                        <div class="GoalCard__clients">
                            <div class="GoalCard__section-title">
                                <i class="ri-focus-2-line"></i>
                                <span> </span>
                            </div>
                            <div class="GoalCard__clients-list">
                                ${g===0?'<div class="GoalCard__empty-state">  </div>':`<div class="GoalCard__client-item"><i class="ri-building-4-line"></i><span>${p.map(Ee).join(", ")}${g>=4?" ":""}  ${g}</span></div>`}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `,k}function ik(t,e,n,s,i){const a=document.createElement("div");a.className=`GoalCard__root summary-card-preview goal-category-${n}`;let r=0;t.totalStartRevenue>0&&(r=(t.totalCurrentRevenue/t.totalStartRevenue-1)*100);const o=t.totalGoalRevenue-t.totalStartRevenue,l=t.growthAmount>=0?"+":"-",c=o>=0?"+":"",d=r>=0?"+":"-",u=L(t.totalStartRevenue),h=L(Math.abs(t.growthAmount)),f=L(Math.abs(o)),p=L(t.totalCurrentRevenue),g=L(t.totalGoalRevenue),m=Math.round(Math.abs(r)),_=Math.round(t.achievementRate),y=r>=0?"summary-badge-growth":"summary-badge-decline";let b="summary-badge-low";return t.achievementRate>=100?b="summary-badge-high":t.achievementRate>=80&&(b="summary-badge-mid"),a.dataset.summaryData=JSON.stringify({categoryLabel:s,startRevenue:t.totalStartRevenue,growthAmount:t.growthAmount,targetGrowthAmount:o,currentRevenue:t.totalCurrentRevenue,goalRevenue:t.totalGoalRevenue,weekOverWeekRate:r,achievementRate:t.achievementRate,growthSign:l,targetGrowthSign:c,weekOverWeekSign:d}),a.innerHTML=`
        <div class="summary-card-preview-content">
            <span class="goal-category-badge goal-category-${n}">${Ee(s)}</span>
            <span class="summary-text-main"> : ${p} <span class="summary-text-muted">(${g})</span> = ${u} ${l} ${h} <span class="summary-text-muted">(${c}${f})</span></span>
            <span class="summary-rate-group">
                <span class="summary-rate-badge ${y}">${d}${m}%</span>
                <span class="summary-rate-badge ${b}">${_}%</span>
            </span>
        </div>
    `,a.style.cursor="pointer",a.addEventListener("click",()=>{Iw(t,e,n,s)}),a}function Ow(){return`
<div id="goal-detail-modal" class="Modal__overlay">
  <div class="Modal__container">
    <div class="Modal__header">
      <h3 class="Modal__title">OBJECTIVE DETAIL</h3>
      <div class="Modal__headerActions">
        <button class="Modal__editBtn" id="edit-goal-detail-btn" title="">
          <i class="ri-edit-line"></i>
        </button>
        <button class="Modal__cloneBtn" id="clone-goal-detail-btn" title="  ">
          <i class="ri-file-copy-line"></i>
        </button>
        <button class="Modal__closeBtn" id="close-goal-detail-modal-btn">
          <i class="ri-close-line"></i>
        </button>
      </div>
    </div>
    <div class="Modal__body" id="goal-detail-body">
    </div>
  </div>
</div>
`}function Pw(t){t.insertAdjacentHTML("beforeend",Ow())}const Ol={progress:{icon:"ri-loader-4-line",color:"#3b82f6"},done:{icon:"ri-check-line",color:"#10b981"},failed:{icon:"ri-close-line",color:"#ef4444"}};async function $w(t,e){var l;if(!window.supabase)return;const n=window.supabase,s=A(`action-item-${t}`),i=A(`memo-wrapper-${t}`),a=s?s.getAttribute("data-status")||"progress":e||"progress";let r="progress";if(a==="progress"||!a?r="done":a==="done"?r="failed":a==="failed"&&(r="progress"),r==="progress"){try{const{data:c}=await n.from("ads_data_goal_actionitem").select("goal_id").eq("id",t).single(),{error:d}=await n.from("ads_data_goal_actionitem").update({status:"progress",done_memo:null}).eq("id",t);if(d)throw d;const u=c;if(u!=null&&u.goal_id&&(F.actionItems.delete(u.goal_id),F.goalDetails.delete(u.goal_id)),pt(parseInt(t),"progress",null),i){i.style.display="none";const f=document.getElementById(`memo-input-${t}`);f&&(f.value="")}const h=document.getElementById(`action-item-${t}`);if(h){const f=h.querySelector(".GoalDetailModal__actionContent");if(f){const p=f.querySelector(".GoalDetailModal__actionMemoDisplay");p&&p.remove()}}}catch{alert("  .")}return}const o=Ol[r]||Ol.progress;if(s){const c=s.querySelector(".GoalDetailModal__actionPillIcon");c&&(c.innerHTML=`<i class="${o.icon}"></i>`,c.style.color=o.color,s.setAttribute("data-status",r))}if(i){i.style.display="block";const c=document.getElementById(`memo-input-${t}`);if(c){if(s){const d=s.querySelector(".GoalDetailModal__actionMemoDisplay");if(d&&a==="done"){const u=((l=d.textContent)==null?void 0:l.trim().replace("","").trim())??"";c.value=u}else c.value=""}else c.value="";c.focus(),c.placeholder="    "}i.dataset.nextStatus=r}}async function Nw(t){if(!window.supabase)return;const e=window.supabase,n=document.getElementById(`memo-wrapper-${t}`),s=document.getElementById(`memo-input-${t}`);if(!n||!s)return;const i=s.value.trim(),a=n.dataset.nextStatus;if(a)try{const r={status:a};i&&(r.done_memo=i);const{data:o}=await e.from("ads_data_goal_actionitem").select("goal_id").eq("id",t).single(),{error:l}=await e.from("ads_data_goal_actionitem").update(r).eq("id",t);if(l)throw l;const c=o;c!=null&&c.goal_id&&(F.actionItems.delete(c.goal_id),F.goalDetails.delete(c.goal_id)),pt(parseInt(t),a,i||null),n.style.display="none",s.value="",delete n.dataset.nextStatus}catch{alert("  .")}}function Bw(){window.supabase=T()??void 0,window.toggleActionItemStatus=$w,window.saveActionMemo=Nw}function jw(t,e,n){var l;if(t.classList.contains("readonly-cell")||t.classList.contains("editing"))return;const s=((l=t.textContent)==null?void 0:l.trim().replace(/,/g,""))??"";t.dataset.originalValue=s,t.classList.add("editing"),t.contentEditable="true",t.style.backgroundColor="#ffffff",t.style.cursor="text",t.textContent=s,setTimeout(()=>{t.focus();const c=document.createRange();c.selectNodeContents(t);const d=window.getSelection();d==null||d.removeAllRanges(),d==null||d.addRange(c)},0);const i=()=>{var d;const c=((d=t.textContent)==null?void 0:d.replace(/[^\d]/g,""))??"";c?(t.textContent=L(parseInt(c,10)),setTimeout(()=>{const u=t.firstChild;if(u){const h=document.createRange();h.selectNodeContents(u),h.collapse(!1);const f=window.getSelection();f==null||f.removeAllRanges(),f==null||f.addRange(h)}},0)):t.textContent=""},a=c=>{c.key==="Enter"?(c.preventDefault(),c.stopPropagation(),o(),e(t)):c.key==="Escape"&&(c.preventDefault(),c.stopPropagation(),o(),n(t))},r=()=>{o(),n(t)},o=()=>{t.removeEventListener("input",i),t.removeEventListener("keydown",a),t.removeEventListener("blur",r)};t.addEventListener("input",i),t.addEventListener("keydown",a),t.addEventListener("blur",r)}async function Fw(t,e){var g;const n=parseInt(t.dataset.managerId??"",10),s=t.dataset.monthKey??"",i=t.dataset.originalValue??"",a=((g=t.textContent)==null?void 0:g.trim().replace(/,/g,""))??"",r=a===""?0:parseInt(a,10);if(t.classList.remove("editing"),t.contentEditable="false",t.style.backgroundColor="",t.style.cursor="",delete t.dataset.originalValue,Number.isNaN(r)||r<0){t.textContent=i?L(parseInt(i,10)):"",t.style.textAlign="right";return}t.textContent=r>0?L(r):"",t.style.textAlign="right";const[o,l]=s.split("-").map(Number),c=new Date(o,l-1,1),d=new Date(o,l,0).getDate(),u=new Date(o,l-1,d),h=he(c),f=he(u),p=T();if(!p){Nt(new Error("Supabase   ."),"saveCellEditDirect");return}try{const{data:m,error:_}=await p.from("ads_data_goal").select("id").eq("manager_id",n).eq("period_type","monthly").eq("start_date",h).eq("end_date",f);if(_)throw _;const y=m??[];if(y.length>0){const{error:v}=await p.from("ads_data_goal").update({goal_revenue:r}).eq("id",y[0].id);if(v)throw v}else{const{error:v}=await p.from("ads_data_goal").insert({manager_id:n,period_type:"monthly",start_date:h,end_date:f,goal_category:null,memo:`${o} ${l} `,goal_revenue:r,start_revenue:0,activate:!0});if(v)throw v}const b=t.closest("tr");b&&e(b)}catch(m){console.error("  :",m),alert("    : "+(m.message??"   ")),t.textContent=i?L(parseInt(i,10)):"",t.style.textAlign="right"}}function Ww(t){const e=t.dataset.originalValue??"";t.classList.remove("editing"),t.contentEditable="false",t.style.backgroundColor="",t.style.cursor="",delete t.dataset.originalValue,t.textContent=e?L(parseInt(e,10)):"",t.style.textAlign="right"}function Gw(t){var c;const e=t.children[1],n=parseInt(((c=e==null?void 0:e.textContent)==null?void 0:c.replace(/,/g,""))??"0",10)||0,s=t.querySelectorAll(".editable-cell");let i=0,a=0;s.forEach(d=>{var h;const u=parseInt(((h=d.textContent)==null?void 0:h.replace(/,/g,""))??"0",10)||0;i+=u,u>0&&a++});const r=t.querySelector(".total-cell"),o=t.querySelector(".gap-cell");r&&(r.textContent=i>0?L(i):"");const l=s.length;if(o){if(a===l&&l>0){const d=i-n;o.textContent=d!==0?L(d):""}else o.textContent="";o.style.color="#94a3b8"}}async function Hw(t,e,n){const s=T();if(!s)throw new Error("Supabase   .");const{error:i}=await s.from("ads_data_client").update({manager_id:e}).eq("client_id",t);if(i)throw new Error(`Manager  : ${i.message}`);await sb(s,t,e),Y(` Client ID ${t}  "${n==="-"?"":n}"() .`)}function Pl(t){const e=document.querySelectorAll(".cell-glass-dropdown:not(.cell-glass-dropdown--second)");e!=null&&e.length&&e.forEach(n=>{n.hasAttribute("data-change-listener-attached")||(n.setAttribute("data-change-listener-attached","true"),n.addEventListener("dropdown-change",async s=>{const i=s.detail,a=i.value?parseInt(i.value,10):null,r=i.managerName||"";try{await Hw(i.clientId,a,r)}catch(o){console.error("[  ] :",o),Y(`   : ${o.message}`),t()}}))})}async function Uw(t,e,n){const s=T();if(!s)throw new Error("Supabase   .");const{error:i}=await s.from("ads_data_client").update({second_manager_id:e}).eq("client_id",t);if(i)throw new Error(`   : ${i.message}`);Y(` Client ID ${t}   "${n==="-"?"":n}"() .`)}function $l(t){const e=document.querySelectorAll(".cell-glass-dropdown--second");e!=null&&e.length&&e.forEach(n=>{n.hasAttribute("data-change-listener-attached")||(n.setAttribute("data-change-listener-attached","true"),n.addEventListener("dropdown-change",async s=>{const i=s.detail,a=i.value?parseInt(i.value,10):null,r=i.managerName||"";try{await Uw(i.clientId,a,r)}catch(o){console.error("[  ] :",o),Y(`    : ${o.message}`),t()}}))})}function qw(){const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function Vw(t){const[e,n]=t.split("-").map(Number),s=new Date(e,n+2,0);return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`}async function zw(){const t=T(),e=new Map;if(!t)return e;try{const n=await t.from("ads_data_client_outbound").select("id, client_id, outbound_start, outbound_end, created_at").order("created_at",{ascending:!1});if(n.error||!n.data)return e;const s=qw();for(const i of n.data){const a=Number(i.client_id),r=i.outbound_start.split("T")[0],o=i.outbound_end.split("T")[0];!e.has(a)&&r<=s&&o>=s&&e.set(a,{...i,client_id:a,outbound_start:r,outbound_end:o})}return e}catch{return e}}function Kw(t,e,n,s){const i=`${t} ${String(e).padStart(2,"0")}`,a=new Date(t,e-1,1).getDay(),r=new Date(t,e,0).getDate(),o=a===0?6:a-1;let l="",c=1;const d=Math.ceil((o+r)/7)*7;for(let u=0;u<d;u++){if(u%7===0&&(l+="<tr>"),u<o||c>r)l+="<td></td>";else{const h=`${t}-${String(e).padStart(2,"0")}-${String(c).padStart(2,"0")}`;let f="outbound-cal-day";n===h&&(f+=" outbound-cal-day--start"),s===h&&(f+=" outbound-cal-day--end"),n&&s&&h>n&&h<s&&(f+=" outbound-cal-day--range");const p=u%7;p===5&&(f+=" outbound-cal-day--sat"),p===6&&(f+=" outbound-cal-day--sun"),l+=`<td><span class="${f}" data-date="${h}">${c}</span></td>`,c++}u%7===6&&(l+="</tr>")}return`
    <div class="outbound-cal-nav">
      <button type="button" class="outbound-cal-nav-btn" data-action="prev-month">&lt;</button>
      <span class="outbound-cal-month-label">${i}</span>
      <button type="button" class="outbound-cal-nav-btn" data-action="next-month">&gt;</button>
    </div>
    <table class="outbound-cal-table">
      <thead>
        <tr><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr>
      </thead>
      <tbody>${l}</tbody>
    </table>
  `}async function Yw(t,e,n){const s=T();if(!s)return;const i=await s.from("ads_data_client_outbound").insert({client_id:String(t),outbound_start:e,outbound_end:n});if(i.error)throw new Error(i.error.message);await s.from("ads_data_client").update({outbound:!0}).eq("client_id",t),Y("    ")}async function Jw(t,e,n){const s=T();if(!s)return;const i=await s.from("ads_data_client_outbound").update({outbound_start:e,outbound_end:n}).eq("id",t);if(i.error)throw new Error(i.error.message);Y("     ")}async function Xw(t){var a,r;const e=T();if(!e)return;const n=await e.from("ads_data_client_outbound").select("id").eq("client_id",String(t)).order("created_at",{ascending:!1}).limit(1);if(n.error||!((a=n.data)!=null&&a.length))throw new Error("    .");const s=await e.from("ads_data_client_outbound").delete().eq("id",n.data[0].id);if(s.error)throw new Error(s.error.message);(r=(await e.from("ads_data_client_outbound").select("id").eq("client_id",String(t)).limit(1)).data)!=null&&r.length||await e.from("ads_data_client").update({outbound:!1}).eq("client_id",t),Y("    ")}const zi="outbound-setting-modal";let hn="start",_e=null,pe=null,Ci=null,Ei=null,rn=new Date().getFullYear(),qe=new Date().getMonth()+1,fn=null,nu="",gs=null,Bt=null;function Nl(t,e){Bt=e;const n=document.querySelectorAll(".outbound-setting-btn");n.length&&n.forEach(s=>{s.hasAttribute("data-outbound-listener-attached")||(s.setAttribute("data-outbound-listener-attached","true"),s.addEventListener("click",()=>{const i=parseInt(s.dataset.clientId??"",10),a=s.dataset.clientName??"",r=t.get(i)??null;Qw(i,a,r)}))})}function Qw(t,e,n){if(jt(),fn=t,nu=e||`Client ${t}`,gs=n,hn="start",n){_e=n.outbound_start,pe=n.outbound_end,Ci=n.outbound_start,Ei=n.outbound_end;const[s,i]=n.outbound_start.split("-").map(Number);rn=s,qe=i}else{_e=null,pe=null,Ci=null,Ei=null;const s=new Date;rn=s.getFullYear(),qe=s.getMonth()+1}Zw()}function jt(){const t=document.getElementById(zi);t&&(t.classList.remove("active"),setTimeout(()=>t.remove(),200)),document.removeEventListener("keydown",iu),fn=null,gs=null,_e=null,pe=null,Ci=null,Ei=null}function Zw(){const t=document.createElement("div");t.id=zi,t.className="outbound-setting-overlay",t.innerHTML=su(),t.addEventListener("click",e0),document.addEventListener("keydown",iu),document.body.appendChild(t),requestAnimationFrame(()=>t.classList.add("active"))}function li(){const t=document.getElementById(zi);t&&(t.innerHTML=su())}function su(){const t=gs!==null,e=t&&(_e!==Ci||pe!==Ei),n=Kw(rn,qe,_e,pe);let s;_e&&pe?s=`
      <div class="outbound-setting-dates">
        <span class="outbound-setting-date-item ${hn==="start"?"active":""}" data-field="start">
          ${_e}
        </span>
        <span class="outbound-setting-date-separator">~</span>
        <span class="outbound-setting-date-item ${hn==="end"?"active":""}" data-field="end">
          ${pe}
        </span>
      </div>
    `:s='<p class="outbound-setting-guide">  </p>';let i="";return t?e?i=`
        <div class="outbound-setting-actions">
          <button type="button" class="outbound-setting-action-btn outbound-setting-action-btn--danger" data-action="delete">  </button>
          <button type="button" class="outbound-setting-action-btn outbound-setting-action-btn--primary" data-action="update"></button>
        </div>`:i=`
        <div class="outbound-setting-actions">
          <button type="button" class="outbound-setting-action-btn outbound-setting-action-btn--danger" data-action="delete">  </button>
          <button type="button" class="outbound-setting-action-btn outbound-setting-action-btn--close" data-action="close"></button>
        </div>`:_e&&pe&&(i=`
      <div class="outbound-setting-actions">
        <button type="button" class="outbound-setting-action-btn outbound-setting-action-btn--primary" data-action="save"></button>
      </div>`),`
    <div class="outbound-setting-content">
      <div class="outbound-setting-header">
        <h3 class="outbound-setting-title">${nu}</h3>
        <span class="outbound-setting-subtitle">  </span>
      </div>
      <div class="outbound-setting-body">
        ${s}
        <div class="outbound-setting-calendar">
          ${n}
        </div>
      </div>
      ${i}
    </div>
  `}function e0(t){const e=t.target;if(e.id===zi){jt();return}if(e.closest('[data-action="prev-month"]')){qe--,qe<1&&(qe=12,rn--),li();return}if(e.closest('[data-action="next-month"]')){qe++,qe>12&&(qe=1,rn++),li();return}const n=e.closest(".outbound-cal-day");if(n!=null&&n.dataset.date){t0(n.dataset.date);return}const s=e.closest(".outbound-setting-date-item");if(s!=null&&s.dataset.field){hn=s.dataset.field;const a=hn==="start"?_e:pe;if(a){const[r,o]=a.split("-").map(Number);rn=r,qe=o}li();return}const i=e.closest("[data-action]");if(i){const a=i.dataset.action;a==="save"?n0():a==="update"?s0():a==="delete"?i0():a==="close"&&jt()}}function t0(t){hn==="start"?(_e=t,pe=Vw(t)):pe=t,li()}function iu(t){t.key==="Escape"&&jt()}async function n0(){if(!(!fn||!_e||!pe)){if(_e>pe){Y("     .");return}try{await Yw(fn,_e,pe),jt(),Bt&&Bt()}catch(t){Y(`  : ${t.message}`)}}}async function s0(){if(!(!gs||!_e||!pe)){if(_e>pe){Y("     .");return}try{await Jw(gs.id,_e,pe),jt(),Bt&&Bt()}catch(t){Y(`  : ${t.message}`)}}}async function i0(){if(fn)try{await Xw(fn),jt(),Bt&&Bt()}catch(t){Y(`  : ${t.message}`)}}let xe={column:null,order:null};function Bl(){return{...xe}}function jl(t,e){if(!xe.order||!e)return[...t];const n=[...t],s=xe.order;return n.sort((i,a)=>{let r,o;switch(e){case"created_at":r=i.created_at?new Date(i.created_at).getTime():0,o=a.created_at?new Date(a.created_at).getTime():0;break;case"client_id":r=i.client_id,o=a.client_id;break;case"client_name":r=(i.client_name??"").toString(),o=(a.client_name??"").toString();break;case"manager_id":r=i.manager_id==null?1/0:i.manager_id,o=a.manager_id==null?1/0:a.manager_id;break;case"second_manager_id":r=i.second_manager_id==null?1/0:i.second_manager_id,o=a.second_manager_id==null?1/0:a.second_manager_id;break;case"outbound":r=i.outbound===!0?1:0,o=a.outbound===!0?1:0;break;default:r=i[e],o=a[e]}return s==="asc"?typeof r=="string"?r.localeCompare(o):r-o:typeof r=="string"?o.localeCompare(r):o-r}),n}function a0(t){xe.column===t?xe.order==="asc"?xe.order="desc":xe.order==="desc"?xe.order=null:xe.order="asc":(xe.column=t,xe.order="asc")}function au(t,e){const n=t.querySelector(".sort-icon");if(n&&n.remove(),xe.column===e&&xe.order){const s=document.createElement("span");s.className="sort-icon",s.style.marginLeft="4px",s.style.fontSize="10px",s.textContent=xe.order==="asc"?"":"",t.appendChild(s)}}function r0(t){if(!t)return;t.querySelectorAll("th[data-column]").forEach(n=>{const s=n.dataset.column;s&&au(n,s)})}function o0(t,e,n,s){t.textContent=n,t.style.textAlign="center",t.style.cursor="pointer",t.style.userSelect="none",t.dataset.column=e,au(t,e),t.addEventListener("click",()=>{a0(e),s&&s()})}function ru(){document.querySelectorAll(".cell-glass-dropdown.open").forEach(t=>{t.classList.remove("open")}),document.querySelectorAll(".cell-glass-dropdown__menu--portal, .bulk-glass-dropdown__menu--portal").forEach(t=>{t.classList.remove("cell-glass-dropdown__menu--visible"),setTimeout(()=>t.remove(),200)})}function Fl(t,e,n,s,i){const a=document.createElement("div");a.className=`cell-glass-dropdown${i?` ${i}`:""}`,a.dataset.clientId=String(t);const r=n!=null?e.get(n)??"-":"-",o=document.createElement("button");o.type="button",o.className="cell-glass-dropdown__trigger";const l=document.createElement("span");l.className="cell-glass-dropdown__value",l.textContent=r,o.appendChild(l);const c=document.createElement("span");c.className="cell-glass-dropdown__chevron",c.innerHTML="&#9662;",o.appendChild(c),a.appendChild(o);function d(){var p;const u=document.createElement("div");u.className="cell-glass-dropdown__menu cell-glass-dropdown__menu--portal";const h=document.createElement("div");return h.className=`glass-dropdown-item${n==null?" active":""}`,h.dataset.value="",h.textContent="-",u.appendChild(h),s.forEach(g=>{const m=document.createElement("div"),_=a.dataset.selectedValue??"",y=_?_===String(g):n===g;m.className=`glass-dropdown-item${y?" active":""}`,m.dataset.value=String(g),m.textContent=e.get(g)??"",u.appendChild(m)}),(a.dataset.selectedValue??"")||(p=u.querySelector(".glass-dropdown-item"))==null||p.classList.add("active"),u.addEventListener("click",g=>{const m=g.target.closest(".glass-dropdown-item");if(!m)return;g.stopPropagation();const _=m.dataset.value??"";l.textContent=m.textContent??"-",a.dataset.selectedValue=_,a.classList.remove("open"),u.classList.remove("cell-glass-dropdown__menu--visible"),setTimeout(()=>u.remove(),200),a.dispatchEvent(new CustomEvent("dropdown-change",{detail:{clientId:t,value:_,managerName:m.textContent??"-"}}))}),u}return o.addEventListener("click",u=>{u.preventDefault(),u.stopPropagation();const h=a.classList.contains("open");if(ru(),h)return;const f=d();document.body.appendChild(f);const p=o.getBoundingClientRect(),g=4;f.style.minWidth=`${p.width}px`,f.style.left=`${p.left}px`;const m=window.innerHeight-p.bottom-g,_=p.top-g;m>=200||m>=_?(f.style.top=`${p.bottom+g}px`,f.style.bottom=""):(f.style.top="",f.style.bottom=`${window.innerHeight-p.top+g}px`),a.classList.add("open"),requestAnimationFrame(()=>{f.classList.add("cell-glass-dropdown__menu--visible")})}),a.dataset.selectedValue=n!=null?String(n):"",a}function l0(t){if(!t)return"";const e=new Date(t);if(Number.isNaN(e.getTime()))return"";const n=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${n}. ${s}. ${i}.`}function Wl(t,e,n,s){t.innerHTML="";const i=Array.from(n.keys()).sort((r,o)=>r-o),a=i.filter(r=>r!==98);e.forEach(r=>{const o=document.createElement("tr"),l=document.createElement("td");l.style.textAlign="center",l.style.width="50px";const c=document.createElement("input");c.type="checkbox",c.className="client-checkbox",c.dataset.clientId=String(r.client_id),l.appendChild(c),o.appendChild(l);const d=document.createElement("td");d.textContent=l0(r.created_at),d.style.textAlign="center",d.style.fontFamily="'Roboto Mono', monospace",d.className="manager-setting-date-cell",o.appendChild(d);const u=document.createElement("td");u.textContent=String(r.client_id),u.style.textAlign="center",u.style.fontFamily="'Roboto Mono', monospace",o.appendChild(u);const h=document.createElement("td");h.textContent=$t(r.client_name??""),h.style.textAlign="center",o.appendChild(h);const f=document.createElement("td");f.style.textAlign="center";const p=Fl(r.client_id,n,r.manager_id,i);f.appendChild(p),o.appendChild(f);const g=document.createElement("td");g.style.textAlign="center";const m=Fl(r.client_id,n,r.second_manager_id??null,a,"cell-glass-dropdown--second");g.appendChild(m),o.appendChild(g);const _=document.createElement("td");_.style.textAlign="center";const y=document.createElement("button");y.type="button";const b=(s==null?void 0:s.has(Number(r.client_id)))??!1;y.className=`outbound-setting-btn${b?" outbound-setting-btn--active":""}`,y.dataset.clientId=String(r.client_id),y.dataset.clientName=$t(r.client_name??""),y.textContent=b?"":"",_.appendChild(y),o.appendChild(_),t.appendChild(o)})}async function c0(t){const e=T();if(!e)return Nt(new Error("Supabase   ."),"fetchManagerSettingData"),null;let n=e.from("ads_data_client").select("client_id, client_name, manager_id, second_manager_id, outbound, created_at").order("client_id",{ascending:!0});t&&(n=n.is("manager_id",null));const{data:s,error:i}=await n;if(i)throw new Error(`  : ${i.message}`);if(!(s!=null&&s.length))return null;const a=s,{data:r,error:o}=await e.from("shared_manager").select("id, manager_name").eq("manager_team","ads").in("id",[1,2,3,4,5,98]).order("id",{ascending:!0});o&&console.error("Manager   :",o);const l=new Map;if(r!=null&&r.length){for(const c of r)l.set(c.id,c.manager_name??`Manager ${c.id}`);l.has(98)||l.set(98,"Manager 98")}else{for(let c=1;c<=5;c++)l.set(c,`Manager ${c}`);l.set(98,"Manager 98")}return{clients:a,managerMap:l}}let Rn=null,Dn=null,Gl=!1;async function qa(t,e){const n=A("manager-setting-tbody"),s=A("manager-setting-thead");if(!n||!s){console.error("Manager Setting     .");return}const i=A("show-unassigned-btn"),a=!!(i!=null&&i.classList.contains("active"));let r;try{r=await c0(a)}catch(g){Rn=null,Dn=null,console.error("Manager Setting  :",g),n.innerHTML='<tr><td colspan="7" class="empty-state">    : '+g.message+"</td></tr>";return}if(!r){Rn=null,Dn=null,n.innerHTML='<tr><td colspan="7" class="empty-state"> </td></tr>';return}const{clients:o,managerMap:l}=r,c=await zw();for(const g of o)g.outbound=c.has(Number(g.client_id));Rn=o,Dn=l;const d=()=>qa(t,e);function u(){r0(s);const g=jl(Rn,Bl().column);Wl(n,g,Dn,c),t().then(()=>{Pl(d),$l(d),Nl(c,d)})}const h=()=>{Rn&&Dn?u():qa(t,e)},f=s.querySelector("tr");if(f){f.innerHTML="";const g=document.createElement("th");g.style.textAlign="center",g.style.width="50px",f.appendChild(g);const m=[["created_at","DATE"],["client_id","Client ID"],["client_name","Client"],["manager_id",""],["second_manager_id"," "],["outbound","OUT-BOUND"]];for(const[_,y]of m){const b=document.createElement("th");o0(b,_,y,h),f.appendChild(b)}}const p=jl(o,Bl().column);Wl(n,p,l,c),await t(),e(),Pl(d),$l(d),Nl(c,d),Gl||(document.addEventListener("click",g=>{const m=g.target;m.closest(".cell-glass-dropdown")||m.closest(".cell-glass-dropdown__menu--portal")||m.closest(".bulk-glass-dropdown__menu--portal")||ru()}),Gl=!0)}let Jn=[];function d0(){const t=document.getElementById("bulk-manager-dropdown");t==null||t.classList.remove("open"),document.querySelectorAll(".bulk-glass-dropdown__menu--portal").forEach(e=>{e.classList.remove("cell-glass-dropdown__menu--visible"),setTimeout(()=>e.remove(),200)})}async function u0(){const t=T();if(!t)return;const e=document.getElementById("bulk-manager-dropdown");if(e)try{const{data:n,error:s}=await t.from("shared_manager").select("id, manager_name").eq("manager_team","ads").in("id",[1,2,3,4,5,98]).order("id",{ascending:!0});if(s){console.error("Manager   :",s);return}if(Jn=[],n!=null&&n.length)for(const r of n)Jn.push({id:r.id,name:r.manager_name??`Manager ${r.id}`});else for(const r of[1,2,3,4,5,98])Jn.push({id:r,name:`Manager ${r}`});e.dataset.selectedValue="";const i=e.querySelector(".cell-glass-dropdown__value");i&&(i.textContent=" ");const a=e.querySelector(".cell-glass-dropdown__trigger");a&&!a.hasAttribute("data-bulk-listener")&&(a.setAttribute("data-bulk-listener","true"),a.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation();const o=e.classList.contains("open");if(document.querySelectorAll(".cell-glass-dropdown.open").forEach(f=>f.classList.remove("open")),document.querySelectorAll(".cell-glass-dropdown__menu--portal, .bulk-glass-dropdown__menu--portal").forEach(f=>{f.classList.remove("cell-glass-dropdown__menu--visible"),setTimeout(()=>f.remove(),200)}),o)return;const l=h0(e,i);document.body.appendChild(l);const c=a.getBoundingClientRect(),d=4;l.style.minWidth=`${c.width}px`,l.style.left=`${c.left}px`;const u=window.innerHeight-c.bottom-d,h=c.top-d;u>=200||u>=h?(l.style.top=`${c.bottom+d}px`,l.style.bottom=""):(l.style.top="",l.style.bottom=`${window.innerHeight-c.top+d}px`),e.classList.add("open"),requestAnimationFrame(()=>{l.classList.add("cell-glass-dropdown__menu--visible")})}),document.addEventListener("click",r=>{const o=r.target;o.closest("#bulk-manager-dropdown")||o.closest(".bulk-glass-dropdown__menu--portal")||d0()}))}catch(n){console.error("    :",n)}}function h0(t,e){const n=document.createElement("div");n.className="cell-glass-dropdown__menu--portal bulk-glass-dropdown__menu--portal";const s=t.dataset.selectedValue??"",i=document.createElement("div");i.className=`glass-dropdown-item${s?"":" active"}`,i.dataset.value="",i.textContent=" ",n.appendChild(i);for(const a of Jn){const r=document.createElement("div");r.className=`glass-dropdown-item${s===String(a.id)?" active":""}`,r.dataset.value=String(a.id),r.textContent=a.name,n.appendChild(r)}return n.addEventListener("click",a=>{const r=a.target.closest(".glass-dropdown-item");if(!r)return;a.stopPropagation();const o=r.dataset.value??"";t.dataset.selectedValue=o,e.textContent=r.textContent??" ",t.classList.remove("open"),n.classList.remove("cell-glass-dropdown__menu--visible"),setTimeout(()=>n.remove(),200)}),n}async function f0(t){var d;const e=T();if(!e){Y("   ");return}const n=document.getElementById("bulk-manager-dropdown"),s=(n==null?void 0:n.dataset.selectedValue)??"";if(!s){Y("  ");return}const i=parseInt(s,10);if(Number.isNaN(i)){Y("   ");return}const a=((d=Jn.find(u=>u.id===i))==null?void 0:d.name)??"",r=document.querySelectorAll("#manager-setting-table .client-checkbox:checked");if(!r.length){Y("    ");return}const o=Array.from(r).map(u=>parseInt(u.dataset.clientId??"",10));if(o.length===0){Y("   ");return}if(!confirm(`${o.length}   "${a}" ?`))return;const l=A("save-managers-btn"),c=(l==null?void 0:l.textContent)??"";l&&(l.setAttribute("disabled","true"),l.textContent=" ...");try{const{error:u}=await e.from("ads_data_client").update({manager_id:i}).in("client_id",o);if(u)throw new Error(`  : ${u.message}`);if(await ib(e,o,i),Y(` ${o.length}   "${a}"() `),r.forEach(h=>h.checked=!1),n){n.dataset.selectedValue="";const h=n.querySelector(".cell-glass-dropdown__value");h&&(h.textContent=" ")}await t()}catch(u){console.error("[saveSelectedManagers]   :",u),Y(`   : ${u.message}`)}finally{l&&(l.removeAttribute("disabled"),l.textContent=c)}}async function g0(t){const e=A("goal-setting-tbody");!e||e.hasAttribute("data-delegated")||(e.setAttribute("data-delegated","true"),e.addEventListener("dblclick",function(n){const i=n.target.closest("td.editable-cell");i&&!i.classList.contains("readonly-cell")&&!i.classList.contains("editing")&&(n.stopPropagation(),t(i))}))}function p0(t,e){const n=document.getElementById("show-unassigned-btn");n&&!n.hasAttribute("data-listener-attached")&&(n.setAttribute("data-listener-attached","true"),n.addEventListener("click",function(){this.classList.toggle("active"),t==null||t()}));const s=A("save-managers-btn");s&&!s.hasAttribute("data-listener-attached")&&t&&e&&(s.setAttribute("data-listener-attached","true"),s.addEventListener("click",async()=>{await e(t)}))}function m0(t,e){return e?`${t}/${e}`:t}const tt={dashboard:()=>Xe(()=>import("./index-BoEwlzj5.js"),__vite__mapDeps([3,1,4])),"sales-report":()=>Xe(()=>import("./index-Bfmsk32O.js"),[]),"sales-report/daily":()=>Xe(()=>import("./index-Bfmsk32O.js"),[]),"sales-report/weekly":()=>Xe(()=>import("./index-Bfmsk32O.js"),[]),"goal/monthly":()=>Xe(()=>import("./index-CoKPUul2.js"),__vite__mapDeps([0,1,2])),"goal/weekly":()=>Xe(()=>import("./index-oU2ABZ4C.js"),[]),"setting/goal-setting":()=>Xe(()=>import("./index-B0QNUSyj.js"),[]),"setting/manager-setting":()=>Xe(()=>import("./index-B0QNUSyj.js"),[])};let ce=null;function _0(t){ce=t}let Be={};async function ou(){if(Be.destroy)try{Be.destroy()}finally{Be={}}}function Fn(t){const e=async()=>{if(await ou(),t==="sales-report"){const n=jn('.Sidebar__navItem[data-page="sales-report"] .Sidebar__subItem[data-sub-page="daily"]'),s=jn('.Sidebar__navItem[data-page="sales-report"] .Sidebar__subItem[data-sub-page="weekly"]');n&&n.classList.add("active"),s&&s.classList.remove("active");const i=await tt["sales-report"]();i.initReportsPage(),Be={destroy:i.destroy};return}if(t==="dashboard"){const n=await tt.dashboard();n.initDashboardPage(),Be={destroy:n.destroy};return}if(t==="goal"){Ie("#goal-page .tab-content").forEach(l=>l.classList.remove("active"));const s=A("goal-monthly-tab");s&&s.classList.add("active"),Ie('.Sidebar__navItem[data-page="goal"] .Sidebar__subItem').forEach(l=>l.classList.remove("active"));const a=jn('.Sidebar__navItem[data-page="goal"] .Sidebar__subItem[data-sub-page="monthly"]');a&&a.classList.add("active");const r=await tt["goal/monthly"]();if(typeof r.state<"u"){const l=r.state;l.selectedManagerId=null,r.setActiveManagerTab(null)}const o=await rd();typeof r.state<"u"&&(r.state.selectedMonth=o),r.updateMonthDisplay(),await r.initGoalMonthly(),Be={destroy:r.destroy};return}if(t==="setting"){(await tt["setting/manager-setting"]()).initSettingsPage(),Ie("#setting-page .tab-content").forEach(o=>o.classList.remove("active"));const i=A("manager-setting-tab");i&&i.classList.add("active"),Ie('.Sidebar__navItem[data-page="setting"] .Sidebar__subItem').forEach(o=>o.classList.remove("active"));const r=jn('.Sidebar__navItem[data-page="setting"] .Sidebar__subItem[data-sub-page="manager-setting"]');r&&(r.classList.add("active"),setTimeout(()=>ce==null?void 0:ce.loadManagerSetting(),0)),Be={};return}};setTimeout(()=>e(),0)}function lu(t,e){const n=async()=>{const s=m0(t,e),i=tt[s];if(i){if(t==="sales-report"){Ie("#sales-report-page .tab-content").forEach(o=>o.classList.remove("active"));const r=A(`${e}-tab`);if(r){r.classList.add("active");const o=await i();o.initReportsPage(),e==="daily"?o.loadDailyReport():e==="weekly"&&o.loadWeeklyReport(),Be={destroy:o.destroy}}return}if(t==="goal"){Ie("#goal-page .tab-content").forEach(o=>o.classList.remove("active"));const r=A(`goal-${e}-tab`);if(r){if(r.classList.add("active"),e==="weekly")await tt["goal/weekly"](),setTimeout(()=>{ce==null||ce.loadGoalManagerOptions(),ce==null||ce.initLoadManagerTabs(),ce==null||ce.setupRegisterButtonListener()},0),Be={};else if(e==="monthly"){await ou();const o=await tt["goal/monthly"](),l=o.state;l&&(l.selectedManagerId=null,o.setActiveManagerTab(null));const c=await rd();l&&(l.selectedMonth=c),o.updateMonthDisplay(),await o.initGoalMonthly(),Be={destroy:o.destroy}}}return}if(t==="setting"){(await tt[s]()).initSettingsPage(),Ie("#setting-page .tab-content").forEach(l=>l.classList.remove("active"));const o=A(`${e}-tab`);o&&(o.classList.add("active"),e==="goal-setting"?(await(await tt["goal/weekly"]()).loadGoalSetting(),await(ce==null?void 0:ce.setupGoalSettingEvents())):e==="manager-setting"&&(ce==null||ce.loadManagerSetting())),Be={}}}};setTimeout(()=>n(),0)}function y0(){const t=Ie(".Sidebar__navItem"),e=Ie(".page");t.forEach(n=>{n.addEventListener("click",function(s){s.preventDefault(),t.forEach(r=>r.classList.remove("active")),this.classList.add("active"),e.forEach(r=>r.classList.remove("active"));const i=this.getAttribute("data-page"),a=A(`${i}-page`);a&&(a.classList.add("active"),window.scrollTo({top:0}),a.scrollTop=0,Fn(i??""))})})}function b0(){Ie(".Sidebar__subItem").forEach(e=>{e.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation();const s=this.closest(".Sidebar__navItem");if(!s)return;const i=s.getAttribute("data-page");s.querySelectorAll(".Sidebar__subItem").forEach(o=>o.classList.remove("active")),this.classList.add("active"),window.scrollTo({top:0});const r=this.getAttribute("data-sub-page");lu(i??"",r??"")})})}function v0(){const t=Ie(".manager-tabs .tab-btn"),e=Ie(".manager-tab-content");t.forEach(n=>{n.addEventListener("click",function(){t.forEach(a=>a.classList.remove("active")),this.classList.add("active"),e.forEach(a=>a.classList.remove("active"));const s=this.getAttribute("data-manager-tab"),i=A(`manager-${s}-tab`);i&&i.classList.add("active")})})}function w0(){const t=document.querySelector(".page.active");if(!t)return;const e=t.id;if(e==="dashboard-page"){Fn("dashboard");return}if(e==="sales-report-page"){Fn("sales-report");return}if(e==="goal-page"){const n=document.querySelector('.Sidebar__navItem[data-page="goal"] .Sidebar__subItem.active');(n==null?void 0:n.getAttribute("data-sub-page"))==="weekly"?lu("goal","weekly"):Fn("goal");return}if(e==="setting-page"){Fn("setting");return}}function k0(t){_0(t),y0(),b0(),v0(),w0()}class S0{constructor(){C(this,"root",null)}render(e){e.insertAdjacentHTML("beforeend",`
      <aside class="Sidebar">
        <div class="Sidebar__header">
          <div class="Sidebar__logo">
            <i class="ri-bar-chart-grouped-fill"></i>
            <span>Data Board</span>
          </div>
        </div>
        <nav class="Sidebar__nav">
          <ul class="Sidebar__navMenu">
            <li class="Sidebar__navItem active" data-page="dashboard">
              <a href="#" class="Sidebar__navLink">
                <i class="ri-dashboard-3-line Sidebar__navIcon"></i>
                <span class="Sidebar__navText">Dashboard</span>
              </a>
            </li>
            <li class="Sidebar__navItem" data-page="sales-report">
              <div class="Sidebar__navLinkWrapper">
                <a href="#" class="Sidebar__navLink">
                  <i class="ri-pie-chart-2-line Sidebar__navIcon"></i>
                  <span class="Sidebar__navText">Report</span>
                  <i class="ri-arrow-down-s-line Sidebar__arrowIcon"></i>
                </a>
              </div>
              <ul class="Sidebar__subMenu">
                <li class="Sidebar__subItem active" data-sub-page="daily">
                  <a href="#" class="Sidebar__subLink" data-tab="daily">
                    <span class="Sidebar__dot"></span>Daily Report
                  </a>
                </li>
                <li class="Sidebar__subItem" data-sub-page="weekly">
                  <a href="#" class="Sidebar__subLink" data-tab="weekly">
                    <span class="Sidebar__dot"></span>Weekly Report
                  </a>
                </li>
              </ul>
            </li>
            <li class="Sidebar__navItem" data-page="goal">
              <div class="Sidebar__navLinkWrapper">
                <a href="#" class="Sidebar__navLink">
                  <i class="ri-focus-3-line Sidebar__navIcon"></i>
                  <span class="Sidebar__navText">Goal</span>
                  <i class="ri-arrow-down-s-line Sidebar__arrowIcon"></i>
                </a>
              </div>
              <ul class="Sidebar__subMenu">
                <li class="Sidebar__subItem" data-sub-page="monthly">
                  <a href="#" class="Sidebar__subLink" data-tab="goal-monthly">
                    <span class="Sidebar__dot"></span>Monthly
                  </a>
                </li>
                <li class="Sidebar__subItem" data-sub-page="weekly">
                  <a href="#" class="Sidebar__subLink" data-tab="goal-weekly">
                    <span class="Sidebar__dot"></span>Weekly
                  </a>
                </li>
              </ul>
            </li>
            <li class="Sidebar__navItem" data-page="setting">
              <div class="Sidebar__navLinkWrapper">
                <a href="#" class="Sidebar__navLink">
                  <i class="ri-settings-3-line Sidebar__navIcon"></i>
                  <span class="Sidebar__navText">Setting</span>
                  <i class="ri-arrow-down-s-line Sidebar__arrowIcon"></i>
                </a>
              </div>
              <ul class="Sidebar__subMenu">
                <li class="Sidebar__subItem" data-sub-page="goal-setting">
                  <a href="#" class="Sidebar__subLink" data-tab="goal-setting">
                    <span class="Sidebar__dot"></span>Goal Setting
                  </a>
                </li>
                <li class="Sidebar__subItem" data-sub-page="manager-setting">
                  <a href="#" class="Sidebar__subLink" data-tab="manager-setting">
                    <span class="Sidebar__dot"></span>Manager Setting
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </nav>
        <div class="Sidebar__footer">
          <button class="Sidebar__updateBtn" type="button">
            <i class="ri-refresh-line"></i> Update Data
          </button>
        </div>
      </aside>
    `),this.root=e.querySelector(".Sidebar")}destroy(){var e;(e=this.root)==null||e.remove(),this.root=null}}class x0{constructor(){C(this,"root",null);C(this,"sidebar",null)}render(e){const n=document.createElement("div");n.className="dashboard-container";const s=document.createElement("div");s.className="sidebar-mount",n.appendChild(s),n.insertAdjacentHTML("beforeend",`
      <main class="main-content" id="main-content">
        <div class="page active" id="dashboard-page"></div>
        <div class="page" id="sales-report-page"></div>
        <div class="page" id="goal-page">
          <div class="tab-content" id="goal-monthly-tab"></div>
          <div class="tab-content active" id="goal-weekly-tab">
            <div class="goal-weekly-header">
              <div class="manager-tabs-container goal-weekly-header-tabs">
                <div class="manager-tabs" id="manager-tabs"></div>
              </div>
              <button class="register-btn" id="open-goal-modal-btn" type="button">
                <i class="ri-add-line"></i> 
              </button>
            </div>
            <div class="report-section" id="manager-content-area">
              <p class="empty-state"> .</p>
            </div>
          </div>
        </div>
        <div class="page" id="setting-page"></div>
      </main>
    `),this.sidebar=new S0,this.sidebar.render(s),e.appendChild(n),this.root=n}destroy(){var e,n;(e=this.sidebar)==null||e.destroy(),this.sidebar=null,(n=this.root)==null||n.remove(),this.root=null}}class C0{constructor(){C(this,"root",null);C(this,"overlay",null);C(this,"closeBtn",null);C(this,"openCsvBtn",null);C(this,"importBtn",null);C(this,"progressArea",null);C(this,"progressBar",null);C(this,"progressStatus",null);C(this,"progressDetail",null);C(this,"forceCheckbox",null);C(this,"forceDateRange",null);C(this,"forceStartInput",null);C(this,"forceEndInput",null);C(this,"isForceMode",!1);C(this,"boundClose",()=>this.close());C(this,"boundOverlayClick",e=>{e.target===this.overlay&&this.close()});C(this,"boundCsvClick",()=>{window.open(rb,"_blank")});C(this,"boundImportClick",()=>this.handleImportClick());C(this,"boundForceChange",()=>{var e;this.toggleForceMode(((e=this.forceCheckbox)==null?void 0:e.checked)??!1)})}render(e){var s,i,a,r,o;e.insertAdjacentHTML("beforeend",`
      <div id="data-update-modal" class="DataUpdateModal__overlay">
        <div class="DataUpdateModal__modal">
          <div class="DataUpdateModal__header">
            <h3 class="DataUpdateModal__title">
              <i class="ri-database-2-line"></i>
              Data Import
            </h3>
            <button class="DataUpdateModal__close" id="data-update-modal-close" type="button">
              <i class="ri-close-line"></i>
            </button>
          </div>
          <div class="DataUpdateModal__body">
            <div class="DataUpdateModal__desc">
              <a href="https://redash.dable.io/queries/12601/" target="_blank" rel="noopener noreferrer" class="DataUpdateModal__codeLink">&lt;/&gt;</a>      CSV 
            </div>
            <div class="DataUpdateModal__desc">
              Google Sheets CSV   .
            </div>
            <div class="DataUpdateModal__forceSection">
              <label class="DataUpdateModal__forceToggle">
                <input type="checkbox" id="data-update-force-checkbox">
                <span class="DataUpdateModal__forceToggleTrack">
                  <span class="DataUpdateModal__forceToggleThumb"></span>
                </span>
                <span class="DataUpdateModal__forceToggleLabel"> </span>
              </label>
              <div class="DataUpdateModal__forceDateRange" id="data-update-force-date-range" style="display:none;">
                <div class="DataUpdateModal__forceDateRow">
                  <div class="DataUpdateModal__forceDateField">
                    <label class="DataUpdateModal__forceDateLabel"></label>
                    <input type="date" class="DataUpdateModal__forceDateInput" id="data-update-force-start">
                  </div>
                  <span class="DataUpdateModal__forceDateSeparator">~</span>
                  <div class="DataUpdateModal__forceDateField">
                    <label class="DataUpdateModal__forceDateLabel"></label>
                    <input type="date" class="DataUpdateModal__forceDateInput" id="data-update-force-end">
                  </div>
                </div>
                <p class="DataUpdateModal__forceWarning">
                  <i class="ri-error-warning-line"></i>
                        .
                </p>
              </div>
            </div>
            <div class="DataUpdateModal__actions">
              <button class="DataUpdateModal__btnCsv" id="data-update-open-csv" type="button">
                <i class="ri-file-text-line"></i>
                <span>CSV</span>
              </button>
              <button class="DataUpdateModal__btnImport" id="data-update-import" type="button">
                <i class="ri-upload-cloud-2-line"></i>
                <span>IMPORT</span>
              </button>
            </div>
            <div class="DataUpdateModal__progressArea" id="data-update-progress-area" style="display:none;">
              <div class="DataUpdateModal__progressStatus" id="data-update-progress-status"> ...</div>
              <div class="DataUpdateModal__progressTrack">
                <div class="DataUpdateModal__progressBar" id="data-update-progress-bar"></div>
              </div>
              <div class="DataUpdateModal__progressDetail" id="data-update-progress-detail"></div>
            </div>
          </div>
        </div>
      </div>
    `),this.root=e.lastElementChild,this.overlay=this.root,this.closeBtn=this.root.querySelector("#data-update-modal-close"),this.openCsvBtn=this.root.querySelector("#data-update-open-csv"),this.importBtn=this.root.querySelector("#data-update-import"),this.progressArea=this.root.querySelector("#data-update-progress-area"),this.progressBar=this.root.querySelector("#data-update-progress-bar"),this.progressStatus=this.root.querySelector("#data-update-progress-status"),this.progressDetail=this.root.querySelector("#data-update-progress-detail"),this.forceCheckbox=this.root.querySelector("#data-update-force-checkbox"),this.forceDateRange=this.root.querySelector("#data-update-force-date-range"),this.forceStartInput=this.root.querySelector("#data-update-force-start"),this.forceEndInput=this.root.querySelector("#data-update-force-end"),(s=this.closeBtn)==null||s.addEventListener("click",this.boundClose),(i=this.overlay)==null||i.addEventListener("click",this.boundOverlayClick),(a=this.openCsvBtn)==null||a.addEventListener("click",this.boundCsvClick),(r=this.importBtn)==null||r.addEventListener("click",this.boundImportClick),(o=this.forceCheckbox)==null||o.addEventListener("change",this.boundForceChange)}open(){this.overlay&&(this.progressArea&&(this.progressArea.style.display="none",this.progressArea.classList.remove("done","error")),this.progressBar&&(this.progressBar.style.width="0%"),this.progressStatus&&(this.progressStatus.textContent=""),this.progressDetail&&(this.progressDetail.textContent=""),this.importBtn&&(this.importBtn.disabled=!1),this.resetForceMode(),this.overlay.classList.add("active"))}close(){var e;(e=this.overlay)==null||e.classList.remove("active")}toggleForceMode(e){if(this.isForceMode=e,this.forceDateRange&&(this.forceDateRange.style.display=e?"block":"none"),this.importBtn){const n=this.importBtn.querySelector("i"),s=this.importBtn.querySelector("span");e?(this.importBtn.classList.add("DataUpdateModal__btnImport--force"),n&&(n.className="ri-alert-line"),s&&(s.textContent=" Import")):(this.importBtn.classList.remove("DataUpdateModal__btnImport--force"),n&&(n.className="ri-upload-cloud-2-line"),s&&(s.textContent="IMPORT"))}}resetForceMode(){this.isForceMode=!1,this.forceCheckbox&&(this.forceCheckbox.checked=!1),this.forceDateRange&&(this.forceDateRange.style.display="none"),this.forceStartInput&&(this.forceStartInput.value=""),this.forceEndInput&&(this.forceEndInput.value=""),this.toggleForceMode(!1)}async handleImportClick(){var e,n;if(this.isForceMode){const s=(e=this.forceStartInput)==null?void 0:e.value,i=(n=this.forceEndInput)==null?void 0:n.value;if(!s||!i){this.progressArea&&(this.progressArea.style.display="block",this.progressArea.classList.add("error")),this.progressStatus&&(this.progressStatus.textContent=""),this.progressDetail&&(this.progressDetail.textContent="   .");return}if(s>i){this.progressArea&&(this.progressArea.style.display="block",this.progressArea.classList.add("error")),this.progressStatus&&(this.progressStatus.textContent=""),this.progressDetail&&(this.progressDetail.textContent="    .");return}}this.importBtn&&(this.importBtn.disabled=!0),this.openCsvBtn&&(this.openCsvBtn.disabled=!0),this.progressArea&&(this.progressArea.style.display="block",this.progressArea.classList.remove("done","error"));try{const s=a=>{this.progressBar&&(this.progressBar.style.width=`${a.percent}%`),this.progressStatus&&(this.progressStatus.textContent=a.stage),this.progressDetail&&(this.progressDetail.textContent=a.detail??"")};this.isForceMode&&this.forceStartInput&&this.forceEndInput?await db(this.forceStartInput.value,this.forceEndInput.value,s):await cb(s),this.progressArea&&this.progressArea.classList.add("done"),this.progressBar&&(this.progressBar.style.width="100%"),this.progressStatus&&(this.progressStatus.textContent=" ");const i=this.isForceMode?"  ":"  ";setTimeout(()=>{this.close(),localStorage.setItem("data-update-toast",i),window.location.reload()},800)}catch(s){const i=s instanceof Error?s.message:String(s);this.progressArea&&(this.progressArea.classList.add("error"),this.progressArea.style.display="block"),this.progressStatus&&(this.progressStatus.textContent=" "),this.progressDetail&&(this.progressDetail.textContent=i),this.importBtn&&(this.importBtn.disabled=!1),this.openCsvBtn&&(this.openCsvBtn.disabled=!1)}}destroy(){var e,n,s,i,a,r;(e=this.closeBtn)==null||e.removeEventListener("click",this.boundClose),(n=this.overlay)==null||n.removeEventListener("click",this.boundOverlayClick),(s=this.openCsvBtn)==null||s.removeEventListener("click",this.boundCsvClick),(i=this.importBtn)==null||i.removeEventListener("click",this.boundImportClick),(a=this.forceCheckbox)==null||a.removeEventListener("change",this.boundForceChange),(r=this.root)==null||r.remove(),this.root=null,this.overlay=null,this.closeBtn=null,this.openCsvBtn=null,this.importBtn=null,this.progressArea=null,this.progressBar=null,this.progressStatus=null,this.progressDetail=null,this.forceCheckbox=null,this.forceDateRange=null,this.forceStartInput=null,this.forceEndInput=null}}let Xn=null;function E0(t){Xn=new C0,Xn.render(t)}function A0(){Xn==null||Xn.open()}function M0(){const t=document.querySelector(".update-btn");t&&t.addEventListener("click",()=>A0())}const T0=t=>Gw(t),R0=t=>Fw(t,T0),D0=t=>Ww(t),I0=t=>jw(t,R0,D0),L0=()=>g0(I0),O0=()=>p0(Rr,P0),Rr=()=>qa($0,O0),P0=()=>f0(Rr),$0=()=>u0();async function N0(){const t=document.getElementById("manager-content-area");if(t){Rd(null);try{await Ev(t),B("[loadAllManagersGoals]     ")}catch{}}}async function cu(t,e=[]){const n=document.getElementById("manager-content-area");if(!(!T()||!n)){Rd(t);try{await Cv(n,t),B(`[loadManagerGoals]  ${t}   `)}catch{}}}async function B0(){return Kb(N0,cu,rt)}function j0(){var n;const t=document.getElementById("open-goal-modal-btn");if(!t)return;const e=t.cloneNode(!0);(n=t.parentNode)==null||n.replaceChild(e,t),e.addEventListener("click",async s=>{s.stopPropagation(),window.goalRegisterContext=Ar(),await Sw(window.goalRegisterContext)})}function F0(){const t=document.getElementById("app");if(!t)return;new x0().render(t),E0(t),Tw(document.body),Pw(document.body);const n=localStorage.getItem("data-update-toast");n&&(localStorage.removeItem("data-update-toast"),setTimeout(()=>Y(n),500)),Jy(),Ga.preCacheCommon(),B("[Phase 1] Performance utilities initialized:",{domCacheSize:Ga.size,chartRegistrySize:id.size,pendingRequests:Ni.pendingCount}),Hb(),Tv(j),hw(),ew(cu),Bw(),Ob(),Pb(),hb(kd,Td),k0({initLoadManagerTabs:B0,loadGoalManagerOptions:Jd,setupRegisterButtonListener:j0,setupGoalSettingEvents:L0,loadManagerSetting:Rr}),M0(),kw()}document.addEventListener("DOMContentLoaded",F0);export{nw as $,sw as A,Hi as B,dn as C,lw as D,iw as E,tk as F,ow as G,Lw as H,_n as I,eu as J,Ar as K,Hb as L,J0 as M,Gd as N,nk as O,j as P,Mr as Q,K0 as R,Y0 as S,z0 as T,tw as U,Jd as V,G0 as W,Kb as X,Ua as Y,Sw as Z,Iw as _,ad as a,jd as a0,ek as a1,Od as a2,Gi as a3,Cr as a4,rw as a5,Pw as a6,Tw as a7,xr as a8,Ui as a9,rt as aA,Ww as aB,jw as aC,u0 as aD,qa as aE,Fw as aF,f0 as aG,g0 as aH,p0 as aI,Gw as aJ,aw as aa,X0 as ab,Nw as ac,Er as ad,cw as ae,Rd as af,Q0 as ag,vr as ah,Tv as ai,ew as aj,Bw as ak,ww as al,kw as am,hw as an,vw as ao,mw as ap,br as aq,dw as ar,Cv as as,Ev as at,$w as au,Xd as av,pt as aw,qi as ax,Qd as ay,Zd as az,T as b,L as c,B as d,id as e,he as f,A as g,Nt as h,Ee as i,Pb as j,hb as k,Td as l,kd as m,Bi as n,H0 as o,U0 as p,V0 as q,q0 as r,Ob as s,tu as t,Vi as u,Pd as v,sk as w,ik as x,bs as y,Z0 as z};
