import{a as I,n as R,o as M,p as N,q as b,r as A,C as S,t as x,u as B,v as P,w as F,x as $}from"./index-DEwrhD7r.js";import{y as X,z as Z,A as ee,B as ae,D as te,E as se,F as ne,G as oe,H as re,I as le,J as ie,K as ce,L as de,M as ue,N as ge,O as me,P as pe,Q as fe,R as ve,S as ye,T as ke,U as _e,V as we,W as he,X as Se,Y as Ce,Z as Ge,_ as We,$ as Le,a0 as De,a1 as Re,a2 as Me,a3 as Ne,a4 as Ae,a5 as Ee,a6 as He,a7 as Oe,a8 as Te,a9 as Ie,aa as be,ab as xe,ac as Be,ad as Pe,ae as Fe,af as $e,ag as qe,ah as ze,ai as je,aj as Ue,ak as Ve,al as Ye,am as Je,an as Ke,ao as Qe,ap as Xe,aq as Ze,ar as ea,as as aa,at as ta,au as sa,av as na,aw as oa,ax as ra,ay as la,az as ia,aA as ca}from"./index-DEwrhD7r.js";async function U(a,e,v,n){if(!(!a||!e)){a.innerHTML='<p class="empty-state">데이터를 불러오는 중...</p>';try{let s=await I();if(!s)return;if(s=s.filter(o=>o.id!==98&&o.id!==99),s.length===0){a.innerHTML='<p class="empty-state">등록된 매니저가 없습니다.</p>';return}const c=s.map(o=>o.id),{data:r,error:m}=await e.from("ads_data_goal").select("id, manager_id, period_type, start_date, end_date, goal_category, memo, start_revenue, goal_revenue, activate, updated_at").in("manager_id",c).eq("activate",!0).order("start_date",{ascending:!1});if(m){a.innerHTML='<p class="empty-state">데이터를 불러오는 중 오류가 발생했습니다.</p>';return}const i=r??[];if(i.length===0){a.innerHTML='<p class="empty-state">등록된 목표가 없습니다.</p>';return}const d=i.filter(o=>o.period_type==="weekly");if(d.length===0){a.innerHTML='<p class="empty-state">등록된 주간 목표가 없습니다.</p>';return}const l=await R(d),u=M(l);n.allWeeksData=u,n.weekNavigationState={weeksOffset:0,nextWeekOffset:0,loadedRange:{startOffset:-2,endOffset:2}},n.currentContentArea=a,n.currentShowSummary=!0;const p=N(u);v(a,p,!0)}catch(s){console.error("목표 데이터 로드 오류:",s),a.innerHTML='<p class="empty-state">데이터를 불러오는 중 오류가 발생했습니다.</p>'}}}async function V(a,e,v,n,s,c=[]){if(!(!e||!v)){e.innerHTML='<p class="empty-state">데이터를 불러오는 중...</p>';try{const{data:r,error:m}=await v.from("ads_data_goal").select("id, manager_id, period_type, start_date, end_date, goal_category, memo, start_revenue, goal_revenue, activate, updated_at").eq("manager_id",a).eq("activate",!0).order("start_date",{ascending:!1});if(m){e.innerHTML='<p class="empty-state">데이터를 불러오는 중 오류가 발생했습니다.</p>';return}const i=r??[];if(i.length===0){e.innerHTML='<p class="empty-state">등록된 목표가 없습니다.</p>';return}const d=i.filter(o=>o.period_type==="weekly");if(d.length===0){e.innerHTML='<p class="empty-state">등록된 주간 목표가 없습니다.</p>';return}const l=await R(d,!1,c),u=M(l);s.allWeeksData=u,s.weekNavigationState={weeksOffset:0,nextWeekOffset:0,loadedRange:{startOffset:-2,endOffset:2}},s.currentContentArea=e,s.currentShowSummary=!1;const p=N(u);n(e,p,!1)}catch(r){console.error("목표 데이터 로드 오류:",r),e.innerHTML='<p class="empty-state">데이터를 불러오는 중 오류가 발생했습니다.</p>'}}}async function Y(a,e,v,n){if(!e.allWeeksData||!e.currentContentArea||!e.weekNavigationState)return;await b(a,e.allWeeksData,e.weekNavigationState,n),a==="prev"?e.weekNavigationState.nextWeekOffset===2?e.weekNavigationState.nextWeekOffset=1:e.weekNavigationState.nextWeekOffset===1?e.weekNavigationState.nextWeekOffset=0:e.weekNavigationState.weeksOffset===0&&e.weekNavigationState.nextWeekOffset===0&&(e.weekNavigationState.weeksOffset=-1):e.weekNavigationState.weeksOffset===-1?e.weekNavigationState.weeksOffset=0:e.weekNavigationState.weeksOffset===0&&e.weekNavigationState.nextWeekOffset===0?e.weekNavigationState.nextWeekOffset=1:e.weekNavigationState.nextWeekOffset===1&&(e.weekNavigationState.nextWeekOffset=2);const s=A(e.allWeeksData,e.weekNavigationState);v(e.currentContentArea,s.weeks,e.currentShowSummary??!1)}function J(a,e,v=!1,n,s){a.innerHTML="";let c=e,r={col1:"지난 주",col2:"이번 주",col3:"다음 주"};if(n.allWeeksData&&n.allWeeksData.length>0&&n.weekNavigationState){const t=A(n.allWeeksData,n.weekNavigationState);c=t.weeks,r=t.columnConfig}if(c.length===0){a.innerHTML='<p class="empty-state">등록된 목표가 없습니다.</p>';return}const m=new Date;m.setHours(0,0,0,0);const i=m.getDay(),d=m.getDate()-i+(i===0?-6:1),l=new Date(m);l.setDate(d),l.setHours(0,0,0,0);const u=document.createElement("div");u.className="GoalsLayout__headerRowNew GoalsLayout__headerRow--3col";const p=r.col1??"지난 주",o=r.col2??"이번 주",g=r.col3??"다음 주",h=p==="이번 주",C=o==="이번 주",E=g==="이번 주";u.appendChild(L("◀",p,h)),u.appendChild(L("",o,C)),u.appendChild(L("",g,E,"▶")),a.appendChild(u);let w=null;if(v){const t=document.createElement("div");t.className="GoalsLayout__categoryDivider summary-divider",t.innerHTML=`
      <span class="GoalsLayout__dividerLine"></span>
      <span class="GoalsLayout__dividerText summary-badge" id="summary-toggle-badge">요약</span>
      <span class="GoalsLayout__dividerLine"></span>
    `,a.appendChild(t),w=document.createElement("div"),w.className="summary-section",w.id="summary-section",w.style.display="none",a.appendChild(w)}if(Object.keys(S).forEach(t=>{const y=c.map(f=>f.goals.filter(k=>(k.goal_category||"etc")===t));if(y.some(f=>f.length>0)){const f=document.createElement("div");f.className="GoalsLayout__categoryDivider",f.innerHTML=`<span class="GoalsLayout__dividerLine"></span><span class="GoalsLayout__dividerText GoalCard__categoryBadge goal-category-${t}">${S[t]??t}</span><span class="GoalsLayout__dividerLine"></span>`,a.appendChild(f);const k=document.createElement("div");k.className="GoalsLayout__categoryRowNew GoalsLayout__categoryRow--3col",c.forEach((G,H)=>{const W=document.createElement("div");W.className="GoalsLayout__weekColumnNew";const O=y[H]??[],D=document.createDocumentFragment();O.forEach(T=>{D.appendChild(x(T))}),W.appendChild(D),k.appendChild(W)}),a.appendChild(k)}}),a.hasAttribute("data-arrow-delegated")||(a.setAttribute("data-arrow-delegated","true"),a.addEventListener("click",async t=>{const y=t.target.closest(".WeekHeader__navArrow");if(y){t.stopPropagation(),y.style.cursor="pointer";const _=y.classList.contains("WeekHeader__navArrow--left")?"prev":"next";await s(_)}})),a.hasAttribute("data-card-delegated")||(a.setAttribute("data-card-delegated","true"),a.addEventListener("click",async t=>{if(t.target.closest(".action-item-icon"))return;const y=t.target.closest(".GoalCard__root[data-goal-id]");if(y){const _=y.getAttribute("data-goal-id"),f=c.flatMap(k=>k.goals).find(k=>String(k.id)===_);f&&B(f,y)}})),a.hasAttribute("data-action-delegated")||(a.setAttribute("data-action-delegated","true"),a.addEventListener("click",async t=>{if(!t.target.closest(".action-item-icon"))return;t.stopPropagation();const _=t.target.closest(".GoalCard__action-item");if(_){const f=_.getAttribute("data-action-item-id"),k=_.getAttribute("data-status")??"progress",G=_.getAttribute("data-goal-id");f&&G&&await P(parseInt(f,10),k,parseInt(G,10))}})),v&&w){q(w,c);const t=document.getElementById("summary-toggle-badge");t&&(t.addEventListener("click",()=>{F(w,t)}),t.style.cursor="pointer")}}function L(a,e,v=!1,n=""){const s=document.createElement("div");s.className=v?"WeekHeader__rootNew current-week":"WeekHeader__rootNew";let c="";return a&&(c+=`<i class="WeekHeader__navArrow WeekHeader__navArrow--left">${a}</i>`),c+=`<span class="WeekHeader__text">${e}</span>`,n&&(c+=`<i class="WeekHeader__navArrow WeekHeader__navArrow--right">${n}</i>`),s.innerHTML=c,s}function q(a,e){if(!e||e.length===0){a.innerHTML='<p class="empty-state">요약 데이터가 없습니다.</p>';return}Object.keys(S).forEach(n=>{const s=e.map(r=>{const m=r.goals.filter(g=>(g.goal_category||"etc")===n);let i=0,d=0,l=0;m.forEach(g=>{i+=g.start_revenue??0,d+=g.goal_revenue??0,l+=g.currentRevenue??0});const u=l-i,p=i>0?u/i*100:0,o=d>0?l/d*100:0;return{category:n,totalStartRevenue:i,totalGoalRevenue:d,totalCurrentRevenue:l,growthAmount:u,growthRate:p,achievementRate:o,hasData:m.length>0}});if(s.some(r=>r.hasData)){const r=document.createElement("div");r.className="summary-category-container",r.style.setProperty("--week-count",String(e.length)),r.style.gridTemplateColumns="repeat(3, 1fr)",e.forEach((m,i)=>{const d=document.createElement("div");d.className="week-column-new";const l=s[i],u=new Date(m.startDate),p=new Date(u);p.setDate(p.getDate()-7),p.setHours(0,0,0,0);let o=null;for(let g=0;g<e.length;g++){if(g===i)continue;const h=new Date(e[g].startDate);if(h.setHours(0,0,0,0),h.getTime()===p.getTime()){o=s[g];break}}if(l!=null&&l.hasData){const g={totalStartRevenue:l.totalStartRevenue,totalCurrentRevenue:l.totalCurrentRevenue,totalGoalRevenue:l.totalGoalRevenue,growthAmount:l.growthAmount,achievementRate:l.achievementRate},h=o?{totalStartRevenue:o.totalStartRevenue,totalCurrentRevenue:o.totalCurrentRevenue,totalGoalRevenue:o.totalGoalRevenue,growthAmount:o.growthAmount,achievementRate:o.achievementRate}:null,C=$(g,h,n,S[n]);d.appendChild(C)}r.appendChild(d)}),a.appendChild(r)}})}export{X as addActionItemInput,Z as addSelectedClient,ee as calculateGoalRevenueFromPercentage,ae as calculateStartRevenue,te as changeDatePickerMonth,se as clearAllClients,ne as clearSelectedClients,oe as closeDatePicker,re as closeGoalDetailModal,le as closeGoalModal,ie as closeGoalModalWrapper,x as createGoalCard,ce as createGoalRegisterContext,$ as createSummaryCard,de as exposeWeeklyGoalState,ue as getCurrentNavigationState,ge as getEditModeState,me as getSelectedClientIds,pe as goalRegisterState,P as handleActionItemStatusToggle,fe as handleGoalSubmit,Y as handleWeekNavigation,ve as initializeWeekNavigation,ye as initializeWeekNavigationForAll,ke as invalidateActionItemsCache,U as loadAllManagersGoals,_e as loadClientList,we as loadGoalManagerOptions,he as loadGoalSetting,R as loadGoalsWithRevenue,V as loadManagerGoals,Se as loadManagerTabs,Ce as openDatePicker,B as openGoalDetailModal,Ge as openGoalModal,We as openSummaryDetailModal,Le as recalculateStartRevenueForEdit,De as refreshWeekNavigation,Re as removeSelectedClient,Me as renderActionItemHTML,Ne as renderClientOptions,Ae as renderDatePicker,Ee as renderExistingActionItems,J as renderGoalCards,He as renderGoalDetailModal,Oe as renderGoalRegisterModal,Te as renderSelectedClients,Ie as renderSelectedClientsInRightPanel,q as renderSummarySection,be as resetActionItems,xe as resetGoalRegisterState,Be as saveActionMemo,Pe as selectDate,Fe as selectTodayDate,$e as setCurrentManagerTab,qe as setEditMode,ze as setEditModeState,je as setExternalState,Ue as setLoadManagerGoalsCallback,Ve as setupActionGlobals,Ye as setupActionItemEvents,Je as setupAllGoalEvents,Ke as setupGlobalContext,Qe as setupGoalFormEvents,Xe as setupGoalModalEvents,Ze as showActionItemMemoInput,ea as showToast,aa as switchManagerNavigation,ta as switchToAllManagersNavigation,sa as toggleActionItemStatus,na as toggleClientSelection,F as toggleSummarySection,oa as updateActionItemUI,ra as updateCategoryDropdownVisual,la as updateClientSelectCount,ia as updateHiddenInput,ca as weeklyGoalState};
