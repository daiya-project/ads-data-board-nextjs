---
description: Migration goal — vanilla TS to Next.js using _docs/MIGRATION_ANALYSIS.md and _reference source
alwaysApply: true
---

# Project Migration Context

## Goal

This project aims to **migrate the existing vanilla TypeScript application to Next.js** in a high-quality way. The migration is not a rewrite from scratch: it reuses and adapts the original behavior, structure, and business logic into the Next.js App Router and React patterns.

## Mandatory References

### 1. Migration analysis document

- **Path:** `_docs/MIGRATION_ANALYSIS.md`
- **Use:** Before designing or implementing migration work (new pages, features, state, or data flow), consult this document. It describes:
  - Current architecture (Feature-Sliced Design, features, shared modules).
  - State management (feature-local state, window globals, event bus, cache).
  - Routing and screen transitions.
  - Data flow and API usage.
  - Mapping from vanilla patterns to Next.js/React (Server/Client Components, Zustand, lib/api, etc.).

Use the analysis to keep behavior and domain boundaries aligned with the original app and to avoid inventing new patterns that conflict with it.

### 2. Reference source code

- **Path:** `_reference/` (e.g. `_reference/ts-ads/src/`)
- **Use:** The reference folder contains the **original vanilla TypeScript source**. When implementing a migrated feature or screen:
  - **Read the corresponding reference code** (same feature or shared module) to preserve business logic, validation, and data shapes.
  - **Reuse and adapt** that logic into the Next.js structure: `lib/api/` for data, `lib/` or `lib/logic/` for business logic, React components for UI, Zustand for client state where appropriate.
  - Do not copy-paste blindly; convert imperative/DOM-based code to React (components, hooks, Server/Client split) and follow project rules (e.g. `00-project-main.mdc`, `01-project-structure-rule.mdc`, `20-code-main.mdc`).

## Database schema (Supabase / Postgres)

- **This project’s schema:** New tables and views belong to the **`ads`** schema.
- **`public` schema:** Used by the pre-migration app. Tables in `public` are **legacy or reference**; in this project we are building new tables in `ads` (and using `shared` where applicable). Any code that targets the `public` schema is legacy or reference-only.
- **Schemas in use:** This project uses **only** the **`ads`** and **`shared`** schemas. New migrations and application code should reference `ads.*` and `shared.*` only, not `public.*`.

## Principles

- **Behavior parity:** Migrated screens and features should match original behavior and data semantics; use the analysis doc and reference code to verify.
- **Structure alignment:** Map original features and shared modules to the Next.js project structure (App Router, `_components/`, `lib/api/`, `lib/`, `types/`, `stores/`) as described in the migration analysis and project structure rules.
- **No unnecessary divergence:** Avoid introducing new architectures or libraries that are not in the analysis or project rules; prefer adapting reference code to the agreed stack (Next.js, React, Tailwind, Shadcn, Zustand, Supabase).

## Checklist

- [ ] Checked `_docs/MIGRATION_ANALYSIS.md` for the area being migrated?
- [ ] Used `_reference/` source for the same feature or module when implementing?
- [ ] Adapted logic to Next.js/React patterns (Server/Client, lib/api, components) instead of copying vanilla patterns?
- [ ] Preserved behavior and data semantics from the original app?
